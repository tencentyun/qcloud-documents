## Description
The POST Object API allows the user to upload a file (Object) to the specified Bucket in the form of a form. This operation requires the requester to have WRITE permission on the Bucket. All API parameters carried by the HTTP header are requested using form fields.

###Version

If version control is enabled for the bucket, the POST operation will automatically generate a unique version ID for the object to be added. COS uses the x-cos-version-id response header to return this ID in the response.
If you do not enable or paused version control in the target bucket, the version ID generated by COS is always null.

### Notes
1. WRITE permission to the Bucket is required;
2. If an Object with the same name already exists, the newly uploaded file will overwrite the original file and return “200 OK” if successful.

## Request

Request example:
```
POST / HTTP/1.1
Headers
Form
```

> Signature (see [Request Signature](https://cloud.tencent.com/document/product/436/7778) for details)


### Request Headers
#### Required header
The request operation requires the following mandatory request headers:

|Name|Description|Type| Required|
|:---|:-- |:---|:-- |
| Content-Length | HTTP request content length (bytes) defined in RFC 2616|String| Yes |

### Form Fields
|Name|Description|Type| Required|
|:---|:-- |:---|:-- |
| acl | File permissions. Inherit from the parent if it's left empty. See [PUT Object acl](https://cloud.tencent.com/document/product/436/7748) | String| No|
| Cache-Control, Content-Type, Content-Disposition, Content-Encoding, Expires | Header defined in RFC 2616, see [PUT Object](https://cloud.tencent.com/document/product/436/ 7749) | String| No|
| file|File content. It is used as the last field of the form |String| yes |
| key | The file name after uploading, using **${filename}** will be replaced. For example, a/b/${filename}, upload file a1.txt, then the final upload path is a/b/a1.txt | String| yes |
| success_action_redirect | If the setting takes effect first, return 303 and provide the Location header, at the end of the URL, add `bucket={bucket}&key={key}&etag={%22etag%22}` |String| No|
| success_action_status |Values: 200, 201, 204. Returns 204 by default. If you fill in success_action_redirect, this setting is ignored. |String| No|
| x-cos-meta- * | Customized information, which will be returned as Object metadata. Size limit: 2K | String| No|
| x-cos-storage-class | Sets the storage level of the Object. Values: STANDARD (default), STANDARD_IA| String | No |
| policy | Base64 encoding. Used for request checking, if the content of the request does not match the conditions specified by Policy, return 403 AccessDenied | String| No|
| x-cos-server-side-encryption | Specifies how the server is enabled for server-side encryption. Use COS master key encryption to fill in: AES256 | String | For encryption, yes |


#### Policy
##### Basic format
```json
{ "expiration": "2007-12-01T12:00:00.000Z",
  "conditions": [
    {"acl": "public-read" },
    {"bucket": "johnsmith" },
    ["starts-with", "$key", "user/eric/"],
  ]
}
```

##### Expiration
Set the timeout for this POST Policy, using ISO8601 GMT time, for example 2017-12-01T12:00:00.000Z.

##### Conditions Rules
| Type | Description |
| ---- | ---------------------------------------- |
| Exact match | Use `{"key": "value"}` or `["eq", "$key", "value"]`
| Prefix matching | Use `["starts-with", "$key", "value"]` to express, value can be left blank |
| Range matching | Use `["content-length-range", int1, int2]`, then the number of file bytes must be in the range of int1 and int2 |

##### Conditions Parameters
All parameters are optional. If they are not filled, they cannot be verified.

| Name | Description | Matching method |
|-------|------------------|  -----|
| acl | (Optional) File ACL attribute permission range| full, prefix |
| bucket | Specify the upload Bucket | Full |
| content-length-range | Specify the upload size range of the file | Scope |
| Five Standard Header | Cache-Control Content-Type Content-Disposition Content-Encoding Expires | Full, Prefix |
| key | object storage path | full, prefix |
| success_action_redirect | URL returned after successful upload | full, prefix |
| success_action_status | Status returned after successful upload | Complete |
| x-cos-credential | Format *<your-access-key-id>*/*<date>*/*<aws-region>*/*<aws-service>*/aws4_request | Complete |
| x-cos-date | UTC Time for ISO8601 | Complete |
| x-cos-meta-* | User-Defined Header | Full, Prefix |
| x-cos-* | Other AWS headers that need to be signed | Complete |

## Response
### Response Header
#### Common Response Header
The response uses common response headers. See [Common Response Header](https://cloud.tencent.com/document/product/436/7729).
#### API response headers
The response header specific data for this request operation is:

|Name|Description|Type|
|:---|:-- |:-- |
| ETag| Returns the MD5 algorithm checksum of the file. The value of ETag can be used to check if the Object is corrupted during the upload process |String|
| Location| If `success_action_redirect` is specified, the corresponding value is returned. If not specified, the complete path of the object is returned | String|
|x-cos-version-id|The version of the replicated object in the target bucket. |String|
|x-cos-server-side -encryption|If the object is stored by COS-managed server-side encryption, the response will contain the value of this header and the encryption algorithm used, AES256|string|

### Response body
|Node name (keyword)|Parent node|Description|Type|Required|
|:---|:-- |:--|:--|:--|
| PostResponse | None | Container for POST Object Results | Container |Yes |

The contents of the Container node PostResponse:

|Node name (keyword)|Parent node|Description|Type|Required|
|:---|:-- |:--|:--|:--|
| Location | PostResponse | The full path to the object. | String |Yes |
| Bucket | PostResponse | The bucket in which the object is located. | String |Yes |
|Key | PostResponse | Object key name | String |Yes |
| ETag | PostResponse | Etag content. | String |Yes |
### Error Codes
The following describes some error conditions that can occur with this request:

| Error Code | HTTP Status Code | Description |
| ---------- | --------- | ------------------ |
|InvalidDigest |400 Bad Request | If the user uploads a file with a Content-MD5 header, the COS will check whether the MD5 of the body is the same as the MD5 carried by the user. If it is inconsistent, it will return InvalidDigest |
|KeyTooLong |400 Bad Request | The custom header that starts with x-cos-meta when uploading files, the key and value of each custom header cannot add up to 4k, otherwise return KeyTooLong error |
|MissingContentLength | 411 Length Required | If the Content-Length header is not added when uploading the file, the error code will be returned |
|NoSuchBucket | 404 Not Found | If the Bucket where the Object you are trying to add does not exist, return a 404 Not Found error, error code: NoSuchBucket |
| EntityTooLarge | 400 Bad Request |If the added file is larger than 5G, it will return EntityTooLarge and return the error message `Your proposed upload exceeds the maximum allowed object size` |
| InvalidURI | 400 Bad Request | Object key length is limited to 850, if it exceeds 850, it will return InvalidURI |

For more information on COS error codes, or a list of all product errors, please see the [Error Codes](https://cloud.tencent.com/document/product/436/7730) documentation.

## Sample Code
### Request
```
POST / HTTP/1.1
Connection: keep-alive
Accept-Encoding: gzip, deflate
Accept: */*
User-Agent: python-requests/2.12.4
Host: xxxx-123456.cos.ap-guangzhou.myqcloud.com
Content-Length: 1352
Content-Type: multipart/form-data; boundary=e07f2a7876ae4755ae18d300807ad879

--e07f2a7876ae4755ae18d300807ad879
Content-Disposition: form-data; name="key"

a/${filename}
--e07f2a7876ae4755ae18d300807ad879
Content-Disposition: form-data; name="success_action_status"

201
--e07f2a7876ae4755ae18d300807ad879
Content-Disposition: form-data; name="Acl"

public-read
--e07f2a7876ae4755ae18d300807ad879
Content-Disposition: form-data; name="x-cos-storage-class"

STANDARD
--e07f2a7876ae4755ae18d300807ad879
Content-Disposition: form-data; name="Signature"

q-sign-algorithm=sha1&q-ak=AKIDZfbOAo7cllgPvF9cXFrJD0a1ICvR98JM&q-sign-time=1512983814;1512984814&q-key-time=1512983814;1512984814&q-url-param-list=&q-header-list=host&q-signature=2ffd2ae714e7445a8da000ec5d51771ff5056500
--e07f2a7876ae4755ae18d300807ad879
Content-Disposition: form-data; name="policy"

eyJjb25kaXRpb25zIjogW3siYnVja2V0IjogImtpdG1hbnMzdGVzdDEifSwgWyJjb250ZW50LWxlbmd0aC1yYW5nZSIsIDAsIDEwMDAwMDAwXSwgWyJzdGFydHMtd2l0aCIsICJ4LWNvcy1tZXRhLWJiIiwgIjEyIl1dLCAiZXhwaXJhdGlvbiI6ICIyMDQ3LTEyLTAxVDEyOjAwOjAwLjAwMFoifQ==
--e07f2a7876ae4755ae18d300807ad879
Content-Disposition: form-data; name="x-Cos-meta-bb"

124
--e07f2a7876ae4755ae18d300807ad879
Content-Disposition: form-data; name="key1"

1
--e07f2a7876ae4755ae18d300807ad879
Content-Disposition: form-data; name="file"; filename="empty:a"


--e07f2a7876ae4755ae18d300807ad879--
```

### Response
```
HTTP/1.1 201
Content-Type: application/xml
Content-Length: 232
Connection: keep-alive
Date: Mon, 11 Dec 2017 09:16:56 GMT
ETag: "d41d8cd98f00b204e9800998ecf8427e"
Location: http://xxxx-123456.cos.ap-guangzhou.myqcloud.com/a/empty:a
Server: tencent-cos
x-cos-request-id: NWEyZTRkMDZfMjQ4OGY3MGFfNTE4Yl81

<PostResponse>
        <Location>http://xxxx-123456.cos.ap-guangzhou.myqcloud.com/a/empty:a</Location>
        <Bucket>xxxx-123456</Bucket>
        <Key>a/empty:a</Key>
        <ETag>d41d8cd98f00b204e9800998ecf8427e</ETag>
</PostResponse>

```
