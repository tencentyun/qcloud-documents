## 设置读写模式
### 背景介绍
当业务系统升级、故障恢复、巡检演练等过程中，需要控制数据写入，以避免数据混乱。
>!设置成只读模式时将导致数据库不可写，可能造成业务异常，请谨慎操作。

### 操作步骤
1. 在赤兔管理台主界面，点击左侧菜单【实例管理】，进入实例管理界面。
2. 进入实例详情/set详情界面。 
非分布式实例设置读写模式在【实例详情】页面，分布式实例设置读写模式在【set详情】页面。
	- 对于非分布式实例：选择所需非分布式实例ID>【实例详情】，进入实例详情界面。
	- 对于分布式实例：选择所需分布式实例ID>【Set管理】>选择所需子SetID，进入set详情页面。
3. 查看读写模式的设置项，如需更改，点击右侧【设置读写模式】，系统弹出【设置Set读写模式】对话框。
4. 将【读写模式】设置成可写或只读，点击【确定】，系统进入任务详情页，可以查看实例的读写模式设置进度和结果。


## 设置扩缩容
### 非分布式实例扩（缩）容
####   背景介绍
当非分布式实例性能、容量不足以支撑业务需要时，可以通过扩容以扩展实例配置；当实例容量远超业务需要而形成浪费时，可通过缩容来缩减实例配置。
>!非分布式实例最大的可扩展配置为物理硬件配置，缩容时不能超过实例所有表空间和日志的占用空间。

#### 操作步骤
1. 在赤兔管理台主界面，点击左侧菜单【实例管理】，进入实例管理界面。
2. 点击需要扩/缩容的实例ID，点击【实例详情】进入实例详情页面。
3. 点击【规格】右侧【扩(缩)容】，系统弹出【扩(缩)容非分布式实例】对话框。
4. 输入需要扩(缩)容的实例设置、容灾设置和其他设置项（参考4.1.3新增set步骤3），点击【确定】，系统进入任务详情页，可以查看实例的扩/缩容设置进度和结果。

### 分布式实例扩（缩）容
#### 背景介绍
当非分布式实例性能、容量不足以支撑业务需要时，可以通过扩容以扩展实例配置；当实例容量远超业务需要而形成浪费时，可通过缩容来缩减实例配置。
分布式实例扩（缩）容指将现有TDSQL实例规格进行升级或降级，因分布式数据库是由多个节点组（Set）组成，因此，其实例升级有升级节点组（Set）和新增节点组（Set）两种方案。
>!实例升级过程中不会停止服务，但部分分片会发生若干秒的只读现象，建议在低峰期进行。

**升级节点组（Set）**
实例升级节点组（Set）也叫实例的垂直扩容，与非分布式实例升级方案类似。 
**操作步骤**
1. 在赤兔管理台主界面，点击左侧菜单【实例管理】，进入实例管理界面。
2. 选择需要扩/缩容的分布式实例ID，选择【Set管理】进入子实例管理页面。
3. 点击所需子Set【操作】栏下方【扩(缩)容】，进入子Set的【扩(缩)容非分布式实例】页面。
4. 输入需要扩(缩)容的实例设置、容灾设置和其他设置项，点击【保存】，系统进入详情页，可以查看实例的扩容/缩容进度和结果。

**新增节点组（Set）**
新增节点组（Set），也叫实例的水平扩容，即增加分片数量。
**操作步骤**
1. 在赤兔管理台主界面，点击左侧菜单【实例管理】，进入实例管理界面。
2. 选择需要扩/缩容的分布式实例ID > 选择【Set管理】进入子实例管理页面。
3. 点击【添加Set+】，系统弹出【添加Set到分布式实例】对话框。
4. 输入新增分片的机型规格、容灾设置和其他设置，点击【保存】，系统进入任务详情页，可以查看新增分片的进度和结果。

###  SET（水平扩容）
#### 背景介绍
新增SET，即增加分片数量 ，仅对分布式实例。
#### 操作步骤
1. 打开赤兔首页，点击左侧菜单【实例管理】，进入实例管理页。
2. 点击【实例ID】中的超链接，然后选择【Set管理】，进入Set管理页面。
3. 选择【添加Set+】，系统弹出【添加set到分布式实例】对话框。
	- 实例设置：
		-   指定扩容目标set的机型、规格。
		-   指定源set切分：扩容分片可以选择扩容的原set名称，以及要迁移的分片范围。默认会选择分片数最多的set，迁移二分之一的分片数迁移到新set。
	- 容灾设置：
	 -   容灾模式：指定扩容目标set容灾模式。
	 -   同步异步模式：指定扩容目标set同步模式。
	 -   主DB部署Zone：指定扩容目标sett主DB部署Zone。
	 -   备DB部署Zone：指定扩容目标set备DB部署Zone。
	 -   DB部署所在IDC：指定扩容目标set所在IDC。
	 -   主节点所在IDC：选择主节点部署所在IDC。
	 -   备节点所在IDC：选择备节点部署所在IDC。
	 -   资源独享标识：选"无"为公有云，选"独享标识"为指定资源独享。
	 -   服务器分配:选填。
	 -   IDC效验：默认开启，仅适用于独立部署版。
	 -   是否开启IPV6：默认不开启，仅适用于TCE3100版。
	 -   切换路由时间：
			 -   手工切换：新实例数据同步好数据好，手工触发切换路由
			 -   自动切换：新实例数据同步好数据好，自动触发切换路由
	-  其他设置：
		 -   指定扩容目标set的proxy是否保持同版本、db是否保持同版本、proxy和db推包速度。
4.  按照页面提示填写相关信息，点击"创建"进入任务流程页面，等待任务结束。
5.  如果选择手工切换，则在数据同步好之后，要点击路由切换按钮，完成路由切换。


## 主备切换
### 背景介绍
主备切换是将主机切换为备机，即将主节点更换为从节点。 
>!进行主备切换时可能导致机器连接中断，请确保数据库有重连机制。

### 操作步骤
1. 在赤兔管理台主界面，点击【实例管理】，进入实例管理界面。
2. 进入实例详情/set详情界面。 
非分布式实例设置主备切换在【实例详情】页面，分布式实例设置主备切换在【set详情】页面。
	- 对于非分布式实例：选择所需非分布式实例ID>【实例详情】，进入实例详情界面。
	- 对于分布式实例：选择所需分布式实例ID>【Set管理】>选择所需SetID，进入set详情页面。
3. 点击【DB节点】右侧【主备切换】，系统弹出【设置主备切换】对话框。
4. 选择需要进行切换的备机，并确认是否需要强制切换，点击【确定】，系统进入详情页，可以查看主机与备机切换进度和结果。

## 重做备机
### 背景介绍
重做备机是将原备机的数据删除，从其他DB机器上拉取全量数据重建备机节点，以恢复主从数据和主从关系。
>!重做备机可能影响系统业务层的读写分离功能，请确保数据库有重连机制。

### 操作步骤
1. 在赤兔管理台主界面，点击【实例管理】，进入实例管理界面。
2. 进入实例详情/set详情界面。
非分布式实例重做备机在【实例详情】页面，分布式实例重做备机在【set详情】页面。
- 对于非分布式实例：选择所需非分布式实例ID>【实例详情】，进入实例详情界面。
- 对于分布式实例：选择所需分布式实例ID>【Set管理】>选择所需SetID，进入set详情页面。
3. 确认是否需要修改主备同步方式（强同步/异步）。 如果没有剩余可用的备机，则需要在实例详情页的【数据复制方式（配置值）】设置成【异步】。
4. 点击【DB节点】右侧【重做备机】，系统弹出【重做备机】对话框。
5. 选择需要重做的备机，点击【重做备机】，系统进入任务详情页，可以查看重做备机的进度和结果。

## 添加备机
### 背景介绍
添加备机为实例添加新备机，并建立新备机与主机的主从数据和主从关系。
### 操作步骤
1. 添加新备机的设备资源，具体参见“3.1录入DB设备信息”。
2. 在赤兔管理台主界面，点击左侧菜单【实例管理】，进入实例管理界面。
3. 进入实例详情/set详情界面。 
非分布式实例添加备机在【实例详情】页面，分布式实例添加备机在【set详情】页面。
- 对于非分布式实例：选择所需非分布式实例ID>【实例详情】，进入实例详情界面。
- 对于分布式实例：选择所需分布式实例ID>【Set管理】>选择所需SetID，进入set详情页面。
4. 点击【DB节点】右侧【添加备机】，系统弹出【添加备机】对话框。
5. 选择新备机IP、同步模式、proxy/db保持同版本、proxy/db推包速度。
6. 点击【添加备机】，系统进入详情页，可以查看添加备机的进度和结果。

## 删除备机
### 操作步骤
1. 在赤兔管理台主界面，点击【实例管理】，进入实例管理界面。
2. 进入实例详情/set详情界面。
非分布式实例删除备机在【实例详情】页面，分布式实例删除备机在【set详情】页面。
- 对于非分布式实例：选择所需非分布式实例ID>【实例详情】，进入实例详情界面。
- 对于分布式实例：选择所需分布式实例ID>【Set管理】>选择所需SetID，进入set详情页面。
3. 点击【DB节点】右侧【删除备机】，系统弹出【删除备机】对话框。
4. 选择需要删除的备机，并确认是否需要删除备机进程，点击【删除备机】，系统进入任务详情页，可以查看备机删除的进度和结果。

## 延迟备机
### 背景介绍
延迟备机用于延迟时间到期后自动开始数据应用
### 操作步骤
1. 在赤兔管理台主界面，点击【实例管理】，进入实例管理界面。
2. 进入实例详情/set详情界面。非分布式实例延迟备机在【实例详情】页面，分布式实例延迟备机在【set详情】页面。
	-  对于非分布式实例：选择所需非分布式实例ID>【实例详情】，进入实例详情界面。
	-  对于分布式实例：选择所需分布式实例ID>【Set管理】>选择所需SetID，进入set详情页面。
3. 点击【DB节点】右侧【延迟备机】，系统弹出【延迟备机】对话框。
	- 【设置类型】:选择设置延迟备机或者删除延迟备机。
	- 【延迟备机】:选择需要延迟的备机。
	- 【延迟时间】:设置延迟时间，单位秒。
	- 【停止时间】:选择停止时间，可选。
>! 停止时间，备机从该时间点开始停止数据应用，如果是在当前时间之前，会立即停止。
4. 上述信息填写后，点击【设置延迟备机】，系统进入任务详情页，可以查看设置延迟备机的进度和结果。

## 设置数据复制方式
数据复制的同步方式有强同步、异步及同IDC异步，跨IDC强同步。
>!布式实例不同Set的同步模式设置为相同，以保持数据一致性。

### 操作步骤
1. 在赤兔管理台主界面，点击【实例管理】，进入实例管理界面。
2. 进入实例详情/set详情界面。
	- 对于非分布式实例：选择所需非分布式实例ID>【实例详情】，进入实例详情界面。
	- 对于分布式实例：选择所需分布式实例ID>【Set管理】>选择所需SetID，进入set详情页面。
3. 在数据复制方式菜单下，点击【设置数据同步模式/设置】，系统弹出【设置数据同步方式】对话框。
4. 选择同步模式设置和退化设置，点击【设置数据同步模式】，系统进入任务详情页，可以查看数据复制同步方式设置的进度和结果。


## 设置闲时超用模式
设置是否开启闲时超用模式，并设置CPU限制核数，其中限制核数单位为1代表0.01核。
### 操作步骤
1. 在赤兔管理台主界面，点击【实例管理】，进入实例管理界面。
2. 进入实例详情/set详情界面。
  -  对于非分布式实例：选择所需非分布式实例ID>【实例详情】，进入实例详情界面。
  -  对于分布式实例：选择所需分布式实例ID>【Set管理】>选择所需SetID，进入set详情页面。
3. 点击【CPU限制级别】右侧【设置CPU限制级别】，系统弹出对话框。
4. 设置是否开启闲时超用模式，并设置CPU限制核数，点击【设置CPU限制级别】，系统进入任务详情页，可以查看CPU限制级别设置的进度和结果。

## 设置免切
###    背景介绍
免切设置是用于当实例出现假死类故障时，避免主机与从机之间频繁切换，而导致业务系统和数据异常的设置。可设置手动免切、自动免切和降级免切三种方式。 
>?假死类故障一般在业务系统高负载时，无法快速应答业务和监控系统请求，但数据库节点和进程仍然存活且正常运行，只需要稍作等待即可恢复的情况。

>?如果一主多从强同步其中一个备机down了，原逻辑是备机宕机会自动配置300s免切；现在若备机down了，此时会检测主和另外备的强同步情况，如果能正常返回ACK满足要求，可以正常切换。


### 操作步骤
1.  在赤兔管理台主界面，点击【实例管理】，进入实例管理界面。
2.  进入实例详情界面。
    -   对于非分布式实例：选择所需非分布式实例ID>【实例详情】，进入实例详情界面。
    -   对于分布式实例：选择所需分布式实例ID>【Set管理】>选择所需SetID，进入set详情页面。
3.  在【容灾配置】菜单下，可设置主备机的手动免切，删除手动、自动免切及降级免切。
 -   **设置手动免切**
	 -   点击【手动免切设置】右侧【设置】，系统弹出【设置手动免切】对话框。
 -	**删除手动免切**
	 -	如需删除手动免切设置，点击【手动免切设置】右侧【删除手动免切】。
 -  **批量设置手动免切**
	 - 在赤兔管理台主界面，点击【实例管理】，进入实例管理界面。
	 - 	勾选需设置免切的实例，点击上方【设置手动免切】，系统弹出批量设置免切状态对话框。
	 - 	设置免切参数，点击【确定】退出对话框。
 -  **批量删除手动和自动免切**
		-  在赤兔管理台主界面，点击【实例管理】，进入实例管理界面。
		-  勾选需删除免切的实例，点击上方【删除免切】，系统弹出批量删除免切状态对话框。
		-  选择免切设置，点击【确定】退出对话框。
     a.  点击【手动免切设置】右侧【设置】，系统弹出【设置手动免切】对话框。
		 b.  设置免切参数，点击【确定】，系统进入详情页，可以查看免切设置的进度和结果。
      如需删除手动免切设置，点击【手动免切设置】右侧【删除手动免切】。
  -   **删除自动免切**
点击【自动免切设置】右侧【删除自动免切】，在弹出的【删除自动免切】对话框中输入验证码。
  -   **删除降级免切**
 点击【降级免切设置】右侧【删除降级免切】，在弹出的【删除降级免切】对话框中输入验证码。



## 设置IO隔离
### 背景介绍
用于对数据盘和日志盘的IO限制。
### 操作步骤
1. 在赤兔管理台主界面，点击左侧菜单【实例管理】，进入实例管理界面。
2. 进入实例详情界面。
 - 对于非分布式实例：选择所需非分布式实例ID>【实例详情】，进入实例详情界面。
 - 对于分布式实例：选择所需分布式实例ID>【Set管理】>选择所需SetID，进入set详情页面。
3. 在【IO隔离】菜单下，点击【设置IO隔离参数】，系统弹出设置IO隔离参数对话框。
4. 设置实例读写类型、子类型、类型值。
	-   读写类型：
		-   指定设备读字节/秒(read_bps_device) 
		-   指定设备读iops(read_iops_device) 
		-   指定设备写字节/秒(write_bps_device) 
		-   指定设备写iops(write_iops_device)
	- 	子类型：数据盘或者日志盘	。
	- 	类型值：IO限制数据值。
5. 点击对话框中【设置IO隔离参数】生效，设置结果可在【IO隔离】菜单栏下查看。


## 设置实例禁止删除
### 操作步骤
1. 在赤兔管理台主界面，点击【实例管理】，进入实例管理界面
2. 进入实例详情/set详情界面。
 - 对于非分布式实例：选择所需非分布式实例ID>【实例详情】，进入实例详情界面。
 - 对于分布式实例：选择所需分布式实例ID>【Set管理】>选择所需SetID，进入set详情页面。
3. 在【实例禁止删除】菜单栏下方，点击【设置实例禁止删除】，系统弹出实例保护属性对话框。
4. 选择实例禁止删除开启或者关闭，点击【设置实例禁止删除】设置实例禁止删除生效。

## 设置接入配置
>!本产品以（分布式）云数据库部署于TCE时，本功能不可用。

## 操作步骤
1. 在赤兔管理台主界面，点击【实例管理】，进入实例管理界面
2. 选择所需实例ID>【实例详情】，进入实例详情界面。
3. 在【接入配置】菜单栏下方，点击【添加接入层】，系统弹出添加接入层对话框。
4. 选择实例访问配置，点击【确定】添加接入层生效。

## 设置其他信息
### 背景介绍
在其他信息设置菜单，可显示实例初始化和OSS接口信息，设置此类信息通常用于排查问题。
操作步骤
1. 在赤兔管理台主界面，点击【实例管理】，进入实例管理界面
2. 进入实例详情/set详情界面。
 - 对于非分布式实例：选择所需非分布式实例ID>【实例详情】，进入实例详情界面。
 - 对于分布式实例：选择所需分布式实例ID>【Set管理】>选择所需SetID，进入set详情页面。
3. 在【其他信息】菜单下，可设置初始化账号和密码、数据订阅及网关审计数据入库及kafka topic id设置。
>!基于信息安全要求，请勿泄露初始账号和密码，也请勿告知租户端用户初始化账号和密码。

## SSL链路加密

### **背景介绍**
用于对SSL链路进行加密显示。

### **操作步骤**
1.  在赤兔管理台主界面，点击左侧菜单【实例管理】，进入实例管理界面。
2.  选择所需实例ID>【实例详情】，进入实例详情界面。
3.  在【安全管理配置】菜单下，点击SSL链路加密右侧【设置】，系统弹出设置SSL链路加密对话框。
4.  填写链路加密设置为开启/关闭，点击【确定】退出对话框。
>?验证步骤1：通过网关ＳSL连接DB实例查看ＳSL是否启用，连接语法为：`＂mysql -u［用户名］ -h［网关IP］ -P［网关端口］ -p　-ｃ \--ssl　＂`，连接后执行命令：`＂＼ｓ＂`，SSL显示为Cipher in use is AES256-GCM-SHA384即为开启。
验证步骤2：通过网关ＳSL连接DB实例，执行任意SQL，执行SQL的同时使用tcpdump在连接的Proxy机器proxy的端口抓包，eth０为网卡名按具体配置填写。Tcpdump语法：`＂tcpdump -i eth0 -s 0 -l -w - dst port \[proxy_port\] \| strings＂`
>验证步骤3：可以看到抓包出来结果SQL语句被加密。


## 强制生产binlog

### **背景介绍**
在某些情况下，用户需要强制主机进行binlog生产，赤兔界面新增设置强制主机生产binlog信息接口。
### **操作步骤**
1.	在赤兔管理台主界面，点击【实例管理】，进入实例管理界面。
2.	进入实例详情/set详情界面。
 + 对于非分布式实例：选择所需非分布式实例ID>【实例详情】，进入实例详情界面。
 + 对于分布式实例：选择所需分布式实例ID>【Set管理】>选择所需SetID，进入set详情页面。
3.	点击【强制主机生产Binlog】右侧【设置强制主机生产Binlog】，系统弹出强制主机生产Binlog对话框。
4.	选择设置类型，点击【设置】退出对话框。
