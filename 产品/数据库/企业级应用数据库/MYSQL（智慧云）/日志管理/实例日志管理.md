## 背景介绍
实例日志管理用于辅助DBA查询数据库具体性能，以确认实例是否存在慢查询（showlog）、主备切换的情况。可查看慢查询、proxy慢查询、主备切换、DBA日志、实例的控制台操作日志、网关日志和在线ddl任务详情。 
进入实例日志管理的路径为：在赤兔管理台主界面，点击左侧菜单【实例管理】>点击所选实例ID>【日志管理】。

## 慢查询日志
### 背景介绍
在日志中记录运行较慢的SQL语句，系统提供慢查询语句分析能力，并默认为开启。
慢查询相关术语定义如下：
- 慢查询：超过指定时间的SQL语句的查询。
- 慢查询语句：超过指定时间的SQL语句查询中的SQL语句。
- 慢查询分析：数据库管理员（DBA）对慢查询语句进行分析，并查找慢查询起因的过程。
慢查询时间和日志记录时间说明
- 慢查询时间（long_query_time）：默认配置为1s；即SQL查询超过1s的才被记录。
- 分析数据输出延迟：1~5分钟。
- 日志记录时长：30天，根据备份和日志设置周期决定。
>!如果实例频繁出现大量慢查询，可能为实例性能不足、SQL未优化或其他问题。

### 操作步骤
1. 在赤兔管理台主界面，点击左侧菜单【实例详情】>点击所选实例ID >【日志管理】，系统默认进入慢查询子界面。
2. 可通过【时间区间】、【抽象SQL】、【SetHost】、【客户端(账号/IP】，点击【查询】筛选符合条件的慢查询语句。
3. 可在列表中查看慢查询的相关参数项，点击【显示列】下拉框，可查看更多慢查询参数。各参数说明如下：
慢查询列表参数说明

| 参数                          | 解释                                           |
| --------------------------------- | -------------------------------------------------- |
| 校验值（checksum）                | 标示慢查询语句的序列数字，默认64bit                |
| 抽象后的慢查询语句（fingerprint） | 隐藏用户数据以后的慢查询语句                       |
| 数据库                            | 出现慢查询语句的数据库                             |
| 账号                              | 出现慢查询语句的账号                               |
| 最后执行时间（last_seen）         | 一定时间内，最后一次出现慢查询语句的时间           |
| 首次执行时间（first_seen）        | 一定时间内，第一次出现慢查询语句的时间             |
| 总次数（ts_cnt）                  | 一定时间内，慢查询语句出现的次数                   |
| 总次数占比                        | 一定时间内，慢查询语句占所有慢查询语句次数的占比   |
| 总时间（query_time_sum）          | 一定时间内，慢查询语句查询总耗时                   |
| 总时间占比                        | 一定时间内，慢查询语句查询总耗时的占比             |
| 平均时间（query_time_avg）        | 慢查询语句总时间除以总次数的平均时间               |
| 最小时间（query_time_min）        | 慢查询语句出现的最小时间；                         |
| 最大时间（query_time_max）        | 慢查询语句出现的最大时间                           |
| 总锁时间（lock_time_sum）         | 慢查询语句出现锁的总耗时                           |
| 总锁时间占比                      | 一定时间内，慢查询语句占所有慢查询语句锁时间的占比 |
| 平均锁时间（lock_time_avg）       | 慢查询语句总锁时间除以总锁次数的平均时间           |
| 最小锁时间（lock_time_min）       | 慢查询语句锁出现的最小时间                         |
| 最大锁时间（lock_time_max）       | 慢查询语句锁出现的最大时间                         |
| 发送行数（Rows_sent_sum）         | 该条慢查询语句发送的数据行数总和                   |
| 扫描行数（Rows_examined_sum）     | 该条慢查询语句扫描的数据行数总和                   |

## Proxy慢查询日志
### 操作步骤
1. 在赤兔管理台主界面，点击左侧菜单【实例详情】>点击所选实例ID >【日志管理】 > 【Proxy慢查询日志】，系统进入Proxy慢查询日志子界面。
2. 可通过【时间区间】筛选符合条件的慢查询语句，查看和操作方式与慢查询日志类似，具体参见“11.2.1慢查询日志”。

## 主备切换日志
### 背景介绍
可查看主机与备机自动切换、手动切换的日志记录。
>!如果实例频繁的出现大量主备切换，可能为实例性能不足、SQL未优化或其他问题。
### 操作步骤
1. 在赤兔管理台主界面，点击左侧菜单【实例详情】>点击所选实例ID >【日志管理】>【主备切换】，进入主备切换子界面。
2. 可在列表中查看手动及自动的主备切换日志记录，可通过【时间区间】筛选符合条件的日志记录。
3. 点击所需日志的【查看切换原因】，可进入详情页查看主备切换的详细日志信息。

## 创建DBA日志
### 背景介绍
为便于DBA手动记录日志信息，并进行DBA日志的记录和查看。 
### 操作步骤
1. 在赤兔管理台主界面，点击左侧菜单【实例详情】>点击所选实例ID >【日志管理】>【DBA日志】，进入DBA日志子界面。
2. 点击列表上方【创建日志】，系统弹出【创建日志】对话框。
3. 在【日志】框中输入需要记录的日志内容，点击【保存】，保存并退出对话框，列表中将显示创建的DBA日志信息。
 - 选择所需日志内容，点击右侧【修改】，可修改日志信息。
 - 选择所需日志内容，点击右侧【删除】，可删除日志信息。

## 控制台操作日志
### 背景介绍
用于记录管理员对赤兔管理台的相关实例操作信息，并通过任务状态可查看任务执行详情。
### 操作步骤
1. 在赤兔管理台主界面，点击左侧菜单【实例详情】>点击所选实例ID>【日志管理】>【控制台操作日志】，进入控制台操作日志子界面。
2. 可在列表中查看管理员对控制台的实例操作日志记录，可通过模糊查询查找符合条件的日志记录。
 - 如需查看日志详细信息，点击所需日志【任务状态】，可查看相关任务执行的详细日志信息。
 - 如需导出，点击右上方【导出】，可导出Ms-Excel、CSV格式的当前日志列表信息。
 - 如需刷新列表，点击右上方【刷新】，可实时刷新当前列表信息。

## 网关日志
可查看实例的网关日志信息。 
### 操作步骤
1. 在赤兔管理台主界面，点击左侧菜单【实例详情】>点击所选实例ID>【日志管理】>【网关日志】，进入网关日志子界面。
2. 可在列表中查看网关日志记录，可通过【时间区间】点击【KIBANA查询】查找符合条件的日志记录。
 - 如需导出，点击右上方【导出】，可导出Ms-Excel、CSV格式的当前日志列表信息。
>?本功能会生产大量SQL日志，需要额外日志存储服务方可正常使用；您需要自己安装Elasticsearch和Kibana 5.6.4，并在“集群管理>集群设置”配置Elasticsearch和Kibana接口。 相关责任请参考《专有云数据库产品使用许可协议》第4章。

## 在线ddl任务详情
可查看实例的在线ddl任务详情日志 。
### 操作步骤
1. 在赤兔管理台主界面，点击左侧菜单【实例详情】>点击所选实例ID>【日志管理】>【在线ddl任务详情】，进入在线ddl任务详情子界面。
2. 可在列表中查看在线ddl任务记录，可通过【时间区间】或模糊查询查找符合条件的日志记录。
 - 如需导出，点击右上方【导出】，可导出Ms-Excel、CSV格式的当前日志列表信息。
 - 如需刷新列表，点击右上方【刷新】，可实时刷新当前列表信息。
