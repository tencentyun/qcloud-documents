## 准备工作

1. 开通腾讯云账号并通过实名认证，有关实名认证的更多问题请参考 [实名认证基本介绍](https://cloud.tencent.com/document/product/378/3629)；
2. 开通 CDN/ECDN 服务；
腾讯云 CDN 支持中国境内和中国境外两个服务区域，目前默认提供按流量小时计费方式。有关计费规则的更多说明，请参考 [计费说明](https://cloud.tencent.com/document/product/228/2949)。
勾选统一服务条款后，单击开通服务，即可成功开通并开始使用 CDN/ECDN 服务。
![](https://qcloudimg.tencent-cloud.cn/raw/271c328c6b39a49c91790d4ae5043d97.png)
3. 已有一个自有域名和可访问的站点；


## 从零开始配置 CDN/ECDN 域名
### 第一步：添加域名
1. 登录 [CDN 控制台](https://console.cloud.tencent.com/cdn)；
2. 单击左侧菜单内的**域名管理**，进入域名管理列表；
3. 单击**添加域名**，添加一个新域名；
![](https://qcloudimg.tencent-cloud.cn/raw/7b2e10a5dfb8f3f619ba9901d8b85bd0.png)
4. 配置加速域名基础信息：
![](https://qcloudimg.tencent-cloud.cn/raw/a3098a98bc764edff1789a70c11f85d4.png)

|配置项	|说明|
|--|--|
|加速区域|您可以根据需求选择合适的加速区域：<br>**中国境内：**所有用户均使用腾讯云中国境内节点就近提供加速服务；选择该加速区域时，加速域名需为**已备案域名**；<br>**中国境外：**所有用户均使用腾讯云中国境外节点就近提供加速服务，包括中国香港、中国澳门、中国台湾等地区；选择该区域时，对加速域名**备案不做要求**；<br>**全球：**所有用户均由腾讯云全球节点提供就近服务，选择该加速区域时，加速域名需为**已备案域名**。<br><br>**注意：**<br>1. 根据您的加速区域，在源站配置时建议源站设立位置与区域相同，例如加速中国境内，源站需设置在中国境内，如果设置在中国香港或其他境外区域，可能因存在跨境访问出现回源失败、回源速度慢等情况。如果您的加速区域为全球，可以在添加域名后，在域名配置中为源站分别设置境内、境外独立的区域源站配置。<br>2. 不同加速区域的计费策略不一样，详情请参考 [CDN 计费策略](https://cloud.tencent.com/document/product/228/2949) 和 [ECDN 计费策略](https://cloud.tencent.com/document/product/228/70927)；<br>3. 如果您购买了区域流量包，请注意您的访问用户分布，区域流量包无法抵扣跨区域产生的流量，例如：购买了北美区域500GB流量包，仅可以抵扣访问至北美节点的用户产生的流量消耗，如果用户访问至南美节点产生的流量无法抵扣。|
|加速域名|**域名长度：**<br>加速域名长度不超过81字符；<br><br>**域名备案/合规要求：**<br>1. 如果加速区域为中国境内、全球加速，域名需要已经在工信部进行过备案；如果加速区域为境外，域名可以不需要备案；<br>2. 域名备案同步有一定的延迟，预计需1 - 2个小时，请您在备案完成后等待1 - 2个小时后再重试添加域名；<br>3. 接入 CDN 的加速内容需符合国家相关法律法规要求，若域名`*.example.com`、`*.a.example.com`、`b.a.example.com`同时接入 CDN，域名`b.a.example.com`因存在违规内容导致被封禁，则匹配该域名的`*.example.com`、`*.a.example.com`、`b.a.example.com`将全部被封禁。<br><br>**域名格式要求：**<br>1. 支持接入域名为`example.com`、`a.b.example.com` 等形式域名，单域名接入后，当前加速配置仅针对该域名生效，例如：接入域名为`example.com`，用户仅访问`example.com`有加速效果，若访问`www.example.com`或`m.example.com`没有加速效果，需要单独接入 CDN 加速后生效。<br>2. 支持含下划线的域名或中文域名转 punycode 码接入，中文域名需先以中文形式备案。<br><br>**泛域名格式要求：**<br>1. 支持接入`*.example.com`、`*.a.example.com`等形式的泛域名，接入泛域名后，暂不支持其子域名或二级泛域名在其他账号中接入；例如：接入泛域名为`*.example.com`，用户访问域名`a.example.com`匹配该泛域名，按照该泛域名配置加速；用户访问域名`example.com`不匹配该泛域名，不具有加速效果;<br>2. 在同一账号下，允许接入多层嵌套域名，如：`*.example.com`、`*.path.example.com`、`a.path.example.com`在同一账号下允许同时接入，域名配置、流量统计可区分优先级进行统计，匹配越精准优先级越高，例如：`a.path.example.com`访问将匹配`a.path.example.com`的域名配置，`b.path.example.com`访问将匹配`*.path.example.com`的域名配置，`c.example.com`访问将匹配`*.example.com`的配置，流量统计同理。<br>3. 如果您当前需接入的泛域名已包含的子域名已在其他账号下接入，需在对应账号下删除对应的子域名后，方可在当前账号下接入，例如：A账号已接入域名`a.example.com`，B账号如需接入`*.example.com`，因为`*.example.com`已包含子域名`a.example.com`，需先删除A账号下的`a.example.com`后方可在B账号下接入`*.example.com`；<br><br>**域名归属校验：**<br>当您的域名账号符合以下条件时，需进行域名归属校验，校验方式可参考 [域名归属权验证](https://cloud.tencent.com/document/product/228/61702)：<br>1. 域名首次接入时，例如：`a.example.com`；该域名接入后，同级域名及次级域名如`b.example.com`视为已有权限域名，默认可接入，无需校验。但上级域名如`example.com`接入仍需校验；<br>2. 子域名已在其他账号下接入时，需进行域名归属校验验证当前域名归属权，如验证通过，可通过取回域名接入当前账号；<br>3. 同级泛域名接入时，需校验，例如：`a.example.com`已接入，`*.example.com`接入时仍需校验，`*.a.example.com`属于次级泛域名，可免校验接入。|
|加速类型|加速类型主要分为 CDN 静态加速和 ECDN 全站加速两大类，您可以根据您当前文件的类型，选择合适的加速类型：<br><br>**注意：**<br>1. CDN 和 ECDN 分别采用不同的计费方式，其中 CDN 流量包仅适用于抵扣内容分发网络 CDN 产生的流量费用，不适用全站加速网络 ECDN。若需要了解更详细的对比和计费价格，请查看 [产品文档](https://cloud.tencent.com/document/product/228/43827)。<br>2. 当前部分特殊情况下暂不支持用户切换加速类型，请根据您的业务谨慎选择适合的加速类型，配置后如需修改，可删除域名后重新添加。<br><br>**内容分发网络CDN：**<br>适用于静态资源加速，静态资源指假如不同用户多次访问某一资源时，源站会返回相同内容。例如：html、css 和 js 文件、图片、视频、软件安装包、apk 文件、压缩包文件等。<br>您可以选择如下细分场景的加速类型，获得最优的加速效果：<br>**CDN 网页小文件：**适用于电商、网站、UGC 社区等以小型静态资源（如网页样式、图片和小文件）为主的业务场景。<br>**CDN 下载大文件：**适用于较大文件，如游戏安装包、应用更新、应用程序包下载等业务场景。<br>**CDN 音视频点播：**适用于在线音视频点播等音视频文件的点播加速业务场景。<br><br>**ECDN 全站加速：**<br>适用于动态资源加速，动态资源指假如不同用户多次访问某一资源时，源站会返回不同内容。 例如：API 接口、.jsp、.asp、.php、.perl 和 .cgi 文件等。<br> 您可以选择如下细分场景的加速类型，获得最优的加速效果：<br>**ECDN 动静加速：**适用于各类网站首页等动静态数据相融合的业务场景。<br>**ECDN 动态加速：**适用于账号登录、订单交易、API调用、实时查询等场景。|
|IPV6 访问| 默认为关闭，开启后，当用户的客户端使用 IPV6 协议发起请求时，CDN 支持通过 IPv6 协议访问 CDN 节点。域名添加后，可自助开启/关闭此开关。<br><br>**注意：<br>**仅中国境内支持 IPv6 访问。若域名的加速区域为全球，则开启 IPv6 访问开关后，仅中国境内生效。若域名的加速区域为中国境外，则不可开启。|
|标签| 标签用于从不同维度对资源分类管理。如现有标签不符合您的要求，请前往控制台 [管理标签](https://console.cloud.tencent.com/tag/taglist )。<br>1. 最多可添加 50 个标签；<br>2. 仅支持选择存量标签（标签控制台⾥已经添加的标签）；<br>3. 添加标签中标签键和标签值均为必选。|

5. 配置源站基础信息
源站配置可选源站类型包括自有源、COS 源、第三方对象存储三种，您可以根据自己的需求，设置合适的源站，各类型源站的配置方法如下：
当您的源站为自有源时，例如：自有服务器或 CVM 服务器资源，可选择源站类型为自有源，配置内容如下：
![](https://qcloudimg.tencent-cloud.cn/raw/a84324b1ebb5360d08a1d31254a69216.png)

|配置项	|说明|
|--|--|
|回源协议|**HTTP：**回源请求使用 HTTP 请求，如未自定义源站端口的情况下，默认使用80端口回源，请确保源站的80端口为放通状态；<br>**HTTPS：**回源请求使用 HTTPS 请求，如未自定义源站端口的情况下，默认使用443端口回源，请确保源站的443端口为放通状态；部分平台当前暂时未开放自定义 HTTPS 回源端口。<br>**协议跟随：**按照用户访问的请求协议回源，例如：当用户访问为 HTTPS 请求时，即使用 HTTPS 请求回源；当回源协议为协议跟随时，无法自定义指定回源端口，以避免部分请求回源失败。|
|源站地址|源站地址允许用户填写回源地址、自定义端口、源站权重：<br>**源站地址：** 支持输入域名或 IP 地址，最多支持输入50个；<br>**自定义端口：**用户指定回源使用的访问端口，如果您的源站未修改访问端口号，可无需填写，CDN 将根据回源协议使用默认端口回源；<br>**权重：**当配置有多个源站时，可以为每个源站划分权重，CDN 回源时将按照权重轮询回源。<br><br>**注意：**<br>1. 源站地址不能与加速域名相同，或者是 A 域名回源B域名，再添加 B 域名回源 A 域名的情况，否则会造成解析循环导致访问错误；<br>2. 如果您的 COS 源或第三方对象存储访问为公开读写，您也可以选择源站类型为自有源，填写 COS 源地址或第三方对象存储地址回源。|


当您的源站为 COS 源时，可选择源站类型为 COS 源，配置内容如下：
![](https://qcloudimg.tencent-cloud.cn/raw/1a4a12932ee7c4d18b103c9802382c09.png)

|配置项	|说明|
|--|--|
|回源协议|**HTTP：**回 COS 源请求使用HTTP请求；<br>**HTTPS：**回 COS 源请求使用 HTTPS 请求，COS 源默认支持 HTTPS 访问，建议选择HTTPS 回源；<br>**协议跟随：**按照用户访问的请求协议回COS源访问。|
|源站地址|如果源站为 COS 源的情况下，CDN 支持通过下拉选择作为源站的腾讯云对象存储 COS 的 bucket 名称，可通过模糊搜索进行筛选。<br>1. 首次添加 bucket 时，需要点击添加授权服务，授权 CDN 对该 bucket 的访问权限。![](https://qcloudimg.tencent-cloud.cn/raw/14371bfe556e6e5d369461069708aebd.png)<br>![](https://qcloudimg.tencent-cloud.cn/raw/0c3d4dd9bacab9e34c8082373155cf3e.png)<br>勾选同意授权后，单击**确定**，即可完成授权；<br>2.COS 源的 bucket 地址分为默认域名、静态网站域名、全球加速域名三种；<br>**默认域名：**默认 bucket 访问域名，该域名可直接用于访问该存储桶；<br>**静态网站域名：**如果当前 bucket 已开启静态网站配置，请使用该域名作为源站地址，否则可能导致静态网站配置失效；<br>**全球加速域名：**如果您当前的 bucket 已开启全球加速，请使用该域名作为回源地址，否则可能导致 bucket 的全球加速配置失效。<br><br>**注意：**<br>1. 如果您的存储桶配置了跨域规则，请同步在 CDN 的 HTTP 响应头内配置相同的跨域规则，否则可能导致访问跨域问题；<br> 2. 当前源站类型为 COS 源时，暂时仅允许添加一个源站。|
|私有存储桶访问|默认为关闭，当您的 COS 存储桶访问权限为私有读写时，请同步开启私有存储桶访问，CDN 在回源时，将自动生成有效的访问密钥回源请求文件；如果您的 COS 存储桶访问权限为私有写公有读、公有读写时，不需要开启该功能。|

当您的源站为第三方对象存储且开启了私有读写访问时，可选择源站类型为第三方对象存储，配置内容如下：
![](https://qcloudimg.tencent-cloud.cn/raw/8f7a535885857381c420fe467d2bdac2.png)

|配置项	|说明|
|--|--|
|厂商来源|第三方对象存储已支持选择 AWS S3、阿里云 OSS、华为 OBS、七牛云 kodo；其中华为 OBS、七牛云 kodo 仍然在灰度测试阶段，如您有需要使用，可以联系腾讯云工程师进行开通。|
|回源协议|您可以根据第三方对象存储的访问协议选择回源协议：<br>**HTTP：**回第三方对象存储请求使用 HTTP 请求，使用默认80端口回源；<br>**HTTPS：**回第三方对象存储请求使用 HTTPS 请求，使用默认443端口回源。|
|源站地址|请填写第三方对象存储可用的访问地址，CDN 对该地址格式没有严格限制，请确保地址可以访问，域名地址格式可参照如下：<br>**AWS S3：**`my-bucket.s3.ap-east-1.amazonaws.com`；<br>**阿里云 OSS：**`my-bucket.oss-cn-beijing.aliyuncs.com`；<br>**华为云 OBS：**`my-bucket.obs.cn-east-3.myhuaweicloud.com`；<br>**七牛云 kodo：**自定义访问域名，无固定格式。|
|私有存储桶访问|如果您的第三方对象存储访问权限为私有读写，请同步开启私有存储桶访问，开启后，您还需要单击下方的密钥填写，填写相应的访问密钥信息；<br>![](https://qcloudimg.tencent-cloud.cn/raw/c0c76ecbe31ace3f61534c34bcc4278b.png)|

6.配置完后，点击添加域名，进入下一步。

### 第二步：推荐配置
添加完域名后，您可以在推荐配置中，按照不同的加速类型，从提升资源命中率、提升访问性能、防止费用超额、提升访问安全四个维度来配置您的 CDN，以实现最佳的加速效果。
![](https://qcloudimg.tencent-cloud.cn/raw/f94b4815357ee52f8fdc47f1778df808.png)
如果您暂不需要进行推荐配置，可点击返回域名管理，返回当前域名列表页或点击跳过，下一步，进入第三步配置 Cname 页面。
推荐配置中默认为您提供了推荐配置项以及推荐配置内容，您可以根据实际需要进行修改，点击提交配置后，将提交所有配置并进入下一步。

#### 2.1 提升资源命中率

|推荐配置项|	推荐配置的加速类型|	推荐配置|
|--|--|--|
|[节点缓存过期配置](https://cloud.tencent.com/document/product/228/47672)|	CDN 网页小文件/CDN 大文件下载/CDN 音视频点播/ECDN 动静加速|对不常更新的图片、JS等内容，可设置较长的缓存时间，以提高节点的资源命中率；对动态文件一律不缓存。<br><br>**注意：**<br>如果您的源站资源更新后需要立刻更新CDN节点缓存，可使用缓存刷新功能来主动更新CDN节点未过期的文件，更多请参考：[缓存刷新](https://cloud.tencent.com/document/product/228/6299)<br>**推荐可配置（按照规则顺序，规则2优先级需高于规则1）：**<br>1. 全部文件缓存30天；<br>文件后缀包括 php/jsp/asp/aspx 的文件类型一律不缓存。|
|[缓存键规则配置](https://cloud.tencent.com/document/product/228/47671)	|CDN 网页小文件/CDN 大文件下载/CDN 音视频点播/ECDN 动静加速	|CDN 节点可按照用户请求 URL 的？后参数区分资源版本，如果当前资源未通过？后参数来区分版本，忽略？后参数，可以有效提高资源的命中率。<br>**推荐配置：**<br>1. 当前资源如果通过？参数进行了不同版本区分，建议不忽略参数或保留指定参数；<br>2. 针对未通过？后参数区分版本的资源，建议默认开启忽略参数配置。
|[浏览器缓存过期配置](https://cloud.tencent.com/document/product/228/50114)|	CDN 网页小文件/ECDN 动静加速	|浏览器缓存规则可将不常更新的文件类型缓存在用户浏览器上以提高用户的资源响应速度。<br>**推荐配置：**<br>指定不常更新的文件后缀或文件目录设置浏览器缓存时间，例如：文件后缀包括 jpg/png/gif/bmp/svg/webp 等图片文件，浏览器缓存时间为1小时。|


#### 2.2 提升访问性能

|推荐配置项|	推荐配置的加速类型	|推荐配置|
|--|--|--|
|[节点缓存过期配置](https://cloud.tencent.com/document/product/228/47672)|	ECDN 动态加速|	对于动态加速类型，如果在节点内缓存文件，可能导致访问出错或无法登录等情况。因此，在 ECDN 动态加速中，建议不缓存文件。<br>**推荐配置：**全部文件设置为不缓存。|
|[智能压缩配置](https://cloud.tencent.com/document/product/228/41736)|CDN网页小文件/ECDN动静加速	|通过智能压缩配置，CDN 在返回内容时会按照设定规则对资源进行 Gzip 、 Brotli 压缩，有效减少传输内容大小，节省开销。<br>**推荐配置：**<br>CDN 会默认为后缀 .js、.html、.css、.xml、.json、.shtml、.htm，大小为 256Byte - 2MB 范围内的资源开启 Gzip 压缩。您可以按需添加文件类型配置。|
|[分片回源配置](https://cloud.tencent.com/document/product/228/7184)	|CDN 大文件下载/CDN 音视频点播|	如果您的文件以静态大文件为主，开启分片回源后，针对回源的资源请求，腾讯云将通过分片请求的方式回源，能够帮助提升回源文件响应速度，提升大文件的分发效率。<br>**推荐配置：<br>**如果您的源站支持 range 请求，当您的文件大小大于4M时，推荐可开启分片回源。|
|[回源301/302跟随](https://cloud.tencent.com/document/product/228/7183)	|CDN 网页小文件/ECDN 动静加速	|开启301/302跟随后，针对源站返回的301/302状态码，腾讯云 CDN 节点将主动跟随跳转，直至获取到对应的资源文件，无需用户端自行跳转请求，可以减少返回链路耗时，提高响应速度。<br>**推荐配置：**<br>在存在多链路跳转的情况下推荐开启。|
|[视频拖拽配置](https://cloud.tencent.com/document/product/228/8111)	|CDN 音视频点播	|视频拖拽主要产生于视频点播场景中，开启此配置后，当用户拖拽播放进度时，各节点可直接响应视频拖拽请求。开启视频拖拽后，缓存键规则需同步配置为全部忽略参数<br>**推荐配置：**<br>视频点播场景下推荐开启。|

#### 2.3 防止费用超额
|推荐配置项	|推荐配置的加速类型	|推荐配置|
|--|--|--|
|[用量封顶配置](https://cloud.tencent.com/document/product/228/41733)	|所有加速类型	|用量封顶配置可以让用户自行根据自己的费用承受能力，以及当前业务量的预估，设定用量封顶告警以及对应的处置措施。<br>**推荐配置：**<br>开启用量封顶配置，按照实际用量需求配置用量封顶规则。|

#### 2.4 提升访问安全性
|推荐配置项	|推荐配置的加速类型	|推荐配置|
|--|--|--|
|[HTTPS 配置](https://cloud.tencent.com/document/product/228/41685)|	所有加速类型	|HTTPS 传输是一种加密可靠的传输协议手段，可有效保护您的传输数据安全性，如果您的网站已支持 HTTPS 访问，建议配置 HTTPS 证书。|
|[IP 访问限频配置	]()|所有加速类型	|通过 IP 访问限频配置，可一定程度上防范单一用户对资源、接口的恶意访问，您可以根据实际需求调整限频配置值。请注意，IP访问限频无法防范 DDoS 攻击。<br>**推荐配置：**<br>建议开启，可根据网站实际访问量进行请求限频。|

### 第三步：配置 CNAME

#### 如何配置 CNAME
![](https://qcloudimg.tencent-cloud.cn/raw/629dee65a6809b53e910d6a764a7e45c.png)
添加域名后，您还需要配置 CNAME 才能使加速生效。我们为您提供了两种配置 CNAME 的方式，详情请见 [配置 CNAME](https://cloud.tencent.com/document/product/228/3121)。

#### 如何验证 CNAME 是否生效
1. 在配置完成 CNAME 后，您可以在添加域名的第三步中，单击验证 CNAME 状态，查看当前域名 CNAME 是否生效，如果生效状态显示为已生效，则当前 CNAME 解析已正确生效，域名已启动 CDN 加速，如果当前生效状态未生效，需检查当前是否已完成 CNAME 配置，如果确认当前 CNAME 已正确配置，可能是当前解析生效延迟问题，您也可以选择用第3种方式进行验证。
![](https://qcloudimg.tencent-cloud.cn/raw/468e8395cbf14923afe41df096b8da2c.png)
2. 您可以在控制台的域名管理列表内查看，如果域名的 CNAME 解析已有正确解析提示，表示当前 CDN 域名加速已生效。**如果有两条 CNAME 解析的情况下，其中一条生效即可。**
![](https://qcloudimg.tencent-cloud.cn/raw/2183b758f9f8618b241e68c7797a527f.png)
3. 您也可以使用 nslookup 或 dig 命令来查看当前域名的解析生效状态。如果您的系统为windows系统，在window系统中打开cmd运行程序，以域名 `www.test.com`为例，您可以在 cmd 内运行：`nslookup -qt=cname www.test.com`，根据运行的解析结果内，可以查看该域名的 CNAME 信息，如果与腾讯云 CDN 提供的 CNAME 地址一致，即当前 CDN 加速已生效。
<br>
<img src="https://qcloudimg.tencent-cloud.cn/raw/8d744fb4485d1c61c412c645b36de419.png" width="70%">
<br>
如果您的系统为 Mac 系统或 Linux 系统，可以使用 dig 命令进行验证，以域名`www.test.com`为例，您可以在终端内运行命令：`dig www.test.com`，根据运行的解析结果内，可以查看该域名的 CNAME 信息，如果与腾讯云 CDN 提供的 CNAME 地址一致，即当前的 CDN 加速已生效。
<br>
<img src="https://qcloudimg.tencent-cloud.cn/raw/c04e0f6a20ebb490dd28e9378995f066.png" width="70%">
<br>

## 了解缓存、刷新、预热相关概念

1. 添加域名后，您可以根据自身的文件类型配置 CDN 缓存，CDN 缓存可以帮助您将静态文件缓存于边缘节点内，以更快地响应用户的文件请求，减少回源流量。详情请参见 [节点缓存过期配置](https://cloud.tencent.com/document/product/228/47672)。
2. 缓存刷新主要应用于用户文件已被节点缓存，有新文件发布或文件违规的情况下，由用户主动触发缓存刷新，删除节点内的缓存资源。详情请参见 [缓存刷新](https://cloud.tencent.com/document/product/228/6299)。
3. 缓存预热主要应用于用户有大文件或热点文件访问时，可以通过预热将文件提前缓存至腾讯云 CDN 节点内，避免用户访问时需要回源访问，可以有效减少回源流量，同时提升用户的访问体验。详情请参见 [缓存预热](https://cloud.tencent.com/document/product/228/40273)。

## 常见问题

1. `example.com`的域名接入后，`www.example.com`有加速效果吗？
没有，`example.com`和`www.example.com`分别属于两个域名，需要在控制台上全部接入才会有 CDN 加速效果。

2. `*.example.com`的域名接入后，`example.com`有加速效果吗？
没有，若您添加了`*.example.com`，只能支持类似`a.example.com`及`a.b.example.com`域名的加速，若`example.com`域名也需要接入 CDN 加速，您需要单独添加`example.com`域名。
