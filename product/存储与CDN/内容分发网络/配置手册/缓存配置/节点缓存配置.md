节点缓存过期配置已全面升级，高级模式支持更多精细化配置。了解更多详情，请前往 [节点缓存过期配置（新）](https://cloud.tencent.com/document/product/228/47672)。 

## 配置场景
腾讯云 CDN 缓存资源为触发式，当用户发起针对某资源的访问，若请求触达的 CDN 节点未缓存该资源，则回用户源站拉取资源，成功拉取到资源（2XX状态码）后，在节点进行缓存并返回给用户。

您无法直接对 CDN 节点上缓存的资源进行管理，若担心源站资源可能发生变化而 CDN 节点仍缓存旧资源返回给用户，可通过配置节点缓存规则来进行一定程度的控制。

每一个 CDN 节点上的缓存资源都有“过期时间”的概念，若请求到的缓存资源已到期，即便节点仍有缓存，也会判定为无效，进行再次回源拉取。节点缓存规则配置支持指定某类型、某目录、路径的资源在节点的缓存过期时间，可根据实际业务场景进行配置。

>! 目前，缓存有文件大小限制：32G 以内。若超过此限制，将无法正常缓存，会回源获取资源。

## 配置指南
### 查看配置
登录 [CDN 控制台](https://console.cloud.tencent.com/cdn)，在左侧菜单栏选择【域名管理】，单击域名操作列的【管理】，进入域名配置页面，切换 Tab 至【缓存配置】，即可找到【节点缓存过期配置】。
![](https://main.qcloudimg.com/raw/cbfb1f714d3eb2d4cf099a8f200b65b0.png)

### 新增规则

CDN 目前支持以下四种类型的节点缓存过期规则：
+ 文件类型：根据填入的文件后缀进行缓存过期时间设置，格式为文件类型形式，如`jpg;css`，不同后缀之间用`;`间隔。
+ 文件夹：根据填入的目录路径进行缓存过期时间设置，格式为`/test`形式，无需以`/`结尾，不同目录之间用`;`间隔。
+ 全路径文件：指定完整的文件路径进行缓存过期时间设置，格式为`/index.html`，支持完整路径加文件类型匹配模式，如`/test/*.jpg`。
+ 首页：针对根目录设置缓存过期时间。

<img src="https://main.qcloudimg.com/raw/4c2af825001df8ad55f22881e17bd3a9.png" style="width:400px"/>

**配置约束：**
- 单个域名至多可添加100条缓存规则。
- 多条规则支持调整优先级：底部优先级大于顶部。
- 单条文件类型/文件夹/全路径文件规则中，至多可输入100组内容，不同内容之间用“;”分隔。例如：文件类型 - jpg;png。
- 缓存时间最大可设365天。

>! 【模式】选项中若选择了“高级模式”且提交了规则，则会全面升级至高级模式，详情可参见 [节点缓存过期配置（新）](https://cloud.tencent.com/document/product/228/47672)。升级后，不可恢复至原基础模式。


#### 高级缓存过期设置开关
开启时，CDN会对比命中的缓存规则中的缓存时间与源站max-age值，取较小的作为实际生效的缓存时间

- 用户源站配置`/index.html`的 Max-Age 为200秒，CDN 对应配置的缓存时间为600秒，则文件在节点的实际缓存时间为200秒。
- 用户源站配置`/index.html`的 Max-Age 为800秒，CDN 对应的缓存时间为600秒，则文件在节点的实际缓存时间为600秒。

> !开启时，若源站没有返回 Last-Modified 字段，CDN 会默认添加 Last-Modified 字段，每10分钟变一次。

#### 遵循源站开关
开启时，若请求没有命中任何配置的缓存规则，则遵循源站。

>! 开启遵循源站开关时，不可开启高级缓存过期设置开关。两者只可开其一。


###  平台默认策略
若您未开启任何开关，且未配置任何规则或请求未命中配置的规则时，默认遵循以下平台策略：
- 当用户请求您某一业务资源时，若源站对应的 HTTP Response Header 中存在 Cache-Control 字段，则遵循该 Cache-Control 。
- 若源站对应的 HTTP Response Header 中无 Cache-Control 字段，则：CDN 节点默认对该资源缓存600s。


## 配置示例
若加速域名`cloud.tencent.com`的节点缓存过期配置如下：
![](https://main.qcloudimg.com/raw/c5c117398283a9aedf0bc2d46fccedac.png)
则实际缓存时间如下：
1. `/test/def.jpg` 文件节点缓存时间为400秒。
2. `/test/1.png` 文件节点缓存时间为5分钟。
3. 其他文件节点缓存时间均为30天。
