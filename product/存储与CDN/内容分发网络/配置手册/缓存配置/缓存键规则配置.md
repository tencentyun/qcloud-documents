


## 配置场景

腾讯云 CDN 在进行缓存时使用的是 Key-Value 格式进行资源映射，其中的 Key 即缓存键，是缓存资源的唯一标识。您可通过缓存键规则配置，对不同文件类型的内容配置过滤参数和忽略大小写来进行缓存键优化。



### 过滤参数

- 用户通过 URL 进行资源访问时，可能会携带一些具有特殊作用的参数，如使用以下链接来表示两张不同的图片：
`http://cloud.tencent.com/1.jpg?version=1`
`http://cloud.tencent.com/1.jpg?version=2`
这种场景下需要关闭过滤参数，由完整的 URL 作为缓存键，分别进行图片内容的缓存，来进行资源区分。

- 在音视频场景下，若使用时间戳签名参数来进行访问认证：
`http://cloud.tencent.com/1.mp4?sign=XXXXXX`
这种场景下需要开启过滤参数，由“?”之前的链接`http://cloud.tencent.com/1.mp4`作为缓存键。节点仅缓存一份资源，即使时间戳签名不断变化，通过签名校验后可直接命中缓存。

### 忽略大小写

若在您的业务场景下，资源 URL 路径中大小写差异与资源内容有关，则可关闭忽略大小写配置；
若在您的业务场景下，资源 URL 路径中大小写差异与资源内容无关，则可开启忽略大小写配置，提升命中率。
>!平台升级中，暂不支持开启忽略大小写。

## 配置指南

### 查看配置

登录 [CDN 控制台](https://console.cloud.tencent.com/cdn)，在左侧菜单栏选择【域名管理】，单击域名操作列的【管理】，进入域名配置页面，切换Tab至【缓存配置】，即可找到【缓存键规则配置】。

添加加速域名时，根据不同的业务类型，过滤参数默认关闭或开启：

- 若加速域名选择静态加速业务类型，默认不开启过滤参数。缓存键规则配置中，全部文件规则的【过滤参数】同步为“不过滤”。
- 若加速域名选择下载、流媒体点播业务类型，默认开启过滤参数。缓存键规则配置中，全部文件规则的【过滤参数】同步为“全部过滤”。


![](https://main.qcloudimg.com/raw/b82450778493e5b45c714c426e507c3f.png)

### 新增规则

您可按需添加缓存键规则。
<img src="https://main.qcloudimg.com/raw/0956da1c99754636da7a5d1f0115a5f7.png" height="250" width="438" />

#### 配置约束

- 单个域名至多可添加20条缓存键规则（包含默认规则）。
- 多条规则支持调整优先级：底部优先级大于顶部（默认规则不可调整优先级）。
- 单条文件类型/文件夹/全路径文件规则中，至多可输入100组内容，不同内容之间用“;”分隔。例如：文件类型 - jpg;png。
- 过滤参数 - 保留指定参数
  - 全部文件：至多可填6个参数名，每个参数名不可超过20个字符。
  - 文件类型/文件夹/全路径文件：至多可填5个参数名，每个参数名不可超过20个字符。
    多个参数名之间用“;”分隔，例如：key1;key2;key3。

### 修改规则

对已添加的缓存键规则，可进行修改。单击缓存键规则操作列的【修改】即可。

>!默认规则仅支持修改过滤参数和忽略大小写配置，不支持修改类型和内容。

### 删除规则

可删除已添加的缓存键规则。单击缓存键规则操作列的【删除】即可。（默认规则不可删除）


## 配置示例

若加速域名`www.test.com`的【缓存键规则配置】如下：
![](https://main.qcloudimg.com/raw/2dc21d4d41c678b277be26589ea96bca.png)

则实际访问情况如下：

客户端请求资源`www.test.com/abc.jpg?version=1&colour=red`和`www.test.com/abc.JPG?version=1&colour=red`，假设请求均访问到 CDN 节点 X，节点 X 无上述两个资源的缓存：

- 请求回源站获取`abc.jpg`图片资源，并缓存在 CDN 节点 X 上，因已开启过滤参数：全部过滤，则由“?”之前的链接`www.test.com/abc.jpg`作为缓存键。
- 当客户端请求`www.test.com/abc.JPG?version=1&colour=red`时，因忽略大小写未开启，则无法命中之前缓存的`www.test.com/abc.jpg`资源，请求回源站获取`abc.JPG`图片资源，并缓存在 CDN 节点 X 上，其对应的缓存键为`www.test.com/abc.JPG`



