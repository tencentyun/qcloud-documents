


<blockquote class="d-mod-alarm">
<div class="d-mod-title d-alarm-title">
<i class="d-icon-alarm"></i>公告：
</div>
<p>我们正在灰度发布此功能中，若您的账号下符合启用此功能的域名未看到此功能项，请耐心等待全量发布完成。</p>
</blockquote>


## 功能说明

腾讯云 CDN 支持对单个域名进行版本管理，一个版本对应一份域名配置，您可以对域名部署不同的版本。支持生产环境和模拟环境两种部署环境：

- 生产环境：即现网环境，加速服务实际生效的环境。
- 模拟环境：即沙箱，仅做域名功能测试的独立环境。模拟环境规模较小，仅支持控制台域名配置测试，不可承载实际业务或性能测试。

>!
>1. 暂仅支持未配置自有证书，未开启 [图片优化](https://cloud.tencent.com/document/product/228/43121) 功能的域名启用版本管理。
>2. 每个环境中每次仅支持部署一个版本。
>3. URL 刷新功能会同时作用于生产环境和模拟环境，目录刷新和 URL 预热功能仅作用于生产环境。刷新预热功能介绍请参见 [刷新预热](https://cloud.tencent.com/document/product/228/40272)。
>4. [用量封顶](https://cloud.tencent.com/document/product/228/41733) 等数据/用量监控功能仅作用于生产环境。


## 使用场景

- 域名配置灰度测试。



[](id:open)
## 启用版本管理

登录 [CDN 控制台](https://console.cloud.tencent.com/cdn)，在菜单栏里选择【域名管理】，进入域名列表。单击要启用版本管理的域名，进入域名配置页面，右上角可看到【启用版本管理】。
![](https://main.qcloudimg.com/raw/8c60d15a989ded86ad697f4cc8e588ea.png)

确认启用后，当前域名的配置自动生成为第一个版本：Ver.1，同时部署至生产环境和模拟环境。

## 版本管理

启用版本管理后可进入【版本管理页面】 ，查看和管理版本。不同的版本用版本号 **Ver.n (n=1,2,3,...)** 区分。
您可通过域名列表页 > 域名操作栏 > 【更多】 > 【版本管理】，或单击域名，通过域名配置页右上角的【版本管理】，进入【版本管理页面】。
![](https://main.qcloudimg.com/raw/5646d1b1a5c812dc04af690b9efb457c.png)



### 新增版本
单击【新增版本】：新增版本时的版本配置默认为当前生产环境中的版本配置，可在此基础上调整并提交，生成新版本。
![](https://main.qcloudimg.com/raw/f748948c5a279709b713b2da4dfa7fb9.png)

>! 若您提交新版本后有配置项报错提示（可能是某个配置项未成功提交），该版本仍会生成（报错的配置项默认为原内容），不用再次新建。您可返回版本管理页面，编辑该版本，继续调整配置。

### 编辑版本

版本列表中最新的版本未发布至模拟环境时，可以编辑：单击版本操作列的【更多】 > 【编辑】。
![](https://main.qcloudimg.com/raw/b874c1ce46736815efe6ade4147e7a5a.png)
历史版本（最新版本之前的所有版本）不论是否有发布至模拟环境，均不可编辑，仅支持查看。

>!新增版本前请确认是否还有未发布的版本，因为新增版本后该版本会自动变为历史版本，不可编辑也不可发布至模拟环境。


### 发布版本

对于已启用版本管理的域名，请采用以下发布版本的步骤：

1. 在模拟环境中上线要测试或发布的版本：单击版本操作列的【更多】>【发布至模拟环境】。
![](https://main.qcloudimg.com/raw/06196f7c4bef077be3721ece2682f48b.png)
2. 测试已部署在模拟环境中的版本：CDN 会为域名分配一个 IPv4 的 IP，修改客户端 HOSTS，将域名指向该 IP 即可进行测试。
3. 若要调整配置再次测试，需新增版本并提交，生成新版本，重复步骤 1-2。
4. 测试通过后，将版本同步至生产环境，将配置下发现网，全网生效：单击模拟环境卡片中版本号旁边的【同步至生产环境】。
![](https://main.qcloudimg.com/raw/a6eb38ef147e2347654c8c6b21cd1819.png)
5. 若更换生产环境中的版本，请重复步骤 1-4。

>!
>- 仅允许将版本列表中最新的版本（即版本号最大的版本）发布至模拟环境，历史版本均仅支持查看。
>- 后端特殊配置或平台升级优化会直接下发至生产环境，现网生效。
>- 若域名当前存在人工配置或有平台升级优化，从测试环境同步版本至生产环境时可能会有冲突，控制台会报错提示域名存在后端特殊配置，请新建版本再发布。
>- 模拟环境的 IP 基本不会高频变化。但为了确保准确性，建议您每次测试前，单击 IP 后方的刷新按钮，获取最新的 IP。



### 查看版本

单击对应版本操作列的【查看】，可查看该版本中的配置内容。


### 下线/上线版本
单击生产环境中的【下线】，会同时下线生产环境和模拟环境中的版本，即对域名进行下线，关闭加速服务。
![](https://main.qcloudimg.com/raw/7a09e9b936cdeae90283315dcac900b7.png)
下线后，您可再次上线域名，单击生产环境中相同位置的【上线】，生产环境和模拟环境会同时上线环境中展示的版本。

## 停用版本管理

对于正常运行中，已启用版本管理的域名，您也可以停用版本管理。停用后，将恢复到基础的现网配置模式，以当前生产环境已上线的版本为现网配置。其他存量版本均会消失，不可恢复。

若有需要，您可再次 [启用版本管理](#open)。


## 注意事项

已开启版本管理的域名：
- 不支持 [复制配置](https://cloud.tencent.com/document/product/228/49576)，[批量变更配置](https://cloud.tencent.com/document/product/228/53940) 等批量配置功能。
- 不支持在控制台左侧导航栏的证书管理页面单独配置证书。
- 关闭/启动加速服务时，会同时下线/上线生产环境和模拟环境中的版本。
- 仍可编辑域名的标签和项目。
- 不可变更域名的加速区域和业务类型，如需变更，请先关闭域名的版本管理。 
