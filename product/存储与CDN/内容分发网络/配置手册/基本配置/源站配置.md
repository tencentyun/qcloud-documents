在源站配置模块，您可以对域名的源站配置进行修改，CDN 支持以下几种回源模式：
- 多活 IP
  配置多个 IP 作为源站时，回源采取轮询策略，随机挑选一个 IP 进行回源，同时 CDN 还会进行源站被动探测，若发现某 IP 一段时间内回源失败率突增，则会自动屏蔽一定时间（默认为 60s），轮询时会跳过被屏蔽的源站 IP。
- 域名源站
  支持设置指定域名为源站，设置为源站的域名需要与加速域名不一致。
- COS bucket 源站
  直接选中已有的 COS 存储桶作为回源的源站，仅支持 COS V5 版本存储桶。
- 备站配置
  支持自有源域名配置热备源站，当回源请求至主源站错误（包括 4XX、5XX 错误码及 TCP 连接错误）后，会直接回源至热备源站。配置热备源站能够有效降低回源失败率，提升服务质量。热备源站暂时不支持 HTTPS 回源，配置了热备源站的域名在配置证书时，请勿选择 HTTPS 回源。

>!
> - 仅支持修改用户自行接入的域名的源站，不支持修改 [对象存储](https://cloud.tencent.com/product/cos) 中 Bucket 自动创建的 file.myqcloud.com 后缀作为加速域名的源站。
> - 根据有关部门规定，源站为腾讯云 CVM 的加速域名，回源 HOST 配置的域名需要在腾讯云备案，否则可能被拦截。

## 配置指引

### 查看配置

1. 登录 [CDN 控制台](https://console.cloud.tencent.com/cdn)，单击左侧目录的【域名管理】，进入管理页面，在列表中找到您需要编辑的域名所在行，单击操作栏的【管理】。
   ![img](https://main.qcloudimg.com/raw/99e0c24b4530c30b9abe27325bb1b317.png)
2. 在“基本配置”页面，可以看到**源站信息**模块，可查看域名当前的源站配置。
   ![img](https://main.qcloudimg.com/raw/4d03f386fd5a2e5c5290d037d3b2642f.png)

### 修改源站
单击“源站信息-主源站”右上角【编辑】图标，可以对主源站的源站类型及源站地址进行修改。
![](https://main.qcloudimg.com/raw/21d2952e8ba021057b02ac9aaba45e14.png)

**自有源站**：源站地址可以配置为多个 IP 模式或一个域名模式。支持指定端口回源，格式为“域名:PORT/IP:PORT”，端口取值范围为0 - 65535。
- 当源站地址为 IP 模式时，支持源站权重配置，格式为 “IP:PORT:WEIGHT”，权重取值范围为0 - 100。
	- 单个源站不能设置权重。
	- 源站为多个 IP 时，不允许只为部分IP设置回源权重。
	- 源站为域名格式时不能设置权重，仅当源站为 IP 时可以设置权重。
	- 设置权重格式为 IP:PORT:WEIGHT，其中 PORT 可以省略，格式为 IP::WEIGHT。
	- 目前仅支持 IPv4 地址的权重配置，暂不支持 IPv6。

**COS 源站**：指定 COS 存储桶作为源站。

### 备站添加

1. 针对源站为【自有源】类型的域名，可为其添加热备源站配置，当回源请求至主源站错误（包括 4XX、5XX 错误码及 TCP 连接错误）后，会直接回源至热备源站。
   ![img](https://main.qcloudimg.com/raw/e54b5b7f5edcc70b4f9a6d410d5b367c.png)
2. 备站仅可添加自有源类型，源站地址可配置为多个 IP 模式，或者一个域名，支持指定端口回源，端口号需要为0 - 65535之间。
   ![img](https://main.qcloudimg.com/raw/a433c625fa6c41075ad6c5a5ec7d5593.png)

### 备站修改

添加好备站后，可在控制台进行一键主备切换，调整主备策略，也可修改、删除备站。
![img](https://main.qcloudimg.com/raw/858e4ef4548539838ef4f8f6b5c2702a.png)

## 配置案例
用户请求：`http://www.test.com/1.jpg`，未在节点命中，回源站获取。
1. 若源站配置如下：
![img](https://main.qcloudimg.com/raw/005664fb87eb93fe8ded14f8a6181e89.png)
   服务器`1.1.1.1`上无该资源，会直接返回404，此时回源层的 CDN 节点收到 response 后，会直接返回给请求客户端，客户无法获取该图片。
2. 若源站配置如下：
![img](https://main.qcloudimg.com/raw/fe043255636d48508e41a12b167c2ee2.png)
   服务器`1.1.1.1`上无该资源，会直接返回404，此时回源层的 CDN 节点收到 response 后，再次向备用源站`2.2.2.2`请求该资源，若`2.2.2.2`返回200，则节点会将成功获取到的内容反馈给请求客户端，客户成功获取图片。
