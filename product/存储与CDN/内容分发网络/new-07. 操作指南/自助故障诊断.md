## 功能简介
CDN为您提供了自助故障诊断工具，当您发现您的某资源URL出现访问异常时，本工具能够帮助您进行自助检测，自助检测过程包括了接入域名的DNS解析、链路质量、站点可用性、数据访问一致性等一系列诊断项，帮助您定位问题，并给您提供解决建议。

**注：诊断的资源URL需要是您的账号下接入的状态为”已启动“的域名。诊断中产生的带宽将计入计费带宽，我们建议您诊断的目标资源不超过200MBytes。**


## 使用说明
### 本机接入诊断
当您发现您的某个资源访问存在异常，您可以通过“本机接入诊断”发起检测。本机接入诊断的步骤如下：

1. 进入控制台高级工具>>自助故障诊断页面，选择“本机接入诊断”标签；
2. 输入您需要诊断资源的URL，暂时仅支持http:// 前缀URL，尚不支持https的诊断。输入正确URL后，点击“获取检测URL”，页面中将会生成检测地址；
3. 点击第二步生成的检测地址，会打开检测页面，开始收集诊断信息。请您不要在诊断过程中关闭检测页面，诊断结束后该页面将会自动关闭；
4. 检测完毕后，您可以前往“诊断报告”标签中查看本次诊断的结果。

![本机诊断](https://mc.qcloudimg.com/static/img/33da072a0bb7e8dc1b4760f46f5132cf/image.png)


### 用户接入诊断 
当您的用户向您反应资源访问存在异常，您可以通过“用户接入诊断”定位问题，并通过腾讯云提供的建议操作解决问题。用户接入诊断的步骤如下：
1. 进入控制台高级工具>>自助故障诊断页面中，选择“用户接入诊断”标签；
2. 输入您需要诊断的资源URL，暂时仅支持http:// 前缀URL，尚不支持https的诊断。输入正确URL后，点击“获取检测URL”，页面中将会生成检测地址；
3. 请您将该检测地址发送至您的用户，诊断信息将会在您的用户打开该检测网址时开始收集，请不要在诊断过程中关闭该页面。
4. 检测完毕后，您可以前往“诊断报告”标签中查看从您用户处收集到的诊断结果。

![用户诊断](https://mc.qcloudimg.com/static/img/9472e76b645ed71f745451d31ef58ef1/image.png)


### 查看诊断报告
您可以进入控制台高级工具>>自助故障诊断页面，选择“诊断报告”标签查看诊断报告列表。页面中按照时间排序为您展示已经产生的诊断报告。
![诊断报告列表](https://mc.qcloudimg.com/static/img/970fd85db28891e090e879d4f9700cd3/image.png)
您可以点击“查看”，浏览诊断报告详情。 
![报告详情](https://mc.qcloudimg.com/static/img/d7aa4c44c5fcbd4ba5a963e8c0028601/image.png)

报告详情页分为“诊断对象”与“诊断报告”两个部分：

**诊断对象**：包含诊断ID、异常URL、异常域名、源站类型信息。
**诊断报告：**包含了CNAME、DNS解析、各站点可用性、链路质量、数据访问一致性的诊断结果。


**第一项：CNAME**
1. 正常：若诊断域名实际解析CNAME与应配置解析的CNAME一致时，诊断结果为“正常”。
2. CNAME配置异常：若诊断域名实际解析与应配置解析的CNAME不一致时，诊断结果为”异常“，您可以点击”查看详情“，查看实际解析以及应配置解析的CNAME及其CDN厂商。若诊断域名实际解析多个CNAME，详情处仅展示一个。此时建议您在DNS服务商处修改CNAME配置。若CNAME配置异常，将不继续进行其他项目的诊断。

**第二项：DNS解析**
1. 正常：若诊断域名访问的实际节点与最优节点一致，诊断结果为”正常“，您可以点击”查看详情“，查看客户端IP、Local DNS、实际节点与最优节点的IP、地区与运营商信息
2. 非最优路径：若诊断域名实际访问节点与最优节点不一致，则诊断结果为“非最优路径”，建议您联系腾讯云技术人员。
3. 节点IP获取失败：若诊断域名IP被劫持，或者出现访问节点连接失败等情况，诊断结果为”节点IP获取失败“，此时建议您联系腾讯云技术人员。

**第三项：各站点可用性**
1. 正常：若节点与源站连接正常，则诊断结果为”节点源站连接正常“
2. 异常：如果节点或源站连接异常，则诊断结果为“节点连接异常”或“源站连接异常”或“节点、源站均连接异常”，此时建议您联系腾讯云技术人员。

**第四项：链路质量**
1. 正常：若诊断域名访问正常，则诊断结果为“正常”，并为您展示资源访问的总延时，您还可以点击“查看详情”，进一步查看详细链路中每一环节的耗时。
2. 异常：若诊断域名访问失败，则诊断结果为“异常”，此时建议请您联系腾讯云技术人员。若链路质量为异常，将不继续进行数据访问一致性诊断。

**第五项：数据访问一致性**
1. 正常：若诊断资源在源站、节点上均访问正常，并且MD5一致，则诊断结果为“正常”。您可以点击“查看详情”，查看源站与节点的资源情况。
2. 源站资源异常：若源站资源出现4XX、5XX等状态码，或多个源站上的资源出现MD5不一致，则诊断结果为“源站资源异常”，此时建议您检查源站资源。您还可以点击“查看详情”，进一步查看源站与节点的资源情况。
3. CDN资源异常：若源站资源正常，但是节点资源返回码为4XX或5XX，或者节点资源与源站资源MD5不一致，则诊断结果为“CDN资源异常”，此时建议您联系腾讯云技术人员。您还可以点击“查看详情”，进一步查看源站与节点的资源情况。

若诊断报告无法解决您的问题，我们建议您提交工单，或联系腾讯云技术人员排查问题。
