## 功能介绍

内容分发网络（CDN）提供基础缓存配置能力，可根据指定业务类型、目录、具体 URL 等各类规则设置缓存过期时间，来达到定期清理节点缓存资源，回源站重新拉取最新资源重新缓存的目的。

除此之外，CDN 提供了缓存刷新的能力，可批量指定 URL 或目录进行刷新操作：

- 刷新 URL：删除 CDN 所有节点上对应资源的缓存。
- 刷新目录：选择 “刷新变更资源” 模式，当用户访问匹配目录下资源时，会回源获取资源的 Last-Modify 信息，若与当前缓存资源一致，则直接返回已缓存资源，若不一致，回源拉取资源并重新缓存；选择 “刷新全部资源” 时，当用户访问匹配目录下资源时，直接回源拉取新资源返回给用户，并重新缓存新资源。

> ?刷新成功执行后，节点上对应资源无有效缓存，当用户再次发起访问时，节点回源站拉取所需资源，并重新缓存在节点上。因此提交大量的刷新任务，会清空较多缓存，从而导致回源请求突增，源站会产生较大压力。

## 适用场景

### 新资源发布

在源站点将新资源覆盖至同名旧资源后，为避免全网用户受节点缓存影响仍访问到旧的资源上，可通过提交对应资源的 URL/目录进行刷新，清空全网缓存后，全网用户可直接访问到最新资源。

### 违规资源清理

当站点上存在违规资源（如涉黄、涉毒、涉赌）被发现时，删除源站资源后，由于节点缓存资源仍可被访问到，为维护网络环境，可通过 URL 刷新删除缓存资源，保证及时清理。

## 操作指南



登录 [CDN 控制台](https://console.cloud.tencent.com/cdn)，单击左侧目录的**刷新预热**，进入后可按需提交 **URL 刷新**及**目录刷新**任务：
- 内容分发网络 CDN 与 全站加速 ECDN 域名的 URL/目录支持混合填写提交。
- 支持输入内容和上传 txt 文件两种提交方式。

![](https://main.qcloudimg.com/raw/af61f5b96fa43354ab2c2c3033a58bd4.png)






### 内容规范
请您先关注确认提交的内容是否符合规范：
- URL 必须包含 http:// 或 https:// 协议标识，例如 `http://www.test.com/test.html`，一行一个。
- 请避免提交已关闭/被锁定/未接入当前账号的域名。
- 若您选择了上传文件的提交方式，需确保文件格式为 txt，大小不超过10M。
- 不支持提交 `http://*.test.com/` 格式的 URL  - 即使接入的加速域名为泛域名，也需要提交对应的子域名。
- URL 刷新不支持提交包含通配符的 URL。
- 若 URL 含有中文，请开启 URL Encode 开关，对中文编码转换。

### 提交限额
- **URL 刷新**：
每一个账号单日 URL 刷新限额为10000个，开通了中国境外加速的客户，中国境外单日 URL 刷新限额为10000个，与境内配额相互独立：
	- 若您选择了自行输入内容的提交方式，单次可提交的 URL 刷新限额为1000个。
	- 若您选择了上传文件的提交方式，无单次提交限额，会直接扣除提交的个数作为剩余配额。
>? 若您的 URL 刷新量较大，当 URL 刷新的单日剩余限额较低时（例如，小于1000时），腾讯云 CDN 支持控制台自助一键提升单日限额（例如，提升至 50000 条）。
>- 提升后立即生效，届时请刷新页面，勿频繁单击提升按钮。
>- 仅支持提升一次，例如本次提升单日限额至 50000 后，当剩余限额较低时，不再支持提升至高于 50000 的限额。
>- 不同区域的限额提升相互独立。
- **目录刷新**：
	每一个账号单日目录刷新限额为100个，开通了中国境外加速的客户，中国境外单日目录刷新限额为100条，与境内配额相互独立：
	- 若您选择了自行输入内容的提交方式，单次可提交的目录刷新限额为20个。
	- 若您选择了上传文件的提交方式，无单次提交限额，会直接扣除提交的个数作为剩余配额。
	
提交刷新任务时，默认按照 URL 中域名所在加速区域全区域刷新。域名加速区域为全球时，会同时消耗中国境内和中国境外的配额。
<span ID = "notes"></span>
查询操作记录请见 [操作记录](https://cloud.tencent.com/document/product/228/60683)。


### 子用户权限配置

URL 刷新、目录刷新和查询刷新记录已经接入权限系统，支持资源（域名）维度权限配置，详细说明请参见 [权限配置](https://cloud.tencent.com/document/product/228/12722)。


## 使用案例

### 目录刷新-刷新变更资源

加速域名为：purge-test-1251991073.file.myqcloud.com，源站为腾讯云对象存储（COS），源站资源如下：
![](https://main.qcloudimg.com/raw/91739f8f9315e1e5be36980d0af248e4.png)

1. 分别发起请求访问资源 1.txt 与 2.txt，根据 X-Cache-Lookup: Hit From Disktank3 与 Server: NWS_SPMid 可以判定命中节点， 由节点直接返回资源：
   ![](https://main.qcloudimg.com/raw/9b307b80e7d1c759bb073eb9f2cf4b6c.png)
   ![](https://main.qcloudimg.com/raw/5fed8bff43d699f47235e5d0db1f2447.png)
2. 在源站替换掉同名文件 1.txt，文件修改时间发生改变，2.txt 保持不变：
   ![](https://main.qcloudimg.com/raw/5602a365abf57124b31bd24516c9f362.png)
   ![](https://main.qcloudimg.com/raw/f2f45c7bf3fd86c5a4b307143c9a6a6f.png)
3. 此时再发起请求，由于缓存尚未过期，访问资源 1.txt 仍为旧的内容：
   ![](https://main.qcloudimg.com/raw/b5769a3d7fddaeadfda229115ac59bb8.png)
4. 提交目录刷新，选择【刷新变更资源】，等待刷新完成：
   ![](https://main.qcloudimg.com/raw/6638c5d781b9d41a0b11ee5c4c6ea3af.png)
5. 刷新完成后，由于文件 1.txt Last-Modified 发生变更，请求直接回源，而文件 2.txt 由于未做变更，即使提交目录刷新，仍被节点命中返回：
   ![](https://main.qcloudimg.com/raw/0ea8c1e0e7caac970b3875d4b3987687.png)
   ![](https://main.qcloudimg.com/raw/84e599b1c9c655e62497fb4bdc8e7918.png)
