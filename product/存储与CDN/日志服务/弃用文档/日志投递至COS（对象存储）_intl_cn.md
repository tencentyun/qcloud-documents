日志服务提供日志投递至对象存储（COS）的服务，持久化存储日志数据。您可以指定日志按照一定的时间间隔、文件大小进行投递。目前我们支持投递 V4 版本以上的 COS 存储桶。

## 权限要求

设置日志投递将授权日志服务对您指定的 Bucket 有 **写操作权限**，若您以协作者身份配置日志投递，请先确认您的主账号下的该存储桶已经授权日志服务有 **写操作权限**，否则将投递失败。

## 配置说明

在日志集详情页中，选择日志主题，点击管理配置，在日志主题的配置页面中创建投递配置。一个日志主题可以创建多个投递配置。

### 开启/关闭投递任务

您可以在投递配置的管理列表中开启或者关闭投递任务。

### 基本配置

- 投递任务名称：支持数字字母下划线与中划线
- COS 存储桶：选择需要投递的存储桶。目前日志服务仅支持**投递至与日志集所在区域相同区域的存储桶**。
- 目录前缀（非必选）：日志服务支持您自定目录前缀，目前投递至COS存储桶中的分区为`COS-BUCKET/{prefix}/{logset}/{topic}/{Y}/{m}/{d}/{time}_{random}_{index}.gz` 我们将每天在该存储桶下新建一个目录，路径中的 time 指此日志文件中包含的实际的日志时间，random_index是一个随机数
- 投递间隔时间：指定投递的时间间隔，**支持1分钟至1小时**。假设您设置投递时间间隔为5分钟，那么意味着您的日志数据将每五分钟产生一个文件存储至COS存储桶。日志数据将在半小时之内投递至您的存储桶。
- 投递文件大小：指定在该投递时间间隔中**未压缩的投递文件**上限，意味着在该时间间隔中，日志文件最大将为您设置的值，超过该上限，将被分成多个日志文件，上限支持**100MB 到 10GB**。

![](https://mc.qcloudimg.com/static/img/8d1f42f4657568290c95d79c4d6b2469/image.png)

### 高级配置

日志投递还支持您根据日志内容进行过滤投递，您可以打开高级选项进行配置。您可以指定一个key，对该键值所对应的值进行正则提取，并设定提取出的部分需要匹配的值。只有当日志数据匹配您的配置后，该日志可以投递。没有匹配的日志不进行投递。如下图所示，指定 action 字段，该字段为 write 时，日志进行投递。投递过滤规则最多支持 5 条。

![](https://mc.qcloudimg.com/static/img/98cf7e06c8883c55d7b61c7e81612083/image.png)

### 投递任务查询

您可以在一级菜单投递任务查询中查询到近三天的投递任务状态，以及状态详情。
