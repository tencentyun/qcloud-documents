

日志服务 CLS 支持按量计费（后付费）模式，即根据用户的实际使用资源情况进行计量，然后按日进行费用扣除。按量计费模式适用于日志服务所有地域。

## 计费模式

| 类别     | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| 计费周期 | 按量计费周期为：天，即当日所产生用量的费用会在次日00:00点时开始结算 |
| 计费价格 | 参考日志服务 [产品定价](https://cloud.tencent.com/document/product/614/45803)     |



## 计费项说明

### 计费项概览

![](https://main.qcloudimg.com/raw/a17353813a3d7bf8a35139c781b6a23a.png)

### 计费项图示说明

![](https://main.qcloudimg.com/raw/12dcfe719574138b127fd56c1d20e960.png)



#### 按量计费模式中的计费项包含以下几类：

#### 流量类计费项

  | 流量类计费项   | 计费项说明                                                   | 计费公式                                     |
  | -------------- | ------------------------------------------------------------ | -------------------------------------------- |
  | 写流量费用     | 根据日志服务所接收的数据量大小进行计费。压缩上传会以压缩后的实际数据量计算（LogListener 默认使用压缩上传） | 写流量费用=每 GB 单价 x 日累计写流量         |
  | 索引流量费用   | 根据日志服务构建索引时所产生的数据量大小进行计费。开启索引后才会产生索引流量，且索引流量的大小与索引配置的字段数有关。 | 索引流量费用=每 GB 单价 x 日累计索引流量     |
  | 内网读流量费用 | 根据访问日志服务内网域名时所产生的下行流量进行计费，如同地域通过内网下载日志、消费日志、投递到 COS 以及投递到 Ckafka 等，均会产生内网读流量费用 | 内网读流量费用=每 GB 单价 x 日累计内网读流量  |
  | 外网读流量费用 | 根据访问日志服务外网域名时所产生的下行流量进行计费，如跨地域通过外网下载日志、消费日志、投递到 COS 以及投递到 Ckafka 等，均会产生内网读流量费用 | 外网读流量费用= 每GB 单价 x 日累计外网读流量 |

  ##### 限制说明

  1. 无论通过内网还是外网上传日志，均会收取写流量费用。
  2. 日志服务中如\_\_FILENAME\_\_、\_\_SOURCE__等元信息会构建索引，也会计算索引流量。
  3. 若同时开启全文索引和键值索引，不会重复计算索引流量。

  

##### 存储类计费项

  | 存储类计费项 | 计费项说明                               | 计费公式                                  |
  | ------------ | ---------------------------------------- | ----------------------------------------- |
  | 日志存储费用 | 根据日志数据所占用的存储空间大小进行计费 | 日志存储费用= 每 GB 单价 * 日均日志存储量 |
  | 索引存储费用 | 根据索引数据所占用的存储空间大小进行计费 | 索引存储费用= 每 GB 单价 * 日均索引存储量 |

##### 限制说明

  1. 日志服务根据上传数据量的实际大小计算日志存储量。例如，原始日志量为100 GB：

     - 若上传**开启压缩**，上传实际的数据量大小为25 GB，则日志存储量的增量为25 GB
     - 若上传**未开启压缩**，上传数据量大小为100 GB，则日志存储量的增量为100 GB
     - 同理，若用户**开启索引**的字段产生了50 GB 索引流量，则索引存储量的增量为 50GB

  2. 日志存储量计量方式采用均值计量，即按每分钟统计当前时刻的存储量值，然后每天按分钟累加后求平均值作为当天的日均存储量，计算公式：

     ```
     日均日志存储量= “当日每分钟日志存储量值”之和 / 1440
     日均索引存储量= “当日每分钟索引存储量值”之和 / 1440
     ```

  3. 日志数据和索引数据会根据用户设置的存储周期进行保存，数据过期后不会再计算存储费用，删除过期数据量的时间点为临近的整点时间。例如，保存周期设置为3天，6月15号12:15 上传日志，6月15号12:15至6月18号12:15为有效保存周期，所占存储量将会在6月18号13:00进行扣除。（**强烈不建议用户频繁修改存储周期，每天最多修改一次**）

     - 修改存储周期（延长）

       修改延长存储周期后，日志服务会将当前存储周期内的有效数据延长保存。例如，6月15号将存储周期从7天延长为15天，则6月7号的数据不会在6月15号进行删除，会延长保存至6月23号。

     - 修改存储周期（缩短）

       修改缩短存储周期后，日志服务会将当前存在周期内的有效数据缩短保存。例如，6月15号将存储周期从15天缩短为7天，则下一个校正周期会删除6月1号至6月7号的数据。

  

 ##### 其他计费项（防止滥用）

  | 其他类计费项 | 计费项说明                                                   | 计费公式                                                     |
  | ------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
  | 服务请求费用 | 根据调用日志服务接口的总次数进行计费                         | 服务请求费用= 每百万次请求单价 x（日累计请求次数 /  1000000） |
  | 主题分区费用 | 根据占用的主题分区数量进行计费，包括读写态和只读态的主题分区 | 主题分区费用= 单价 x 日累计主题分区数量                      |

  ##### 限制说明

  1. 服务请求费用 用户使用 LogListener、API 或 SDK 调用日志服务接口的请求次数，统计包括上传下载、创建删除、检索分析等读写请求。

  2. 服务请求数无论成功或失败均会统计。

     

## 计费示例

#### 案例1：Nginx 日志查询及分析

甲公司的网站每天有1亿次请求，平均一次请求会产生一条100 字节的日志，一天共一亿条日志，日志量共 10GB。甲公司决定将Nginx 访问日志上传到北京地域的 CLS，并保存15天，进行查询及统计分析。

<table>
   <tr>
      <td  colspan="2">计费项</td>
      <td>计量说明</td>
      <td>计量</td>
      <td>单价（北京）</td>
      <td>费用</td>
   </tr>
   <tr>
      <td rowspan="4">流量费用</td>
      <td>写流量费用</td>
      <td>使用 LogListener 会压缩上传，压缩后流量 3GB</td>
      <td>3 GB</td>
      <td>0.18 元/GB/日</td>
      <td>0.54 元/日</td>
   </tr>
     <tr>
      <td>索引流量费用</td>
      <td>开启全文索引后，产生 12GB 索引流量</td>
      <td>12 GB</td>
      <td>0.35 元/GB/日</td>
      <td>4.20 元/日</td>
   </tr>
   <tr>
      <td>内网读流量费用</td>
      <td>没有内网下载消费，无内网读流量</td>
      <td>0 GB</td>
      <td>0.18 元/GB/日</td>
      <td>0.00 元/日</td>
   </tr>
   <tr>
      <td>外网读流量费用</td>
      <td>没有外网下载消费，无外网读流量</td>
      <td>0 GB</td>
      <td>0.8 元/GB/日</td>
      <td>0.00 元/日</td>
   </tr>
   <tr>
      <td rowspan="2">存储费用</td>
      <td>日志存储费用</td>
      <td>每天上传3 GB 日志，保存15天后平均存储量 45GB（3GB * 15天）</td>
      <td>45 GB</td>
      <td>0.014元/GB/日</td>
      <td>0.63 元/日</td>
   </tr>
   <tr>
      <td>索引存储费用</td>
      <td>每天产生12 GB索引，保存15天后平均存储量 180GB （12GB * 15天）</td>
      <td>180 GB</td>
      <td>0.014元/GB/日</td>
      <td>2.52 元/日</td>
   </tr>
   <tr>
      <td rowspan="2">其他费用</td>
      <td>服务请求费用</td>
      <td>使用 Loglistener 会批量上传，会产生 10 万次上传请求</td>
      <td>0.1 百万次</td>
      <td>0.15 元/GB/日</td>
      <td>0.015 元/日</td>
   </tr>
   <tr>
      <td>主题分区租用费用</td>
      <td>业务高峰每秒会产生 8MB 日志量，需要2个主题分区来承载日志洪峰</td>
      <td>2个</td>
      <td>0.04元/个/日</td>
      <td>0.08 元/日</td>
   </tr>
   <tr>
      <td colspan="2">费用合计</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>7.985 元/日</td>
   </tr>
</table>

