## 概述
多行全文日志是指一条完整的日志数据跨占多行（例如 Java 程序日志）。在这种情况下，以换行符 `\n` 为日志的结束标识符就显得有些不合理，为了能让日志系统明确区分开每条日志，采用首行正则的方式进行匹配，当某行日志匹配上预先设置的正则表达式，就认为是一条日志的开头，而下一个行首出现作为该条日志的结束标识符。

多行全文也会设置一个默认的键值`__CONTENT__`，但日志数据本身不再进行日志结构化处理，也不会提取日志字段，日志属性的时间项由日志采集的时间决定。

### 示例

假设您的一条多行日志原始数据为：

```
10.20.20.10 - - [Tue Jan 22 14:24:03 CST 2019 +0800] GET /online/sample HTTP/1.1 127.0.0.1 200 628 35 http://127.0.0.1/group/1 
Mozilla/5.0 (Windows NT 10.0; WOW64; rv:64.0) Gecko/20100101 Firefox/64.0 0.310 0.310
```

该条日志最终被日志服务结构化处理为：

```
__CONTENT__:10.20.20.10 - - [Tue Jan 22 14:24:03 CST 2019 +0800] GET /online/sample HTTP/1.1 127.0.0.1 200 628 35 http://127.0.0.1/group/1 \nMozilla/5.0 (Windows NT 10.0; WOW64; rv:64.0) Gecko/20100101 Firefox/64.0  0.310 0.310
```

## 采集配置

### 1. 登录控制台

登录 [日志服务控制台](https://console.cloud.tencent.com/cls)，左侧选择日志集管理。

### 2. 新建 LogListener 采集

选择目标日志集，单击【新建日志主题】，输入日志主题名称：test-mtext ，单击【确定】。
![](https://main.qcloudimg.com/raw/88001a66216a9f049d26c449d2d3ef27.png)

### 3. 配置 LogListener 采集

单击 LogListener 采集的日志主题，在采集配置界面中单击右上角【编辑】按钮，进入到编辑模式，然后开启**采集状态**和**使用 LogListener**。 
![](https://main.qcloudimg.com/raw/207c7c0148c140d03a5ea5b3f8f6fa1a.png)

### 4. 配置日志文件采集路径

采集路径处需要填写需要采集的完整路径，而非目录格式（即需要以`/`开头，非`/`结尾），文件名支持正则表达式，目前暂不支持通配符。

>!采集路径中仅允许日志文件名称使用正则表达式，目录不支持正则。

#### 配置方式
|方式|路径|
| ------------------------ | ------------------ |
| 使用绝对路径匹配日志文件 | /www/logs/nginx/www-test.access.log |
| 使用正则匹配日志文件| /www/logs/nginx/.*access.log   |

### 5. 关联机器组

从机器组列表中选择目标机器组，将其与当前日志主题进行关联，值得注意的是，关联的机器组与日志主题所在的地域需保持一致。操作详情请参阅 [如何创建机器组](https://cloud.tencent.com/document/product/614/17412#.E5.88.9B.E5.BB.BA.E6.9C.BA.E5.99.A8.E7.BB.84) 文档。
![](https://main.qcloudimg.com/raw/58efdb45d99d737507827a7db6c29b7b.png)

### 6. 多行全文模式选择

键值提取模式选择**多行全文**。
![](https://main.qcloudimg.com/raw/34c96979d989520a78ad1003d89507ea.png)

配置多行全文格式：

1. 键值提取模式选择**多行全文**
2. 将日志文件中单条多行日志粘贴至对话框内
3. 选择自动生成（推荐使用），也可使用手动输入需要自己手动输入首行正则表达式
4. 生成正则表达式（高亮表示正则表达式匹配首行内容），完成配置。

![](https://main.qcloudimg.com/raw/fe5ddbd40bfd7784778948bf9db1e0fe.png)

### 7. 过滤器条件

过滤器旨在您根据业务需要添加日志采集过滤规则，帮助您方便筛选出有价值的日志数据。对于JSON格式日志，可以根据所解析成的键值对配置过滤规则，过滤规则为正则表达式。所创建的过滤规则为命中规则，即匹配上正则表达式的日志才会被采集上报。

例如，您希望指定 status = 400或500的日志数据被采集。key 处配置status，过滤规则处配置（400|500）。

### 8. 检索结果

登录 [日志服务控制台](https://console.cloud.tencent.com/cls)，左侧选择日志检索，选择日志集与日志主题，单击【搜索】，即可检索日志。
![](https://main.qcloudimg.com/raw/a60e1f7ae45e7f2b66bd361e29636d78.png)

>!检索必须开启索引配置，否则无法进行检索。
