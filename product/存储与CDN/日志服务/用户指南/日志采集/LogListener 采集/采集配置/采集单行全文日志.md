## 概述

单行全文日志是指一条日志仅包含一行的内容，在采集的时候，将使用换行符\n来作为一条日志的结束符。为了统一结构化管理，每条日志都会存在一个默认的键值`__CONTENT__`，但日志数据本身不再进行日志结构化处理，也不会提取日志字段，日志属性的时间项由日志采集的时间决定。

#### 示例

假设您的一条日志原始数据为：

```plaintext
Tue Jan 22 12:08:15 CST 2019 Installed: libjpeg-turbo-static-1.2.90-6.el7.x86_64
```

日志最终被日志服务处理为：

```plaintext
__CONTENT__:Tue Jan 22 12:08:15 CST 2019 Installed: libjpeg-turbo-static-1.2.90-6.el7.x86_64
```

## 采集配置

### 步骤1：登录控制台

登录 [日志服务控制台](https://console.cloud.tencent.com/cls)，在左侧导航栏中单击【日志集管理】。

### 步骤2：新建 LogListener 采集

选择目标日志集，单击【新建日志主题】，输入日志主题名称：test-full ，单击【确定】。
![](https://main.qcloudimg.com/raw/528377a52b7474d3919b96b94271c7cf.png)

### 步骤3：配置 LogListener 采集

1. 选择 LogListener 采集的日志主题，进入日志主题管理页面。
2. 单击【采集配置】页签，并单击采集状态开关，进入到采集配置编辑模式。
3. 在 LogListener 采集配置项中，单击右侧的【修改配置】，进入 Agent 配置页面。
 - 采集路径：
![](https://main.qcloudimg.com/raw/be734da423bba8976558bb91ba3e11ef.jpg)


3. 配置项中，然后开启**采集状态**和**使用 LogListener**。
![](https://main.qcloudimg.com/raw/23cace59adf0a6fa2f8c30d4c76f59b5.png)

### 4. 配置日志文件采集路径

日志采集路径格式为 **[目录前缀表达式]**/\*\*/**[文件名表达式]** ，LogListener 会按照 **[目录前缀表达式]** 匹配所有符合规则的公共前缀路径，并监听这些目录（包含子层目录）下所有符合 **[文件名表达式]** 规则的日志文件，参数详细说明如下：

| 字段     | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| 目录前缀 | 日志文件前缀目录结构，仅支持通配符 \* 和 ? ，\* 表示匹配多个任意字符，? 表示匹配单个任意字符 |
| /**/     | 表示当前目录以及所有子目录                                   |
| 文件名   | 日志文件名，仅支持通配符 \* 和 ? ，\* 表示匹配多个任意字符，? 表示匹配单个任意字符 |

> ?常用配置模式参考如下：
> - [公共目录前缀]/\*\*/[公共文件名前缀]\*
> - [公共目录前缀]/\*\*/*[公共文件名后缀]
> - [公共目录前缀]/\*\*/[公共文件名前缀]\*[公共文件名后缀]
> - [公共目录前缀]/\*\*/\*[公共字符串]\*

填写示例：

| 序号 | 目录前缀表达式 | 文件名表达式 | 说明                                                         |
| ---- | -------------- | ------------ | ------------------------------------------------------------ |
| 1.   | /var/log/nginx | access.log   | 此例中，日志路径配置为`/var/log/nginx/**/access.log`，LogListener 将会监听`/var/log/nginx`前缀路径下所有子目录中以`access.log`命名的日志文件 |
| 2.   | /var/log/nginx | \*.log       | 此例中，日志路径配置为`/var/log/nginx/**/*.log`，LogListener 将会监听`/var/log/nginx`前缀路径下所有子目录中以`.log`结尾的日志文件 |
| 3.   | /var/log/nginx | error\*      | 此例中，日志路径配置为`/var/log/nginx/**/error*`，LogListener 将会监听`/var/log/nginx`前缀路径下所有子目录中以`error`开头命名的日志文件 |

> !
> 1. 多层目录和通配符配置方式依赖2.2.2及以上版本的 loglistener，为兼容低版本 loglistener 路径配置修改方式，用户可切换旧配置进行历史修改，旧采集路径方式不支持多目录采集。
> 2. 一个日志文件只能被一个日志主题采集。
> 3. LogListener 不支持监听软连接方式的日志文件和 NFS、CIFS 等共享文件目录上的日志文件。

### 5. 关联机器组

从机器组列表中选择目标机器组，将其与当前日志主题进行关联，值得注意的是，关联的机器组与日志主题所在的地域需保持一致。操作详情请参见 [如何创建机器组](https://cloud.tencent.com/document/product/614/17412#.E5.88.9B.E5.BB.BA.E6.9C.BA.E5.99.A8.E7.BB.84) 文档。
![](https://main.qcloudimg.com/raw/4e110aae8383c318c641c6352b78e451.png)

### 6. 单行全文模式选择

【键值提取模式】请选择**单行全文**，如下图所示：
![](https://main.qcloudimg.com/raw/23abce292dfbb8a5e9ab4d12645bd81f.png)

### 7. 过滤器条件

过滤器旨在您根据业务需要添加日志采集过滤规则，帮助您筛选出有价值的日志数据。过滤规则为 Perl 正则表达式，所创建的过滤规则为命中规则，即匹配上正则表达式的日志才会被采集上报。

单行全文模式下，默认使用`__CONTENT__`作为全文的键（key）名。例如，单行全文日志样例格式为`Tue Jan 22 12:08:15 CST 2019 Installed: libjpeg-turbo-static-1.2.90-6.el7.x86_64`，您希望采集1月22号这一天的所有日志，则 key 处填写`__CONTENT__`，过滤规则配置`Tue Jan 22.*`。

> !多条过滤规则之间关系是"与"逻辑；若同一 key 名配置多条过滤规则，规则会被覆盖。

### 8. 检索结果

登录 [日志服务控制台](https://console.cloud.tencent.com/cls)，单击【日志检索】，选择日志集与日志主题，单击【搜索】，系统将开始检索日志。
![img](https://main.qcloudimg.com/raw/a9d44b05d0072299076d9df24c75bda7.png)

> !检索必须开启索引配置，否则无法进行检索。
