## 概述
分隔符日志是指一条日志数据可以根据指定的分隔符将整条日志进行结构化处理，每条完整的日志以换行符``\n``为结束标识符。日志服务在进行分隔符格式日志处理时，您需要为每个分开的字段定义唯一的 key。

### 示例
假设您的一条日志原始数据为：

```shell
10.20.20.10 - ::: [Tue Jan 22 14:49:45 CST 2019 +0800] ::: GET /online/sample HTTP/1.1 ::: 127.0.0.1 ::: 200 ::: 647 ::: 35 ::: http://127.0.0.1/
```

当日志解析的分隔符指定为：`:::`，该条日志会被分割成八个字段，并为这四个字段定义唯一的 key，如下所示：
```shell
IP: 10.20.20.10 -
bytes: 35
host: 127.0.0.1
length: 647
referer: http://127.0.0.1/
request: GET /online/sample HTTP/1.1
status: 200
time: [Tue Jan 22 14:49:45 CST 2019 +0800]
```

## 采集配置

### 1. 登录控制台
登录[日志服务控制台](https://console.cloud.tencent.com/cls)，左侧选择日志集管理。

### 2. 新建 LogListener 采集

选择目标日志集，单击【新建日志主题】，输入日志主题名称：test-separator ，单击【确定】。
![](https://main.qcloudimg.com/raw/1e89802565c5be84657755768d0a2b22.png)

### 3. 配置 LogListener 采集

单击 LogListener 采集的日志主题，在采集配置界面中单击右上角【编辑】按钮，进入到编辑模式，然后开启**采集状态**和**使用 LogListener**。 
![](https://main.qcloudimg.com/raw/92ec9e7503f72df53eb5b917835ee413.png)

### 4. 配置日志文件采集路径

日志采集路径需分别指定日志前缀目录和文件名，支持通配符`*`和`？`两种方式。路径匹配规则支持多层目录匹配，即指定目录前缀后，会监听到所有子层目录中符合采集文件名规则的日志文件，参数说明如下：

| 字段     | 说明                                      |
| -------- | ----------------------------------------- |
| 目录前缀 | 日志文件前缀目录结构，支持通配符`*`和`？` |
| 文件名   | 日志文件名，支持通配符`*`和`？`           |

例如，目录前缀是 `/var/logs/app_*`，文件名是`*.log`，则agent会监听`/var/log`下所有`app_*` 模式的以`.log`为后缀名的日志文件。


>!
>1. 多层目录和通配符配置方式依赖 agent 2.2.2版本及以上，为兼容低版本 agent 路径配置修改方式，用户可切换旧配置进行历史修改，旧采集路径方式不支持多目录采集
>2. 一个日志文件只能被一个 topic 配置采集。

### 5. 关联机器组

从机器组列表中选择目标机器组，将其与当前日志主题进行关联，值得注意的是，关联的机器组与日志主题所在的地域需保持一致。操作详情请参阅 [如何创建机器组](https://cloud.tencent.com/document/product/614/17412#.E5.88.9B.E5.BB.BA.E6.9C.BA.E5.99.A8.E7.BB.84) 文档。
![](https://main.qcloudimg.com/raw/666a57c5d039a922cea566e7406d95d2.png)

### 6. 分隔符模式选择

【键值提取模式】选择**分隔符**，如下图所示：

![](https://main.qcloudimg.com/raw/ca48770ab72d495a025db91c1f2549df.png)

### 7. 确定分隔符

首先需要您选择唯一的分隔符，系统根据确定的分隔符将日志样例进行切分，并展示在抽取结果栏中，您需要为每个字段定义唯一的 key。目前，日志采集支持多种分隔符，常见的分隔符有：空格、制表符、逗号、分号、竖线，若您的日志数据所采用的分隔符是其他符号，例如 `:::` ，也可以通过自定义分词符进行解析。
![](https://main.qcloudimg.com/raw/ad211bca9f961c3ef5e3faad6ccaf4b4.png)

### 8. 采集时间配置
>?
>- 日志时间单位为：秒。
>- 日志的时间属性有两种方式来定义：采集时间和原始时间戳。
>- 采集时间：日志的时间属性由日志服务 CLS 采集该条日志的时间决定。
>- 原始时间戳：日志的时间属性由原始日志中时间戳决定。

#### 8.1 采集时间作为日志的时间属性

保持采集时间状态为开启状态即可，如下图所示：
![](https://main.qcloudimg.com/raw/3b36dd535049de092c00c9a216dad4d2.png)

#### 8.2 日志的原始时间戳作为日志时间属性

关闭采集时间状态，填写原始时间戳的时间键以及对应的时间解析格式，转换格式支持strftime的所有函数。
![](https://main.qcloudimg.com/raw/5a4020e2934bd454b3ab611c02cc408b.png)

这里举例说明时间格式解析规则填写：  
例1：日志样例原始时间戳：`10/Dec/2017:08:00:00`，解析格式为：`%d/%b/%Y:%H:%M:%S`。  
例2：日志样例原始时间戳：`2017-12-10 08:00:00`，解析格式为：`%Y-%m-%d %H:%M:%S`。  
例3：日志样例原始时间戳：`12/10/2017, 08:00:00`，解析格式为：`%m/%d/%Y, %H:%M:%S`。 

>!日志时间支持以秒为单位，若时间格式填写错误日志时间将以采集时间为准。

### 9. 过滤器条件
过滤器旨在您根据业务需要添加日志采集过滤规则，帮助您方便筛选出有价值的日志数据。对于分隔符格式日志，可以根据所解析成的键值对配置过滤规则，过滤规则为正则表达式。所创建的过滤规则为命中规则，即匹配上正则表达式的日志才会被采集上报。

例如，您希望指定 errorcode = 400或500的日志数据被采集。则在 key 处配置 errorcode，过滤规则处配置（400|500）。

### 10. 检索结果

登录 [日志服务控制台](https://console.cloud.tencent.com/cls)，左侧选择日志检索，选择日志集与日志主题，单击【搜索】，即可检索日志。
![](https://main.qcloudimg.com/raw/92cf9979f55dcec57f8c3a8b00d3ecd1.png)

>!检索必须开启索引配置，否则无法进行检索。
