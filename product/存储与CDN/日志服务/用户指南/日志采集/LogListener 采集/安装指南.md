LogListener 是腾讯云日志服务 CLS 所提供的专用日志采集器，将它安装部署到服务器上，可快速采集日志到日志服务。



## 安装环境

LogListener 仅支持64位 Linux 操作系统环境（暂不支持 Windows），并适配主流 Linux 操作系统版本，若其他版本环境若安装异常，请 [提交工单](https://console.cloud.tencent.com/workorder/category) 联系我们。

<table>
<thead>
<tr>
<th>操作系统类别</th>
<th>确定可安装环境</th>
</tr>
</thead>
<tbody><tr>
<td nowrap="nowrap">CentOS（64位）</td>
<td>CentOS_6.8_64位、CentOS_6.9_64位、CentOS_7.2_64位、CentOS_7.3_64位、CentOS_7.4_64位、CentOS_7.5_64位、CentOS_7.6_64位</td>
</tr>
<tr>
<td>Ubuntu（64位）</td>
<td>Ubuntu Server_14.04.1_LTS_64位、Ubuntu Server_16.04.1_LTS_64位、Ubuntu Server_18.04.1_LTS_64位</td>
</tr>
<tr>
<td>Debian（64位）</td>
<td>Debian_8.2_64位、Debian_9.0_64位</td>
</tr>
<tr>
<td nowrap="nowrap">openSUSE（64位）</td>
<td>openSUSE_42.3_64位</td>
</tr>
</tbody></table>





## 安装启动

### 1. 下载安装 LogListener

LogListener 最新版本下载地址： [下载 LogListener](https://loglistener-1254077820.cos.ap-shanghai.myqcloud.com/loglistener-linux-x64-2.2.6.tar.gz)

以安装路径`/usr/local/`为例： 下载 LogListener 安装包并解压，解压路径为`/usr/local/` ，解压完成后进入 LogListener 目录`loglistener/tools`，执行安装命令 。该操作命令如下：

```shell
wget https://loglistener-1254077820.cos.ap-shanghai.myqcloud.com/loglistener-linux-x64-2.2.6.tar.gz && tar -zxvf loglistener-linux-x64-2.2.6.tar.gz -C /usr/local && cd /usr/local/loglistener-2.2.6/tools && ./loglistener.sh install
```



### 2. 初始化 LogListener

在`loglistener/tools`路径下，以 root 用户执行 LogListener 初始化命令：

```shell
./loglistener.sh init -s AKIDc9YlmrBcFk4C8sbmXQ8i65XXXXXXXXXX -s LUSE4nPK1d4tX5SHyXv6tZXXXXXXXXXX -r ap-shanghai
```


默认使用内网域名：
![](https://main.qcloudimg.com/raw/a92b2fca1f32267bb00ce8fe411bca89.png)



如果要使用外网域名使用`-n` 参数，有效值分别为`intra（内网）｜internet（外网）`

```shell
./loglistener.sh init -s AKIDPEtPyKabfW8Z3Uspdz83XXXXXXXXXXXX -k whHwQfjdLnzzCE1jIf09XXXXXXXXXXXX -r ap-shanghai -n internet
```

![](https://main.qcloudimg.com/raw/493b704847771a68dc579d44349dc343.png)



#### 参数说明

| 参数名 | 类型描述                                                     |
| ------ | ------------------------------------------------------------ |
| s      | [云 API 密钥](https://console.cloud.tencent.com/cam/capi) 的一部分，SecretId 用于标识 API 调用者身份 |
| k      | [云 API 密钥](https://console.cloud.tencent.com/cam/capi) 的一部分，SecretKey 是用于加密签名字符串和服务器端验证签名字符串的密钥 |
| r      | region 日志服务所在的 [地域](https://cloud.tencent.com/document/product/614/18940) |
| n      | 网络类型， intra 内网 ， internet 外网                       |

> ?
>
> - 建议使用协作者密钥，需要主账号授权协作者于日志服务的读写权限。
> - region 为您所使用的日志服务区域，而非您的业务机器所处的区域。



### 3. 启动 LogListener

成功安装后，执行 LogListener 启动命令：

```shell
/etc/init.d/loglistenerd start
```

![1573024891837](https://main.qcloudimg.com/raw/cd40ba93f53595c2ad0107055b817aaf.png)



## 操作 LogListener 

> ? 本文档示例的操作命令说明仅适用于 LogListener-2.2.4 及以上版本，低版本操作命令请参见 [低版本 LogListener 安装指南](https://cloud.tencent.com/document/product/614/39211)。

#### 查看 LogListener 版本

```shell
/etc/init.d/loglistenerd -v
```

#### 启动 LogListener

```shell
/etc/init.d/loglistenerd start
```

#### 重启 LogListener

```shell
/etc/init.d/loglistenerd restart
```

#### 停止 LogListener

```shell
/etc/init.d/loglistenerd stop
```

#### 初始化 LogListener

以管理员权限执行`loglistener/tools`目录下的初始化命令：

```shell
./loglistener.sh init -s AKIDc9YlmrBcFk4C8sbmXQ8i65XXXXXXXXXX -k LUSE4nPK1d4tX5SHyXv6tZXXXXXXXXXX -r ap-beijing

```

#### 卸载 LogListener

以管理员权限执行`/loglistener/tools`目录下的卸载命令：

```shell
./loglistener.sh uninstall
```

#### 查看 LogListener 进程状态

```shell
/etc/init.d/loglistenerd status 
```

LogListener 正常情况会运行三个进程：

![](https://main.qcloudimg.com/raw/16dc6439ab88bacd369e93b992503c82.png)

#### 检查 LogListener 心跳及配置

```shell
/etc/init.d/loglistenerd check
```

![1573030900001](https://main.qcloudimg.com/raw/53b13afe85354d36e66e3b81ad2e6ee6.png)



## 手动更新 LogListener

- 复用断点文件（不会重复采集日志）：

  1. 使用停止命令停止运行旧版本的 LogListener。
  2. 下载最新版本的 LogListener。
  3. 使用相关命令安装和初始化新版本 LogListener。
  4. 复制旧版本中的断点文件目录（`loglistener/data`）到新版本 Loglistener目录下。例如，将 LogListener-2.2.3 旧版本的断点文件复制到新版本中。
  ```shell
  cp -r loglistener-2.2.3/data loglistener-2.2.6/
  ```
  5. 使用启动命令启动运行新版本 LogListener。
  6. 使用卸载命令卸载旧版本的 LogListener。

- 不复用断点文件（可能会重复采集日志）：
  1. 使用停止命令停止运行旧版本的 LogListener。
  2. 下载最新版本的 LogListener。
  3. 使用相关命令安装和初始化新版本 LogListener。
  4. 使用启动命令启动运行新版本 LogListener。
  5. 使用卸载命令卸载旧版本的 LogListener。
