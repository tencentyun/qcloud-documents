LogListener 是腾讯云日志服务 CLS 所提供的专用日志采集器，将它安装部署到服务器上，可快速采集日志到日志服务。



## 安装环境

LogListener 仅支持64位 Linux 操作系统环境（暂不支持 Windows），并适配主流 Linux 操作系统版本，若其他版本环境若安装异常，请 [提交工单](https://console.cloud.tencent.com/workorder/category) 联系我们。

<table>
<thead>
<tr>
<th>操作系统类别</th>
<th>确定可安装环境</th>
</tr>
</thead>
<tbody><tr>
<td nowrap="nowrap">CentOS（64位）</td>
<td>CentOS_6.8_64位、CentOS_6.9_64位、CentOS_7.2_64位、CentOS_7.3_64位、CentOS_7.4_64位、CentOS_7.5_64位、CentOS_7.6_64位</td>
</tr>
<tr>
<td>Ubuntu（64位）</td>
<td>Ubuntu Server_14.04.1_LTS_64位、Ubuntu Server_16.04.1_LTS_64位、Ubuntu Server_18.04.1_LTS_64位</td>
</tr>
<tr>
<td>Debian（64位）</td>
<td>Debian_8.2_64位、Debian_9.0_64位</td>
</tr>
<tr>
<td nowrap="nowrap">openSUSE（64位）</td>
<td>openSUSE_42.3_64位</td>
</tr>
</tbody></table>





## 安装启动

### 1. 下载安装 LogListener

LogListener 最新版本下载地址： [下载 LogListener](https://loglistener-1254077820.cos.ap-shanghai.myqcloud.com/loglistener-linux-x64-2.2.6.tar.gz)

以安装路径`/usr/local/`为例： 下载 LogListener 安装包并解压，解压路径为`/usr/local/` ，解压完成后进入 LogListener 目录`loglistener/tools`，执行安装命令 。该操作命令如下：

```shell
wget https://loglistener-1254077820.cos.ap-shanghai.myqcloud.com/loglistener-linux-x64-2.2.6.tar.gz && tar -zxvf loglistener-linux-x64-2.2.6.tar.gz -C /usr/local && cd /usr/local/loglistener-2.2.6/tools && ./loglistener.sh install
```



### 2. 初始化 LogListener

在`loglistener/tools`路径下，以 sudo 权限执行 LogListener 初始化命令（默认使用内网方式访问服务）：

```shell
sudo ./loglistener.sh init -secretid AKIDc9YlmrBcFk4C8sbmXQ8i65XXXXXXXXXX -secretkey LUSE4nPK1d4tX5SHyXv6tZXXXXXXXXXX -region ap-shanghai
```

![image-20191231105208452](https://main.qcloudimg.com/raw/531411112bf93f198fbc4b2bef3de7a3.png)

如果需要通过外网方式访问服务域名，需要显式设置网络参数 ` internet`

```shell
sudo ./loglistener.sh init -secretid AKIDPEtPyKabfW8Z3Uspdz83XXXXXXXXXXXX -secretkey whHwQfjdLnzzCE1jIf09XXXXXXXXXXXX -region ap-shanghai -network internet
```

![image-20191231105605187](https://main.qcloudimg.com/raw/e722c226cae1744638bd5a9145de23b3.png)



#### 参数说明

| 参数名    | 类型描述                                                     |
| --------- | ------------------------------------------------------------ |
| secretid  | [云 API 密钥](https://console.cloud.tencent.com/cam/capi) 的一部分，SecretId 用于标识 API 调用者身份 |
| secretkey | [云 API 密钥](https://console.cloud.tencent.com/cam/capi) 的一部分，SecretKey 是用于加密签名字符串和服务器端验证签名字符串的密钥 |
| region    | region 日志服务所在的 [地域](https://cloud.tencent.com/document/product/614/18940) |
| network   | 表示 loglistener 通过哪种方式访问服务域名，取值： intra 内网访问（默认）， internet 外网访问 |

> - 建议使用协作者密钥，需要主账号授权协作者于日志服务的读写权限。
> - region 为您所使用的日志服务区域，而非您的业务机器所处的区域。
> - 云服务器与日志集同地域的情况下，建议使用内网方式访问服务域名。



### 3. 启动 LogListener

成功安装后，以 sudo 权限执行 LogListener 启动命令：

```shell
sudo /etc/init.d/loglistenerd start
```

![1573024891837](https://main.qcloudimg.com/raw/cd40ba93f53595c2ad0107055b817aaf.png)



## 操作 LogListener 

> ?本文档示例的操作命令说明仅适用于 LogListener-2.2.4 及以上版本，低版本操作命令请参见 [低版本 LogListener 安装指南](https://cloud.tencent.com/document/product/614/39211)。

#### 查看 LogListener 版本

```shell
sudo /etc/init.d/loglistenerd -v
```

#### 启动 LogListener

```shell
sudo /etc/init.d/loglistenerd start
```

#### 重启 LogListener

```shell
sudo /etc/init.d/loglistenerd restart
```

#### 停止 LogListener

```shell
sudo /etc/init.d/loglistenerd stop
```

#### 初始化 LogListener

以管理员权限执行`loglistener/tools`目录下的初始化命令：

```shell
sudo ./loglistener.sh init -s AKIDc9YlmrBcFk4C8sbmXQ8i65XXXXXXXXXX -k LUSE4nPK1d4tX5SHyXv6tZXXXXXXXXXX -r ap-beijing
```

#### 卸载 LogListener

以管理员权限执行`/loglistener/tools`目录下的卸载命令：

```shell
sudo ./loglistener.sh uninstall
```

#### 查看 LogListener 进程状态

```shell
sudo /etc/init.d/loglistenerd status 
```

LogListener 正常情况会运行三个进程：

![1573030294422](https://main.qcloudimg.com/raw/ef6e9fcefb023e0c6bb147b9879942c8.png)

#### 检查 LogListener 心跳及配置

```shell
sudo /etc/init.d/loglistenerd check
```

![1573030900001](https://main.qcloudimg.com/raw/4b59fc95a8856421506e8d0ffda4099c.png)



## 手动更新 LogListener

- 复用断点文件（不会重复采集日志）：

  1. 使用停止命令停止运行旧版本的 LogListener。
  2. 下载最新版本的 LogListener。
  3. 使用相关命令安装和初始化新版本 LogListener。
  4. 复制旧版本中的断点文件目录（`loglistener/data`）到新版本 Loglistener目录下。例如，将 LogListener-2.2.3 旧版本的断点文件复制到新版本中。
  ```shell
  cp -r loglistener-2.2.3/data loglistener-2.2.6/
  ```
  5. 使用启动命令启动运行新版本 LogListener。
  6. 使用卸载命令卸载旧版本的 LogListener。

- 不复用断点文件（可能会重复采集日志）：
  1. 使用停止命令停止运行旧版本的 LogListener。
  2. 下载最新版本的 LogListener。
  3. 使用相关命令安装和初始化新版本 LogListener。
  4. 使用启动命令启动运行新版本 LogListener。
  5. 使用卸载命令卸载旧版本的 LogListener。
