基于日志的监控告警场景，可以通过配置告警策略来完成。本文主要介绍如何在日志服务控制台上配置告警策略。
## 前提条件
- 日志已经上传到某个 [日志主题](https://console.cloud.tencent.com/cls/logset/desc)。
- 日志主题已 [配置索引](https://cloud.tencent.com/document/product/614/50922)。

## 配置流程

###  步骤1：创建告警策略

登录 [日志服务控制台](https://console.cloud.tencent.com/cls/monitor)，单击左侧菜单栏的【监控告警】，进入告警策略创建新的告警策略。

### 步骤2：配置监控规则

#### 监控对象
选择需要监控的日志主题，并配置相应的分析语句及查询时间范围，详细参考如下：

| 名称         | 描述                                      | 示例                                                         |
| ------------ | ----------------------------------------- | ------------------------------------------------------------ |
| 日志主题     | 需要配置监控告警的目标日志主题            | 例如，nginx 日志主题                                         |
| 分析语句     | 作用于日志主题的分析语句，分析语法参考 | 示例1：统计出现 error 状态的日志条数</br>status:error \| select count(\*) as ErrCount</br>示例2：统计域名（url:aaa.com）的平均请求延时情况</br>url:"aaa.com" \| select avg(request_time) as Latency |
| 查询时间范围 | 每次运行分析语句的数据时间范围            | 示例1：统计近5分钟出现 error 状态的日志条数<br>示例2：统计近1分钟请求的平均延时 |

#### 监控周期

监控周期表示监控任务的执行频率，日志服务提供两种周期配置方式：

| 周期配置方式 | 说明                                                         | 示例                    |
| ------------ | ------------------------------------------------------------ | ----------------------- |
| 固定频率     | 按固定的时间间隔执行一次监控任务<br>时间间隔：1-1440分钟，粒度：分钟级 | 每隔5分钟执行一次监控   |
| 固定时间     | 按固定的时间点执行一次监控任务<br>时间点范围：00:00-23:59，粒度：分钟级 | 每天02:00执行一次监控 |

### 步骤3：配置告警策略

#### 触发条件

判断是否满足触发告警的条件表达式，当满足条件时进行告警。
日志服务提供 `$N.keyname `的方式引用分析结果。
- $N： 表示当前告警策略中的第  N 个监控对象（详情参见 [如何查看编号](#number)）
- keyname：表示对应的字段名称，例如 `$1.status>500` 表示编号为1的查询的 `status `字段大于500时触发告警，更多表达式语法参见 [触发条件表达式语法](https://cloud.tencent.com/document/product/614/51756)。

#### 告警频率

当持续满足触发条件达到一定次数（默认为1，有效值范围：1 - 10）以后，日志服务根据告警频率进行通知触达；通过配置持续周期的阈值可以避免不重要的偶发情况。例如，配置持续5个周期满足触发条件，表示累计触发次数达到5次以后，再进行通知触达。当修改了触发条件表达式，或计算过程中不满足表达式条件，累计次数将会清零。

#### 通知收敛

通过设置两次通知的时间间隔，避免频繁发送告警通知。当某次监控执行的结果满足触发条件，所持续累积的触发周期满足阈值，且离上次发送的通知时间满足通知间隔，则发送通知。例如，每15分钟告警一次，表示15分钟内只会收到一次告警通知。



### 步骤4：配置告警通知

通过关联通知模版，设置发送通知的方式及对象，支持短信、电话、微信、企业微信、Webhook 等通知方式。详情参见 [新增通知模版](https://cloud.tencent.com/document/product/614/51749)。

## 常见问题

### 如何查看编号？[](id:number)

在监控规则页面，监控对象左侧显示当前查询的对象编号。第1个监控对象的查询编号为1，第2个监控对象的查询编号为2，以此类推。

![](https://main.qcloudimg.com/raw/c8356f8246fb821bd57e619c9827b17c.png)
