## 实践场景

对于拥有本地 IDC 的用户，对象存储 COS 在不同迁移类型上支持以下迁移方式，帮助用户将本地 IDC 的海量数据快速迁移至对象存储 COS。

<table>
   <tr>
      <th>迁移方式</th>
      <th>说明</th>
   </tr>
   <tr>
	 <td nowrap="nowrap"><a href="#cos">COS Migration</a>（线上迁移）</td>
      <td>COS Migration 是一个集成了 COS 数据迁移功能的一体化工具。用户只需要通过简单的配置操作，便可将数据快速迁移至 COS 中。</td>
   </tr>
   <tr>
      <td nowrap="nowrap"><a href="#cdm">云数据迁移 CDM</a>（线下迁移）</td>
      <td>云数据迁移 CDM 是利用腾讯云提供的离线迁移专用设备，帮助用户将本地数据迁移至云端的一种迁移方式，可解决本地数据中心通过网络传输迁移云端时间长、成本高、安全性低的问题。</td>
   </tr>
</table>

用户可依据数据迁移量、IDC 出口带宽、IDC 空闲机位资源、可接受的迁移完成时间等因素来考虑如何选择迁移方式。下图展示的是使用线上迁移时预估的时间消耗，可以看出，若此次迁移周期超过10天或者迁移数据量超过50TB，我们建议您选择 [云数据迁移 CDM](#cdm) 进行线下迁移。否则，请选择线上迁移。
![](https://main.qcloudimg.com/raw/b07948f0626973d2d64753df39add6f4.png)

> !1MB 以下的小文件数量较多、磁盘 IO 性能不足等也会影响到数据的迁移进度。



## 迁移实践

<span id=cos>

### COS Migration 


迁移操作步骤如下：

1. 安装 Java 环境。
2. 安装 COS Migration 工具。
3. 修改配置文件。
4. 启动工具。

具体的操作方法，请参见 [COS Migration 工具](https://cloud.tencent.com/document/product/436/15392) 文档。

#### 操作技巧

下面介绍如何配置 COS Migration 能最大程度提高迁移速度：

1. 根据自身网络环境调整区分大小文件的阈值和迁移并发度，实现大文件分块，小文件并发传输的最佳迁移方式。调整工具执行时间和设立带宽限制，保证自身业务运行不受迁移数据带宽占用影响。上述调整可在配置文件 config.ini 中`[common]`分节，修改如下参数进行调整：
<table>
   <tr>
      <th>参数名称</td>
      <th>参数说明</td>
   </tr>
   <tr>
      <td>smallFileThreshold</td>
      <td>小文件阈值参数，大于等于这个阈值使用分块上传，默认设置为5MB。</td>
   </tr>
   <tr>
      <td>bigFileExecutorNum</td>
      <td>大文件并发度，默认值为8。<br>如果是通过外网来连接 COS，且带宽较小，请减小该并发度。</td>
   </tr>
   <tr>
      <td>smallFileExecutorNum</td>
      <td>小文件并发度，默认值为64。<br>如果是通过外网来连接 COS，且带宽较小，请减小该并发度。</td>
   </tr>
   <tr>
      <td>executeTimeWindow</td>
      <td>该参数定义迁移工具每天执行的时间段，其他时间则会进入休眠状态，休眠状态暂停迁移并会保留迁移进度，直到下一个时间窗口自动继续执行。</td>
   </tr>
</table>
2. 采用分布式并行传输可以进一步加快迁移速度。用户可以考虑使用多台机器安装 COS Migration 并分别执行不同源数据的迁移任务。


<span id=cdm>

### 云数据迁移 CDM


迁移操作步骤如下：

1. 前往云数据迁移 CDM 控制台提交申请。
2. 申请审核通过后，用户等待签收设备。
3. 收到设备后，按照迁移设备手册把数据拷贝至设备。
4. 完成数据拷贝后，在控制台提交回寄申请并等待腾讯云把数据迁往对象存储 COS。

详情请参见 [云数据迁移 CDM ](https://cloud.tencent.com/document/product/623) 产品文档。

#### 操作技巧

下面介绍如何高效安全通过离线迁移把数据迁移至腾迅云对象存储 COS。

1. 在 IDC 配置10Gbps的网络环境，为避免本地数据环境成为传输瓶颈，您可配备高性能的挂载点机器，最大程度加速拷贝。
2. 适用 CDM 传输数据最快的方式是并行传输数据，用户通过监控设备的 CPU 和内存使用率，如果当前迁移速度低于预期，可以选择以下并行传输方式。
	- 多台设备通过不同网络接口连接同一台 CDM 设备。
	- 多台设备通过不同网络接口连接多台 CDM 设备。


