## 实践背景

对于用户想要使用 URL 列表作为数据源地址进行数据迁移。对象存储 COS 支持以下迁移方式：
<table>
   <tr>
      <th>迁移方式</th>
      <th>说明</th>
   </tr>
   <tr>
	 <td nowrap="nowrap"><a href="#msp">迁移服务平台 MSP</a></td>
      <td>迁移服务平台 MSP 是集成了多种迁移工具，并且提供可视化界面的平台，能够帮助用户轻松监控和管理大规模的数据迁移任务。其中“文件迁移工具”能帮助用户将数据从各类公有云和数据源站中迁移至对象存储 COS。</td>
   </tr>
   <tr>
	 <td><a href="#huiyuan">COS 回源</a></td>
      <td>COS 回源是把数据源站中有读写访问请求的数据自动迁移至腾讯云的对象存储 COS。此迁移方式不仅可以帮助用户快速对数据进行冷热分层，还能加快业务系统中热数据的读写访问速度。</td>
   </tr>
   <tr>
	 <td><a href="#cos">COS Migration</a></td>
      <td>COS Migration 是一个集成了 COS 数据迁移功能的一体化工具。用户只需要通过简单的配置操作，便可将数据快速迁移至 COS 中。</td>
   </tr>
</table>

在数据源站迁移上云的过程中，如果用户只希望把数据源站中的热数据全部迁移至云端，而冷数据保留在源站，可以采取 [COS 回源](#huiyuan) 的迁移方式。COS 回源可以实现将有读写请求访问的热数据迁移至对象存储 COS，自动对低频访问的业务数据进行冷热分层。


>!目前 COS 暂不支持含有鉴权信息的 URL 数据进行迁移。

## 迁移实践
<span id=msp>

### 迁移服务平台 MSP

迁移操作步骤如下：

1. 登录 [迁移服务平台 MSP](https://console.cloud.tencent.com/msp)。
2. 在左导航栏中单击【对象存储迁移】，进入对象存储迁移页面。
3. 单击【新建任务】，新建迁移任务并配置任务信息。
4. 启动任务。

具体操作可参见 [URL 列表迁移](https://cloud.tencent.com/document/product/659/37997)。


#### 操作技巧

在进行数据迁移过程中，数据源的读取速度会因为不同的网络环境而有所差异，但客户根据实际状况在“新建文件迁移任务”时选择较高的 QPS 并发度，有助于提高迁移速度 。

<span id=huiyuan>

### COS 回源



迁移操作步骤如下：

1. 进入对象存储控制台，在待迁移数据的目标存储桶中开启回源设置。
2. 配置存储桶回源地址，然后保存。
3. 将业务系统的读写请求转到腾讯云对象存储 COS 上。

具体操作请参见 [设置回源](https://cloud.tencent.com/document/product/436/13310) 文档。

#### 操作技巧

以下步骤可以完成源数据的冷热分离，热数据无缝迁移到腾讯云对象存储 COS，以便加快热数据的读取请求速度。

1. 将业务系统的读写请求切换到 COS 上，在 COS 控制台打开回源设置功能，回源地址为数据源站，此时系统结构如下图所示。
![](https://main.qcloudimg.com/raw/c30ed0391380420007bf9e2d89df89eb.png)
2. 一段时间后，冷数据仍然在源站，但热数据已经迁移至腾讯云对象存储 COS。迁移过程中业务系统不受影响。



<span id=cos>

### COS Migration

迁移操作步骤如下：

1. 安装 Java 环境。
2. 安装 COS Migration 工具。
3. 修改配置文件。
4. 启动工具。

具体的操作方法，请参见 [COS Migration 工具](https://cloud.tencent.com/document/product/436/15392) 文档。



#### 操作技巧
下面介绍如何配置 COS Migration 能最大程度提高迁移速度：


1. 根据自身网络环境调整区分大小文件的阈值和迁移并发度，实现大文件分块，小文件并发传输的最佳迁移方式。调整工具执行时间和设立带宽限制，保证自身业务运行不受迁移数据带宽占用影响。上述调整可在配置文件 config.ini 中`[common]`分节，修改如下参数进行调整：
<table>
   <tr>
      <th>参数名称</td>
      <th>参数说明</td>
   </tr>
   <tr>
      <td>smallFileThreshold</td>
      <td>小文件阈值参数，大于等于这个阈值使用分块上传，默认设置为5MB。</td>
   </tr>
   <tr>
      <td>bigFileExecutorNum</td>
      <td>大文件并发度，默认值为8。<br>如果是通过外网来连接 COS，且带宽较小，请减小该并发度。</td>
   </tr>
   <tr>
      <td>smallFileExecutorNum</td>
      <td>小文件并发度，默认值为64。<br>如果是通过外网来连接 COS，且带宽较小，请减小该并发度。</td>
   </tr>
   <tr>
      <td>executeTimeWindow</td>
      <td>该参数定义迁移工具每天执行的时间段，其他时间则会进入休眠状态，休眠状态暂停迁移并会保留迁移进度，直到下一个时间窗口自动继续执行。</td>
   </tr>
</table>
2. 采用分布式并行传输可以进一步加快迁移速度。用户可以考虑使用多台机器安装 COS Migration 并分别执行不同源数据的迁移任务。
