## 适用场景
- 对响应延时和下载速度有较高要求的场景。
- 需跨地区、国家、大洲传输数 GB 至数 TB 数据的场景。
- 需高密集地反复下载相同的内容的场景。

## 相关说明
关于域名定义、CDN 回源鉴权和 CDN 鉴权配置已在 [CDN 加速概述](/document/product/436/18669) 文档中介绍，此处不再赘述。

CDN 回源鉴权、CDN 鉴权配置会影响 CDN 加速域名和 COS 域名对源站存储桶的访问方式，具体情况如下表：

| 存储桶访问权限      | CDN 回源鉴权 | CDN 鉴权配置 | CDN 加速域名    | COS 域名        | 场景         |
| ------------------- | ------------ | ------------ | --------------- | --------------- | ------------ |
| 公有读              | 关闭         | 关闭         | 可访问          | 可访问          | 全站公共访问 |
| 公有读              | 开启         | 关闭         | 可访问          | 可访问          | 不推荐       |
| 公有读              | 关闭         | 开启         | 需使用 URL 鉴权 | 可访问          | 不推荐       |
| 公有读              | 开启         | 开启         | 需使用 URL 鉴权 | 可访问          | 不推荐       |
| 私有读+CDN 服务授权 | 开启         | 开启         | 需使用 URL 鉴权 | 需使用 COS 鉴权 | 全链路保护   |
| 私有读+CDN 服务授权 | 关闭         | 开启         | 不可访问        | 需使用 COS 鉴权 | 不推荐       |
| 私有读+CDN 服务授权 | 开启         | 关闭         | 可访问          | 需使用 COS 鉴权 | 源站保护     |
| 私有读+CDN 服务授权 | 关闭         | 关闭         | 不可访问        | 需使用 COS 鉴权 | 不推荐       |
| 私有读              | 关闭         | 开启或关闭   | 不可访问        | 需使用 COS 鉴权 | 无法使用 CDN |

## 对默认加速域名配置 CDN 加速

默认加速域名是 COS 为存储桶自动分配的一个 CDN 加速域名，形如`<BucketName-APPID>.file.mycloud.com`，用户可选择**开启**或**关闭**。

### 开启功能
#### 1. 选择存储桶
登录 [对象存储控制台](https://console.cloud.tencent.com/cos5) ，在左侧导航栏中，单击【存储桶列表】，并单击需要加速的存储桶，进入存储桶管理页。
![](https://main.qcloudimg.com/raw/141f56dd0bb515b3705fc9142e52104f.jpg)


#### 2. 进入配置页面
>!从未使用过腾讯云 CDN 服务的用户将无法进入【域名管理】，需先单击外链进入 [CDN 控制台](https://console.cloud.tencent.com/cdn) 开通 CDN 服务。

单击左侧的【域名管理】，找到【默认加速域名】配置项。默认加速域名的初始状态为**关闭**。单击【编辑】，将当前状态设置为**开启**。
![](https://main.qcloudimg.com/raw/7ab9ab6d18d9ce3431b3f0feeb866778.jpg)
**源站类型**：源站类型默认是**默认源站**，若作为源站的存储桶开启了静态网站，并且希望为静态网站加速，可以将源站类型设置为**静态网站源站**，具体详情请参阅 [CDN 加速概述](https://cloud.tencent.com/document/product/436/18669)。

#### 3. 添加 CDN 服务授权（可选）

添加 CDN 服务授权是为了授予 CDN 边缘节点对存储桶进行操作的服务身份，具体情况如下：

- 公有读存储桶：CDN 边缘节点无需任何授权即可直接访问存储桶，无需添加 CDN 服务授权。
- 私有读存储桶：CDN 边缘节点需被授予特殊的服务身份才能访问存储桶，单击【添加 CDN 服务授权】授予 CDN 边缘节点服务身份，选择【我同意以上授权】，并单击【确定】。

添加授权后，CDN 边缘节点可以对存储桶进行 GET Object，Head Object，Options Object 这三项操作。

![](https://main.qcloudimg.com/raw/fcb0f7d7b3408c836b4a546a8910cde1.png)

同意授权之后，系统会自动写入存储桶访问策略，策略示例如下。之后 CDN 节点在需要回源时无需再进行其他操作。

```xml
  {
    "Statement": [
      {
        "Action": [
          "name/cos:GetObject",
          "name/cos:HeadObject",
          "name/cos:OptionsObject"
        ],
        "Effect": "allow",
        "Principal": {
          "qcs": [
            "qcs::cam::uin/100000000001:service/cdn"
          ]
        },
        "Resource": [
          "qcs::cos:ap-chengdu:uid/1250000000:examplebucket-1250000000/*"
        ]
      }
    ],
    "version": "2.0"
  }
```

#### 4. 开启回源鉴权（可选）
>!需添加 CDN 服务授权之后才可开启回源鉴权。

回源鉴权是用来验证 CDN 边缘节点的服务身份以阻止非法访问，具体情况如下：
- 公有读存储桶：CDN 边缘节点无需任何授权即可直接访问存储桶，无需开启回源鉴权。
- 私有读存储桶：CDN 边缘节点需经回源鉴权验证服务身份，验证通过的 CDN 边缘节点才能访问存储桶中对象，单击开启【回源鉴权】>【保存】。
![](https://main.qcloudimg.com/raw/2e0d85ced4511a4091a584f6e1dd4223.png)

>!对于私有读存储桶，开启回源鉴权和 CDN 服务授权会使 CDN 边缘节点访问源站时无需携带签名，CDN 缓存资源会进行公网分发，导致数据的安全性受到影响，因此强烈建议开启 CDN 鉴权。

#### 5. 开启 CDN 加速
单击【保存】之后，可以看到默认加速域名在部署中（预计5分钟左右配置完成）。

### 配置鉴权
>!在为默认域名启用 CDN 加速之后，任何人都可以通过此域名直接访问源站，如果您的数据有一定的私密性，请您务必开启鉴权配置来保护您的源站数据。

开启默认加速域名和回源鉴权后，默认加速域名管理界面下会出现一条 CDN 鉴权状态提示，可通过提示上【鉴权配置】直接跳转到对应域名的 CDN 安全配置页面进行配置。
![](https://main.qcloudimg.com/raw/1d493ba44c60e0b0931e09a432891b77.png)

从 [CDN 控制台](https://console.cloud.tencent.com/cdn) 进入 CDN 鉴权配置页面的路径为【域名管理】> 对应域名的【管理】>【安全配置】。具体配置步骤详见 [鉴权配置](https://cloud.tencent.com/document/product/228/33115) 。


### 关闭功能
- 在默认加速域名管理界面，单击【编辑】，把状态从**开启**改成**关闭**，单击【 保存】，大约需要5分钟时间进行部署。部署完成之后在 CDN 控制台上该域名的状态由**已启动**变为**已关闭**。
![](https://main.qcloudimg.com/raw/029ef0a210a6fe1343bd5b7302c7d0d2.png)

- 在 [CDN 控制台](https://console.cloud.tencent.com/cdn) 可以对域名进行关闭/删除操作，详情请见 [域名操作](https://cloud.tencent.com/document/product/228/5736) 。
>!在 CDN 控制台删除的只是默认加速域名在 CDN 加速时的记录，并不会将默认加速域名真正抹去，可在 COS 控制台重新开启默认加速域名。


## 对自定义加速域名配置 CDN 加速
用户可以通过 COS 控制台为存储桶绑定自定义域名，绑定后开启 CDN 加速，便可通过自定义域名加速访问存储桶。绑定自定义域名时，用户需自行在自定义域名的服务提供商处添加 CNAME 解析。
>! 目前 COS 使用自定义域名必须开启 CDN，请根据您的情况进行判断：
1. 若您的域名接入国内 CDN，需要备案。但不要求必须通过腾讯云备案，保证接入的域名已备案即可。
2. 若您的域名接入海外 CDN，不需要备案。但需要注意，您在腾讯云上存放的数据和操作行为仍需遵守相关国家的法律法规，以及[《腾讯云服务协议》](https://cloud.tencent.com/document/product/301/1967)。

### 开启功能
>!COS 控制台和 CDN 控制台均可完成自定义域名添加及开启 CDN 加速，若要从 CDN 控制台添加自定义域名，可以参考 [域名接入](https://cloud.tencent.com/document/product/228/5734)。

#### 1. 选择自定义加速域名要绑定的存储桶
登录 [对象存储控制台](https://console.cloud.tencent.com/cos5) ，在左侧导航栏中，单击【存储桶列表】，单击需要加速的存储桶，进入存储桶。
![](https://main.qcloudimg.com/raw/141f56dd0bb515b3705fc9142e52104f.jpg)


#### 2. 添加自定义加速域名
单击【域名管理】，进入域名管理页面，单击【自定义加速域名】配置项下的【添加域名】，进入可配置状态。
- **域名**：输入您已购买的域名（例如 `www.example.com`）。
- **源站类型**：默认是**默认源站**，如果选择的存储桶开启了静态网站功能，并且希望为静态网站加速，则可以将源站类型设置为**静态网站源站**。
![](https://main.qcloudimg.com/raw/1ef8d7906ba9a0e4a0a466601a8daa38.jpg)


#### 3. 开启回源鉴权（可选）
回源鉴权是用来验证 CDN 边缘节点的服务身份以阻止非法访问，具体情况如下：

- 公有读存储桶：CDN 边缘节点无需任何授权即可直接访问存储桶，无需开启回源鉴权。
- 私有读存储桶：CDN 边缘节点需经回源鉴权验证服务身份，验证通过的 CDN 边缘节点才能访问存储桶中对象，选择开启【回源鉴权】。
![](https://main.qcloudimg.com/raw/f38730442f491cb15d94ee8909eba0f3.jpg)
>!对于私有读存储桶，开启回源鉴权会使 CDN 边缘节点访问源站时无需携带签名，CDN 缓存资源会进行公网分发，导致数据的安全性受到影响，因此强烈建议开启 CDN 鉴权。

#### 4. 开启 CDN 加速

在右侧单击【保存】，等待5分钟左右，自定义域名的添加与 CDN 加速即可部署完成。

### 配置鉴权
>!您在为自定义域名启用 CDN 加速之后，任何人都可以通过此域名直接访问源站，如果您的数据有一定的私密性，请您务必开启鉴权配置来保护您的源站数据。

自定义域名部署完成后，CDN 鉴权栏会出现 CDN 鉴权功能设置链接，单击【设置】可直接进入 CDN 控制台进行 CDN 鉴权配置，具体操作方式详见 [鉴权配置](https://cloud.tencent.com/document/product/228/33115) 。
![](https://main.qcloudimg.com/raw/f1796258812b5df641a723571bf184f3.png)


### 解析域名
在自定义域名接入 CDN 后，系统会自动为您分配一个 CNAME 域名（以`.cdn.dnsv1.com`为后缀)，您需要在域名服务提供商处完成 CNAME 的配置，具体请见 [CNAME 配置](https://cloud.tencent.com/document/product/228/3121) 。

>!CNAME 域名不能直接访问。
![CNAME](https://main.qcloudimg.com/raw/8b821de049d5bc619494c89cceed3ffa.png)

### 关闭功能
在自定义加速域名管理界面，单击【编辑】可更改域名状态，将域名状态由**已上线**改为**已下线**，单击【保存】后等待部署，时间大约为5分钟即可关闭功能， CDN 控制台上相对应的自定义加速域名的状态由**已启动**改为**已关闭**。

>!如果要删除自定义域名，在自定义域名状态为**已上线**时，无法直接删除域名的，必须将状态改为**已下线**才可删除域名。您可在 [CDN 控制台](https://console.cloud.tencent.com/cdn) 对域名进行关闭或删除操作，详情请参见 [域名操作](https://cloud.tencent.com/document/product/228/5736)。

