## 概述

腾讯云对象存储（Cloud Object Storage，COS）提供了对象锁定功能，支持用户设定保留期限内的对象不可改写、不可删除。

>? 
>- 基于对象锁定功能，对象存储 COS 可满足严格的电子记录保留要求，包括 SEC Rule 17a-4（f）、FINRA 4511、CFTC 1.31等合规要求。
>- SEC 17A-4 法规是美国证券交易委员会根据1934年美国证券交易法而颁布的法规，该法规概述了数据保留、索引、可访问性要求，适用于从事股票，债券和期货等金融证券交易或经纪业务公司，根据该法规，许多类型交易记录必须保留并不可重写和擦除，期限为两年内可立即访问，至少六年内为非立即访问。

对象锁定功能当前为存储桶级别，每个存储桶只可配置一条基于时间策略的对象锁定，保留周期为1天 - 100年，同时保留周期必须设定，不存在永久期限。

存储桶配置对象锁定后，在保留周期内：
- 对象不可删除、修改。
- 对象存储类型不可修改。
- 对象 HTTP 头部和用户元数据都不可修改，包括 Content-Type、Content-Encoding、 Content-Language、Content-Disposition、Cache-Control、Expires、x-cos-meta-。
- 对象标签不可修改。

基于时间策略的对象锁定只有一种状态，创建时间策略提交后，即生效，此状态下无法修改和删除规则，且只允许延长保留周期。


## 使用方法

您可以通过控制台、API 的方式设置对象锁定。

#### 使用对象存储控制台

您可通过对象存储控制台设置对象锁定，请参见 [设置对象锁定](https://cloud.tencent.com/document/product/436/55293) 控制台指南文档。

#### 使用 REST API

您可以直接通过以下 API 管理对象锁定：

- [PUT Bucket ObjectLockConfiguration](https://cloud.tencent.com/document/product/436/55290)
- [GET Bucket ObjectLockConfiguration](https://cloud.tencent.com/document/product/436/55291)
- [GET Object Retention](https://cloud.tencent.com/document/product/436/55292) 


## 限制说明

1. 对象锁定功能目前仅对白名单客户开放，请 [联系我们](https://cloud.tencent.com/document/product/436/37708)。
2. 存储桶的对象锁定配置开启后，大概在5秒内生效。
3. 对象锁定功能支持存量存储桶和存量对象，可参考如下示例：
假设您在2012年7月1日创建一个名为 examplebucket 的存储桶，并且在不同时间点上传了 test1.txt、 test2.txt、test3.txt 三个文件，随后在2013年9月1日创建了保留周期为5年对象锁定策略， 有关这三个文件的具体上传时间以及对应对象锁定规则到期日期如下：
<table>
	<tr><th>文件名称</th><th>上传时间</th><th>对象锁定规则到期日期</th></tr>
	<tr><td>test1.txt</td><td>2012年7月1日</td><td>2017年6月30日</td></tr>
	<tr><td>test2.txt</td><td>2013年9月1日</td><td>2018年8月31日</td></tr>
	<tr><td>test3.txt</td><td>2017年7月30日</td><td>2022年7月29日</td></tr>
</table>

4. 对象锁定不支持版本控制功能，已开启对象锁定的存储桶不支持开启版本控制，存储桶版本控制处于开启、暂停状态，均不支持开启对象锁定。
5. 对象锁定不支持存储桶复制功能，由于对象锁定不兼容版本控制功能，且在存储桶复制规则下源存储桶、目标存储桶必须开启版本控制，所以开启对象锁定的存储桶无法作为存储桶复制的源存储桶、目标存储桶。
6. 对象锁定不支持智能分层功能。已开启对象锁定的存储桶不支持开启智能分层配置，存储桶开启智能分层配置后，不支持开启对象锁定。
7. 对象锁定与生命周期规则的关系。对象处于保留期内，生命周期配置的沉降、删除操作均不生效；对象超过保留期后，生命周期配置的沉降、删除操作可正常生效。
<table>
	<tr><th>生命周期规则</th><th>对象锁定保留期</th><th>生命周期执行表现</th></tr>
	<tr><td>20天沉降对象</td><td>30天保留期</td><td>上传后第20天，对象不沉降，上传后第31天对象沉降。</td></tr>
	<tr><td>20天删除对象</td><td>30天保留期</td><td>上传后第20天，对象不删除，上传后第31天对象被删除。</td></tr>
	<tr><td>20天沉降对象</td><td>10天保留期</td><td>上传后20天对象正常沉降。</td></tr>
	<tr><td>20天删除对象</td><td>10天保留期</td><td>上传后20天对象正常删除。</td></tr>
</table>
8. 对存储桶开启对象锁定后，文件碎片不受对象锁定规则限制，用户可以清除存储桶内的文件碎片。
9. 对象锁定功能开启后无法关闭。当存储桶内所有文件清空后，可以通过删除存储桶取消对象锁定规则。
10. 开启对象锁定后，存储桶和对象 ACL 可以修改。

