## 适用场景

- 对响应延时和下载速度有较高要求的场景。
- 需跨地区、国家、大洲传输数 GB 至数 TB 数据的场景。
- 需高密集地反复下载相同的内容的场景。

>!当您的下载请求来源于腾讯云 VPC 内（例如使用腾讯云 CVM 访问存储桶），建议直接使用 COS 标准域名。若使用自定义 CDN 加速域名，用户相当于通过外网访问 CDN 节点，将会产生额外的 CDN 回源流量费用、CDN 流量费用等。
>

## 相关说明

关于域名定义、CDN 回源鉴权和 CDN 鉴权配置已在 [CDN 加速概述](https://cloud.tencent.com/document/product/436/18669) 文档中介绍，此处不再赘述。

CDN 回源鉴权、CDN 鉴权配置会影响自定义 CDN 加速域名和 COS 域名对源站存储桶的访问方式，具体情况如下表：

| 存储桶访问权限       | 是否开启 CDN 回源鉴权 | 是否开启 CDN 鉴权配置 | 通过自定义 CDN 加速域名是否<br>可访问源站 | 通过 COS  源站域名是否<br>可访问源站 | 适用场景     |
| ------------------- | ------------ | ------------ | --------------- | --------------- | ------------ |
| 公有读              | 关闭         | 关闭         | 可访问          | 可访问          | 全站公共访问 |
| 公有读              | 开启         | 关闭         | 可访问          | 可访问          | 不推荐       |
| 公有读              | 关闭         | 开启         | 需使用 URL 鉴权 | 可访问          | 不推荐       |
| 公有读              | 开启         | 开启         | 需使用 URL 鉴权 | 可访问          | 不推荐       |
| 私有读+CDN 服务授权 | 开启         | 开启         | 需使用 URL 鉴权 | 需使用 COS 鉴权 | 全链路保护   |
| 私有读+CDN 服务授权 | 关闭         | 开启         | 需使用 URL 鉴权       | 需使用 COS 鉴权 | 不推荐       |
| 私有读+CDN 服务授权 | 开启         | 关闭         | 可访问          | 需使用 COS 鉴权 | 源站保护    |
| 私有读+CDN 服务授权 | 关闭         | 关闭         | 不可访问        | 需使用 COS 鉴权 | 不推荐       |
| 私有读              | 关闭         | 开启或关闭   | 不可访问        | 需使用 COS 鉴权 | 无法使用 CDN |

>!以上表格中的**源站保护**场景，若未开启 CDN 鉴权配置，可能导致您缓存在 CDN 边缘节点上的数据被恶意拉取，因此强烈建议同时开启 CDN 鉴权配置以保障数据的安全。

## 配置 CDN 加速


用户可以通过 COS 控制台为存储桶绑定自定义域名，然后为自定义域名开启 CDN 加速，最后通过自定义域名加速访问存储桶。绑定自定义域名时，用户需自行在自定义域名的服务提供商处添加 CNAME 解析。

>! 目前 COS 使用自定义加速域名必须开启 CDN，请根据您的情况进行判断：
1. 若您的域名接入国内 CDN，需要备案。但不要求必须通过腾讯云备案，保证接入的域名已备案即可。
2. 若您的域名接入海外 CDN，不需要备案。但需要注意，您在腾讯云上存放的数据和操作行为仍需遵守相关国家的法律法规，以及[《腾讯云服务协议》](https://cloud.tencent.com/document/product/301/1967)。

### 前提条件


1. 注册域名。您可以通过腾讯云 [域名注册](https://console.cloud.tencent.com/domain) 或其他服务商注册域名。
2. 域名备案。若域名接入国内 CDN，需要完成域名备案，具体介绍请参见 [备案指引](https://cloud.tencent.com/document/product/243)。

### 操作步骤

>!COS 控制台和 CDN 控制台均可完成自定义域名添加及开启 CDN 加速，若要从 CDN 控制台添加自定义域名，可以参考 [接入域名](https://cloud.tencent.com/document/product/228/41215)。

#### 1. 选择存储桶
登录 [对象存储控制台](https://console.cloud.tencent.com/cos5) ，在左侧导航栏中，单击**存储桶列表**，单击需要开启 CDN 加速的存储桶，进入存储桶。

#### 2. 添加自定义 CDN 加速域名

单击**域名与传输管理 > 自定义 CDN 加速域名**，在**自定义 CDN 加速域名**配置项下，单击**添加域名**，进入可配置状态。
  - **域名**：输入待绑定的自定义域名（例如`www.example.com`）。请确保输入的域名已备案，并已在 DNS 服务商处设置好对应的 CNAME，详情请参见 [CNAME 配置](https://cloud.tencent.com/document/product/228/3121)。若您在接入的自定义 CDN 加速域名为以下情况，则需要进行域名归属权验证，详情请查看 [域名归属验证](https://cloud.tencent.com/document/product/228/61702) 文档。
     - 首次接入该域名
     - 该域名已被其他用户接入
     - 接入域名为泛域名
  - **加速地域**：支持中国境内、中国境外和全球加速，其中全球加速指支持所有地域之间的存储桶加速。
  - **源站类型**：默认是**默认源站**，若作为源站的存储桶开启了静态网站，并且希望为静态网站加速，可以将源站类型设置为**静态网站源站**，具体详情请参阅 [CDN 加速概述](https://cloud.tencent.com/document/product/436/18669)。
  - **鉴权**：开启回源鉴权。对于私有读存储桶，请**开启回源鉴权**以保护源站。
>!
>对于私有读存储桶，同时开启回源鉴权和 CDN 服务授权会导致通过 CDN 访问源站时无需携带签名，CDN 缓存资源将进行公网分发，导致数据的安全性受到影响，建议开启 CDN 鉴权。
>
  - 开启回源鉴权
回源鉴权是用来验证 CDN 边缘节点的服务身份以阻止非法访问，具体情况如下：
     - 公有读存储桶：CDN 边缘节点无需任何授权即可直接访问存储桶，无需开启回源鉴权。
     - 私有读存储桶：CDN 边缘节点需经回源鉴权验证服务身份，验证通过的 CDN 边缘节点才能访问存储桶中对象，选择开启**回源鉴权**。
![](https://qcloudimg.tencent-cloud.cn/raw/6d05c90f04b276e21df88135af93f917.png)
开启**回源鉴权**后，在右侧单击**保存**，等待5分钟左右，自定义域名的添加与 CDN 加速即可部署完成。
  - 开启 CDN 鉴权
>!
>您在为自定义域名启用 CDN 加速之后，任何人都可以通过此域名直接访问源站，如果您的数据有一定的私密性，请您务必开启 CDN 鉴权配置来保护您的源站数据。
>
自定义域名部署完成后，CDN 鉴权栏会出现 CDN 鉴权功能设置链接，单击**设置**可直接进入 CDN 控制台进行 CDN 鉴权配置，具体操作方式详见 [鉴权配置](https://cloud.tencent.com/document/product/228/41622) 。

  - **CDN 缓存自动刷新**：开启后，触发 COS 存储桶更新文件规则时，将自动刷新 CDN 缓存，可前往 COS 函数计算配置，操作指引请参见 [设置 CDN 缓存刷新](https://cloud.tencent.com/document/product/436/45597)。
  - **HTTPS 证书**：如需为自定义 CDN 加速域名添加 HTTPS 证书，可前往 [CDN 控制台](https://console.cloud.tencent.com/cdn/certificate) 进行配置。


#### 3. 解析域名

在自定义域名接入 CDN 后，系统会自动为您分配一个 CNAME 域名（以`.cdn.dnsv1.com`为后缀），您需要在域名服务提供商处完成 CNAME 的配置，具体请见 [CNAME 配置](https://cloud.tencent.com/document/product/228/3121) 。

>!CNAME 域名不能直接访问。



#### 4. 关闭功能

以上步骤完成后，即可通过自定义域名加速访问存储桶内资源。如需关闭自定义 CDN 加速，可通过以下方式关闭：

在自定义 CDN 加速域名管理界面，单击**编辑**可更改域名状态，将域名状态由**已上线**改为**已下线**，单击**保存**后等待部署，时间大约为5分钟即可关闭功能， CDN 控制台上相对应的自定义加速域名的状态由**已启动**改为**已关闭**。

>!如果要删除自定义域名，在自定义域名状态为**已上线**时，无法直接删除域名的，必须将状态改为**已下线**才可删除域名。您可在 [CDN 控制台](https://console.cloud.tencent.com/cdn) 对域名进行关闭或删除操作，详情请参见 [域名操作](https://cloud.tencent.com/document/product/228/41241)。


