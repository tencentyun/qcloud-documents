## 功能说明

本迁移工具支持从AWS S3, 阿里云 OSS和七牛等服务中迁移文件到COS对象存储；同时也支持文件列表迁移，即从一系列给定的URL中迁移文件到COS对象存储。**只适用于COS 4.0**

## 使用环境

### 系统环境

Linux，Mac OS

### 软件依赖

工具运行平台为\*nix，需要有Python2.6及以上环境，同时机器应该安装pip, gcc与python-dev。您可以使用系统自带的包管理器安装相关依赖。

在centos上，使用如下命令安装：
```bash
sudo yum install python-pip python-devel gcc
```

在ubuntu/debian上，使用如下命令安装：
```bash
sudo apt-get install python-pip python-dev gcc
```
## 使用方法

### 获取工具

Github项目地址：https://github.com/tencentyun/cos_migrate_tool

### 安装方法

推荐使用pip安装，安装pip的方法，可以参考[官网](https://pip.pypa.io/en/latest/installing/)或者使用apt/yum等包管理工具安装python-pip包。

```bash
 pip install -U cos_migrate_tool
    
```
执行完上述命令后，可以尝试使用如下命令检测是否安装成功。
```bash
cos_migrate_tool -h
```

### 配置文件

配置文件模板, common 部分配置基本配置，workspace是上述的工作目录。source 部分配置数据源的信息，如果你想迁移oss到cos，该部分就是配置oss的属性。destination 部分配置cos属性。

**配置文件请删除注释文字，即 `# 注释` 部分，空白模板参考 [链接](https://github.com/tencentyun/cos_migrate_tool/tree/master/conf)**

```bash
[common]
workspace=/tmp/tmp6   # 工作目录
threads=20            # 工作线程数，如果不配置，则为10线程

[source]
type=oss
accesskeyid=
accesskeysecret=
bucket=
endpoint=

[destination]
type=cosv4
region=shanghai
accesskeyid=
appid=
accesskeysecret=
bucket=sdktest
```

#### 迁移OSS中文件

```bash
[common]
workspace=/tmp/tmp6

[source]
type=oss
accesskeyid=         # oss accesskey id
accesskeysecret=     # oss accesskey secret
bucket=              # 要迁移的bucket名
endpoint=            # oss 的endpoint，例如 oss-cn-beijing.aliyuncs.com

[destination]
type=cosv4
region=shanghai            # cos 的 region，如shanghai, guangzhou
accesskeyid=               # cos 的 accesskeyid
appid=                     # cos 的 appid
accesskeysecret=           # cos 的 accesskeysecret
bucket=sdktest             # cos 的 bucket
prefix_dir=/dir21          # cos 的目录，迁移的文件都会位于该目录下，不配置该项则迁移到根目录
```

#### 迁移七牛中的文件

```bash
[common]
workspace=/tmp/tmp11
       

[source]
type=qiniu
accesskeyid=               # qiniu 的 accesskeyid
accesskeysecret=           # qiniu 的 accesskeysecret
bucket=                    # 要迁移的qiniu的bucket
domain_url=                # qiniu 的下载域名

[destination]
type=cosv4
region=shanghai            # cos 的 region，如shanghai, guangzhou
accesskeyid=               # cos 的 accesskeyid
appid=                     # cos 的 appid
accesskeysecret=           # cos 的 accesskeysecret
bucket=sdktest             # cos 的 bucket
prefix_dir=/dir21          # cos 的目录，迁移的文件都会位于该目录下，不配置该项则迁移到根目录
```

#### 迁移S3中的文件

```bash
[common]
workspace=/tmp/tmp21

[source]
type=s3
accesskeyid=               # s3 的 accesskey id
accesskeysecret=           # s3 的 accesskey secret
bucket=                    # s3 的要迁移的bucket名

[destination]
type=cosv4
region=shanghai
accesskeyid=
appid=
accesskeysecret=
bucket=

```

#### 迁移列表文件

```bash
[common]
workspace=

[source]
type=url
url_list_file=/tmp/urllist.txt   # 要迁移的文件url列表文件，文件每一行为一个完整的url
timeout=3                        # http请求的超时时间

[destination]
type=cosv4
region=
accesskeyid=
appid=
accesskeysecret=
bucket=
```

### 运行工具

在安装成功后，系统会有一个可执行命令 `cos_migrate_tool`，之后的迁移过程都是使用该命令。执行命令的方式如下：

```bash
cos_migrate_tool -c /path/to/your/conf
```

配置文件自行编写，模版参考上文内容。在配置文件中，需要配置一个工作目录，之后迁移过程中产生的临时文件都在放置在该目录，请保证目录空间足够大，如果并行执行多个迁移任务，推荐使用不同的目录。

在迁移过程中，你可以查看你设定的工作目录下面的 fail_file.txt 来查看迁移失败的文件列表。

### 卸载方法

执行如下命令：

```
pip uninstall cos_migrate_tool
```

## 常见问题
1. pip 命令不存在。 使用 apt install python-pip 或者 yum install python-pip 命令安装PIP。
2. 使用pip安装迁移工具不成功。尝试执行 sudo pip install cos_migrate_tool。

