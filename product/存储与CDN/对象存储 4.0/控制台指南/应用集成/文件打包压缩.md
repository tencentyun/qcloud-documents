## 简介

ZIP 多文件打包压缩是腾讯云对象存储（Cloud Object Storage，COS）基于 [云函数（Serverless Cloud Function，SCF）](https://cloud.tencent.com/document/product/583) 为用户提供的数据处理解决方案。用户为存储桶添加多文件打包压缩规则后，指定需要打包压缩文件的 URLs，再通过触发 SCF 函数来执行打包压缩的动作，并将最终的压缩包投递至存储桶的指定路径下。


## 注意事项

- ZIP 多文件打包压缩最终生成的压缩包不能大于50GB。
- 若您此前在对象存储控制台上为存储桶添加了 ZIP 多文件打包压缩规则，可以在 [云函数控制台](https://console.cloud.tencent.com/scf/list?rid=1&ns=default) 上看到您所创建的 ZIP 多文件打包缩函数，请**不要**删除该函数，否则可能导致您的规则不生效。
- 已上线云函数的地域均已支持 ZIP 多文件打包压缩，包括有广州、上海、北京、成都、香港、新加坡、孟买、多伦多、硅谷等，更多支持地域可查看 [云函数产品文档](https://cloud.tencent.com/document/product/583)。
- 如果在打包压缩的过程中出现报错，您可以单击所创建的函数右侧的**查看日志**，跳转到云函数控制台查看日志错误详情。
- 归档存储和深度归档存储类型文件不支持打包压缩，如您需要打包压缩此类型的对象，请先恢复后再进行，恢复操作请参见 [恢复归档对象](https://cloud.tencent.com/document/product/436/32430)。
- 对象存储打包压缩功能依赖于云函数服务，云函数服务为用户提供了 [免费额度](https://cloud.tencent.com/document/product/583/12282)，超出免费额度的部分需要按照 [云函数产品定价](https://cloud.tencent.com/document/product/583/12281) 收费。当您使用打包压缩功能时，如果您打包的文件越多，文件越大，将消耗更多的资源使用量；如果您打包压缩的次数越多，则将消耗更多的调用次数。

## 操作步骤

1. 登录 [对象存储控制台](https://console.cloud.tencent.com/cos5)。
2. 在左侧导航中，单击**应用集成**，选择**数据处理**标签卡，进入基础处理页面。
3. 单击**ZIP 多文件打包**的**配置函数**，进入 **ZIP 多文件打包**配置页面。
>! 若您尚未开通云函数，请前往 [云函数控制台](https://console.cloud.tencent.com/scf) 开通云函数服务，按照提示完成服务授权即可。
>
4. 单击**添加函数**，在弹出的窗口中配置如下信息：
 - **函数名称**：函数名称作为函数的唯一标识名称，创建后不可修改。您可以在 [云函数控制台](https://console.cloud.tencent.com/scf/list?rid=1&ns=default) 上查看该函数。
 - **执行配置**：选择该函数的执行方式，选择同步执行，函数会在执行完压缩任务后才会响应，并返回运行结果。如果选择异步执行，函数会直接响应，并在后台持续执行压缩任务。
 ![](https://main.qcloudimg.com/raw/f7087a7ecc04d1774ef15833c9143e9f.png)
 - **鉴权方式**：选择该函数的鉴权方式。
    - 如果选择云函数鉴权，那么需要通过拥有该函数调用权限的身份来触发函数。
    ![](https://main.qcloudimg.com/raw/2e1f8de8dd7a7099ccaf5ca19cfb5959.png)
    - 如果选择免鉴权，则需要选择合适的 API 网关来接收请求，如果您在该地域下没有 API 网关，请选择**新建 API 网关服务**，我们会在您所选的地域下配置符合该函数需求的 API 网关。
   ![](https://main.qcloudimg.com/raw/8ebeda17fdc59e513b596d7584815cac.png)
 - **网关服务/API 路径/请求方法**：如需获取更多关于 API 网关的配置说明，请参见 [API 网关产品概述](https://cloud.tencent.com/document/product/628/11755)。
 - **SCF 授权**：打包压缩文件需要授权云函数从您的存储桶中读取对应文件，并将打包压缩后的压缩包上传到您指定的位置，需要勾选该项为 SCF 服务进行授权。
5. 添加配置后，单击**确认**，等待一段时间后，即可看到函数已添加完成。
![](https://main.qcloudimg.com/raw/18249550ab8efb9aa8557479ef4dcbb5.png)
6. 单击**使用引导**，查看该函数所需要配置的参数字段说明。其中，ClientContext 参数以 json 格式传入，配置示例请参见 [通过 API 进行多文件打包压缩](https://cloud.tencent.com/document/product/436/58581)。
![](https://main.qcloudimg.com/raw/2da92dc5049d59e7ab0f69be76d729c2.png)
7. 单击**下一步**，进入调用测试页面。
8. 单击**点击调用**，控制台会根据上一步配置的参数，对该函数发起调用，您可在**响应结果**中查看函数响应结果。
![](https://main.qcloudimg.com/raw/7356c4e101244208a40ac8e7c57d4fe0.png)
9. 您还可以对新创建的函数进行如下操作：
 - 单击**查看日志**，查看打包压缩函数的历史运行情况。当函数出现报错时，您还可以通过单击**查看日志**，快速跳转到云函数控制台查看日志错误详情。
 - 单击**编辑**，修改文件打包压缩规则。
 - 单击**删除**，删除不再需要的文件打包压缩函数。
