## 简介

多文件合并是由腾讯云对象存储（Cloud Object Storage，COS）基于 [云函数（Serverless Cloud Function，SCF）](https://cloud.tencent.com/document/product/583) 为用户提供的文件内容合并功能。文件内容合并能力可将 COS 上多个文件的二进制内容，按指定的顺序合并完整的内容，并生成新的文件。

用户为存储桶添加多文件合并规则后，需要指定合并文件的 URLs，再通过触发 SCF 函数来执行文件内容合并的动作，并将合并后的文件投递至存储桶的指定路径下。


## 注意事项

- 合并后的新文件不能大于50TB。
- 该功能仅合并文件的二进制不能用于音视频拼接和图片拼接。
- 若您此前在对象存储控制台上为存储桶添加了多文件合并规则，可以在 [云函数控制台](https://console.cloud.tencent.com/scf/list?rid=1&ns=default) 上看到您所创建的多文件合并函数，请**不要**删除该函数，否则可能导致您的规则不生效。
- 已上线云函数的地域均已支持多文件合并，包括有广州、上海、北京、成都、香港、新加坡、孟买、多伦多、硅谷等，更多支持地域可查看 [云函数产品文档](https://cloud.tencent.com/document/product/583)。
- 如果在合并的过程中出现报错，您可以单击所创建的函数右侧的**查看日志**，跳转到云函数控制台查看日志错误详情。
- 归档存储和深度归档存储类型文件不支持合并，如您需要合并此类型的文件内容，请先恢复后再进行，恢复操作请参见 [恢复归档对象](https://cloud.tencent.com/document/product/436/32430)。
- 对象存储多文件合并功能依赖于云函数服务，云函数服务为用户提供了 [免费额度](https://cloud.tencent.com/document/product/583/12282)，超出免费额度的部分需要按照 [云函数产品定价](https://cloud.tencent.com/document/product/583/12281) 收费。当您使用多文件合并功能时，如果您合并的文件内容越多，将消耗更多的资源使用量；如果您合并的次数越多，则将消耗更多的调用次数。

## 操作步骤

1. 登录 [对象存储控制台](https://console.cloud.tencent.com/cos5)。
2. 在左侧导航中，单击**应用集成**，选择**数据处理**标签卡，进入基础处理页面。
3. 单击**多文件合并**，进入**多文件合并**配置页面。
>! 若您尚未开通云函数，请前往 [云函数控制台](https://console.cloud.tencent.com/scf) 开通云函数服务，按照提示完成服务授权即可。
>
4. 单击**添加函数**，在弹出的窗口中配置如下信息：
 - **函数名称**：函数名称作为函数的唯一标识名称，创建后不可修改。您可以在 [云函数控制台](https://console.cloud.tencent.com/scf/list?rid=1&ns=default) 上查看该函数。
 - **执行配置**：选择该函数的执行方式，选择同步执行，函数会在执行完合并任务后才会响应，并返回运行结果。如果选择异步执行，函数会直接响应，并在后台持续执行合并任务。
 ![img](https://main.qcloudimg.com/raw/90d1bba5d9754182abbb14804cb835e4.png)
 - **鉴权方式**：选择该函数的鉴权方式。
    - 如果选择云函数鉴权，那么需要通过拥有该函数调用权限的身份来触发函数。
    - 如果选择免鉴权，则需要选择合适的 API 网关来接收请求，如果您在该地域下没有 API 网关，请选择**新建 API 网关服务**，我们会在您所选的地域下配置符合该函数需求的 API 网关。
 - **网关服务/API 路径/请求方法**：如需获取更多关于 API 网关的配置说明，请参见 [API 网关产品概述](https://cloud.tencent.com/document/product/628/11755)。
 - **SCF 授权**：合并文件内容需要授权云函数从您的存储桶中读取对应文件，并将合并后的新文件上传到您指定的位置，需要勾选该项为 SCF 服务进行授权。
5. 添加配置后，单击**确认**，等待一段时间后，即可看到函数已添加完成。
![](https://main.qcloudimg.com/raw/b156a1492beeb7033960e541781d6676.png)
6. 单击**使用引导**，查看该函数所需要配置的参数字段说明。其中，正文内容参数以 json 格式传入，配置示例请参见 [通过 API 进行多文件合并](https://cloud.tencent.com/document/product/436/60663)。
![](https://main.qcloudimg.com/raw/9452d03c20c5c81b3376ac1eede83560.png)
7. 单击**下一步**，进入调用测试页面。
8. 单击**点击调用**，控制台会根据上一步配置的参数，对该函数发起调用，您可在**响应结果**中查看函数响应结果。
![](https://main.qcloudimg.com/raw/466047a50346ff4b0bdfb98f03acae8a.png)
9. 您还可以对新创建的函数进行如下操作：
 - 单击**查看日志**，查看多文件合并函数的历史运行情况。当函数出现报错时，您还可以通过单击**查看日志**，快速跳转到云函数控制台查看日志错误详情。
 - 单击**编辑**，修改文件合并规则。
 - 单击**删除**，删除不再需要的文件合并函数。


