## 简介

文件哈希值计算是腾讯云对象存储（Cloud Object Storage，COS）基于 [云函数（Serverless Cloud Function，SCF）](https://cloud.tencent.com/document/product/583) 为用户提供的云上文件一致性检验方案。当文件上传到对象存储时，将自动进行哈希值计算并添加至文件的自定义头部，以方便您对文件一致性进行校验。

## 注意事项


- 若您此前在对象存储控制台上为存储桶添加了文件哈希值计算规则，可以在 [云函数控制台](https://console.cloud.tencent.com/scf/list?rid=1&ns=default) 上看到您所创建的 文件哈希值计算函数，请**不要**删除该函数，否则可能导致您的规则不生效。
- 已上线云函数的地域均已支持文件哈希值计算，包括有广州、上海、北京、成都、香港、新加坡、孟买、多伦多、硅谷等，更多支持地域可查看 [云函数产品文档](https://cloud.tencent.com/document/product/583)。
- 如果在哈希值计算的过程中出现报错，您可以单击所创建的函数右侧的【查看日志】，跳转到云函数控制台查看日志错误详情。
- 归档存储和深度归档存储类型文件不支持哈希值计算，如您需要计算此类型文件的哈希值，请先恢复后再进行，恢复操作请参见 [恢复归档对象](https://cloud.tencent.com/document/product/436/32430)。
- 对象存储文件哈希值计算功能依赖于云函数服务，云函数服务为用户提供了 [免费额度](https://cloud.tencent.com/document/product/583/12282)，超出免费额度的部分需要按照 [云函数产品定价](https://cloud.tencent.com/document/product/583/12281) 收费。

## 操作步骤

1. 登录 [对象存储控制台](https://console.cloud.tencent.com/cos5)。
2. 在左侧导航中，单击【应用集成】，在【数据处理】页签下找到【文件哈希值计算】。
3. 单击【文件哈希值计算】，进入规则配置页面。
>! 如果您尚未开通云函数服务，请前往 [云函数控制台](https://console.cloud.tencent.com/scf) 开通云函数服务，按照提示完成服务授权即可。
>
4. 单击【配置哈希规则】，在弹出的窗口中配置如下信息：
<img src="https://main.qcloudimg.com/raw/b87217d555d0b3e8d1272d4ce9bdd0b3.png" style="width: 50%;"></br>
 - **函数名称**：作为函数的唯一标识名称，创建后不可修改。您可以在 [云函数控制台](https://console.cloud.tencent.com/scf/list?rid=1&ns=default) 上查看该函数。
 - **关联存储桶**：待计算哈希值的文件所存在的 COS 存储桶。
 - **事件类型**：事件指触发云函数的操作。以上传操作为例，上传的方式可能是调用`PUT Object`接口，也可能是调用`POST Object`接口，当选择事件为【Put方法创建】时，只有通过`PUT Object`接口上传的文件会触发哈希值计算。
 - **触发条件**：指文件上传到哪个路径时会触发云函数。如果选择指定范围，则仅当文件上传到指定前缀或后缀下时才会触发云函数；如果选择整个存储桶，则文件上传到存储桶任意位置均会触发。
 - **SCF 授权**：计算文件哈希值需要授权云函数从您的存储桶中读取对应文件，并将计算的哈希值结果添加至文件的自定义头部，需要勾选该项为 SCF 服务进行授权。
5. 添加配置后，单击【确认】，等待一段时间后，即可看到函数已添加完成。
![img](https://main.qcloudimg.com/raw/0c19d5425ee8f8efda848f38c4ffdb7f.png)
您还可以对新创建的函数进行如下操作：
 - 单击【查看日志】，查看文件哈希值计算函数的历史运行情况。当函数出现报错时，您还可以通过单击【查看日志】，快速跳转到云函数控制台查看日志错误详情。
 - 单击【编辑】，修改文件哈希值计算规则。
 - 单击【删除】，删除不再需要的文件哈希值计算函数。
