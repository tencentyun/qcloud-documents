## 简介

本文介绍如何通过控制台使用对象存储（Cloud Object Storage，COS）的图片审核功能。开启图片审核服务后，该存储桶中新增的图片会在上传时自动进行检测，并支持自动冻结（禁止公有读访问）已检测的违规内容。

您也可以对 COS 中的**历史**图片文件进行扫描，审核涉黄、违法违规及广告传播的文件，详情请参见 [设置历史数据审核任务](https://cloud.tencent.com/document/product/436/54405) 和 [图片审核](https://cloud.tencent.com/document/product/436/45434) API 文档。

>! 当前图片审核的图片限制为：图片格式支持 png、jpeg、jpg、bmp、webp、gif 格式；图片大小不超过5MB。图片宽高不低于100 x 100像素。
>

## 操作步骤

1. 登录 [对象存储控制台](https://console.cloud.tencent.com/cos)，在**存储桶列表**页面选择需操作的存储桶，进入存储桶管理页面。
2. 在左侧导航栏中，选择**内容审核 > 自动审核配置**，单击**图片审核**。
3. 单击**添加图片自动审核配置**，进入图片审核配置页面，并按照如下配置项说明进行配置：
 - **审核范围**：可选择审核的范围为整个存储桶或指定范围。
    - **审核路径**：当选择指定范围，则填写您希望审核图片所在的路径。<br>示例1：如您需要审核指定目录 test 内的文件，则需要填写指定前缀为 test/。<br>示例2：如您需要审核指定前缀为123的文件，则需要填写指定前缀为123。
>!您可以添加多条审核配置，但审核路径不能重复或存在包含关系。例如您已经配置了审核整个存储桶，则不能再添加针对存储桶内某个路径的审核。
>
 - **审核后缀**：图片格式支持 jpg、jpeg、png、bmp、webp、gif 格式，支持智能判断后缀和空后缀图片。
>?智能判断后缀：选中后会根据文件的后缀和内容，智能判断是否为图片。
>
 - **选择审核策略**：请选择您配置的审核策略，不同审核策略对应不同的策略分类，您可以通过自定义策略定制个性化场景审核。支持审核涉黄、违法违规、广告审核场景，可勾选一种或多种检测场景。您可以前往 [公共策略](https://cloud.tencent.com/document/product/436/55206) 查看如何配置审核策略。
 - **审核场景**：审核场景展示的是默认场景或者您在审核策略中配置的场景，您可以勾选希望审核的场景分类。
 - **敏感文件冻结**：您可以通过开启敏感文件冻结服务，授权数据万象对相应类型文件进行自动机审冻结或人工审核冻结，从而禁止公有读访问已检测的违规内容。
 - **冻结类型**：您可指定冻结类型，选择冻结机制并指定冻结图片分数区间（即60-100的整数，分值越大则说明图片越敏感）。默认选择机审自动冻结，若您选择人工审核冻结，则天御专业团队将会对机审结果为敏感的图片进行二次复检。
>! 人工审核冻结价格为70元/千次，详情请查看 [内容审核费用](https://cloud.tencent.com/document/product/436/58965)。
>
 - **回调设置**：开启回调后将把相应图片的审核结果反馈给您。您需选择回调的审核类型、回调内容、回调 URL、回调图片域名。若您选择自定义回调阈值，则需设定回调图片分值区间。设置回调地址后，数据万象会发送一份默认回调信息至您设置的回调地址，以检测回调地址是否能够正常接收回调信息。回调详情请查看 [回调内容](#1)。
4. 配置完成后，单击**保存**即可启用该功能，后续将对您新上传的图片进行审核。

<span id=1></span>
## 回调内容
默认回调信息如下：
```plaintext
{
    "code": 0,
    "data": {
        "forbidden_status": 0,
        "porn_info": {
            "hit_flag": 0,
            "label": "",
            "score": 9
        },
        "result": 0,
        "trace_id": "test_trace_id",
        "url": "test_image"
    },
    "message": "Test request when setting callback url"
}  
```

>?
>- 回调阈值为一个分值区间。设置后，数据万象将会把图片分值在阈值内的图片返回给您。
>- 对于腾讯云冻结的图片，如果勾选了回调，此类图片也会返回给您，但是无法进行公有读访问。
>- 回调 URL 需以 HTTP 或 HTTPS 开头且默认返回200正确码方可进行使用，请在保存设置前进行检查。
>- 回调 URL 预计30分钟后生效。
>- 回调 URL 设置生效后，当发现上传的图片分值在阈值内，数据万象会默认回调该 URL，向其发送一个标准的 HTTP POST 通知消息。
>

HTTP 包信息如下表：

| 参数名称         | 描述                                                    | 类型   | 是否必选 |
| ---------------- | ------------------------------------------------------- | ------ | -------- |
| forbidden_status | 冻结状态，0表示正常，1表示图片已被冻结                  | Int    | 是       |
| porn_info        | 涉黄信息，包括是否命中、审核分数及详细标签等            | json   | 是       |
| ads_info         | 广告引导信息，包括是否命中、审核分数及详细标签等        | json   | 是       |
| result           | 供参考的识别结果，0为确认正常，1为确认敏感，2为疑似敏感 | Int    | 是       |
| trace_id         | 提交的审核任务的 jobid                                       | String | 是       |
| url              | 上传后的资源 URL，包括域名                              | String | 是       |

审核信息（porn_info、ads_info）中包含如下内容：

| 参数名称 | 描述                                                         | 类型   | 是否必选 |
| -------- | ------------------------------------------------------------ | ------ | -------- |
| hit_flag | 是否命中该审核分类                                           | Int    | 是       |
| label    | 识别出的图片标签                                             | String | 是       |
| score    | 该字段表示审核结果命中审核信息的置信度，取值范围：0（置信度最低）-100（置信度最高 ），越高代表该内容越有可能属于当前返回审核信息。<br>例如：色情 99，则表明该内容非常有可能属于色情内容 | Int    | 是       |


**回调示例**


以下为回调内容示例：
	
```plaintext
	{
		"code": 0,
		"data": {
			"forbidden_status": 1,
			"porn_info": {
				"hit_flag": 1,
				"label": "",
				"score": 99
			},
			"result": 1,
			"trace_id": "NWNhMzFjZDdfNjQ2MmMwYzJfNDkz****_1e4bcad6-8123-4b4c-86c4-e7954880f974",
			"url": "http://examplebucket-1250000000.cos.ap-shanghai.myqcloud.com/ccc/1a64737b-e52e-401e-881d-79e5625c3a6c.jpg"
		},
		"message": "success"
	}
```

<span id=2></span>
## 相关说明

1. 图片审核为打分制，对于每一张图片均有一个0 - 100的分值。
2. **确定部分**指确定是敏感图片和确定正常的图片，分值在[0,60]和(90,100]区间，我们认为图片置信度比较明确，无需进行人工干预。
3. **不确定部分**指疑似敏感图片，机审无法区分是否为敏感内容，分值在(60,90]区间，建议用户通过人工审核的方式确定。

