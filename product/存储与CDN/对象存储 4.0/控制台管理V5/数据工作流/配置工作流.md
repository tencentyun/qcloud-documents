## 简介

通过媒体工作流，您可以快速、灵活、按需搭建视频处理流程。每个工作流与输入存储桶的一个路径绑定，当视频文件**上传**至该路径时，该媒体工作流就会被**自动触发**，执行指定的处理操作，并将处理结果自动保存至输出存储桶的指定路径下。在工作流中可以设置**音视频转码**任务、**音视频拼接**任务、**视频截帧**任务、 **视频转动图**任务和**智能封面**任务。

>! 工作流目前支持处理 avi、mp4、mkv、flv、hls、ts、mp3、aac、flac 等格式文件，您在发起媒体处理请求时，请务必输入完整的文件名和文件格式，否则无法识别格式和处理。
>

## 操作步骤

### 创建工作流

1. 登录 [对象存储控制台](https://console.cloud.tencent.com/cos5)。
2. 在左侧导航栏中，单击【存储桶列表】，进入存储桶列表管理页面。
3. 找到需要进行媒体文件处理的存储桶，单击该存储桶名称，进入该存储桶管理页面。
4. 在左侧导航栏中，选择【数据工作流】，单击【工作流】，进入工作流管理页面。
5. 单击【创建工作流】，进入创建工作流页面。
6. 在创建工作流页面，配置如下信息：
![](https://main.qcloudimg.com/raw/23fd28410fca42f5dbe9dc1cc3c4163c.png)
  - **工作流名称**：必填项，仅支持中文、英文大小写[A-Z,a-z]、数字[0-9]、下划线(\_)和短横线(-)，长度不能超过128个字符。
  - **输入存储桶**：默认项，即为当前存储桶。
  - **输入路径**：选填项，以`/`开头，以`/`结尾，如果不填写，则对输入存储桶所有路径生效。工作流启用后，当视频文件上传至该路径时，媒体工作流将被自动触发。
  - **配置工作流**：单击输入右侧的“+”添加**音视频转码**、**音视频拼接**、**视频截帧**、**视频转动图**和**智能封面**节点，每个工作流至少配置一个任务节点。任务节点配置需设置输出存储桶、输出文件名和路径、选择任务模板。模板的介绍和设置详情请参见 [公共配置文档](跳转至公共配置文档)中的模板介绍部分。
<dx-tabs>
::: 音视频转码
 ![](https://main.qcloudimg.com/raw/9cb479e913ef6de2740ee75d02745840.png)
:::
::: 视频截帧
![img](https://main.qcloudimg.com/raw/ff18c20c29b018e1a03c6a23ad3be4a4.png)
:::
::: 视频转动图
![img](https://main.qcloudimg.com/raw/32bc6162f99f736ac38f1d9fd5f128d1.png)
:::
::: 智能封面
![](https://main.qcloudimg.com/raw/4a175f08f29fabd93ae9c36bfdf698c0.png)
>? 智能封面结合腾讯云先进的 AI 技术，通过对视频内容的理解，智能计算输出3张最优的关键帧。
>
:::
::: 音视频拼接
 ![](https://main.qcloudimg.com/raw/662304e4988dbeae7aa15295849c2d35.png)
:::
</dx-tabs>
  - **队列**：必选项，在开通服务时，系统会自动创建一个用户队列。当用户提交任务后，任务会先进入队列中进行排队，根据优先级和提交顺序依次执行，您可以前往【公共配置】中查看队列信息。
  - **队列回调 URL**：回调 URL 与队列绑定，如需修改请前往指定队列的列表进行修改。
7. 以上配置无误后，单击【保存】，即可看到刚创建的工作流。
![](https://main.qcloudimg.com/raw/b603c8a249e36230eaf1ade521df2afd.png)
工作流默认为未启用状态，单击该工作流对应的状态按钮，即可启用工作流。工作流启用后，将在5分钟内生效。工作流生效后，后续上传的视频文件将自动进行媒体处理操作，待处理完成后，将新生成的文件输出到指定文件路径中。


### 管理工作流

进入工作流管理页面，查看已创建工作流的列表。
![](https://main.qcloudimg.com/raw/b603c8a249e36230eaf1ade521df2afd.png)
工作流列表展示了工作流名称、工作流 ID、输入路径、创建时间以及启用状态等信息。支持按照工作流名称、工作流 ID 搜索以及对指定工作流进行查看详情、编辑和删除操作。
 - **启用按钮**：启动工作流后，您上传至输入存储桶对应路径下的视频文件将会根据工作流配置自动处理。再次单击该启用按钮，可暂停工作流。暂停工作流后，将不会对上传至对应路径下的视频文件进行自动处理。
   >? 工作流默认为未启用状态，单击该工作流对应的状态按钮后，可启用工作流。工作流启用后，将在5分钟内生效。
   >
 - **详情**：查看当前工作流的配置详情。
 - **查看执行实例**：按照时间维度查看工作流的执行状态、执行时间等信息。
 - **更多**：   
    - 在操作栏下，单击【更多】>【编辑】，进入“工作流编辑”页面，您可在该页面更改工作流配置。
    - 在操作栏下，单击【更多】>【删除】，删除该工作流。

>! 工作流处于启用状态时，无法对其进行编辑和删除操作。
>

### 查看执行实例

每个文件执行完一遍工作流，就会产生一个执行实例，执行实例页面展示源文件地址、工作流执行状态、执行时间等信息。

1. 进入工作流管理页面，找到目标工作流，并在操作栏中单击【查看执行实例】，进入执行实例列表页面。
![](https://main.qcloudimg.com/raw/b603c8a249e36230eaf1ade521df2afd.png)
2. 在列表页面，找到目标实例，并在操作栏中单击【详情】，进入实例详情页面。
![](https://main.qcloudimg.com/raw/9adfdda6e20fe90c1675a0192bbe4e95.png)
在实例详情页面中，您可查看工作流各节点的任务 ID、执行状态、开始/结束时间等信息。
![](https://main.qcloudimg.com/raw/0c2f798838b18d708e00edb66d5c36cb.png)

### 触发工作流

创建工作流完成后，除了针对上传文件至存储桶时会自动触发外，还支持对已存储在存储桶中的文件立即触发工作流。

1. 进入工作流管理页面，找到目标工作流，并在操作栏中单击【触发工作流】，进入触发工作流页面。
2. 在触发工作流页面中，选择需要触发工作流的文件，单击【保存】，即可立即触发工作流并执行。
后续您可在执行实例页面查看工作流执行状态。
![](https://main.qcloudimg.com/raw/4925678570b9d512f95baed3bb34f9fc.png)

