## 简介

本文介绍如何通过控制台使用 COS 的视频审核功能。视频审核的检测场景包括**鉴黄**、**鉴政**、**鉴暴恐**、**广告检测**。当您开启视频审核功能后，该存储桶中新增的视频将在**上传时**自动进行检测，并支持自动冻结（禁止公有读访问）已检测的违规内容。通过调用 [视频审核](https://cloud.tencent.com/document/product/436/47316) API 接口，您可以对 COS 中的**存量**视频进行扫描审核。
> !
- 视频审核功能基于**视频截帧**技术，通过对所截图片进行审核的方式实现此功能。开启视频审核时您可选择截帧方式，详情请查看下方操作步骤。
- 视频审核是付费服务，由数据万象收取，详细的计费说明请参见数据万象 [计费与定价](https://cloud.tencent.com/document/product/460/6970)。数据万象提供每日2000张的**免费鉴图额度**，未用完的额度不累计至下一天，计费系统会扣除免费的2000张（免费额度优先抵扣 [确定部分](#1) 的张数）。 
- 当前视频审核的视频限制为：视频格式支持 mp4、avi、mkv、wmv、rmvb、flv、m3u8，视频大小不能超过5GB，截帧数不能超过10万帧。


## 操作步骤

1. 登录 [对象存储控制台](https://console.cloud.tencent.com/cos) ，在【存储桶列表】页面选择需操作的存储桶，进入存储桶管理页面。
2. 单击【数据处理】>【内容审核】页签，选择【视频审核】配置项，单击【编辑】，将状态修改为**开启**。
3. 选择审核类型，并开启敏感文件冻结及回调设置，即可使用该功能。
   - **审核后缀**：视频格式支持 mp4、avi、mkv、wmv、rmvb、flv、m3u8。
   - **审核类型**：支持审核涉黄、涉暴恐、政治敏感、广告审核场景，可勾选一种或多种检测场景。
   - **审核截帧规则**：视频审核基于视频截帧，通过对所截图片进行审核的方式实现此功能。支持固定时间、固定帧率和固定数量审核截帧。
     - 固定时间：以固定时间间隔截取图片进行审核。您可设定时间间隔和单视频最大截帧数。
     - 固定帧率：每秒截取固定帧数图片进行审核。您可设定每秒截帧数和单视频最大截帧数。
     - 固定数量：按照平均百分比对全视频截取固定数量图片进行审核。您可设定单视频最大截帧数。
>!截帧规则的设定会影响审核的结果。
 - **敏感文件冻结**：您可以开启敏感文件冻结服务，开启后将授权数据万象对相应类型文件进行自动机审冻结，从而禁止公有读访问检测出的违规内容。开启服务后，您需要选择冻结类型。
 - **冻结类型**：您可指定冻结类型，同时选择冻结机制。默认选择机审自动冻结，若您选择人工审核冻结，则天御专业团队将会对机审结果为敏感的视频进行二次复检。
   >!人工审核冻结价格为700元/万次，详情请查看数据万象 [计费与定价](https://cloud.tencent.com/document/product/460/6970#.E5.86.85.E5.AE.B9.E8.AF.86.E5.88.AB.E8.B4.B9.E7.94.A8)。
4. **回调设置**：您可以通过回调功能接收相应的视频审核结果。您需选择回调的审核类型、回调内容，同时设置回调 URL。设置回调地址后，数据万象会发送一份默认回调信息至您设置的回调地址，以检测回调地址是否能够正常接收回调信息。默认回调信息如下：
```plaintext
{
    "code": 0,
    "data": {
        "forbidden_status": 0,
        "porn_info": {
            "hit_flag": 0,
            "label": "",
            "count": 9
        },
        "result": 0,
        "trace_id": "test_trace_id",
        "url": "test_image"
    },
    "message": "Test request when setting callback url"
}  
```

>?
- 如需查看被冻结的视频，可前往数据万象控制台查看。
- 对于腾讯云冻结的图片，如果勾选了回调，此类图片也会返回给您，但是无法进行公有读访问。
- 回调 URL 需以 HTTP 或 HTTPS 开头且默认返回200正确码方可进行使用，请在保存设置前进行检查。
- 回调 URL 预计30分钟后生效。
- 回调 URL 设置生效后，当发现上传的图片分值在阈值内，数据万象会默认回调该 URL ，向其发送一个标准的 HTTP POST 通知消息。HTTP 包信息如下表。

| 参数名称         | 描述                                                    | 类型   | 是否必选 |
| :--------------- | :------------------------------------------------------ | :----- | :------- |
| url              | 上传后的资源 URL ，包括域名                             | String | 是       |
| result           | 供参考的识别结果，0为确认正常，1为确认敏感，2为疑似敏感 | Int    | 是       |
| forbidden_status | 冻结状态，0表示正常，1表示图片已被冻结                  | Int    | 是       |
| porn_info        | 涉黄信息，包括是否命中、审核分数及详细标签等            | json   | 是       |
| terrorist_info   | 涉暴恐信息，包括是否命中、审核分数及详细标签等          | json   | 是       |
| politics_info    | 涉政信息，包括是否命中、审核分数及敏感人物信息等        | json   | 是       |
| ads_info         | 广告引导信息，包括是否命中、审核分数及详细标签等        | json   | 是       |

审核信息（porn_info、terrorist_info、politics_info、ads_info）中包含如下内容：

| 参数名称 | 描述                                       | 类型   | 是否必选 |
| :------- | :----------------------------------------- | :----- | :------- |
| hit_flag | 是否命中该审核分类                         | Int    | 是       |
| label    | 识别出的图片标签                           | String | 是       |
| count    | 视频文件回调参数，命中该审核分类的截图张数 | Int    | 否       |

以下为回调内容示例：

```plaintext
{
"code": 0,
"data": {
"forbidden_status": 1,
"politics_info": {
		"hit_flag": 0,
		"label": "",
		"count": 2
},
"porn_info": {
		"hit_flag": 1,
		"label": "",
		"count": 1
},
"result": 1,
"trace_id": "NWNhMzFjZDdfNjQ2MmMwYzJfNDkz****_1e4bcad6-8123-4b4c-86c4-e7954880f974",
"url": "http://examplebucket-1250000000.cos.ap-shanghai.myqcloud.com/doc/picture.jpg"
},
"message": "success"
}
```

<span id=1>

## 相关说明

1. 视频审核为打分制，对于每一张视频截帧截取出来的图片均有一个0 - 100的分值。
2. **确定部分**指确定是敏感图片和确定正常的图片，分值在60分以下及90分以上，无需人工干预。
3. **不确定部分**指疑似敏感图片，系统无法区分是否涉敏，分值在60 - 90，建议用户通过人工审核的方式确定。
