## 简介

文件解压缩功能是腾讯云对象存储 COS 基于 [云函数 SCF](https://cloud.tencent.com/document/product/583) 为用户提供的数据处理解决方案。用户为存储桶添加文件解压缩规则后，当压缩文件上传到 COS 时，将自动触发 COS 为您预配置的云函数，自动将文件解压到指定的存储桶和路径中。文件解压缩的流程图如下所示。

![解压流程](https://main.qcloudimg.com/raw/8595c7c538a7d951779b9e5b849377b4.png)

> !文件解压缩仅支持解压 ZIP 格式文件，且压缩包中单个文件大小不得超过5GB。

## 相关说明

- 若您此前在 COS 控制台上为存储桶添加了文件解压缩规则，可以在 [云函数 SCF](https://console.cloud.tencent.com/scf/list?rid=1&ns=default) 控制台上看到您所创建的文件解压缩函数，请**不要**删除该文件解压缩函数，否则可能导致您的规则不生效。
- 已上线 SCF 的地域均已支持 ZIP 包解压缩，包括有广州、上海、北京、成都、香港、新加坡、孟买、多伦多、硅谷等，更多支持地域可查看 [SCF 产品文档](https://cloud.tencent.com/document/product/583)。
- 压缩包中的目录或者文件名请严格使用 UTF-8 或 GB 2312 编码，否则可能导致解压后的文件名或者目录名出现乱码、解压过程中断等情况；如果出现报错，您可以单击所创建的函数右侧的【查看日志】，跳转到 SCF 控制台查看日志错误详情。
- 归档存储类型文件不支持解压缩，如您需要解压缩归档存储类型的压缩包，请先恢复后再进行，恢复操作请参见 [恢复归档对象](https://cloud.tencent.com/document/product/436/32430)。
- 解压单个压缩包最大处理时间为900秒，超过900秒未完成的解压任务会失败。COS 的解压缩功能限制说明基于云函数服务，其他限制请参见 [云函数限制说明](https://cloud.tencent.com/document/product/583/11637)。
- 压缩包里面单个文件大小不得大于5G，否则将导致解压缩失败。
- COS 解压缩功能依赖于云函数服务，云函数服务为用户提供了 [免费额度](https://cloud.tencent.com/document/product/583/12282)，超出免费额度的部分需要按照 [SCF 产品定价](https://cloud.tencent.com/document/product/583/12281) 收费。当您使用解压缩功能时，如果您的压缩包越大，将消耗更多的资源使用量；如果您解压缩的次数越多，则将消耗更多的调用次数。



## 操作步骤

1. 登录 [对象存储控制台](https://console.cloud.tencent.com/cos5)。
2. 在左侧导航中，单击【存储桶列表】，选择并单击需要添加文件解压缩规则的存储桶，进入存储桶管理页。
3. 单击左侧的【函数计算】，并找到 **zip文件解压函数**配置页面。
> !若您尚未开通云函数 SCF，请前往 [云函数 SCF 控制台](https://console.cloud.tencent.com/scf) 开通 SCF 服务，按照提示完成服务授权即可。
4. 单击【添加函数】，在弹出的窗口中配置如下信息：
   - **函数名称**：函数名称作为函数的唯一标识名称，创建后不可修改。您可以在 [云函数 SCF](https://console.cloud.tencent.com/scf/list?rid=1&ns=default) 控制台上查看该函数。
   - **事件类型**：事件是指触发云函数的操作。以上传操作为例，上传的方式可能是调用`PUT Object`接口，也可能是调用`POST Object`接口，当选择事件为【Put方法创建】时，只有通过`PUT Object`接口上传的压缩包会触发解压缩。
> !如果您的文件是通过简单上传、分块上传、跨地域复制等多种渠道上传到存储桶中，建议您选择【全部创建】事件。
 - **触发条件**：指压缩包上传到哪个路径时会触发云函数。如果选择指定前缀，则仅当压缩包上传到指定前缀路径下时才会触发云函数；如果选择整个存储桶，则压缩包上传到存储桶任意位置均会触发。
  !如果配置的目标文件前缀与触发条件存在包含关系，可能导致循环触发，请尽量避免这种情况。例如目标前缀为`prefix`，触发条件为`pre`，当上传一个`pref`的压缩包时，将触发循环解压。
 - **解压格式**：指当前可支持的压缩格式，目前仅支持 ZIP 格式压缩包解压。
 - **目标存储桶**：压缩包解压缩后，文件存储的存储桶。
 - **目标文件前缀**：压缩包解压缩后，文件存储的具体路径，如果不设置则默认为存储桶根目录。
 - **SCF 授权**：解压缩需要授权云函数从您的存储桶中读取压缩包，并将解压缩后的文件上传到您指定的位置。因此需要添加此授权。
 ![](https://main.qcloudimg.com/raw/208829697a9772efa43648e62735b2ee.png)
5. 添加配置后，单击【确认】，即可看到函数已添加完成。单击【查看日志】，可查看解压缩的历史运行情况。当解压出现报错时，您可以通过单击【查看日志】，快速跳转到 SCF 控制台查看日志错误详情。如果需要删除不使用的文件解压缩规则，可以单击【删除】删除相关配置。
   ![](https://main.qcloudimg.com/raw/e40d39e2933e2ad49faff936234e5d77.png)
