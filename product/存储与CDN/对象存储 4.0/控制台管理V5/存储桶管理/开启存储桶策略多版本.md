## 简介

用户在 COS 控制台设置存储桶策略时，可能会出现误修改或者误操作等情况，而开启存储桶策略多版本功能，可帮助用户找回先前设置的存储桶策略。

**功能特性**

存储桶策略多版本主要有以下特性：

- 存储桶策略多版本为存储桶属性，其中多版本的策略内容只能应用于当前存储桶，不能应用于其他存储桶。
- 存储桶策略多版本在用户对存储桶策略进行创建或修改完成后自动生成，即不需额外触发。
- 存储桶策略多版本中每个版本包含权限策略内容、创建时间，方便用户查看。
- 对于存储桶的配置来说，用户可以不配置存储桶策略，因此存储桶策略多版本中的生效版本允许被删除。
- 存储桶策略多版本可以不设置生效版本或设置多个版本中的一个作为生效版本。

**使用约束**

使用存储桶策略多版本，有如下约束：

- 存储桶策略多版本对于每个存储桶最多可保留五个版本，如果再继续添加多版本，将删除最旧版本。
- 存储桶策略多版本为低频率操作，因此只支持在控制台操作。
- 存储桶策略多版本功能当前适用于北京地域。

**计费方式**
存储桶策略多版本功能当前可免费使用。

## 步骤说明

使用存储桶策略多版本，需要先添加存储桶策略，本文从添加存储桶策略开始，详细介绍如何查看、修改以及回滚存储桶策略多版本。

## 添加存储桶策略

1. 登录 [对象存储控制台](https://console.cloud.tencent.com/cos5)，在左侧导航栏中单击【存储桶列表】，进入存储桶列表页。
2. 单击需要操作的存储桶，进入存储桶管理页。
3. 单击【权限管理】页签，即可看到【Policy 权限设置】配置项，如下图所示：
   ![](https://main.qcloudimg.com/raw/af7c6fe8027c380b679208135fc6fb10.png)
4. 选择【图形设置】或者【策略语法】，创建存储桶策略。
5. 以下通过图形设置方式为例，单击编辑策略，按所需策略进行添加。
6. 策略编辑完成后，单击【保存】，控制台顶部将显示“设置 Policy 权限信息成功，已应用为生效版本”提示。
7. 详细操作步骤，请参见 [添加存储桶策略](https://cloud.tencent.com/document/product/436/33369)。

## 查看存储桶策略多版本

存储桶策略创建后，可以在版本列表中查看：

1. 登录 [对象存储控制台](https://console.cloud.tencent.com/cos5)，在左侧导航栏中单击【存储桶列表】，进入存储桶列表页。
2. 单击需要操作的存储桶，进入存储桶管理页。
3. 单击【权限管理】页签，在【Policy权限设置】配置项中，单击【版本列表】，可以看到此前创建的存储桶策略，版本号为1，同时标识其为生效版本：
   ![](https://main.qcloudimg.com/raw/99a7ecf32adb0dcfddf66d60e93c2e92.png)
4. 同时单击【1（生效版本）】，即可查看此生效版本的具体内容：
   <img src="https://main.qcloudimg.com/raw/161f65dcebc1f387f71ddae09ba41e9f.png" width="700">

## 修改存储桶策略

存储桶策略创建后，可以对存储桶策略进行修改：

1. 登录 [对象存储控制台](https://console.cloud.tencent.com/cos5)，在左侧导航栏中单击【存储桶列表】，进入存储桶列表页。
2. 单击需要操作的存储桶，进入存储桶管理页。
3. 单击【权限管理】页签，在【Policy权限设置】配置项中，单击【图形设置】或者【策略语法】，对存储桶策略进行修改。
4. 以**策略语法**方式为例，对存储桶策略进行修改，如下图所示：
![](https://main.qcloudimg.com/raw/b0c6ed61f9e4d109981305b53879895b.png)
5. 单击策略右上角处的【编辑】，对存储桶策略内容进行修改。
6. 修改完成后，单击【保存】，控制台顶部将显示“设置 Policy 权限信息成功，已应用为生效版本”提示。

>!图形设置或者策略语法中展示的内容为生效版本内容。

## 回滚存储桶策略多版本

存储桶策略修改后，在版本列表中可以查看修改前的版本。

1. 登录 [对象存储控制台](https://console.cloud.tencent.com/cos5)，在左侧导航栏中单击【存储桶列表】，进入存储桶列表页。
2. 单击需要操作的存储桶，进入存储桶管理页。
3. 单击【权限管理】页签，在【Policy权限设置】配置项中，单击【版本列表】，可以看到刚修改后的存储桶策略，版本号为2，同时标识其为生效版本，修改前的版本，其版本号为1，如下图所示：
   ![](https://main.qcloudimg.com/raw/2a83b3de5ebdd11ce162fa819f51415a.png)
4. 如果发现修改后的存储桶策略（如版本2）不合适，需要回滚到版本1，则可以通过选择版本1，同时设置为生效版本即可，如下图所示：
   ![](https://main.qcloudimg.com/raw/4ef38759c2a5868d29c235ee8f66e13e.png)

> !版本号为阿拉伯数字，从1开始，如果将某个版本删除，后续版本号持续累加，因此会出现版本号不连续的情况。

