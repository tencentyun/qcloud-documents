## 简介

CDN 加速适用于对 COS 存储桶中的内容进行下载、分发，特别适用于相同内容反复下载的使用场景。

## 设置说明

用户可对以下域名进行管理，实现存储桶中对象的快速下载和分发：
- 默认域名：即 COS 源站域名，是创建存储桶时，由系统根据存储桶名称和地域自动生成的，要与默认加速域名区分开。
- 默认加速域名：经由 CDN 加速节点的域名，系统默认生成，用户可选择开启或关闭。
- 自定义加速域名：用户可以为存储桶绑定已备案的自定义域名到腾讯云国内 CDN 加速平台，通过自定义域名访问存储桶中的对象。
- 自定义源站域名：用户可以将已备案的自定义域名绑定至当前存储桶，通过自定义域名访问桶内对象。

>!目前 COS 使用自定义域名必须开启 CDN，请根据您的情况进行判断：
1. 若您的域名接入国内 CDN，需要备案。但不要求必须通过腾讯云备案，保证接入的域名已备案即可。
2. 若您的域名接入海外 CDN，不需要备案。但需要注意，您在腾讯云上存放的数据和操作行为仍需遵守相关国家的法律法规，以及 [《腾讯云服务协议》](https://cloud.tencent.com/document/product/301/1967)。

在对默认加速域名或自定义域名开启了 CDN 加速的情况下，如果源站为公有读存储桶，那么系统会默认用户可以直接通过 CDN 加速域名或自定义域名访问到源站中的对象。如果源站为私有读存储桶，则建议用户开启 CDN 回源鉴权和 CDN 鉴权配置两个选项。

- 回源鉴权（开启前提是已添加 CDN 服务授权）：当用户请求的数据在边缘节点没有命中缓存时，CDN 需要回源获取数据内容。使用 COS 作为源站并开启回源鉴权后，CDN 边缘节点将使用特殊的服务身份（需要通过 CDN 服务授权得到此身份）访问 COS 源站，以实现获取并缓存私有访问存储桶中的数据。
- CDN 鉴权配置：当用户通过访问边缘节点获取缓存数据的时候，边缘节点会根据鉴权配置规则，校验访问 URL 中的身份验证字段，以此防范非授权的访问，实现防盗链，提高边缘节点缓存数据的安全性和可靠性。

CDN 鉴权配置和 CDN 回源鉴权的使用情况不冲突，但是两者配置的状态不同对数据的保护效果也不同，具体情况如下表：


| 存储桶访问权限      | 是否开启 CDN 回源鉴权 | 是否开启 CDN 鉴权配置 | 通过 CDN 加速域名是否可访问源站  |通过 COS 源站域名是否可访问源站   | 适用场景         |
| ------------------- | ------------ | ------------ | --------------- | --------------- | ------------ |
| 公有读              | 关闭         | 关闭         | 可访问          | 可访问          | 全站公有读 |
| 公有读              | 关闭         | 开启         | 需使用 URL 鉴权 | 可访问          | 不推荐       |
| 公有读              | 开启         | 关闭         | 不可访问        | 可访问          | 不推荐       |
| 公有读              | 开启         | 开启         | 需使用 URL 鉴权 | 可访问          | 不推荐       |
| 私有读+CDN 服务授权 | 开启         | 开启         | 需使用 URL 鉴权 | 需使用 COS 鉴权 | 全链路保护   |
| 私有读+CDN 服务授权 | 关闭         | 开启         | 需使用 URL 鉴权 | 需使用 COS 鉴权 | 不推荐       |
| 私有读+CDN 服务授权 | 开启         | 关闭         | 可访问          | 需使用 COS 鉴权 |源站保护     |
| 私有读+CDN 服务授权 | 关闭         | 关闭         | 不可访问        | 需使用 COS 鉴权 | 不推荐       |
| 私有读              |      关闭        |      开启或关闭        | 不可访问        | 需使用 COS 鉴权 | 无法使用 CDN |

>!
>- 以上述列表第一行为例，当源站存储桶访问权限为公有读的时候，如果既不开启 CDN 回源鉴权也不开启 CDN 鉴权配置，那么通过 CDN 域名可以直接访问 CDN 边缘节点和源站存储桶，通过 COS 域名可以直接访问源站存储桶。
>- 用户为域名启用 CDN 加速之后，任何人都可以通过此域名直接访问源站，所以如果您的数据有一定的私密性，请您务必通过**鉴权配置**来保护您的源站数据。

## 开启默认加速域名
### 操作步骤
1. 登录 [对象存储控制台](https://console.cloud.tencent.com/cos5) 。在左侧导航栏中，单击【存储桶列表】，进入存储桶列表页面。
2. 单击需要配置域名的存储桶，进入存储配置页面，如下图所示：
![](https://main.qcloudimg.com/raw/8a4ceacd4892f0f9f660a6f6fa9dacd0.png)
3. 单击上方的【域名管理】，在“默认加速域名”模块下，单击【编辑】，把默认加速域名的当前状态设置为开启，配置如下选项。
 - **源站类型**：通常默认为**默认源站**，如果作为源站的存储桶开启了静态网站，并且希望为静态网站加速，则选择为**静态网站源站**。
![](https://main.qcloudimg.com/raw/90169099da40a28451808e4f41d94f31.png)
 - **回源鉴权**：当存储桶为公有读时，则不需要开启回源鉴权。当存储桶为私有读时，需要 [开启回源鉴权](#step1)（在已添加 CDN 服务授权前提下）。
 >!如果用户在之前从未使用过腾讯云 CDN 服务，则无法进入【域名管理】，需先进入 CDN 控制台开启 CDN 服务。
4. 单击【保存】，即可开启 CDN 加速。
>!对于私有读存储桶，同时开启回源鉴权和 CDN 服务授权会导致通过 CDN 访问源站时无需携带签名，CDN 缓存资源会进行公网分发，导致数据的安全性受到影响，建议开启 CDN 鉴权。

<span id="step1"></span>
#### 开启回源鉴权
1. 当存储桶为私有读时，需要开启**回源鉴权**（在已添加 CDN 服务授权前提下）。
2. 在存储桶域名管理页面下，开启【回源鉴权】（需确认已添加 CDN 服务授权）。
![](https://main.qcloudimg.com/raw/08c716a65196d653c56ae3a63e9f0605.png)
3. 单击【保存】，即可开启 CDN 加速。
4. 保存之后，可以看到默认加速域名在部署中了。同时下方会出现 **CDN 鉴权**的状态提示，单击【鉴权配置】开始配置 CDN 鉴权，如下图所示：
![](https://main.qcloudimg.com/raw/996b8f07d0c026e314b8207a2ccbc5c5.png)
5. 登录 [CDN 控制台](https://console.cloud.tencent.com/cdn) ，进入 CDN 鉴权配置页面的路径为【域名管理】> 对应域名的【管理】>【安全配置】。具体配置步骤详见 [鉴权配置](https://cloud.tencent.com/document/product/228/33115)。

## 开启自定义加速域名

>!
>- 此处仅介绍在 COS 控制台添加自定义加速域名及开启 CDN 加速，若要从 CDN 控制台添加自定义域名，请查阅 CDN 的 [域名接入](https://cloud.tencent.com/document/product/228/5734) 文档。 
>-  通过 COS 控制台添加自定义域名上限为10个。

### 操作步骤

1. 登录 [对象存储控制台](https://console.cloud.tencent.com/cos5) 。 在左侧导航栏中，单击【存储桶列表】，进入存储桶列表页面。
2. 单击需要配置域名的存储桶，进入存储配置页面，如下图所示：
![](https://main.qcloudimg.com/raw/8a4ceacd4892f0f9f660a6f6fa9dacd0.png)
3. 单击上方的【域名管理】，找到**自定义加速域名**栏后，单击【添加域名】，配置如下选项。
 - **域名**：输入待绑定的自定义域名（如 ` www.example.com`）。请确保输入的域名已备案，并已在 DNS 服务商处设置好对应的 CNAME，详情请参阅 [CNAME 配置 ](https://cloud.tencent.com/document/product/228/3121)。
 - **回源鉴权**：开启回源鉴权。对于私有读存储桶，请开启**回源鉴权**以保护源站。
![](https://main.qcloudimg.com/raw/b70664a7da5a81e819a662a9e8253976.png)
>!对于私有读存储桶，同时开启回源鉴权和 CDN 服务授权会导致通过 CDN 访问源站时无需携带签名，CDN 缓存资源会进行公网分发，导致数据的安全性受到影响，建议开启 CDN 鉴权，进入步骤5。
4. 配置完成之后，在右侧操作栏中，单击【保存】即可添加域名。保存之后，**CDN 鉴权**栏会出现 CDN 鉴权功能开关，可开启自定义域名 CDN 鉴权。
**CDN 鉴权：**开启时间戳鉴权配置，可防止恶意用户盗取内容，需在添加完域名后进行设置。
5. 登录 [CDN 控制台](https://console.cloud.tencent.com/cdn/access)，在左侧导航栏中，单击【域名管理】。
6. 找到您需要配置的域名，在其右侧操作栏中单击【管理】，进入域名管理页面之后，单击上方的【安全配置】。具体配置步骤详见 [鉴权配置](https://cloud.tencent.com/document/product/228/33115)。

>!用户为域名启用 CDN 加速之后，任何人都可以通过此域名直接访问源站，所以如果您的数据有一定的私密性，请您务必通过**鉴权配置**来保护您的源站数据。

## 开启自定义源站域名

>!
>- 此处介绍如何将自定义域名绑定至存储桶中，您可以通过这个自定义域名访问存储桶内文件。
>- 通过 COS 控制台添加自定义域名上限为20个，如您想提高自定义域名的个数上限，请 [提交工单](https://console.cloud.tencent.com/workorder/category) 与我们联系。

### 操作步骤

1. 登录 [对象存储控制台](https://console.cloud.tencent.com/cos5) 。 在左侧导航栏中，单击【存储桶列表】，进入存储桶列表页面。
2. 单击需要配置域名的存储桶，进入存储配置页面，如下图所示：
![自定义源站域名入口](https://main.qcloudimg.com/raw/8a4ceacd4892f0f9f660a6f6fa9dacd0.png)
3. 单击上方的【域名管理】，找到**自定义源站域名**栏后，单击【添加域名】。如果您的自定义域名已经在在工信部 [备案](https://cloud.tencent.com/product/ba) 且在 [域名服务控制台](https://console.cloud.tencent.com/cns/domains) 添加解析，您可以直接将您的自定义域名填写至【域名】输入框后，然后单击【保存】即可。
![](https://main.qcloudimg.com/raw/9c1b6532351fc4c0d1daf9fba724a55e.png)
4. 如果您还没有为您的自定义域名添加解析，请按照以下步骤添加您的自定义域名。
a. 登录 [域名服务控制台](https://console.cloud.tencent.com/cns/domains)，单击左侧菜单栏【域名解析列表】，进入全部域名页面。单击【添加解析】，弹出添加解析对话框。
![](https://main.qcloudimg.com/raw/77a68240b2ebcaf47352e7e8038a382c.png)
b. 输入自定义域名，项目选项选择默认项目，单击【确定】保存即可。注意：如无特殊需求，项目选项选择默认项目即可。
![添加解析弹窗](https://main.qcloudimg.com/raw/3c12489c4b45f223afd7f7cb43598e9c.png)
c. 域名添加成功后，单击域名，进入解析记录管理页面。单击【添加记录】，弹出添加记录对话框。
d. 主机记录按提示选填，记录类型选择 CNAME，线路类型选择默认，记录值请填写您的存储桶域名，TTL 保持默认，单击【确定】保存即可。添加解析完成后，15分钟左右生效，生效后您即可按照步骤3进行配置。
![](https://main.qcloudimg.com/raw/ef12eca13884d5e70438c51afab39d29.png)

### 新旧版本控制台差异	
当前新旧版本控制台的存储桶域名有所差别，以广州地域为例，新版本控制台的存储桶地域简称为 `ap-guangzhou`，旧版本存储桶则是 `cosgz`。有关域名详情请参阅 [地域和访问域名](https://cloud.tencent.com/document/product/436/6224)。	

 由于域名的差异，您在使用自定义源站域名时需要注意 CNAME 的配置。我们**推荐**您使用新版本的存储桶域名作为 CNAME，相较于旧版本的存储桶域名，使用新版本域名作为 CNAME 可以进行更丰富的操作。	

 您可以到您的 DNS 厂商处修改您的 CNAME 信息：	
- 如果您的 DNS 厂商是腾讯云，可以前往 [腾讯云域名解析控制台](https://console.cloud.tencent.com/domain) 配置。	
- 如果您的 DNS 厂商是阿里云，可以前往 [阿里云域名解析控制台](https://dns.console.aliyun.com/?spm=5176.100251.111252.1.72014f15lWTwr6#/dns/domainList) 配置。	
- 如果您的 DNS 厂商是亚马逊云，可以前往 [亚马逊云域名解析控制台](https://console.aws.amazon.com/route53/home?#DomainListing:) 配置。	

>!除了域名差异外，新旧版本控制台所调用的 API 也存在差异，我们**推荐**您使用新版本控制台以及使用新版本 API、工具、SDK，因为这能够让您体验更加丰富和稳定的功能。COS 新版本控制台所调用的操作对象或存储桶的 API 是 XML API，旧版本控制台上调用的则是 JSON API，有关新旧两个版本 API 的差异，可参阅 [API 常见问题](https://cloud.tencent.com/document/product/436/30746)。
