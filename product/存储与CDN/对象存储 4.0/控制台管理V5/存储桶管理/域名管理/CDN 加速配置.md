## 简介

CDN 加速适用于对 COS 存储桶中的内容进行下载、分发，特别是对于相同内容反复下载的使用场景。

## 设置说明

用户可对以下域名进行管理，实现存储桶中对象的快速下载和分发：
- 默认域名：即 COS 源站域名，是创建存储桶时，由系统根据存储桶名称和地域自动生成的，要与默认加速域名区分开。
- 默认加速域名：经由 CDN 加速节点的域名，系统默认生成，用户可选择开启或关闭。
- 自定义域名：用户可以为存储桶绑定已备案的自定义域名到腾讯云国内 CDN 加速平台，通过自定义域名访问存储桶中的对象。

在对默认加速域名或自定义域名开启了 CDN 加速的情况下，如果源站为公有读存储桶，那么系统会默认用户可以直接通过 CDN 加速域名或自定义域名访问到源站中的对象。如果源站为私有读存储桶，则建议用户开启 CDN 回源鉴权和 CDN 鉴权配置两个选项。

- 回源鉴权（开启前提是已添加 CDN 服务授权）：当用户请求的数据在边缘节点没有命中缓存时，CDN 需要回源获取数据内容。使用 COS 作为源站并开启回源鉴权后，CDN 边缘节点将使用特殊的服务身份（需要通过 CDN 服务授权得到此身份）访问 COS 源站，以实现获取并缓存私有访问存储桶中的数据。
- CDN 鉴权配置：当用户通过访问边缘节点获取缓存数据的时候，边缘节点会根据鉴权配置规则，校验访问 URL 中的身份验证字段，以此防范非授权的访问，实现防盗链，提高边缘节点缓存数据的安全性和可靠性。

CDN 鉴权配置和 CDN 回源鉴权的使用情况不冲突，但是两者配置的状态不同对数据的保护效果也不同，具体情况如下表：


| 存储桶访问权限      | 是否开启 CDN 回源鉴权 | 是否开启 CDN 鉴权配置 | 通过 CDN 加速域名是否可访问源站  |通过 COS 源站域名是否可访问源站   | 适用场景         |
| ------------------- | ------------ | ------------ | --------------- | --------------- | ------------ |
| 公有读              | 关闭         | 关闭         | 可访问          | 可访问          | 全站公有读 |
| 公有读              | 关闭         | 开启         | 需使用 URL 鉴权 | 可访问          | 不推荐       |
| 公有读              | 开启         | 关闭         | 不可访问        | 可访问          | 不推荐       |
| 公有读              | 开启         | 开启         | 需使用 URL 鉴权 | 可访问          | 不推荐       |
| 私有读+CDN 服务授权 | 开启         | 开启         | 需使用 URL 鉴权 | 需使用 COS 鉴权 | 全链路保护   |
| 私有读+CDN 服务授权 | 关闭         | 开启         | 需使用 URL 鉴权 | 需使用 COS 鉴权 | 不推荐       |
| 私有读+CDN 服务授权 | 开启         | 关闭         | 可访问          | 需使用 COS 鉴权 |源站保护     |
| 私有读+CDN 服务授权 | 关闭         | 关闭         | 不可访问        | 需使用 COS 鉴权 | 不推荐       |
| 私有读              |      关闭        |      开启或关闭        | 不可访问        | 需使用 COS 鉴权 | 无法使用 CDN |

>!
>- 以第一行为例，当源站存储桶访问权限为公有读的时候，如果既不开启 CDN 回源鉴权也不开启 CDN 鉴权配置，那么通过 CDN 域名可以直接访问 CDN 边缘节点和源站存储桶，通过 COS 域名可以直接访问源站存储桶。
>- 用户为域名启用 CDN 加速之后，任何人都可以通过此域名直接访问源站，所以如果您的数据有一定的私密性，请您务必通过**鉴权配置**来保护您的源站数据。

## 开启默认加速域名
### 操作步骤
1. 单击存储桶详情界面上方的【域名管理】，单击【编辑】，把默认加速域名的当前状态设置为开启。源站类型通常默认为 **默认源站**，如果作为源站的存储桶开启了静态网站，并且希望为静态网站加速，则选择为**静态网站源站**，如下图所示：
![](https://main.qcloudimg.com/raw/c2a680b936c033d0ad00b058c7112bb1.png)
>!如果用户在之前从未使用过腾讯云 CDN 服务，则无法进入【域名管理】，需先进入 CDN 控制台开启 CDN 服务。
2. 当存储桶为公有读时，则不需要开启**回源鉴权**，最后单击【保存】按钮即可开启 CDN 加速。
>!对于私有读存储桶，同时开启回源鉴权和 CDN 服务授权会导致通过 CDN 访问源站时无需携带签名，CDN 缓存资源会进行公网分发，导致数据的安全性受到影响，建议开启 CDN 鉴权。

3. 开启回源鉴权
1）当存储桶为私有读时，需要开启**回源鉴权**（在已添加 CDN 服务授权前提下）。登录 [对象存储控制台](https://console.cloud.tencent.com/cos5) ，进入左侧菜单栏【存储桶列表】，单击需要配置域名的存储桶，进入存储桶配置界面，如下图所示： 
![](https://main.qcloudimg.com/raw/b90ad17947a0ec530db87210f4b9027d.png)
2）单击存储桶详情界面上方的【域名管理】，单击【编辑】，选择开启【回源鉴权】（需确认已添加 CDN 服务授权），并单击【保存】即可开启 CDN 加速，如下图所示：
![](https://main.qcloudimg.com/raw/439f408aae267d3052758a1fdaa93743.png)

3）单击【保存】之后，可以看到默认加速域名在部署中了。同时下方会出现**CDN 鉴权**的状态提示，可单击页面上【鉴权配置】开始配置 CDN 鉴权，如下图所示：
![](https://main.qcloudimg.com/raw/8ed30acab9085f97f052e9eda83e6740.png)

4）在跳转界面中单击“鉴权配置”旁边的开启按钮，输入鉴权 Key 和有效时间，如下图所示：
![](https://main.qcloudimg.com/raw/7b8f499321fbe7a61e304397a945215f.png)

5）单击【鉴权计算器】，如果上一步已经配置好，鉴权 Key 和有效时间会自动填入，通常只用输入需要访问的对象的 Path，然后单击【生成】即可得到鉴权 URL，使用鉴权 URL 能直接访问到目标对象。如之前没有输入，需在鉴权计算器上输入鉴权 Key 、有效时间和目标路径，如下图所示：
![鉴权计算器](https://main.qcloudimg.com/raw/572b32410086d49cbfc00a650eb6f514.png)

## 开启自定义加速域名

>!
>- 此处仅介绍从 COS 控制台完成自定义域名添加及开启 CDN 加速，若要从 CDN 控制台添加自定义域名，请查阅 CDN 的 [域名接入](https://cloud.tencent.com/document/product/228/5734) 文档。 
>- 通过 COS 控制台添加自定义域名上限为10个。

### 操作步骤

1. 登录 [对象存储控制台](https://console.cloud.tencent.com/cos5) ，进入左侧菜单栏【存储桶列表】，单击需要配置域名的存储桶（如 example），进入存储桶配置界面，如下图所示： 
![](https://main.qcloudimg.com/raw/b90ad17947a0ec530db87210f4b9027d.png)

2. 从存储桶页面上方进入【域名管理】，在第二栏“自定义加速域名”处单击【添加域名】，输入待绑定的自定义域名（如 ` www.example.com`），选择开启回源鉴权，单击右侧的【保存】即可完成域名添加，如下图所示：
![](https://main.qcloudimg.com/raw/0bfbd7e43e19f9bf8e0d42e2957fc1b8.png)
>!对于私有读存储桶，同时开启回源鉴权和 CDN 服务授权会导致通过 CDN 访问源站时无需携带签名，CDN 缓存资源会进行公网分发，导致数据的安全性受到影响，建议开启 CDN 鉴权，进入步骤3。

3. 保存自定义域名之后，CDN 鉴权栏会出现 CDN 鉴权功能开关，可开启自定义域名 CDN 鉴权。
4. 登录 [CDN 控制台](https://console.cloud.tencent.com/cdn/access)，进入左侧菜单栏【域名管理】，单击要配置的域名的【管理】，选择【安全配置】。输入鉴权 Key 和有效时间，设置完成后单击【确定】，如下图所示：
![详细鉴权配置](https://main.qcloudimg.com/raw/61310b0c5960b4846a946bbacbc9fd00.png)

5. 单击【鉴权计算器】，如果上一步已经配置好，鉴权 Key 和有效时间会自动填入，通常只用输入需要访问的对象的 Path，然后单击【生成】即可得到鉴权 URL，使用鉴权 URL 能直接访问到目标对象。如之前没有输入，需在鉴权计算器上输入鉴权 Key 、有效时间和目标路径，如下图所示：
![鉴权计算器](https://main.qcloudimg.com/raw/ad4a7703e469269bbf299e19869d00d6.png)

## 注意事项
用户为域名启用 CDN 加速之后，任何人都可以通过此域名直接访问源站，所以如果您的数据有一定的私密性，请您务必通过**鉴权配置**来保护您的源站数据。
