## 新增 TCP/UDP 监听器

1. 登录 [全球应用加速控制台](https://console.cloud.tencent.com/gaap)，进入“接入管理”页面，单击指定通道的 **ID/通道名**。
2. 进入下一级页面，选择**TCP /UDP 监听器管理** > **新建**，具体配置如下：
   1. 配置监听器信息，用于设置加速协议和端口映射关系。
		![](https://qcloudimg.tencent-cloud.cn/raw/8f0ff0f7ac833cc909fdeb5c86a7831e.png)
      - 源站类型：可以填写 IP 地址或域名，但同一个监听器只支持一种类型。（备注：IPv6通道暂不支持域名类型）
      - 获取客户端IP：可选择 TOA 或 Proxy Protocol 两种获取客户端 IP 的方法获取真实用户 IP，具体介绍可参考 [获取访问用户真实 IP](https://cloud.tencent.com/document/product/608/14429) 页面。
      - 监听端口：指加速通道 VIP 的访问端口。端口规范：有效范围1 - 64999（21端口暂不开放）。支持单个端口或连续端口范围，但端口不能重复，一次最多添加的连续端口20个，如8000 - 8019。
   2. 配置源站处理策略。即在同一个监听器绑定多个源站的情况下，选择源站之间的调度策略。
  ![](https://qcloudimg.tencent-cloud.cn/raw/200150677082313cf5b430904ea0517c.png)
      - 轮询：多个源站按轮询策略回源。
      - 轮询加权：多个源站按权重比例回源（可以在绑定监听器时设置各源站的权重）。
      - 最小连接数：在所有源站中选择连接数最小的源站优先进行调度。
      - 最小时延：选择时延最小的源站优先进行调度。
      - 备源：选择是否开启主备源切换（开启该功能会强制要求开启源站健康检查）。
      <blockquote class="d-mod-notice">
      					<div class="d-mod-title d-notice-title">
      						<i class="d-icon-notice"></i>注意：
      					</div>
             <p>源站类型为域名的监听器，仅支持“轮询”及“最小连接数”两种调度策，暂不支持备源。</p>
      				</blockquote>
   3. 如果使用 TCP 监听器，则可以选择配置健康检查机制，帮助您自动检查并移除异常的源站，启用备源则无法关闭健康检查。
![](https://qcloudimg.tencent-cloud.cn/raw/c4bda7e03c245d77a08104a6295c4b97.png)
      - 响应超时时间：指源站响应的超时时间。
      - 健康检查间隔：指前后两次健康检查的时间间隔。
      - 不健康阈值：表示监听器连续检查失败多少次后确定源站不健康。当健康检查判断源站不健康时，将不再向该源站转发数据包，直至该源站健康检查状态恢复正常。 
      - 健康阈值：表示监听器连续检查成功多少次后确定源站健康。当健康检查判断源站健康时，将重新向该源站转发数据包。
   4. 选择是否开启会话保持功能。
![](https://main.qcloudimg.com/raw/2e7471ba4795c532966dbc67f391c81d.png)
      - 会话保持：来自同一IP的用户请求保持访问相同源站。
      - 保持时间：会话保持的时间。当监听器无请求的持续时间超过保持时间，将会自动断开会话保持。
3. 单击**完成 **，成功新建 TCP/UDP 监听器。

## 设置TCP/UDP 监听器

单击 **TCP/UDP 监听器管理**标签页，在操作栏单击**设置**可以修改监听器名字、调度策略和健康检查参数等。

## 源站绑定

1. 单击 **TCP/UDP 监听器管理**标签页，选择已建立的 “TCP/UDP监听器”。在操作栏单击**源站绑定**，您可选择多个源站进行绑定或解绑。如果控制台显示未找到源站信息，可能是由于源站类型不匹配或源站未添加在 [源站管理](https://console.cloud.tencent.com/gaap/listrs) 中。
![](https://qcloudimg.tencent-cloud.cn/raw/5696c411d24d7b3cbc13babda2e60805.png)
2. 选择源站，并配置回源端口。
   - 如果监听器开启主备轮询选项，则需要在源站绑定页面设置“主源站”与“备源站”。
   - 如果您希望对多个源站的端口进行设定，可使用右上角“覆盖端口/补齐端口”功能。无论您之前设定的源站端口为多少，“覆盖端口”功能都会将您选择的目标源站统一设定为您输入的端口。如果选定的目标源站中存在未设定端口的情况，您可使用“补齐端口”功能进行统一设定，减少您的重复工作量。
   - 如果监听器策略为“加权轮询”，则可以在绑定的同时设置源站的权重，范围1 - 100，按权重值占总权重的比例进行调度，如源站1的权重为60，源站2的权重为80，则源站1的调度比例为 60 / (60 + 80) = 42.8%，源站2的调度比例为57.2%。
     ![](https://main.qcloudimg.com/raw/ddb99c5d31ee860aa75687cc722bcc60.png)
   - 如果您开启了健康检查，绑定源站后，健康检查即开始启动。可以通过监听器的状态来判断源站是否正常，加速通道只会向正常状态的源站进行数据包转发，异常的源站将不再转发数据包，直至该异常源站健康检查状态恢复正常后才重新转发。
   - 如果您未开启健康检查或使用UDP 协议监听器，那么不论源站的状态如何，加速通道将始终做数据包转发。
     ![](https://main.qcloudimg.com/raw/cc79b67e828e33377bd83ff5ba7d356e.png)
3. 配置确认
   源站配置完成后点击下一步到配置确认页面，用户可以查看当前配置的归属通道信息以及监听器详细信息。
![](https://qcloudimg.tencent-cloud.cn/raw/3729ac638e142cc1b65f387880e6a65c.png)
4. 单击**完成**，成功绑定源站。

## 删除TCP/UDP 监听器

单击 **TCP/UDP 监听器管理**标签页，在操作栏单击**删除**，可以删除指定的监听器，若监听器已绑定源站，则需要选中“允许强制删除绑定有源站的监听器”后，才能删除。删除后，该监听器的端口将停止加速。
 ![](https://main.qcloudimg.com/raw/5dd1ebced34ac200ee8e06c47511a8e5.png)
