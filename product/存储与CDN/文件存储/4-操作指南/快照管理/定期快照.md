## 功能概览[](id:FeaturesOverview)

腾讯云文件存储提供了**定期快照**功能，该功能便于开发者灵活设置备份任务策略。
建议针对不同业务采用不同的定期快照策略，推荐设置如下表：
<table>
	<tr>
		<th>业务场景</th>
		<th>快照频率</th>
		<th>快照保留时间</th>
	</tr>
	<tr>
		<td>核心业务</td>
		<td>使用定期快照，策略设置为每天1次</td>
		<td>7天 - 30天</td>
	</tr>
	<tr>
		<td>非核心、非数据类业务</td>
		<td>使用定期快照，策略设置为每周1次</td>
		<td>7天</td>
	</tr>
	<tr>
		<td>归档业务</td>
		<td>根据实际业务需求手动制作快照，无需设置固定频率</td>
		<td>1个月到数个月</td>
	</tr>
	<tr>
		<td>测试业务</td>
		<td>根据实际业务需求手动制作快照，无需设置固定频率</td>
		<td>用完及时删除</td>
	</tr>
</table>


## 策略说明
您可参照下表进一步了解定期快照策略所包含内容及特性，以便更好的在业务中使用快照。
<table>
     <tr>
         <th>策略项</th>  
         <th>说明</th>  
     </tr>
	 <tr>
         <td>对象</td>
         <td>所有文件系统。</td>
     </tr> 
	 <tr>
         <td>执行策略</td>
         <td>自动快照时间点可具体到每小时 - 每天，设置执行策略后，长期有效。</br>修改已有执行策略时，修改成功后立即生效。</td>
     </tr>
	 <tr>
         <td nowrap="nowrap">定期销毁<b>（重要）</b></td>
         <td>定期快照提供定期销毁的功能，事先设置快照的生存周期（1天 - 30天），到期后将自动删除自动生成的快照，有效降低备份成本。</br>若不设置定期销毁策略，则自动快照将长期保留。</td>
     </tr>
	 <tr>
         <td>批量</td>
         <td>可勾选多个文件系统，针对多个文件系统批量执行同一定期快照策略。</td>
     </tr>
	 <tr>
         <td>命名规则</td>
         <td>自动快照的命名为 auto_policy_cfsidyyyyMMddHH。其中，cfsid 是文件系统ID，yyyyMMdd 是当天的日期，HH 为小时。</br>您也可以手动修改快照命名。</br>例如，auto_policy_cfs-2cj5yj0f2021090923 表示2021年9月9日23时对文件系统 cfs-2cj5yj0f 创建的自动快照。</td>
     </tr>
	 <tr>
         <td nowrap="nowrap">生命周期<b>（重要）</b></td>
         <td>快照的生命周期有两种：<li>手动创建的快照，生命周期默认为<b>长期保存</b>，只要账户余额充足，则可长期保留。</li><li>定期快照，根据创建规则，可设定<b>定期销毁</b>的时间点，也可设置为长期保留。</li></td>
     </tr>
	 <tr>
         <td>快照冲突</td>
         <td>自动快照与自定义快照在使用上没有冲突，但在创建过程中时间有可能冲突。</br><li>当正在对某一个文件系统执行自动快照时，用户需要等待自动快照完成后，才能创建自定义快照（反之同理）。</li><li>如果文件系统数据量大，一次快照时长超过两个自动快照时间点间隔，则下一个时间点不自动快照自动跳过。例如，用户设置9:00、10:00以及11:00为自动快照时间点，9:00执行自动快照的使用时长为70分钟（即10:10才完成），那么10:00将不再执行自动快照，下个快照时间点为11:00。</li> </td>
     </tr>
	 <tr>
         <td>快照额度</td>
         <td>每个文件系统具有一定的快照额度，若文件系统的快照数量达到额度上限，自动快照任务会被挂起、阻塞。</br>快照额度主要是为了避免开发者遗忘了某个自动快照策略，导致存储成本无止境攀升。</td>
     </tr>
	 <tr>
         <td>ASP</td>
         <td>指定期快照策略，即 Auto Snapshot Policy。</td>
     </tr>
	 <tr>
         <td>ASP 额度</td>
         <td>单个腾讯云账户下，每一个地域最多设定30个 ASP 策略。单个 ASP 最多关联200个文件系统。</td>
     </tr>
	 <tr>
         <td>保存周期</td>
         <td><li>对于自动快照，控制台会显示回收的倒计时。支持手动将自动快照的保存周期修改为永久保留。</li><li>对于手动创建快照，显示永久保留。</td>
     </tr>
	 <tr>
         <td>ASP 暂停功能</td>
         <td>ASP 自动快照策略提供手动触发<b>暂停</b>的功能，暂停后，将不会再自动创建新的快照。但已经生成的自动快照的生命周期不受暂停功能影响，仍然会根据设定的规则定期销毁或长期保存。</td>
     </tr>
	 <tr>
         <td>操作日志</td>
         <td>显示所有自动快照的创建过程，与手动添加的快照相同。</td>
     </tr>
</table>



## 操作步骤

### 创建定期快照策略

>? 单个腾讯云账户下同一地域内最多支持创建30个定期快照策略。
>


1. 登录文件系统控制台，进入 [快照策略](https://console.cloud.tencent.com/cfs/snapshot/policy?rid=1) 页面。
[](id:step2)
2. 选择地域。
3. 单击**新建**。
[](id:step4)
4. 在“新建快照策略”页面中，设置以下参数，并单击**确定**。如下图所示：
![](https://main.qcloudimg.com/raw/fac19b3bb6126baac6c296dca36f91e2.png)
 <table>
     <tr>
         <th width="14%">参数项</th>  
         <th>参数说明</th>  
     </tr>
	 <tr>
         <td>名称</td>
         <td>必选参数。</br>定期快照策略的名称，最多支持60个字符。</td>
     </tr> 
	 <tr>
         <td>所属地域</td>
         <td>必选参数。</br>当前页面下该参数不可更改，具体设置方法请参见 <a href="#step2">步骤2</a>。</td>
     </tr>
	 <tr>
         <td>备份日期</td>
         <td>必选参数。</br>执行定期快照的日期，可勾选范围：每周日 - 每周六。</td>
     </tr>
	 <tr>
         <td>备份时间点</td>
         <td>必选参数。</br>执行定期快照的时间点，可勾选范围：00:00 - 23:00每个整点（根据后台实际运行情况，设定的定时快照的时间和控制台实际创建快照时间可能存在差异，快照里的数据以控制台创建的时间为准）。</td>
     </tr>
	 <tr>
         <td>快照保留时间</td>
         <td>必选参数。<ul><li>保留固定天数后自动删除，天数可选1 - 30。默认为保留30天。</li><li>永久保留。</li></ul></td>
     </tr>
</table>


### 关联文件系统

>?同一定期快照策略最多支持关联200个文件系统。
>

1. 登录文件系统控制台，进入 [快照策略](https://console.cloud.tencent.com/cfs/snapshot/policy?rid=1) 页面。
2. 选择地域。
3. 单击目标策略所在行的**关联文件系统**。
4. 在“关联文件系统”页面中，勾选需要关联的文件系统。如下图所示：
![](https://main.qcloudimg.com/raw/a3f4a7de22e219325827dcd1fee497c3.png)
5. 单击**确定**。


### 开启/关闭定期快照策略

1. 登录文件系统控制台，进入 [快照策略](https://console.cloud.tencent.com/cfs/snapshot/policy?rid=1) 页面。
2. 选择地域。
3. 找到目标策略所在行，单击“定期快照”栏下的开关按钮即可开启或关闭该定期快照策略。

### 修改定期快照策略

1. 登录文件系统控制台，进入 [快照策略](https://console.cloud.tencent.com/cfs/snapshot/policy?rid=1) 页面。
2. 选择地域。
3. 单击目标策略所在行的**修改策略**。
4. 在“修改快照策略”页面中，修改相关参数（参数说明请参考 [步骤4](#step4)）并单击**确定**。

### 删除定期快照策略

1. 登录文件系统控制台，进入 [快照策略](https://console.cloud.tencent.com/cfs/snapshot/policy?rid=1) 页面。
2. 选择地域。
3. 您可以通过以下方式删除定期快照策略：
 - 单个删除：选择目标策略所在行右侧的**更多 > 删除**。
 - 批量删除：勾选需要删除的定期快照策略，单击列表上方的**删除**。

### 将自动快照转为永久保留的快照

>?若自动快照策略中**快照保留时间**已设置为**永久保留**，则无需对该策略自动生成的快照执行以下操作。
>

1. 登录文件系统控制台，进入 [快照策略](https://console.cloud.tencent.com/cfs/snapshot/policy?rid=1) 页面。
2. 选择地域。
3. 单击目标自动快照的 ID。
4. 在详情页中，单击**长期保存**，将自动快照设置为永久保留，快照保留时长则变为永久保留。如下图所示：
![](https://main.qcloudimg.com/raw/b152425e895de8fe4144d8e8bcd62332.png)
