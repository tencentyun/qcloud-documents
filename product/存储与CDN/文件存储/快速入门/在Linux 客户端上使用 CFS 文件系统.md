## 简介
本文为您详细介绍如何在 Linux 客户端上使用 CFS 文件系统。

## 操作步骤
使用 CFS 文件系统操作流程：“[创建文件系统及挂载点](#.E5.88.9B.E5.BB.BA.E6.96.87.E4.BB.B6.E7.B3.BB.E7.BB.9F.E5.8F.8A.E6.8C.82.E8.BD.BD.E7.82.B9)” > “[连接实例](#.E8.BF.9E.E6.8E.A5.E5.AE.9E.E4.BE.8B)” > “[挂载文件系统](#.E6.8C.82.E8.BD.BD.E6.96.87.E4.BB.B6.E7.B3.BB.E7.BB.9F)” > “[卸载共享文件系统](#.E5.8D.B8.E8.BD.BD.E5.85.B1.E4.BA.AB.E7.9B.AE.E5.BD.95)” > “[终止资源](#.E7.BB.88.E6.AD.A2.E8.B5.84.E6.BA.90)”。详细操作步骤请阅读本文以下章节。


### 创建文件系统及挂载点

#### 1. 进入文件系统界面

登录文件存储 [CFS 控制台](https://console.cloud.tencent.com/cfs)，在左侧导航栏单击【文件系统】，进入文件系统列表页。

#### 2. 创建文件系统及挂载点

单击【新建】，弹出创建文件系统弹窗，在弹窗中配置如下信息，操作无误后，单击【确定】即可创建文件系统及挂载点。

<table>
  <tr>
    <th>字段</th>
    <th>含义</th>
  </tr>
  <tr>
    <td>地域</td>
    <td>选择所需要创建 CFS 文件系统的地域。</td>
  </tr>
  <tr>
    <td>可用区</td>
    <td>选择所需要创建 CFS 文件系统的可用区。</td>
  </tr>
  <tr>
    <td>文件服务协议</td>
    <td>选择文件系统的协议类型，NFS 或 CIFS/SMB 。其中，NFS 协议更适合于 Linux/Unix 客户端，CIFS/SMB 协议更适合于 Windows 客户端（CIFS/SMB 协议近期公测已结束，后续开放时间敬待通知，更多信息请参见 <a href="https://cloud.tencent.com/document/product/582/9553#cifs.2Fsmb-.E5.85.AC.E6.B5.8B.E8.AF.B4.E6.98.8E">CIFS/SMB 公测说明</a>）。</td>
  </tr>
  <tr>
    <td>客户端类型</td>
    <td>选择需要访问 CFS 文件系统的客户端类型，云服务器（含容器、批量计算）或黑石服务器。 因为云服务器和黑石主机分别属于不同的网络，系统会根据您的客户端类型分配该文件系统到指定网络中。</td>
  </tr>
  <tr>
    <td>网络类型</td>
    <td> 
私有网络（VPC）或者是基础网络。请根据您的 CVM 实例所在网络来创建并挂载文件系统，否则可能因为网络不通导致无法访问。
    <li>若您要实现私有网络（VPC） 下 CVM 对文件系统的共享，您需要在创建文件系统时选择私有网络。当文件系统属于私有网络时，如果未进行特殊网络设置，则只有同一私有网络内的 CVM 实例能够挂载。</li>
    <li>若您要实现基础网络下 CVM 对文件系统的共享，您需要在创建文件系统时选择基础网络。当文件系统属于基础网络时，如果未进行特殊网络设置，则只有同在基础网路内的 CVM 实例能够挂载。</li>
    <li>如果有多网络共享文件系统需求，请参见 <a href="https://cloud.tencent.com/document/product/582/9764">跨网络访问文件系统</a> 文档</li>
    </td>
  </tr>  
  <tr>
    <td>权限组</td>
    <td>每个文件系统必须绑定一个权限组，权限组规定了一组可来访白名单及读、写操作权限。
    </td>
  </tr>
</table>

#### 3. 获取挂载点信息

获取挂载点信息。当文件系统及挂载点创建完毕后，单击实例 ID 进入到文件系统详情，单击【挂载点信息】，获取 Linux 客户端上使用文件系统的挂载命令。请按照推荐的挂载命令执行挂载操作。
**数量**指挂载源数量，即可以挂载的方式数量，目前只支持通过 IP 挂载，故该值为1。



### 连接实例
本部分操作介绍登录 Linux 云服务器的常用方法，不同情况下可以使用不同的登录方式，此处介绍控制台登录，更多登录方式请见 [登录 Linux 实例](/doc/product/213/5436) 。

#### 前提条件
登录到云服务器时，需要使用管理员帐号和对应的密码。
 - 管理员账号：对于 Linux 类型的实例，管理员帐号统一为 root（Ubuntu 系统用户为 ubuntu）。
 - 密码：密码为购买云服务器时设置的密码。

#### 控制台登录云服务器
- 在云服务器列表的操作列，单击【登录】按钮即可通过 VNC 连接至 Linux 云服务器。
- 输入帐号（root ，Ubuntu 系统用户为 ubuntu）和密码即可登录。

>?该终端为独享，即同一时间只有一个用户可以使用控制台登录。


#### 验证网络通信
挂载前，需要确认客户端与文件系统的网络可达性。您可以通过 telnet 命令验证，具体各个协议及客户端要求开放端口信息如下：

文件系统协议 | 客户端开放端口 | 确认网络联通性
------- | ------- | ---------
NFS 3.0 | 111，892，2049 |  telnet 111或者892或者2049
NFS 4.0 | 2049 |  telnet 2049
CIFS/SMB | 445 |  telnet 445 

>?CFS 暂不支持 ping。


### 挂载文件系统

#### 挂载 NFS 文件系统

#### 1. 启动 NFS 客户端
挂载前，请确保系统中已经安装了`nfs-utils`或`nfs-common`，安装方法如下：
- CentOS：
```shell
sudo yum install nfs-utils
```
- Ubuntu 或 Debian：
```shell
sudo apt-get install nfs-common
```

#### 2. 创建待挂载目标目录
使用下列命令创建待挂载目标目录。
```shell
mkdir <待挂载目标目录>
```
示例：
```shell
mkdir /local/
mkdir /local/test
```

#### 3. 挂载文件系统
**NFS v4.0 挂载**
使用下列命令实现 NFS v4.0 挂载。
```shell
sudo mount -t nfs -o vers=4 <挂载点IP>:/ <待挂载目录>
```

- 挂载点IP：指创建文件系统时，自动的生成的挂载点 IP。
- 目前默认挂载的是文件系统的根目录`/`。 在文件系统中创建子目录后，可以挂载该子目录。
- 待挂载目标目录： 在当前服务器上，需要挂载的目标目录，需要用户事先创建。

>!`<挂载点IP>:/`与`<待挂载目标目录>`之间有一个空格。


示例：
- 挂载 CFS 根目录：
```shell
sudo mount -t nfs -o vers=4 10.0.24.4:/ /localfolder
```
- 挂载 CFS 子目录：
```shell
sudo mount -t nfs -o vers=4 10.0.24.4:/subfolder /localfolder 
```

**NFS v3.0 挂载**
使用下列命令实现 NFS v3.0 挂载。
```shell
sudo mount -t nfs -o vers=3,nolock,proto=tcp <挂载点IP>:/<fsid> <待挂载目录>
```
- 挂载点IP：指创建文件系统时，自动的生成的挂载点 IP。
- NFS v3.0 仅支持子目录挂载，缺省文件系统子目录为 FSID。
- 待挂载目标目录： 在当前服务器上，需要挂载的目标目录，需要用户事先创建。

>! `<挂载点IP>:/<FSID>` 与 `<待挂载目标目录>`之间有一个空格。

挂载 CFS 子目录示例如下：
```shell
sudo mount -t nfs -o vers=3,nolock,proto=tcp 10.0.24.4:/z3r6k95r /localfolder 
```

#### 4. 查看挂载点信息
挂载完成后，请使用如下命令查看已挂载的文件系统：
```shell
mount -l
```
也可以使用如下命令查看该文件系统的容量信息：
```shell
df -h
```


#### 挂载 CIFS/SMB 文件系统
>!CIFS/SMB 协议文件系统公测中，更多信息请参见 [CIFS/SMB公测说明](https://cloud.tencent.com/document/product/582/9553#cifs.2Fsmb-.E5.85.AC.E6.B5.8B.E8.AF.B4.E6.98.8E)。

#### 1. 启动 CIFS 客户端
挂载前，请确保系统中已经安装了`cifs-utils`，安装方法如下：
CentOS：
```shell
sudo yum install cifs-utils.x86_64 –y
```

#### 2. 创建待挂载目标目录
使用下列命令创建待挂载目标目录。
```shell
mkdir <待挂载目标目录>
```
示例：
```shell
mkdir /local/
mkdir /local/test
```

#### 3. 挂载文件系统
使用下列命令实现 CIFS 挂载。
```shell
mount -t cifs -o guest //<挂载点IP>/<FSID> /<待挂载目标目录>
```
- 挂载点IP：指创建文件系统时，自动的生成的挂载点 IP。
- 目前默认挂载使用文件系统的FSID。 
- 待挂载目标目录： 在当前服务器上，需要挂载的目标目录，需要用户事先创建。

>!`<FSID>` 与 `/<待挂载目标目录>`之间有一个空格。

示例：
```shell
mount -t cifs -o guest //10.66.168.75/vj3i1135  /local/test
```

#### 4. 查看挂载点信息
挂载完成后，请使用如下命令查看已挂载的文件系统：
```shell
mount -l
```
也可以使用如下命令查看该文件系统的容量信息：
```shell
df -h
```

### 卸载共享目录
当某些情况下需要卸载共享目录，请使用如下命令。其中 "目录名称" 为根目录或者文件系统的完整路径。
```shell
umount <目录名称>
```

示例： 
```shell
umount /local/test
```

>!强烈建议您在重启或关闭客户端前先执行卸载文件系统的操作，以避免引起系统异常。

### 终止资源
您可以从腾讯云控制台终止文件系统。进入腾讯云 [文件存储控制台](https://console.cloud.tencent.com/cfs)，选中需要终止的文件系统，单击【删除】并【确认】，即可删除文件系统。


