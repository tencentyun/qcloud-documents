>!**本篇文档仅适用于云开发中的云托管。**

## 基础配置说明

### 上传方式

支持本地代码/代码库拉取/镜像拉取三种方式。

#### 方式 1：本地代码

上传代码工程文件夹或 zip 压缩包，系统解析成功后先将代码构建为镜像、将镜像推送到服务绑定的镜像仓库储存，然后基于该镜像进行部署。

**此方式需要您自行编写 Dockerfile 并包含在代码文件夹或 zip 压缩包中。**

>? 我们提供 [Java](https://clooudbaserun-1258016615.cos.ap-shanghai.myqcloud.com/java_helloworld.zip)、[PHP](https://clooudbaserun-1258016615.cos.ap-shanghai.myqcloud.com/php_helloworld.zip)、[Node.js](https://clooudbaserun-1258016615.cos.ap-shanghai.myqcloud.com/nodejs_helloworld.zip)、[Golang](https://clooudbaserun-1258016615.cos.ap-shanghai.myqcloud.com/go_helloworld.zip)、[Python](https://clooudbaserun-1258016615.cos.ap-shanghai.myqcloud.com/python_helloworld.zip) 语言的示例代码包下载用于 Demo。除此之外的任意开发语言也都可支持。如需更多语言的 Demo 代码包资源，请 [联系我们](https://cloud.tencent.com/act/event/connect-service)。

#### 方式 2：代码库拉取

获得您的授权后，从您的 GitHub / GitLab / 码云 Gitee 仓库拉取代码后，先将代码构建为镜像、将镜像推送到服务绑定的镜像仓库储存，然后基于该镜像进行部署。

**此方式需要您自行编写 Dockerfile 并包含在代码库中。**

>? 首次使用需要您先进行授权。授权成功后，当前环境任意服务新建版本都不再需要再次授权。

#### 方式 3：镜像拉取

无需系统提供从代码构建镜像的服务，由您自行采用任意方式构建好镜像后，手动将镜像上传至服务所绑定的镜像仓库中，然后系统基于您选定的镜像进行部署。

>? 
> 1. 如何上传镜像，请查看本文档“相关操作”中的“手动上传镜像”部分。
> 2. 使用 Demo 镜像可快速体验部署过程。选择 Demo 镜像后无需修改任何配置，直接开始部署。
> 

### 监听端口

应用监听端口。默认为 80。

### 流量策略

部署完成后，如何开启流量。目前有如下两种选择：

- 部署完成后保持流量为 0 稍后再手动调整流量：希望部署完后先手动验证再开流量，或只希望引入部分流量进行灰度升级。
- 部署完成后自动开启 100%流量：首次部署完成后立刻开流量，或升级时进行全量升级。

### 备注信息

选填，会展示在版本列表页面中，对部署不产生任何影响。

## 自动扩缩容配置说明

### 副本模式

支持低成本或高可用两种模式。

#### 模式 1：低成本

适合对成本敏感，对冷启动相对不敏感的业务。

- 副本个数最小值为 0，当没有流量打到版本上时，版本将缩容到 0，不保留任何实例，不产生任何费用。
- 连续半个小时无流量才将实际缩容到 0（避免流量偶然波动带来的误判）。再次冷启动时，可能有 30 秒服务延迟。
- 默认推荐规格为最小规格 0.25 核 0.5G，**单价最低**。您也可按需调整规格。
- 虽然没有业务流量，部署过程中仍然会先产生一个实例，部署完成后再缩容到 0，因此**部署过程本身会产生一定的资源消耗。**
- 是否有业务流量，是通过是否有通过域名访问来判断的。如果通过内网 IP 调用（不推荐），或者服务跑的是定时任务没有外部调用，也会被认为无流量触发缩容。以上类型业务，请采用高可用模式。

>? 将版本流量百分比设置为 0 并不是触发缩容到 0 的充要条件。低成本模式下，版本流量百分比设置为 0，一定会触发缩容到 0。但如果版本流量百分比不为 0，需要连续半小时的观测期，期间版本没有产生真实业务流量，才会触发缩容到 0。
> 

#### 模式 2：高可用

适合对成本相对不敏感，对服务常驻有诉求，或无法接受冷启动的业务。

- 副本个数最小值不能为 0，可以设置为 1 ～ 50 间的任意整数。即便没有流量打到版本上，仍会保持最小个数的实例数，也会**持续产生费用**。
- 部署过程中即开始按最小副本个数和规格产生实例，**部署过程本身会产生一定的资源消耗。**

### 规格

指集群中每个容器实例的配置。自动扩容时，新创建的实例将使用这个规格。同一个版本下所有容器实例规格都会保持一致。

### 副本个数

指当前版本在自动扩缩容时可达到的最大实例数及最小实例数。最小值下限为 0，最大值上限为 50。
- 如需将最小值修改为 0，请先切换副本模式至“低成本”。
- 如需将最小值修改为大于 0 的整数，请先切换副本模式至“高可用”。

### 扩缩容条件

当达到某个条件时，云托管会自动会创建/删除实例，然后检测是否再次达到条件，如果满足条件则继续扩缩容，如此反复直至实例数量达到副本个数的最小值/最大值，或不再满足扩缩容条件时停止自动扩缩容。

目前仅支持 CPU 使用率作为扩缩容条件，更多扩缩容指标敬请期待。

>? 
>- 自动扩容到副本个数最大值后若仍不足以承载业务流量，即便再次达到扩缩容条件，也不会继续创建新的实例，可能导致您的业务受影响，请您评估好业务指标后合理设定副本个数最大值。
> - 若希望提升最大值限额（大于 50），请提交工单联系我们单独处理。
> 

## 高级配置说明

高级配置可不做任何修改直接使用默认值开始部署。

### InitialDelaySeconds

实例创建完成后，等待一定的时间后开始进行健康检查。若健康检查失败，将重试 3 次，依然失败则判定服务版本异常。请将此值设定为大于应用启动的时间，否则版本可能持续处于异常状态。默认值为 2 秒。

### 日志采集路径

可设置目录或文件，支持设置多个路径。采集到的日志可以在 [日志管理](https://console.cloud.tencent.com/tcb/log) 中查看。支持标准输出（stdout）以及 `*` 通配路径（例：/logs/\*），使用 `,`（半角逗号）分割，留空将采集标准输出。

### 环境变量

用户所需的环境变量，直接传入容器中。以 key value 的形式可配置多个。


