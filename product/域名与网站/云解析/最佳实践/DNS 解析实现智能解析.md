DNS 解析实现智能解析

#### 操作场景

**智能解析适用以下场景：**

+  **境内跨运营商或跨地区访问场景**： 企业的线上应用服务，大多数都会使用多个运营商 IP 地址，但是传统DNS解析是随机或优选的方式将其中一个IP地址返回给访问者，因此会造成访问者因跨网或跨地域导致访问速度慢或访问质量差的情况，所以，企业可以通过 DNS 智能解析的配置来实现用户的就近访问。

+ **全球业务智能访问场景**：企业如果是开展全球业务，一般为了实现全球用户都能获得较好的访问质量，通常会在中国和海外分别部署应用服务，所以企业可通过智能解析的配置，实现将用户访问分别路由至海外或境内的接入点。

+ **通过智能解析限制某运营商或地域的访问者进行访问**：一部分企业因某些原因，会期望限制境外的访问者访问企业的应用服务，那么则可以通过配置智能解析，来实现屏蔽境外访问者的访问诉求。



#### 前提条件

+ 一个用户访问的域名（例如：dnspod.cn）。
+ 三个运营商IP地址（例如：1.1.1.1（联通）、2.2.2.2（移动）、3.3.3.3（电信））。

#### 操作步骤

+ **境内跨运营商或跨地区访问场景**
    **按照如下配置，可以实现的效果是**：
  + DNS 解析会智能判断出访问者的来源，并返回配置的记录IP地址。
  + 访问者的本地DNS出口IP来源于移动运营商，DNS查询获取的地址是 2.2.2.2.
  + 访问者的本地DNS出口IP来源于电信运营商，DNS查询获取的地址是 3.3.3.3。
  + 访问者的本地DNS出口IP来源不属于电信或移动（例如来源于鹏博士、联通等）的场景下，DNS查询获取的地址是 1.1.1.1。
  + 在某个运营商的IP地址无法访问时，能够自动将用户的访问流量，切换到其他的运营商的IP地址。



1.登录 [DNS 解析控制台](https://console.cloud.tencent.com/cns)，选择并单击需要配置智能解析的域名，进入该域名的记录管理页，如下图所示。

![](https://main.qcloudimg.com/raw/16ed7f1b819aecc98ef65775fcc54d17.png)

2.在记录管理页中，单击【添加记录】，创建三条子域名的 A 记录，并分别指向三个运营商IP地址：1.1.1.1（联通）、2.2.2.2（移动）、3.3.3.3（电信），解析线路分别选择 默认、移动、电信。如下图所示：

![](https://main.qcloudimg.com/raw/35b80c1228592fa2414c1021c27a374e.png)


+ **全球业务智能访问场景**
    **按照如下配置，可以实现的效果是**：

  + 访问者的本地DNS出口IP来源于境外，DNS查询获取的地址是 海外IP 1.1.1.1
  + 访问者的本地DNS出口IP来源于非境外，DNS查询获取的地址是 移动运营商IP 2.2.2.2
  
1. 登录 [DNS 解析控制台](https://console.cloud.tencent.com/cns)，选择并单击需要配置智能解析的域名，进入该域名的记录管理页，如下图所示。

![](https://main.qcloudimg.com/raw/16ed7f1b819aecc98ef65775fcc54d17.png)

2. 在记录管理页中，单击【添加记录】，创建两条 A 记录，并分别设置【境外】和【默认】线路类型，指向IP地址：1.1.1.1（境外）、2.2.2.2（默认）。如下图所示：

![](https://main.qcloudimg.com/raw/120e6e2f43eb440bee36a5c00fee2785.png)

+ **通过智能解析限制某运营商或地域的访问者进行访问**
**按照如下配置，可以实现的效果是：**

   + 访问者的本地DNS出口IP来源于境外，DNS查询获取的地址是 127.0.0.1 （此地址可实现境外用户无法访问）
   + 访问者的本地DNS出口IP来源于非境外，DNS查询获取的地址是 移动运营商IP 2.2.2.2

1. 登录 [DNS 解析控制台](https://console.cloud.tencent.com/cns)，选择并单击需要配置智能解析的域名，进入该域名的记录管理页，如下图所示。

![](https://main.qcloudimg.com/raw/16ed7f1b819aecc98ef65775fcc54d17.png)

2. 在记录管理页中，单击【添加记录】，创建两条 A 记录，并分别设置【境外】和【默认】线路类型，指向IP地址：127.0.0.1（境外）、2.2.2.2（默认）。如下图所示：

![](https://main.qcloudimg.com/raw/9b228c2574b375664199b409626d1e09.png)





