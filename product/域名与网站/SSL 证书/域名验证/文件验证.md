
## 操作场景
本文档将指导您在证书管理控制台申请证书或新增域名资料时，并且域名验证方式为文件验证，如何进行域名验证操作。

## 验证规则
### 域名验证规则
进行文件验证时，请注意以下几种情况：
>!
- 申请域名为主域时需要额外验证 www。例如，申请域名为 `tencent.com`，则还需验证 `www.tencent.com`。
- 申请 www 的域名需要额外验证 www 后面的域名，无论是几级域名。例如，申请域名为 `www.a.tencent.com`，则还需验证 `a.tencent.com`。
- 申请 `*.域名`，只需要验证上级域名。例如，申请域名为 `*.tencent.com`，则只需验证 `tencent.com`。
- 申请不带 www 的非主域只需要验证当前域名。例如，申请域名为 `cloud.tencent.com`，则只需验证 `cloud.tencent.com`。

### CA 验证规则
- DNS 查询时必须从权威根服务器递归查询每级域名的权威 NS 服务器，再从 NS 服务器查询对应的 A、AAAA 或 CNAME。
- 若 DNS 服务支持 DNSSEC，必须校验响应数据的签名信息。
- 若被查询域名是 IP，直接通过 IP 访问验证内容。
- 必须通过标准的 HTTP / HTTPS 的默认端口进行访问。
- 可以支持 301/302 跳转，跳转次数不超过2次，跳转目的地址跟被检测域名需在同一主域。
- 最终检测结果需要响应200状态码。
- HTTPS 访问时可以忽略证书错误。

## 操作步骤

### 步骤1：查看验证信息
1. 登录 [证书管理控制台](https://console.cloud.tencent.com/certoverview)。
2. 选择【验证中】的证书，进入 “验证域名” 页面，并在规定时间内完成验证操作。如下图所示：
![](https://main.qcloudimg.com/raw/87792ad4441ba0f875888312b1b4d5c3.png)

### 步骤2：添加文件记录
1. 请您登录服务器，并且确保域名已指向该服务器并且对应的网站已正常启用。
>?若您的域名对应的**域名解析商**在腾讯云，将域名指向您的服务器请参见 [A 记录](https://cloud.tencent.com/document/product/302/3449)。
>
4. 在网站根目录下，创建指定的文件。该文件包括文件目录、文件名、文件内容。
 >?
 >- 网站根目录是指您在服务器上存放网站程序的文件夹，大致这几种表示名称：wwwroot、htdocs、public_html、webroot 等。
 >- 请确保 Web 网站端口号设置为80或443。
 >
 - **示例**
您的网站根目录为 `C:/inetpub/wwwroot`，您可以在 `wwwroot` 文件夹下创建一个如下表所示的文件：
<table>
<tr><th>文件目录</th><th>文件名</th><th>文件内容</th></tr>
<tr><td>/.well-known/pki-validation</td><td>fileauth.txt</td><td>2019080603......ep939jlu32alzeo</td></tr>
</table>
 - **注意事项**
 Windows 系统下，需通过执行命令行的方式创建以点开头的文件和文件夹。
 例如，创建 `.well-known` 文件夹，请打开命令提示符，执行命令 `mkdir .well-known` 进行创建。如下图所示：
 ![](https://main.qcloudimg.com/raw/c61a7f40585c7f9f8016bbc38b39df19.png)
5. 在 “验证域名” 页面，您可以单击【查看域名验证状态】检查配置是否成功。
>?
>- 支持 HTTP 和 HTTPS，任意一个均可访问。
>- 文件验证需要直接响应200状态码和文件内容，不支持任何形式的跳转。
>- 对于 www 开头的域名，例如 `www.a.tencent.com`，除了对该域名进行文件验证，还需对 `a.tencent.com` 添加文件验证。
> 
6. 请耐心等待 CA 机构扫描审核。证书颁发完成或域名信息审核通过后，文件和目录即可清除。

>!请确保域名未做国外限制，国外 IP 可以解析至域名的 A 记录并进行访问，否则将导致 CA 机构无法进行扫描审核。


