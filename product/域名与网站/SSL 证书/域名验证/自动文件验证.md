
## 操作场景
本文档将指导您在证书管理控制台申请证书或新增域名资料时，并且域名验证方式为自动文件验证，如何进行域名验证操作。

>!自动文件验证方式仅支持多年期的国际标准证书与非通配符域名。详情请参见 [支持多年期的国际标准证书](https://cloud.tencent.com/document/product/400/52953#multiyear)。
>
## 验证规则
### 域名验证规则
进行自动文件验证时，请注意以下几种情况：
>!
- 因 SSL 证书域名验证策略变更，腾讯云将于**2021年11月21日**停止泛域名证书的文件验证方式，详情参见：[SSL 证书域名验证策略变更通知](https://cloud.tencent.com/document/product/400/57440)。
- 申请域名为主域时需要额外验证 www。例如，申请域名为 `tencent.com`，则还需验证 `www.tencent.com`。
- 申请 www 的域名需要额外验证 www 后面的域名，无论是几级域名。例如，申请域名为 `www.a.tencent.com`，则还需验证 `a.tencent.com`。
- 申请不带 www 的非主域只需要验证当前域名。例如，申请域名为 `cloud.tencent.com`，则只需验证 `cloud.tencent.com`。

### CA 验证规则
- DNS 查询时必须从权威根服务器递归查询每级域名的权威 NS 服务器，再从 NS 服务器查询对应的 A、AAAA 或 CNAME。
- 若 DNS 服务支持 DNSSEC，必须校验响应数据的签名信息。
- 若被查询域名是 IP，直接通过 IP 访问验证内容。
- 必须通过标准的 HTTP / HTTPS 的默认端口进行访问。
- 可以支持 301/302 跳转，跳转次数不超过2次，跳转目的地址跟被检测域名需在同一主域。
- 最终检测结果需要响应200状态码。
- HTTPS 访问时可以忽略证书错误。

## 操作步骤

### 步骤1：查看验证信息
1. 登录 [证书管理控制台](https://console.cloud.tencent.com/certoverview)，单击左侧菜单**我的资料**，进入 “我的资料” 管理页面。
2. 在 “我的资料” 管理页面，单击需要验证域名信息的公司名称，即可查看已申请的管理人信息。
3. 单击您需要验证域名信息的管理人姓名，进入您的 “审核信息” 页面。如下图所示：
![](https://main.qcloudimg.com/raw/896a6b82b2affae3b9540333f73b33a3.png)
4. 单击**域名信息**页签，选择您需要进行验证的域名，并单击**查看验证**。如下图所示：
![](https://main.qcloudimg.com/raw/96bff23854fa29b95d544dc60656274a.png)
5. 在 “验证域名” 页面中，请根据页面提示，并在规定时间内完成验证操作。如下图所示：
![](https://main.qcloudimg.com/raw/f21dff152a56dabd707587e647f8f08e.png)

### 步骤2：添加文件验证
1. 请您登录服务器，确保域名已添加 A 记录并指向该服务器。
>?若您的域名对应的**域名解析商**在腾讯云，将域名指向您的服务器请参考 [A 记录](https://cloud.tencent.com/document/product/302/3449)。
>
2. 请您在服务器上启动一个 Web 服务（也可在业务运行的 Web 服务上进行配置）并监听端口80或443，将文件验证路径地址反向代理为**步骤1：查看验证信息（步骤1.5图例）**中提供的反向代理地址。
腾讯云提供以下两种 Web 服务配置指引，您可以根据您实际情况进行参考配置：
  -  [Nginx 反向代理配置](https://cloud.tencent.com/document/product/400/52820#nginx)
  -  [Apache 反向代理配置](https://cloud.tencent.com/document/product/400/52820#apache)
 
>?
>- 支持 HTTP 和 HTTPS，任意一个可访问均可。
>- 配置完成的反向代理不能删除或者修改，删除或修改之后代理将无效。
>- 可以支持301/302跳转，跳转次数不超过2次，跳转目的地址跟被检测域名需在同一主域。对于 www 开头的域名，例如 `www.a.tencent.com`，除了对该域名进行文件验证，还需对其主域名 `a.tencent.com` 添加文件验证。
>
3. 配置反向代理后，请耐心等待 CA 机构扫描验证，扫描验证成功后即可通过审核。
4. 在 “验证域名” 页面中，您可以单击**立即验证**检查配置是否成功。

