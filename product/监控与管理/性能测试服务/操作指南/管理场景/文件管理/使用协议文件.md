gRPC、tRPC、JCE 等协议需要用户上传协议文件，压测引擎依赖协议文件完成请求的序列化。支持用户上传文件或目录，文件名需要保持唯一，同名文件将会被新上传的文件覆盖。如果用户上传 zip 文件，PTS 会解压文件，并展示解压后的文件结构。如果目录或者 zip 包中包含非 Proto、JCE 文件，PTS 将忽略这些文件。

## tRPC 场景使用协议文件
![](https://qcloudimg.tencent-cloud.cn/raw/e828333f54721033ae0237aeb6457eda.png)


```
import trpc from 'pts/trpc';

const client = new trpc.Client();

client.load('demo/demo.proto'); // 有多个协议文件，只需要 load 主文件

export default function () {
    const rsp = client.invoke('/trpc.wtp.demo.demo/SayHello', {
        "msg": "pts"
    }, {
        "env": "test",
        "serviceName": "trpc.wtp.demo.trpc",
        "metaData": {
            "person_id": "123456",
        }
    });
    console.log(JSON.stringify(rsp));
    console.log(rsp.data.msg); // Hello pts
};
```

## gRPC 场景使用协议文件

![](https://qcloudimg.tencent-cloud.cn/raw/1ef7b00090bbd2e6907dbb894b7d819d.png)


```
import grpc from 'pts/grpc';

const client = new grpc.Client();
client.load('addsvc/addsvc.proto'); // 有多个协议文件，只需要 load 主文件

export default () => {
    client.connect('grpcb.in:9000', {insecure: true});

    const rsp = client.invoke('addsvc.Add/Sum', {
        a: 1,
        b: 2,
    });
    console.log(JSON.stringify(rsp));
    console.log(rsp.data.v); // 3

    client.close();
};
```

## TAF 场景使用协议文件

**以 tars/taf 协议为例：**
![](https://qcloudimg.tencent-cloud.cn/raw/0ca9dbd12b84f07f4fa2e9b80ee2001f.png)

```
import protohub from 'pts/protohub';

protohub.load('RankingRPCServant'); // 只需要 load 目录

export default function () {
    const rsp = protohub.invoke('GetRankingResponse', {
        "request": {
            "query": "query"
        },
    }, {
        protocol: 'taf',
        env: 'test',
        serviceName: 'trpc.wtp.demo.tars',
        head: {"sFuncName": "GetRankingResponse"}
    });
    console.log(JSON.stringify(rsp));
    console.log(rsp.body.response.retList); // a,b,c
};
```

## 多 PB 文件上传
**使用方式**

```
import trpc from 'pts/trpc';

const client = new trpc.Client();
client.load('wtp/data_manager/data_manager.proto');
```


![](https://qcloudimg.tencent-cloud.cn/raw/090597ca43301e9b81ebf62c15164b05.png)


**其中 wtp/data_manager/data_manager.proto**
```
syntax = "proto3";
package trpc.wtp.data_manager;

option go_package ="git.code.oa.com/trpcprotocol/wtp/data_manager";

import "trpc/common/validate.proto";
```

**trpc/common/validate.proto**

```
syntax = "proto2";
package validate;

option go_package = "git.code.oa.com/devsec/protoc-gen-secv/validate";
option java_package = "io.envoyproxy.pgv.validate";

import "google/protobuf/descriptor.proto";
import "google/protobuf/duration.proto";
import "google/protobuf/timestamp.proto";
```
