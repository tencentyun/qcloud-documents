## 基础功能

### 环境介绍

蓝鲸 PaaS 平台承载着众多 App， App 的来源有三种：官方提供，从 [蓝鲸 S-mart](http://bk.tencent.com/s-mart/) 下载的第三方 App，开发者自己开发。蓝鲸 Pass 平台为每个开发者创建的 App 提供了三个环境：

- 本地开发环境：开发者在本地开发、编码的环境。
- 测试环境：App 未对外之前，部署到 PaaS 平台测试其功能的有效性和完整性。
- 正式环境：App 部署到正式环境后，其他用户即可在“工作台”看到该 App。

所以，本地环境和测试环境的主要用户为开发者，用于开发者编码和自测。正式环境，即就是将 App 正式发布对外，是所有用户都可以看到并使用的。

### 基本账号体系

为了保证使用蓝鲸产品的用户都是可信的，PaaS 平台为整个蓝鲸体系提供了“统一登录”模块，该模块包含了基本账号体系。当搭建部署好蓝鲸体系的产品后，会提供一个 URL 给用户访问。

### 基本角色管理

管理员可以管理用户身份，管理入口如下图的“用户管理”。
![](https://main.qcloudimg.com/raw/8ff2431901a9af8cfd84e6e52506a00d.png)
![](https://main.qcloudimg.com/raw/903730841bc1ffd73ee712b16abac671.png)
如上图所示，用户管理支持以下操作：

- 新增用户：录入信息，添加一个用户。
- 批量导入：下载 excel，并按照格式完善信息，即可批量导入用户信息。
- 用户查询：可选择角色类型（所有用户，管理员，用户）进行查询。
- 操作：编辑用户信息，重置密码，删除用户。

### Web 安全防护

Web 安全防护模块主要包括防 csrf 攻击和防 xss 攻击。

- 防 csrf 攻击：使用 django 提供的 csrf 模块，开发框架中已集成，用户无需做其他设置。
  注：如需对某些请求去除 csrf 验证，可在对应 view 函数添加 csrf_exempt 装饰器。
- 防 xss 攻击：开发框架中已集成防 xss 攻击的中间件，会对所有请求参数将进行特殊字符转义（富文本内容、URL 有特殊处理方式）。

### 个人工作台

蓝鲸社区版为每个用户都提供了专属的“工作台”，可以根据情况调整 App 的显示顺序，如下图所示：“排序” > 拖拽调整顺序 > “完成”。 
![](https://main.qcloudimg.com/raw/0682d48a4bd31a710d5c8d0d1feb02ae.png)

## 开发者中心

### 可插拔式应用

PaaS 平台承载了各种功能的 App，单击【开发者中心】 > 【内置应用】，可以将从 [蓝鲸 S-mart](http://bk.tencent.com/s-mart/) 上的 App 下载下来，“上传部署新应用”到蓝鲸中，“部署”后即可通过“工作台”进入使用。
 ![](https://main.qcloudimg.com/raw/1e27cfa10a446353f066d54f02a05108.png)

若不需要哪个 App，即可进行“下架操作，该App就会在“工作台”消失；甚至可以“删除”废弃的应用。

### 开发框架

为了提高开发效率，蓝鲸提供了统一的“开发框架”， 该“开发框架”集成统一登录鉴权模块、功能开关模块（支持开发者在 SaaS 开发迭代中对功能选择性开放、灰度测试等）、Web 安全防护模块（防 csrf 攻击和防 xss 攻击）、功能组件模块等通用模块。让用户可以专注于代码逻辑的构建。
 ![](https://main.qcloudimg.com/raw/c1e05ca77bc93850abc086323853a037.png)

当用户将代码在本地运行，或者打开线上的“开发框架”App，将会看到下图的界面。
 ![](https://main.qcloudimg.com/raw/6b8b4ed60c95604b6f68afb5f06d0114.png)

> ?蓝鲸 PaaS 平台后续会推出“开发样例”，将提供 KendoUI、官方组件调用等功能样例。

### 企业服务总线（ESB 和 API Gateway）

企业服务总线有两个作用：

- 其一：为整个蓝鲸体系服务，蓝鲸的其他平台，如：配置平台、作业平台、数据平台、容器管理平台、AI 平台，均可以将各平台的特性以 API 的形式对接到组件中，便于PaaS平台上的 SaaS 调用，整合各个平台的强大功能，发挥最实用的价值。
- 其二：第三方系统，如微信公众号/企业号、邮件系统、OA 系统、AD 系统、财务系统等非蓝鲸体系内的运营系统，同样以 API 的形式将特性对接到组件，丰富和完善整个PaaS平台企业服务总线的服务。从而使 PaaS 平台之上的 SaaS 可以调度一切，连接一切。

“ESB 管理”仅限于“管理员”角色操作，从“开发者中心”—>“ESB 管理”进入使用。
 ![](https://main.qcloudimg.com/raw/c47b732f5f6abcdf735699cabbf908ae.png)
 ![](https://main.qcloudimg.com/raw/2918903be72fd7c435969b971c051436.png)

“ESB 管理”给出了详细的使用文档，分为以下几个部分：

- 简介：概述 ESB，并指出 ESB 接入的两种方式：编码方式（采用 Python 语法）和自助接入方式（又称 API Gateway）
- 系统管理：ESB 来自于哪个系统，可以看成是ESB的分类。
- 通道管理：ESB 访问的路径管理。
- 组件自助接入：目前仅支持 http 请求形式的自助接入。
- 使用指南：详细的 ESB 接入、使用教程，以及如何为新加入的组件生产/更新“组件文档”。
- ESB 文档：查询蓝鲸官方，自己接入组件的使用样例。

> ?蓝鲸组件在线 [API 文档](https://bk.tencent.com/document/bkapi)。

### 基于 Virtualenv 的应用部署

App 部署时，平台为会它们创建独立的 Virtualenv，保证每个 App 拥有一套“隔离”的 Python 运行环境。App 的服务进程则是以 uWSGI 的 cheaper 模式托管，由于采用了 Busyness 算法，uWSGI 能够根据繁忙度，动态的调配 worker 个数，从而达到合理利用系统资源的目的。

### MagicBox

[MagicBox](http://magicbox.bk.tencent.com/ )，又称为前端魔盒。是一个前端资源 PaaS 平台，为蓝鲸应用开发者提供丰富的前端资源，包括常用的 UI 组件、JS 插件及基础模版，开发者可以通过蓝鲸 MagicBox 快速构建页面。它还提供完整的套餐样例供开发者选择，开发者也可以在线拖拽组件组装页面，让前端布局可视化。
 ![](https://main.qcloudimg.com/raw/22a41b2a45ca4f1bcc399994cc4da22c.png)

### 部署操作记录展示

为了保证 App 的正常使用，严格记录每一次发布变更的操作信息，不论是测试环境，还是正式环境。
 ![](https://main.qcloudimg.com/raw/db64f43c4b923e7b0293f32ea2a2602b.png)

### 线上基础开发培训

蓝鲸为开发者提供了详细的 [线上视频教程](https://cloud.tencent.com/developer/edu/major-100008)。

> ?关注“蓝鲸”微信公众号，点击 “技术干货" > “培训视频”也可以获得培训课程。

### 高级角色管理

高级角色管理将用户角色细分，包括用户、管理员、超级管理员等，并为应用提供通用的权限控制服务。蓝鲸统一权限管理服务主要功能有：

- 权限配置：包括权限功能配置、审批负责人配置、单独用户权限配置、超级用户配置。
- 权限申请：提供统一权限申请的入口，让用户自己根据需要申请 App 的权限。
- 权限续期：给权限设定60天的周期，到期后需要再次申请。
- 权限审批：App 管理员角色，可以在个人中心审核请求。

### 个人定制桌面

公有云版和企业版中提供了蓝鲸桌面，其功能远远高于社区版的“工作台”，除了基本的 App 导航和定制 App 顺序以外，还集合了很多定制化的功能，如：权限统一管理、换肤、搜索、统计等。

### 开发框架增值模块（功能开关、权限控制等）

将蓝鲸平台与企业内的系统整合后，可以提供更便捷的开发框架增值模块，如功能开关，权限控制等，最大效率地降低开发成本，提高开发效率。

### 可扩展的应用变量

对应有些敏感变量，比如外部数据库 IP，账号密码等，直接写到代码中会有暴露风险，而且每次修改，需要拉取代码，修改提测上线后才能使用，蓝鲸开发者中心针对该场景，使用变量设置功能完全可以解决开发者的变量硬编码问题。

### 日志可视化管理

蓝鲸 PaaS 平台提供在线日志服务，开发者可以在“服务” > “日志查询”菜单中查看应用全方位日志信息，包括：普通日志/组件调用`/uWSGI/Celery/Nginx/Gunicorn`，也可以通过环境，日志级别和时间过滤查看。
 ![](https://main.qcloudimg.com/raw/ab61cd0384f56724dcd36be1cde9f185.png)

- `uWSGI/Nginx/Gunicorn` 为系统日志，部署时平台负责将日志输出到固定目录，开发者不能定义内容。
- 普通/组件调用/Celery 为开发框架中定义的 logger 输出的日志，开发者可以自定义内容。
  日志产生后，由采集 Agent 进程采集，解析，汇总入日志查询引擎，在“开发者中心”提供的应用“服务”中可以查询到。
   ![](https://main.qcloudimg.com/raw/9d879ab82461933b9ce5e0f707379115.png)
- 时间：默认最近1小时，可选最近1小时/12小时/1天/7天/14天，支持自定义时间段，最长可以查 30 天内日志。
- 环境： 默认全部，可选测试环境/正式环境。
- 类型：默认普通日志，可选普通/组件调用/uWSGI/Celery/Nginx/Gunicorn。
- 日志级别: 普通/组件调用/Celery 均有五个级别的日志标示，分别是 DEBUG、INFO、WARNNING、ERROR、CRITICAL；uWSGI/Nginx/Guniorn为HTTP 状态码。
- 信息：可输入关键字进行查找。

> ?从日志产生到可查的时间间隔：5s左右。

### 后台任务可视化管理

后台任务，是每一个运营系统的常见需求，为开发者提供了可视化的“任务管理”，有两个功能：

- 管理当前“消息队列”的状态
  直观地查看当前系统/App 后台任务的“消息队列”情况，在阻塞等情况下，可以“清空队列”。
- 查询历史任务的情况
  根据条件，精确检索，并展现每一个后台任务的参数、结果等信息。
   ![](https://main.qcloudimg.com/raw/44d453899e05bb1fac3138f4443f0b21.png)

### 功能函数可视化管理

支持开发者在应用版本开发迭代中，对功能选择性开放，进行灰度测试等。开发者需要在 App_control_function_controller 表中添加功能信息，并使用装饰器，示例代码如下：
 ![](https://main.qcloudimg.com/raw/286265fedf1b80b77d20c43ff8a69d60.png)
功能示例：
 ![](https://main.qcloudimg.com/raw/1cd9070ab6d2a5f740fa44f270b105c7.png)

### 组件访问权限控制

蓝鲸应用需要调用其他系统的接口，如 CC、WEIXIN，都需要通过蓝鲸的组件 API，默认应用并没有任何组件的权限，需要在蓝鲸 App 的“服务”中申请组件权限。
 ![](https://main.qcloudimg.com/raw/51fab8f350e7db6b59afae7ae481432d.png)
点开 API 的名称，可以查看 API 的详细文档。
 ![](https://main.qcloudimg.com/raw/4291447cf34da5d8dd9c90e1721c4e00.png)
组件权限分普通权限和敏感权限，普通权限一般都是查询类等，敏感权限是创建，运行类 API，需要分别申请，如下：
 ![](https://main.qcloudimg.com/raw/2f406dec42a71b37c53f11e27d3a08d5.png)
申请后由 ESB 团队统一审批，通过后即可正常使用组件了。
 ![](https://main.qcloudimg.com/raw/525eb1db949eed11d003e1ea01c2cb80.png)

### ESB 健康度报告

以天/周/月为维度，根据组件实时监控状态，会输出组件的健康度报告，包括：组件的调用频率，响应时间，可用率等。
 ![](https://main.qcloudimg.com/raw/d25e30dc0572a3d8e6087c85799a837c.png)
![](https://main.qcloudimg.com/raw/6b0f0478aa9ba29536419568bad0fdb8.png)

### 代码权限管理

代码权限管理是指SVN/Git 代码的读写权限，开发者可以在权限管理页面添加、删除某些帐号权限信息。代码权限管理维度目前仅细化到单一账户权限，添加后，该账户可以查看、提交当前应用任何目录下的代码（包括 release 目录等）。
 ![](https://main.qcloudimg.com/raw/284d871994ce413b4fa3b3218de1f1e7.png)

### 代码提交纪录

蓝鲸 PaaS 平台会记录应用每次代码提交的操作详情。用户在提交记录中，可以查看应用每次提交的时间，提交修改的文件，提交人的信息等。
 ![](https://main.qcloudimg.com/raw/572f5ec9ea326cf29d47bf11b89ed582.png)

### 代码在线查看

对于应用代码，提供在线查看文件，目录和 diff（差异比较）功能。右边分别显示了文件/文件夹名称、最后提交版本号、最后修改时间、提交人等信息。
 ![](https://main.qcloudimg.com/raw/4b80bd5ec86f561ccd7dd97cebbbee89.png)



### 代码在线编辑

企业版中，会提供代码“在线编辑”服务，可以在线修订代码，提高工作效率。
 ![](https://main.qcloudimg.com/raw/8e55040ed40375f6c8b48897b9574f55.png)

### 应用数据库托管服务

在创建蓝鲸 App 的时候，蓝鲸为每个应用分配有两套独立数据库（测试库和正式库），并配备高可用方案，保证数据可靠性；且支持几乎所有的 MySQL 特性。

- Django admin
  蓝鲸的应用采用了 Django 框架，Django 是基于 Web 的数据库管理工具。您只需要将数据模型注册到 admin.py 文件中，就可以在页面上对数据进行 增、删、改、查。
   ![](https://main.qcloudimg.com/raw/22fe2ffb3b98ac8a7960fb2d437799bf.png)
   ![](https://main.qcloudimg.com/raw/7ec9e7ee7a06b15e4a250662f8cfde5e.png)
- 在线操作
  蓝鲸应用直接集成 Django 框架自带的数据库后台管理服务。开发者可以在页面上管理 测试环境和正式环境的数据库。
   ![](https://main.qcloudimg.com/raw/14f59788faab44c70a235b84a20ab6a2.png)

### 应用监控告警

开发者可以主动通过蓝鲸PaaS平台的“日志查看”功能来查看应用日志记录，但是还需要一个实时推送告警的功能，这样可以帮助开发者在第一时间发现应用的问题，提高用户体验。所以，平台提供了日志监控告警服务。开发者可以自行配置相应的告警参数，告警接收人等信息，平台会实时监控日志数据，一旦命中规则，即向开发者推送告警信息。应用注册后，告警服务默认为开启状态，建议重要的应用不要手动关闭该服务。开启后可以关闭，如果关闭，应用告警将不会发送给告警接收人，所以建议不关闭。
 ![](https://main.qcloudimg.com/raw/b2fd14b6acd4294e7afac7a321258d9c.png)
 ![](https://main.qcloudimg.com/raw/d12327df5f6daf6de454a8d5522028a7.png)
开启后，可以配置告警接收人/告警接收类型/具体类型告警参数。

- 告警接收：填写接收人账号并选择要接收的告警类型，系统将以邮件的形式发送告警给接收人，接收人默认为应用开发者。
- 普通告警：针对开发者代码调试日志进行监控和告警，支持日志等级和关键字关联配置，建议开发者调整日志级别，调试日志用 INFO 级别，异常日志使用 ERROR 级别，以免造成不必要的干扰。
- HTTP告警：针对应用 UWSGI日志进行监控和告警，支持请求错误码和慢请求配置。
- 组件告警：针对应用 组件调用日志进行监控和告警，支持日志等级配置。
- Celery 告警：针对应用 celery 日志进行监控和告警，支持日志等级和关键字关联配置（仅针对启用了 celery 服务的应用）。
  监控告警服务同时提供了告警统计功能，以便开发者掌握应用的稳定情况，并做相应的优化处理。统计主要展示当日告警数，和指定时间段内的告警量趋势，支持按时间和告警类。
   ![](https://main.qcloudimg.com/raw/e10c9c74fa81f45ebd8e11f49303cf79.png)

### 应用运营数据统计

对于应用产品经理，运营人员，比较关心的就是应用的数据，蓝鲸提供应用的访问量，在线时长，活跃度等三个指标，全方位展示应用的使用情况。

- 访问量
  主要针对应用在蓝鲸桌面、应用市场被打开次数进行统计。可以按时间或用户纬度查询访问量。
   ![](https://main.qcloudimg.com/raw/87b421201186cec963cbe7e19eff6ae8.png)
- 在线时长
  主要针对用户在应用页面上的停留时间进行统计。可以按时间或用户纬度查询访问量。
   ![](https://main.qcloudimg.com/raw/ce3b23d4308e91ee688d14e21f6b94f5.png)
- 活跃度
  主要针对用户在应用页面上的点击量（页面上的链接、按钮等点击次数）进行统计。可以按时间或用户纬度查询访问量。
   ![](https://main.qcloudimg.com/raw/c18ecc1139956bb370c3c0745ab01c10.png)
- 容器资源实时统计
  针对应用的 docker 容器所占用内存和 CPU 进行实时监控统计，供用户了解应用的 CPU 和内存使用情况。
  ![](https://main.qcloudimg.com/raw/20b67ec1da2c4ca79a19b7b928171f9a.png)

## 其他高级功能

### 服务状态

每一个 App，即就是一个运营系统，蓝鲸为每个系统提供了“服务状态”的可视化管理。应用一般都使用了蓝鲸体系的多个服务，如 MySQL，UWSGI 等，这些服务的状态均可统一展示。
 ![](https://main.qcloudimg.com/raw/99f4330b0fc75253c32f3ddd9cb8ad2c.png)

> ?蓝鲸应用正式环境和测试环境相互独立，使用的服务也相互独立，应用必须测试部署和正式部署后才能看到相应环境的服务状态。

蓝鲸为每个 App 提供了“服务状态”

- 对接企业 SSO
  为了适配企业内已有的权限登录系统，蓝鲸企业版提供了完善的解决方案，包括但不限于对接企业的 SSO。
- 高可用集群
  平台各服务模块，均采用多机部署，由接入层的 healthcheck 模块做负载均衡，保证了平台基础服务的可用性；线上环境的 App 服务也采用了同样的技术方案，多实例部署，在保证隔离性的同时，提高了 App 服务的可用性。
- 组件访问频率控制
  组件是连接各个系统的桥梁，需要时刻保证组件的可用性和稳定性，通过组件的访问频率控制有效地缓解组件服务的压力。
- 基于容器技术的应用部署
  为了保证 App 运行环境的隔离和安全，提供基于 docker 的隔离部署方案。App 部署时，会基于平台提供的基础镜像，构建出运行时的 App 容器。并且每个容器有独立的软件运行环境和额定的系统资源分配，进一步保证了 App 之间的资源隔离和系统安全性。
- 企业贴身定制培训
  蓝鲸智云产品不仅仅提供通用的产品服务，更为企业提供能力交付的培训，让企业员工快速成长，提高企业的竞争力。授人以鱼，更要授人以渔。因此蓝鲸可以根据企业内部员工的能力，定制培训计划，包括：蓝鲸产品的使用与维护，蓝鲸 DevOps 技能培训，蓝鲸认证等培训服务。
