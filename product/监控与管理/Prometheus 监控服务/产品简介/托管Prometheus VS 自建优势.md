### 面对托管 Prometheus 和自建 Prometheus 我们该如何选择？


基于开源系统自建 Prometheus 有着比较高的学习成本、使用成本和后期维护成本。近年来多个云厂商提供托管的 Prometheus 监控服务，给企业带来更多选择的同时，也一定程度上增加了前期调研和后期决策的成本，自建和托管的优劣势分别是什么？到底我的企业更适合采用哪种解决方案？

### 假设自建 Prometheus，我们会遇到哪些问题？

自建 Prometheus 的优势是可以根据企业自身情况，灵活得配置定制化的监控解决方案，但随着越来越多的企业开始自建 Prometheus 监控解决方案，一些不可避免的突出问题也逐渐显现，给企业带来困扰。

**1. 对于中小企业，使用成本高**
自建 Prometheus 的使用成本，包括机器资源成本和人力成本，最主要的是人力成本。其中人力成本又包括：
- 前期调研成本
- 中期搭建成本
- 后期维护成本

由于中小企业的运维团队规模较小，一般不多于5人，有的甚至只有一两个人，要自建和维护一套 Prometheus 监控服务，显然非常吃力。

**2. 对于大企业，可扩展性差、容易出现性能瓶颈**
大企业或快速发展的中型企业，在业务发展初期，自建 Prometheus 监控，但随着业务量高速的增长，意味着更多资源的投入，对监控也有了更高的要求，自建 Prometheus 开始暴露出可扩展性差、性能瓶颈的问题，使企业运维面临巨大的挑战。

### 托管 Prometheus 相比自建 Prometheus 的优势

**1. 开箱即用**
一键安装监控腾讯云容器及其他云产品，免搭建。
- 与云监控告警体系打通，可复用告警通知渠道。
- 预设常用的 Grafana Dashboard 及告警规则模板。
- 云服务器标签自动识别，机器扩缩容时无需手动增减配置。

**2. 低成本**
- 全托管服务，无需额外采购云资源，节省资源成本。
- 无需手动搭建，免运维，节约运维人力成本。
- 按量付费，避免自己搭建时由于资源分配不合理造成的浪费。
- 容器相关基础指标免费使用，可覆盖日常监控场景。

**3. 可扩展性更强**
数据存储能力无上限，不受限于本地磁盘。可以结合腾讯云自研的分片和调度技术，实现动态扩缩，满足用户的弹性需求，同时支持负载均衡。解决开源 Prometheus 无法水平扩展的痛点。

**4. 高性能**
轻量，资源消耗低，Agent 仅占用 1G 以内内存即可完成数据抓取。

**5. 更可靠**
结合腾讯云云存储服务及自身的副本能力，可用性更强，减少系统中断运行次数。

**6. 主动式服务**
多种开源没有的增强监控运维能力，如健康巡检、Agent 管理等。
