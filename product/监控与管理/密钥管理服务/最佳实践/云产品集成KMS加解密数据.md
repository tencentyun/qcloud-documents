
## 概述
腾讯云为您提供云产品落盘存储加密服务，并统一使用密钥管理系统（[KMS](https://cloud.tencent.com/document/product/573)）进行密钥管理。腾讯云的 KMS 是云上密钥全生命周期管理基础设施，实现云数据全生命周期保护，满足敏感数据的加密存储需求。

在服务端中 KMS 与云产品集成将会给您带来的如下益处：
- 增强云上敏感数据的安全与隐私
 - 通过使用您在 KMS 中 [创建的密钥](https://cloud.tencent.com/document/product/573/8875)，云产品可以加密任何归属您的数据。
 - 数据可以是您可以直接访问的，也可以是无法直接访问的云产品内部数据，其中包括您在服务器侧的密钥、证书、配置文件等数据。
- 降低自我研发加密数据的研发成本
 - 需要考虑密钥的安全保护，密钥与加密数据的分离策略。
 - 需要调研硬件加密机 HSM 并进行采购。
 - 需要考虑生命周期管理，从密钥生成到密钥销毁全流程自动化管控。
 - 需要制定密钥分发策略，围绕密钥管理的数据安全管理策略；访问授权、访问审计、加密/解密等自动化管控。
 - 需要考虑自研系统的可靠性，系统是否可用、加密数据能否可用依赖于密钥的完整性及可用性。
    
云服务端集成 KMS 后，将会为您考虑和解决上述复杂的工程及安全问题，降低研发成本。

## 密钥类型

在腾讯云的 KMS 中密钥类型分**云产品密钥**和**用户密钥**，结合您自身实际需求来进行选择。
- 云产品密钥
 - 您如果考虑到密钥管理会带来的开销，可以选择云产品为您在 KMS 中生成一个云产品密钥 CMK，该 CMK 免费，但 API 调用会收费。
 - 云产品密钥由对应的云产品管理，您对云产品使用该密钥的授权可以是部分隐式和完全显式。对于该密钥的使用情况相关数据，可以通过**云审计**服务进行审计。
- 用户密钥
 - 您可以选择自己托管的密钥进行云产品服务端加密，从而获取对数据加密行为更大的控制权。
   用户密钥是非云产品自主创建的，所以对该密钥的使用均需要您显式的授权。**CAM** 服务是云产品与KMS之间的权限鉴别仲裁者，您可以通过 CAM 服务配置权限策略，安全地管理云产品密钥的资源管理和使用权限，云产品访问 KMS 时，KMS 会向 CAM 服务验证云产品的服务账号、角色及其所配置的相应预设策略。
  - 用户密钥除了可以让 KMS 生成，也支持您自定义密钥材料生成密钥，即通过 **BYOK**（Bring Your Own Key） 的方式，将您自己的密钥材料导入 KMS 的密钥当中，从而对密钥取得更大的控制权。需注意的是导入的密钥材料过期或者被删除后，指定的 CMK 将无法使用，需要再次导入相同的密钥材料才能正常使用，具体的更多的详情请查看 [导入密钥材料](https://cloud.tencent.com/document/product/573/38496)。



## 云产品的加密策略

基于不同产品的业务内容和客户需求，将会采用不同的的加密方式及其策略。通常情况下，存储加密中的密钥层次结构会至少划分为两层，然后通过 [**信封加密**](https://cloud.tencent.com/document/product/573/8791) 的机制去实现敏感数据的加解密。
- KMS 中的用户主密钥（Customer Master Key，CMK） 为第一层，KMS 中的数据加密密钥（Data Encryption Key，DEK）为第二层。
- DEK 是通过 CMK 调用 kms.GenerateDataKey 接口生成，所以 DEK 受 CMK 的加密保护，而 DEK 是对云产品侧的业务数据进行加解密操作与保护。

#### 云产品的加密流程

1. 云产品侧通过 KMS [创建用户主密钥](https://cloud.tencent.com/document/product/573/34430) CMK。
2. 通过 CMK 生成对应的 [数据加密密钥](https://cloud.tencent.com/document/product/573/34419) DEK（DEK 明文+DEK 密文）。
3. 云产品在本地通过 **DEK 的明文**加密业务数据，当业务数据落盘存储时，云产品将 DEK 的密文与加密后的业务数据一同写入持久化存储介质中。

![](https://main.qcloudimg.com/raw/204062268d7d847916583457d9b2e670.png)

- 读取数据
 - 在读取加密数据时，DEK 的密文会与业务数据一同被读取。
 - DEK 密文必须先进行解密，因为只有当 DEK 密文被解密之后（即获取 DEK 明文后），才能正确读取业务数据的密文。
- 云产品侧的交互逻辑：
 - 云产品必须通过恰当的用户授权，才能使用用户的主密钥去生成 DEK，从而对业务数据进行加密操作。
 - 同时也只有通过用户的授权，才能使用对应的主密钥去解密 DEK 密文内容，从而实现业务数据的解密。

>!DEK 的明文将缓存在云产品后台服务的内存中，不会以明文形式存储在永久介质上。

