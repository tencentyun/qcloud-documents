### 探针对应用性能是否影响影响？

探针（Agent）的工作原理是在原有业务代码中动态插入采集性能的相关代码，并且随着原有代码执行而执行。所以它不可避免的、或多或少的都会产生额外的性能消耗。那么在业务高峰期，为了把性能问题带来的影响降到最低，在探针端引入了熔断机制。即根据预设置的阈值（例如CPU、GC等），探针会判断当前系统资源使用情况并采取相应措施。例如，当高于阈值时，探针会停止采集工作，减少对资源的消耗。低于阈值探针会恢复采集工作。



### Java探针采集的原理是什么？

Java Agent基于Java JDK 提供的Instrumentation机制，在class文件被加载的时候，调用transform方法，通过字节码技术，动态对Framework、数据库、NoSQL、Web Service、组件等特定方法实施监控，从而获得方法执行时间、数据库调用时间、NoSQL响应时间以及外部服务响应时间；并在这些时间超过一定阈值时，抓取调用堆栈来进行进一步问题诊断。

扩展知识点：Instrumentation JDK中对它介绍如下：这个类为JVM上运行时的程序提供测量手段。很多工具通过Instrumenation 修改方法字节码实现收集数据目的。这些通过Instrumentaion搜集数据的工具不会改变程序的状态和行为。这些良好的工具包括  monitoring agents  ,profilers, coverage analyzers, 和 event loggers。



### PHP探针采集的原理是什么？

Php agent是一个PHP扩展，使用php扩展技术替换zend_execute的函数指针，在Zend引擎循环执行操作码的过程中追踪获得调用各类函数的性能及错误信息。



### .NET探针采集原理是什么？

.Net探针通过CLR提供的一系列的接口函数，在JIT已开始编译某个函数期间,通过ILRewrite技术替换和修改正在被编译的函数， 从而达到.net探针嵌码的目的，实现对IIS .net应用性能和其他数据的采集。



### Java探针是如何实现执行的慢SQL的抓取的？

Java探针通过对数据库驱动的适配，来实现对数据库数据的采集的，在数据库驱动getConnection的时候采集数据库相关的信息，然后再通过对statement和PreparedStatement等相关接口方法的适配，实现对数据库相关操作数据的抓取。



### 在性能监控时，是否会采集业务数据？

默认不采集业务数据，对探针适配了的框架、组件、容器的关键方法进行嵌码的，固定的地方做采集，采集的是执行时间、执行次数、错误、代码堆栈。




### 分布式链路追踪的原理是什么？

为每一次请求生成一个TransactionId并且透传整个调用过程，通过TransactionId就可以串联整个调用链。



### JVM相关数据是如何获取的？

根据jvm提供一系列JMX接口，取得我们想要的jvm数据，如PermGen，线程数、活跃数等。



### 代码调用堆栈如何采集到的？

调用系统的getstacktrace的方法，就可以获得堆栈信息



### 事务是如何定义的？

事务是业务系统中完成某一业务操作的一组用户请求。例如电商业务系统中的提交订单，OA系统中的审批签署等等。单个的用户请求是事务的一个实例。事务属于业务系统，可以穿透和跨越整个系统中的业务系统以及业务系统中的应用，以第一个收到请求的应用为事务的入口应用，穿透的其他的应用是该事务的下游应用，当事务穿透和跨越应用时，在下游应用上的访问不再产生新的事务。入口应用所在的业务系统为该事务所属的业务系统，当事务穿透和跨越业务系统时，在下游的业务系统不再生成新的事务，而是依然属于入口业务系统。



### 服务接口是如何定义的？

服务接口是业务系统中非事务入口应用（下游应用）中的一组服务请求，通常是事务请求在某个应用上的一段请求，例如认证接口或数据查询接口，单个的服务请求是服务接口的一个实例。每个服务接口都属于具体的一个应用。



### 外部服务是如何定义的？

当前的应用通过探针支持的远程调用框架，发起远程调用，此时记为外部服务（例如：http的一个url）。通俗的说就是一个请求里又调用了另一个请求，那么这个另一请求就叫外部服务。