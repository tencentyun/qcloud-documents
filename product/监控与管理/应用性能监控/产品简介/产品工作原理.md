Java Agent基于JDK 提供的Instrumentation机制，在class文件被加载的时候，通过字节码技术，动态对Framework、数据库、NoSQL、Web Service、组件等特定方法实施监控，从而获得方法执行时间、数据库调用时间、NoSQL响应时间以及外部服务响应时间；并在这些时间超过一定阈值时，抓取调用堆栈。

![](https://main.qcloudimg.com/raw/fc6b08e73aaef05494a1ce565eb15f4e.png)

探针采用两级架构，包括运行在被监控应用上的Agent部分和运行在独立服务器上的Collector部分。其中
Agent部分的工作原理如上图所示，负责对应用进行嵌码和原始的数据采集，采集后的信息全部通过局域网直接传输到Collector上，由Collector进行数据的统计和关联，并最终上报到平台的数据中心上。

由于Agent会采集全量的业务和性能数据并实时传输到Collector上，因此Agent与Collector之间必须保证通畅的本地千兆网络连接。Collector支持Failover的高可用，对一组Agent可以部署多台Collector服务器，当其中个别服务器出现故障无法正常工作时，探针可通过Failover机制将数据实时传输到其他Collector上，以实现数据采集的高可用。

![](https://main.qcloudimg.com/raw/be6c2c9ab919f2ef487f9b04af28be79.png)