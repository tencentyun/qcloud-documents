NAT 边界防火墙开关支持基于内网资产进行流量管控与安全防护，同时支持基于 SNAT、DNAT 进行的网络流量转发。
## 操作指南

1. 登录 [云防火墙控制台](https://console.cloud.tencent.com/cfw)，在左侧导航栏中，选择【防火墙开关】>【NAT边界开关】，进入 NAT 边界开关页面。
>?当某个 NAT 边界防火墙开关开启后，对应子网的互联网流量将经过防火墙，届时访问控制规则、入侵防御功能将对其生效，流量日志也会生成。
2. 在 “NAT 边界开关”页面，可进行创建实例、同步资产、查看并监控基于 NAT 边界的带宽情况等操作。
	- **查看并监控基于 NAT 边界的带宽情况**
		1. 在状态监控面板右上角，单击统计按钮，进入防火墙状态监控页面。
			&nbsp;
			![](https://main.qcloudimg.com/raw/7c1a6c3467c4c6324ebad010d52e1084.png)
			&nbsp;
		2. 在防火墙状态监控页面，可实时查看并监控基于 NAT 边界的带宽情况，可避免因 NAT 边界防火墙带宽超出规格而带来网络丢包和波动，从而及时作出扩容或关闭部分开关等调整。
		 &nbsp;
		![](https://main.qcloudimg.com/raw/b617f70b1aca50d84c17486233fa8c1c.png)
		&nbsp;
	- **创建实例**	
		1. 在 “NAT 边界开关”页面下，单击【创建实例】。
		2. 在“新建 NAT 边界防火墙”弹窗中，可为当前账号创建一个新的 NAT 边界防火墙实例。
&nbsp;
![](https://main.qcloudimg.com/raw/647e1e258372becfb6c595e8b223dede.png)
&nbsp;
>?
>- 地域：用户可在拥有 VPC 的所有国内地域中进行地域选择，但已经创建了 NAT 边界防火墙的地域将无法选择。
>- 弹性 IP：若选择新建弹性 IP，系统会自动为用户申请一个弹性 IP，用户也可从所有闲置的弹性 IP 中选择一个进行绑定。
	- **同步资产**
在 “NAT 边界开关”页面下，单击【同步资产】，可以主动调用后台接口重新读取并同步用户子网的资产信息，可避免发生因用户资产规模在后台轮询间隔内发生变化，但尚未被同步的情况。
&nbsp;
![](https://main.qcloudimg.com/raw/873683d079d9231ae7083bb48f31bcb0.png)
&nbsp;
	- **防火墙开关**：在防火墙开关页面，支持开启或关闭基于子网粒度的 NAT 边界防护。
		- **开启防护**
	>!开启开关后，请勿在 [私有网络控制台](https://console.cloud.tencent.com/vpc/vpc?rid=1) 中手动变更开关对应的路由，否则将导致防火墙丢失路由而引发网络中断。
	>
			- **方式1**：在实例列表上方，单击【开启防护】，所有未开启的 NAT 边界防火墙开关将被打开，所有路由表将会自动添加下一跳类型为 NAT 边界防火墙的路由策略，所有子网的互联网流量将会经过 NAT 边界防火墙。
		>?若用户选择开启同一路由表关联的所有子网，系统会自动在该路由表中增加一条下一跳指向 NAT 边界防火墙的路由策略，并关闭原访问公网的路由策略，因此该路由表关联的所有子网的互联网流量，将会经过NAT边界防火墙。
		>
		![](https://main.qcloudimg.com/raw/30ff60ac2cd2f3a28b9388cf9581d6a0.png)
		&nbsp;
			- **方式2**：如想开启对某个子网实例的 NAT 边界防护，可以在右侧操作栏，单击“防火墙开关”按钮，开启对该子网资产的防护。
>?若用户仅选择开启某个子网，系统会自动为当前子网创建新的路由表，复制现有的全部路由策略，在新路由表中增加一条下一跳指向 NAT 边界防火墙的路由策略，并关闭原访问公网的路由策略，因此该子网的互联网流量，将会经过 NAT 边界防火墙。
>
![](https://main.qcloudimg.com/raw/a817a12d203a27a63d41ee7366fc9379.png)
&nbsp;
		- **关闭防护**
 		- **方式1**：在实例列表上方，单击【关闭防护】，所有已开启的 NAT 边界防火墙开关将被关闭，NAT 边界防火墙会自动关闭下一跳类型为 NAT 边界防火墙的所有路由表的路由策略，所有子网将断开与互联网的连接，用户需要在 [私有网络控制台](https://console.cloud.tencent.com/vpc/vpc?rid=1) 手动启动新的路由策略。
 			>?若用户选择关闭同一路由表关联的所有子网，系统会自动关闭该路由表中下一跳指向 NAT 边界防火墙的路由策略，该路由表关联的所有子网将会断开与互联网的连接。
 			>
			![](https://main.qcloudimg.com/raw/ad1bdfd566e683c156f4795a6b807f03.png)
		&nbsp;
 		- **方式2**：如想关闭对某个子网实例的NAT边界防护，可以在防火墙操作栏，单击“防火墙开关”按钮，关闭对该子网资产的防护，关闭开关后，用户需要前往 [私有网络控制台](https://console.cloud.tencent.com/vpc/vpc?rid=1) 手动启用新的路由策略。
 >?若用户仅选择关闭某个子网，系统会自动为当前子网创建新的路由表，复制现有的全部路由策略，并关闭下一跳指向 NAT 边界防火墙的路由策略，该子网将会断开与互联网的连接。
 >
 ![](https://main.qcloudimg.com/raw/7e09cba9016693cf7642d43c75178185.png)
 &nbsp;
		- **防火墙开关异常场景说明**
			- **场景1**：当已有子网x.x.x.x/24加入了 NAT 边界防火墙且开启开关，当前地域内存在另一个子网且也是x.x.x.x/24时，已开启相同网段的子网会导致防火墙开关开启失败。
			- **场景2**：在后台定时轮询资产的时间间隔内，若用户删除了某个子网或变更了子网绑定的路由表，虽然该子网仍会出现在开关列表内，但防火墙开关将无法开启。
		- **查看某个子网绑定的路由表以及路由策略**
 在目标实例右侧操作栏，选择【更多】>【查看路由策略】，进入路由表页面进行查看。
 &nbsp;
 ![](https://main.qcloudimg.com/raw/fb93a415e7929d26ae18b70e05a35d83.png)
 &nbsp;
	- **实例配置**：在实例配置页面下，可以看到用户基于 NAT 边界防火墙实例所添加的 DNAT 端口转发规则，以及与实例关联的弹性 IP。
		1. 在实例配置页面，单击【新建规则】，弹出“新建端口转发规则”窗口。
	&nbsp;
![](https://main.qcloudimg.com/raw/44f442859246931c1f1419eca8803941.png)
&nbsp;
		2. 在“新建端口转发规则”窗口，用户可为当前 NAT 边界防火墙实例添加一条外部 IP 为用户所绑定的弹性 IP 的 DNAT 规则。
	>?
	>- 在外部 IP 端口下拉框内，提供的选项为当前 NAT 边界防火墙实例所绑定的弹性 IP。
	>- 输入内部 IP 地址时，用户需填写本地域 VPC 网段内可用的 IP。
	>
![](https://main.qcloudimg.com/raw/b91bf104d7c290a7c015d6b9562f869a.png)
&nbsp;
		3. 在实例配置页面右侧的“关联弹性 IP”模块，单击【+绑定弹性IP】。
		4. 在单选下拉框内，用户可为当前 NAT 边界防火墙实例绑定一个系统新建的弹性 IP，或在当前地域拥有的所有闲置弹性 IP 里选择一个进行绑定。
	>?
	>- 关联弹性 IP 功能目前只支持新增模式，暂未支持迁移模式。
	>- 解除绑定某个弹性 IP 时，页面上与其相应的 DNAT 规则也会消失。
	>
![](https://main.qcloudimg.com/raw/48461beaa0162204aa2db464d949458a.png)
