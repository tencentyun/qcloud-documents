## 操作场景
DDoS 高防 IP 通过健康检查帮助用户自动识别后端服务器的运行状况，自动隔离异常的服务器。以此降低了后端服务器异常对整体业务可用性的影响。
- **非网站业务（四层）健康检查**
 DDoS 高防 IP 非网站业务防护的健康检查机制，由高防集群节点向配置中指定的服务器端口发起访问请求，如果端口访问正常则视为后端服务器运行正常，否则视为后端服务器运行异常。
 在 TCP 协议下，探测端口能否连接。在 UDP 协议下，使用 ping 进行可达性检查。
- **网站业务（七层）健康检查**
DDoS 高防 IP 网站业务防护的健康检查机制，由高防转发集群向后端服务器发送 HTTP 请求的方式来检查后端服务，高防系统根据 HTTP 返回状态码来判断服务是否正常。
用户可以自定义设置响应代码所代表的状态。假定在某场景下，HTTP 返回值为 http_1xx、http_2xx、http_3xx、http_4xx 和 http_5xx ，用户可以根据业务需要勾选 http_1xx 及 http_2xx 为服务正常状态，则返回 http_3xx 至 http_5xx 的值则代表异常状态。

>?配置四层或七层转发规则时，如果单条规则中仅配置1个源站 IP ，健康检查功能将不开启，该功能适合多源站 IP 的情况下开启。
## 操作步骤
### 非网站业务健康检查配置
下面将为您介绍配置 DDoS 高防 IP 非网站业务防护的健康检查规则的详细步骤。
1. 登录 [DDoS 防护控制台](https://console.cloud.tencent.com/dayu/overview)，在左侧导航栏中，选择【DDoS 高防 IP】> 【接入配置】，进入管理页面。
2. 单击【非网站业务】，选择目的 DDoS 高防 IP 实例和相应规则，单击健康检查列下的【编辑】。
![](https://main.qcloudimg.com/raw/4eed84d4da259fb9caf544c47d231bad.png)
3. 在健康检查编辑页面，单击【显示高级选项】，设置配置项后，单击【确定】即可。
![](https://main.qcloudimg.com/raw/1e4577974c979e747aa604b4937d4bb3.png)
>?
>- 默认开启健康检查。
>- 在配置健康检查时，建议使用默认值。
>- 支持对健康检查配置信息批量导入导出。导入后，系统将根据导入的“转发协议、转发端口”与规则进行一一匹配，其中“转发端口”必须为已配置了规则的转发端口。 

### 网站业务健康检查配置
下面将为您介绍配置 DDoS 高防 IP 网站业务防护的健康检查规则的详细步骤。
1. 登录 [DDoS 防护控制台](https://console.cloud.tencent.com/dayu/overview)，在左侧导航栏中，选择【DDoS 高防 IP】> 【接入配置】，进入管理页面。
2. 单击【网站业务】，选择目的 DDoS 高防 IP 实例和相应规则，单击健康检查列下的【编辑】。
![](https://main.qcloudimg.com/raw/e52a44e82f338b7360440a88240a1a1d.png)
3. 在健康检查编辑页面，单击<img src ="https://main.qcloudimg.com/raw/ec09016f92120f3a9b58abe311a43c6d.png"  style="margin:0;"> 按钮开启健康检查功能，同时单击【显示高级选项】，进行配置项设置，确认无误后，单击【确定】即可。
![](https://main.qcloudimg.com/raw/fd588285df984109382717a1362a3349.png)
>?
	- 默认关闭健康检查。
	- 在配置健康检查时，建议使用默认值。
	- 支持批量导入导出健康检查配置信息。导入后，系统将根据导入的“转发协议、业务域名”与规则进行一一匹配，其中“业务域名”必须为已配置了规则的业务域名。


## 配置项说明
**四层健康检查**

| 配置项 | 说明 | 
|---------|---------|
| 响应超时 | 每次健康检查响应的最大超时时间。如果后端服务器在指定的时间内没有正确响应，则判定为健康检查失败。 |
| 检测间隔 | 进行健康检查的时间间隔。 | 
| 不健康阈值 | 在健康检查状态为成功时，连续 n 次（n 为填写的数值）收到健康检查失败状态，则识别为不健康，控制台显示异常。 | 
| 健康阈值 | 在健康检查状态为失败时，连续 n 次（n 为填写的数值）收到健康检查成功状态，则识别为健康，控制台无显示。 | 

 **七层健康检查**

| 配置项 | 说明 |
|---------|---------|
| 检测间隔 | 进行健康检查的时间间隔，默认为15秒。 |
|不健康阈值|在健康检查状态为成功时，连续 n 次（n 为填写的数值）收到健康检查失败状态，则识别为不健康，控制台显示异常。|
|健康阈值|在健康检查状态为失败时，连续 n 次（n 为填写的数值）收到健康检查成功状态，则识别为健康，控制台无显示。|
|HTTP 请求方式和检查路径 URL|默认使用 HEAD 方法，服务器仅返回响应消息报文头。使用 GET 方法，服务器返回完整的响应消息。对应后端服务器需要支持 HEAD 和 GET。</br> <li>如果用来进行健康检查的页面并不是应用服务器的缺省首页，用户需要指定具体的检查路径。</li><li>如果对 HTTP HEAD 请求限定了 host 字段的参数，用户需要指定检查路径，即用于健康检查页面文件的 URI。</li>|
|HTTP 状态码检测|判断健康检查是否正常的 HTTP 状态码。默认情况或不做任何选择时，该值为 http_1xx、http_2xx、http_3xx 和 http_4xx，如果 HTTP 返回状态码非默认状态值，则识别为不健康，支持修改。|
