## 应用场景
DDoS 高防 IP 通过健康检查帮助用户自动识别后端服务器的运行状况，自动隔离异常的服务器，以此降低了后端服务器异常对整体业务可用性的影响。
- **四层业务健康检查**
 DDoS 高防 IP 四层业务防护的健康检查机制，由高防集群节点向配置中指定的服务器端口发起访问请求，如果端口访问正常则视为后端服务器运行正常，否则视为后端服务器运行异常。
 在 TCP 协议下，探测端口能否连接。在 UDP 协议下，使用 ping 进行可达性检查。
- **七层业务健康检查**
DDoS 高防 IP 七层业务防护的健康检查机制，由高防转发集群向后端服务器发送 HTTP 请求的方式来检查后端服务，高防系统根据 HTTP 返回状态码来判断服务是否正常。
用户可以自定义设置响应代码所代表的状态。假定在某场景下，HTTP 返回值为 http_1xx、http_2xx、http_3xx、http_4xx 和 http_5xx ，用户可以根据业务需要勾选 http_1xx 及 http_2xx 为服务正常状态，则返回 http_3xx 至 http_5xx 的值则代表异常状态。

>!配置转发规则时，如果单条规则中仅配置1个源站 IP ，健康检查功能将不开启，该功能适合多源站 IP 的情况下开启。

## 操作步骤
### 四层业务健康检查配置
1. 登录 [DDoS 高防 IP（新版）管理控制台](https://console.cloud.tencent.com/ddos/antiddos-advanced/access/l4) ，在左侧目录中，单击**业务接入**，在业务接入页面，单击**端口接入**，进入相关管理页面。
2. 在“端口接入”页签，选择目的 DDoS 高防 IP 实例和相应规则，单击其健康检查列下的**编辑**。
![](https://main.qcloudimg.com/raw/5ee7ca8ee6ef73be9076d5e64ed08beb.png)
3. 在健康检查编辑页面，单击“显示高级选项”，设置配置项后，单击**确定**即可。
>?
> - 默认开启健康检查。在配置健康检查时，建议使用默认值。
> - 在 TCP 协议下，探测端口能否连接。在 UDP 协议下，使用 ping 进行可达性检查。
> 
![](https://main.qcloudimg.com/raw/cdf96e561313c5c40208057a20cdade2.png)



### 七层业务健康检查配置
1. 登录 [DDoS 高防 IP（新版）管理控制台](https://console.cloud.tencent.com/ddos/antiddos-advanced/access/l4) ，在左侧目录中，单击**业务接入**，在业务接入页面，单击**域名接入**，进入相关管理页面。
2. 在“域名接入”页签，选择目的 DDoS 高防 IP 实例和相应规则，单击其健康检查列下的**配置**。
![](https://main.qcloudimg.com/raw/986bcf96a224637ee51be3cb58c65b68.png)
3. 在健康检查编辑页面，单击“显示高级选项”，设置配置项后，单击**确定**即可。
>?默认关闭健康检查。
>
![](https://main.qcloudimg.com/raw/99349be9a33ca020c0ee936652971350.png)

## 配置项说明
**四层健康检查**

| 配置项 | 说明 | 
|---------|---------|
| 响应超时 | 每次健康检查响应的最大超时时间。如果后端服务器在指定的时间内没有正确响应，则判定为健康检查失败。 |
| 检测间隔 | 进行健康检查的时间间隔。 | 
| 不健康阈值 | 在健康检查状态为成功时，连续 n 次（n 为填写的数值）收到健康检查失败状态，则识别为不健康，控制台显示异常。 | 
| 健康阈值 | 在健康检查状态为失败时，连续 n 次（n 为填写的数值）收到健康检查成功状态，则识别为健康，控制台无显示。 | 

 **七层健康检查**
 
| 配置项 | 说明 |
|---------|---------|
| 检测间隔 | 进行健康检查的时间间隔，默认为15秒。 |
|不健康阈值|在健康检查状态为成功时，连续 n 次（n 为填写的数值）收到健康检查失败状态，则识别为不健康，控制台显示异常。|
|健康阈值|在健康检查状态为失败时，连续 n 次（n 为填写的数值）收到健康检查成功状态，则识别为健康，控制台无显示。|
|HTTP 请求方式和检查路径 URL|默认使用 HEAD 方法，服务器仅返回响应消息报文头。使用 GET 方法，服务器返回完整的响应消息。对应后端服务器需要支持 HEAD 和 GET。</br> <li>如果用来进行健康检查的页面并不是应用服务器的缺省首页，用户需要指定具体的检查路径。</li><li>如果对 HTTP HEAD 请求限定了 host 字段的参数，用户需要指定检查路径，即用于健康检查页面文件的 URI。</li>|
|HTTP 状态码检测|判断健康检查是否正常的 HTTP 状态码。默认情况或不做任何选择时，该值为 http_1xx、http_2xx、http_3xx 和 http_4xx，如果 HTTP 返回状态码非默认状态值，则识别为不健康，支持修改。|

