本文为您介绍如何使用攻击日志进行攻击日志索引、快速分析和查询。

## 背景信息
Web 应用防火墙默认提供攻击日志，详细记录攻击产生的时间、攻击源IP、攻击类型及攻击详情等信息，攻击日志仅支持查询或导出最近30天日志。攻击日志支持全文检索、模糊搜索和组合条件搜索等检索方式，同时支持根据检索条件下载日志，支持百万级日志下载。

## 操作指南
1. 登录 [Web 应用防火墙控制台](https://console.cloud.tencent.com/guanjia/tea-overview)，在左侧导航栏中，选择**日志服务** > **攻击日志**。
2. 在日志查询页签，您可以根据需要，选择域名、攻击类型、执行动作及时间维度等信息，筛选查看攻击日志。
![](https://qcloudimg.tencent-cloud.cn/raw/cbf5f9fe63880bee28f3a244cf15bb5b.png)
**字段说明：**
	- **域名过滤**：支持多选，默认显示全部域名。
	- **攻击类型过滤**：支持多选，默认为全部攻击类型，攻击类型包括各个安全模块产生的观察和拦截日志。
	- **执行动作过滤**：单选，默认为全部，包括观察和拦截两种类型。
	- **风险等级**：单选，包括：高危、中危和低危三种类型。
	- **时间范围**：默认为近一小时，支持选择最近时间及相对时间，您根据需要进行选择。
	- **自动刷新**：自动刷新当前页面，默认为关闭，若开启开关，您可选择按照时间范围刷新当前页面，获取最新攻击日志数据。
![](https://main.qcloudimg.com/raw/7a5ce526a018b6713e81d4d1ba248a5c.png)
3. 设置完成检索条件，单击**检索分析**，即可查看检索分析结果。
4. 在攻击日志原始数据页面左侧，单击具体统计字段，可快速查看符合检索条件下，各个字段值在攻击日志中的占比。
![](https://qcloudimg.tencent-cloud.cn/raw/9eedd806dc62ceba5478a737e85c8b59.png)
	- **自定义字段列表**：在日志列表右上方，单击<img src="https://main.qcloudimg.com/raw/9ebb9fa1652d9154137fa1d934329043.png" style="margin:0;">，可设置列表展示字段，选择完成后，单击**确定**，即可设置成功，各字段说明，请参见 [日志详情字段说明](#Log)。
	![](https://main.qcloudimg.com/raw/bced1df9f037206ccadeaf44fb8d5435.png)
	- **攻击日志下载**：
		1. 在日志列表右上方，单击<img src="https://main.qcloudimg.com/raw/ac6451a8dab74a5cf57770ff8af30954.png" style="margin:0;">，即可成功创建下载任务。
>?
>- 同一时间段内只允许创建一个下载任务，请耐心等待。单次最多支持下载100万条日志，如果您需要下载的日志超过100万条，建议您分多次任务进行下载，或 [联系我们](https://cloud.tencent.com/act/event/connect-service) 为您提供支持服务。
>- 当选择泛域名（如*.abc.com）时，所有关联子域名（如以.abc.com结尾）的日志也将会被下载。
>
		2. 在 [攻击日志](https://console.cloud.tencent.com/guanjia/attack) 页面上方，单击**下载任务**，可以查看创建日志文件的下载状态信息。
		![](https://qcloudimg.tencent-cloud.cn/raw/935ee5a083175f6c6f4c3ae9fef432a4.png)
		3. 输入任意任务名称，单击**创建**后即可下载。
		![](https://qcloudimg.tencent-cloud.cn/raw/5165a225a166f800590022d979e2c627.png)
5. 在攻击日志原始数据页面右侧，单击日志前方展开按钮，可以查看日志详情信息，默认展示“日志详情”，单击 **JSON**，可查看对应 JSON 格式展示样式。
![](https://main.qcloudimg.com/raw/bc2c6f1eae83f6213a8f047b5d3b0156.png)
6. 在日志详情中，单击具体参数值，将自动填充检索条件，进行快速检索，支持多种字段组合。
![](https://main.qcloudimg.com/raw/5c10303d7cfc317bd74a19771fa262a6.png)

## 附录

[](id:Log)
### 日志详情字段说明
**基本信息**
<table>
<thead>
<tr>
<th width="20%">字段名称</th>
<th>字段说明</th>
</tr>
</thead>
<tbody><tr>
<td>host</td>
<td>客户端访问域名。</td>
</tr>
<tr>
<td>attack_type</td>
<td>详细攻击类型，全部攻击类型信息。</td>
</tr>
<tr>
<td>attack_category</td>
<td>攻击一级分类，暂未提供。</td>
</tr>
<tr>
<td>count</td>
<td>聚合攻击次数，相同攻击源 IP 和攻击类型，汇总每10秒产生的攻击次数。</td>
</tr>
<tr>
<td>attack_ip</td>
<td>攻击源 IP，客户端攻击的源 IP。</td>
</tr>
<tr>
<td>rule_id</td>
<td>命中规则 ID，触发防护策略的规则 ID，其中 AI 引擎检出的攻击，规则 ID 为0。</td>
</tr>
<tr>
<td>method</td>
<td>请求方法，客户端攻击请求方法。</td>
</tr>
<tr>
<td>risk_level</td>
<td>风险等级，客户端攻击触发的风险等级。</td>
</tr>
<tr>
<td>attack_time</td>
<td>攻击时间，客户端攻击触发的时间。</td>
</tr>
<tr>
<td>attack_place</td>
<td>攻击位置，攻击方式在 HTTP 请求中的位置。</td>
</tr>
<tr>
<td>action</td>
<td>执行动作客户端攻击触发的动作。</td>
</tr>
<tr>
<td>uri</td>
<td>请求 URI 的内容。</td>
</tr>
<tr>
<td>attack_content</td>
<td>攻击内容，客户端触发攻击的内容。</td>
</tr>
<tr>
<td>http_log</td>
<td>请求的其他信息，包括请求协议、协议版本等信息。</td>
</tr>
<tr>
<td>user_agent</td>
<td>User-Agent。攻击源 IP 向服务器用来表明自己的浏览器类型和操作系统标识等信息。</td>
</tr>
<tr>
<td>headers</td>
<td>协议头部信息，包括自定义头部信息。</td>
</tr>
<tr>
<td>UUID</td>
<td>日志唯一标识。</td>
</tr>
</tbody></table>

**攻击 IP 属性**
<table>
<thead>
<tr>
<th width="20%">字段名称</th>
<th>字段说明</th>
</tr>
</thead>
<tbody><tr>
<td>ipinfo_province</td>
<td>攻击 IP 省份信息。</td>
</tr>
<tr>
<td>ipinfo_state</td>
<td>攻击 IP 国家信息，国家英文缩写。</td>
</tr>
<tr>
<td>pinfo_nation</td>
<td>攻击 IP 国家名称。</td>
</tr>
<tr>
<td>ipinfo_city</td>
<td>攻击 IP 城市。</td>
</tr>
<tr>
<td>ipinfo_isp</td>
<td>攻击 IP 运营信息。</td>
</tr>
<tr>
<td>ipinfo_dimensionality</td>
<td>攻击 IP 纬度信息。</td>
</tr>
<tr>
<td>ipinfo_longitude</td>
<td>攻击源 IP 的经度信息。</td>
</tr>
</tbody></table>


### [日志文件字段说明](id:log2)

<table>
<thead>
<tr>
<th width="20%">字段名称</th>
<th>字段说明</th>
</tr>
</thead>
<tbody><tr>
<td>uuid</td>
<td>日志唯一标识。</td>
</tr>
<tr>
<td>attack_time</td>
<td>客户端攻击时间。</td>
</tr>
<tr>
<td>rule_id</td>
<td>客户端攻击触发的策略 ID。</td>
</tr>
<tr>
<td>count</td>
<td>攻击聚合次数，相同攻击源 IP 和攻击类型，每10秒产生的攻击次数汇总。</td>
</tr>
<tr>
<td>status</td>
<td>执行动作，0表示观察，1表示拦截。</td>
</tr>
<tr>
<td>domain</td>
<td>客户端攻击的域名信息。</td>
</tr>
<tr>
<td>attack_ip</td>
<td>客户端攻击 IP。</td>
</tr>
<tr>
<td>attack_type</td>
<td>客户端攻击类型。</td>
</tr>
<tr>
<td>args_name</td>
<td>客户端请求攻击发生的位置，如请求参数、URI、IP 等。</td>
</tr>
<tr>
<td>attack_content</td>
<td>客户端攻击的攻击内容。</td>
</tr>
<tr>
<td>uri</td>
<td>客户端攻击 URI 信息。</td>
</tr>
<tr>
<td>method</td>
<td>客户端攻击请求使用的方法。</td>
</tr>
<tr>
<td>user_agent</td>
<td>客户端的 User_Agent 信息。</td>
</tr>
</tbody></table>
