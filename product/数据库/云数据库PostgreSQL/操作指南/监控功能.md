
## 控制台监控
为方便用户查看和掌握实例的运行信息，云数据库 PostgreSQL 提供了丰富的性能监控项，用户可登录 [PostgreSQL 控制台](https://console.cloud.tencent.com/pgsql) ，在对应实例管理页的**系统监控**页查看。

#### 监控指标

| 指标名                     | 监控指标名        | 单位  | 指标描述                                                     |
| -------------------------- | ----------------- | ----- | ------------------------------------------------------------ |
| CPU 利用率                  | cpu               | %     | CPU 实际利用率                                              |
| 已用存储空间               | storage           | GB    | 整实例空间占用大小                                         |
| 数据文件大小               | data_file_size    | GB    | 数据文件占用空间大小                                       |
| 日志文件大小               | log_file_size     | GB    | wal 日志文件占用空间大小                                    |
| 临时文件大小               | temp_file_size    | MB    | 临时文件的大小                                             |
| 存储空间使用率             | storage_rate      | %     | 总的存储空间使用率，包括临时文件、数据文件、日志文件以及其他类型的数据库文件 |
| 每秒查询数                 | qps               | 次/秒 | 平均每秒执行的 SQL 语句数量                                  |
| 连接数                     | connections       | 个    | 对数据库发起采集时，数据库当前总连接数                     |
| 5秒内新建连接数            | new_conn_in5s     | 次    | 对数据库发起采集时，查询出关于最近5秒内建立的所有连接数    |
| 活跃连接数                 | active_conns      | 个    | 对数据库发起采集时，数据库瞬时活跃连接（非 idle 连接）       |
| 空闲连接数                 | idle_conns        | 个    | 对数据库发起采集时，查询出来的数据库瞬时空闲连接（idle 连接） |
| 等待会话数                 | waiting           | 个    | 对数据库发起采集时，数据库正在等待的会话数量（状态为 waiting） |
| 等待超过5秒的会话数         | long_waiting      | 个    | 一个采集周期内，数据库等待超过5秒的会话数量（状态为 waiting，且等待状态维持了5秒） |
| 空闲事务数                 | idle_in_xact      | 个    | 对数据库发起采集时，数据库正在处于 idle 状态的事务数量       |
| 执行时长超过1秒的事务数目  | long_xact         | 个    | 一个采集周期内，执行时间超过1秒的事务数量                    |
| 超过5秒的空闲事务数        | long_idle_in_xact | 个    | 一个采集周期内，空闲时间超过5秒的事务数量                    |
| 每秒事务数                 | tps               | 次/秒 | 平均每秒执行成功的事务数（包括回滚和提交）                   |
| 事务提交数                 | xact_commit       | 次/秒 | 平均每秒提交的事务数                                         |
| 事务回滚数                 | xact_rollback     | 次/秒 | 平均每秒回滚的事务数                                         |
| 请求数                     | read_write_calls  | 次    | 一个统计周期内的总请求数                                     |
| 读请求数                   | read_calls        | 次    | 一个统计周期内的读请求数                                     |
| 写请求数                   | write_calls       | 次    | 一个统计周期内的写请求数                                     |
| 其他请求数                 | other_calls       | 次    | 一个统计周期内的其他请求数（begin、create、非 DML、DDL、DQL 操作） |
| 缓冲区缓存命中率           | hit_percent       | %     | 一个请求周期内的所有 SQL 语句执行的命中率                      |
| 平均执行时延               | sql_runtime_avg   | ms    | 一次统计周期内所有 SQL 语句的平均执行时延                    |
| 最长 TOP10 执行时延          | sql_runtime_max   | ms    | 一次统计周期内最长 TOP10 的 SQL 平均执行时延          |
| 最短 TOP10 执行时延          | sql_runtime_min   | ms    | 一次统计周期内最短 TOP10 的 SQL 平均执行时延          |
| 剩余 XID 数量                | remain_xid        | 个    | 对数据库发起采集时，显示当前剩余 xid 最少的库的剩余 xid 数量。只读实例无此指标 |
| 备库日志发送与回放位置差异 | xlog_diff         | byte  | 日志从主库发送至备库与备库回放完成之间的大小差异，主要反映了备库日志应用的速度，主要能够通过此指标查看出备库的性能、网络传输的速度。只读实例无此指标 |                     
| 备库日志落盘时间延迟       | xlog_diff_time    | s     | 日志从主库发送至备库与备库接收到日志并落盘之间的时间差异。只读实例无此指标，且实例版本在10.x以上版本才有此指标 |
| 主备数据同步延迟           | slave_apply_delay | s     | 主备数据同步延迟,对于主实例而言，此指标可以体现出故障切换的RTO。反映到只读实例在多少时间后能够查询到在主库进行写入的数据. 只读实例指标名为：与主实例数据同步延迟 |
| 慢查询数量                 | slow_query_cnt    | 个    | 一个采集周期内，出现的慢查询个数                           |
| 执行时长超过1秒的 SQL 数     | long_query    | 个    | 对数据库发起采集时，查询出来 执行时间超过1s的 SQL 数量     |
| 2pc事务数                  | 2pc               | 个    | 对数据库发起采集时，当前的2pc事务数量                        |
| 超过5s未提交的2PC事务数    | long_2pc          | 个    | 对数据库发起采集时，当前执行时间超过5s的 2PC 事务数量    |
| 每秒删除记录数             | tup_deleted       | 个    | 平均每秒删除的 tupe 数量。只读实例无此指标                 |
| 每秒插入记录数             | tup_inserted      | 个    | 平均每秒插入的 tupe 数量。只读实例无此指标                  |
| 每秒更新记录数             | tup_updated       | 个    | 平均每秒更新的 tupe 数量。只读实例无此指标                |
| 每秒索引扫描回表记录数     | tup_inserted      | 个    | 平均每秒通过索引扫描的 tupe 数量                               |
| 每秒全表扫描记录数         | tup_returned      | 个    | 平均每秒全表扫描的 tupe 数量                                   |
| 死锁数                     | deadlocks         | 个    | 在一个采集周期内的所有死锁数                                 |


## pg_stat_statements 模块
您还可以通过 [pg_stat_statements](https://www.postgresql.org/docs/9.4/pgstatstatements.html) 视图查询 pg 详细性能指标。pg_stat_statements 模块提供追踪一个服务器所执行的所有 SQL 语句的执行统计信息的方法，可以用于统计数据库的资源开销，分析 TOP SQL。

```
select * from pg_stat_statements；
```
