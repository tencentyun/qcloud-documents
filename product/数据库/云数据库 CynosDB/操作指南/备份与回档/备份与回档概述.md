数据是企业的核心资产。随着业务发展，企业数据呈现出规模化、爆炸式的增长，业务应用要求实时、在线的快速处理，对于数据库运维人员来说，保护企业核心数据的任务越来越有挑战性，例如数据误删除、相关系统漏洞和病毒、硬件故障，甚至自然灾害都可能造成数据的丢失，因此，备份和回档是数据库非常重要的功能。

## 备份概述
TDSQL-C MySQL 版支持数据备份和 binlog 备份，通过一个完整的数据备份以及后续一段时间的 binlog 备份，就可以将整个 TDSQL-C MySQL 版集群或特定库表恢复到任意时间点。

您可通过可视化列表查询数据备份列表的字段信息，包括：文件名/备注名、备份时间点、开始时间、结束时间、备份类型、备份方式、	备份大小、状态以及操作等；可查询 binlog 备份列表的字段信息，包括：文件名、binlog 数据开始时间、binlog 数据结束时间、备份大小以及操作等，方便您对历史备份进行查询和管理。

备份与回档的控制台界面如下：
![](https://qcloudimg.tencent-cloud.cn/raw/a53ab2c0a1414a32859d912786a9c31c.png)

### 数据备份
数据备份即将某个时间点上集群的全量数据生成一个备份文件，TDSQL-C MySQL 版数据备份支持逻辑备份和快照备份两种备份类型，逻辑备份为全量备份，快照备份包含全量备份和增量备份。

- **逻辑备份**：仅支持全量备份，指的是保存数据库的逻辑结构和内容，是以 SQL 语句的方式来表示数据库的结构和数据，是数据库对象级备份，备份内容是表、索引、存储过程等数据库对象，其优势主要体现在能支持进行更精细的库、表级别备份，对数据库性能影响较小，但相对备份速度较慢，占用体积较大。
- **快照备份**：采用写时重定向技术 ROW（Redirect-On-Write），通过对存储层磁盘创建快照的方式进行备份，其优势主要体现在备份速度快，可秒级完成，整个过程计算层业务无感知，相对占用体积小。
 - **全量备份**：对某⼀个时间点上的所有数据进行的⼀个完全拷贝。
 - **增量备份**：在上一次备份的基础上，备份新增或改变的文件。

### 备份类型对比表
<table>
<thead><tr><th colspan = "2" style="text-align:center" width="28%">备份类型</th><th>优势/劣势</th><th>对象</th><th>方式</th><th>下载</th><th>删除</th></tr></thead>
<tbody>
<tr>
<td>逻辑备份</td><td>全量备份</td><td><li>优势：精细的库、表级别备份，对数据库性能影响较小<br><li>劣势：会对数据库加锁，备份速度较慢，占用体积较大</td><td>表、索引、存储过程等数据库对象；整个集群</td><td>手动</td><td>&#10003;</td><td>&#10003;</td></tr>
<tr>
<td rowspan="3">快照备份</td><td rowspan="2" >全量备份</td><td rowspan="3" ><li>优势：备份速度为秒级，业务无感知，占用体积小<br><li>劣势：备份不支持下载</td><td rowspan="3" >整个集群</td><td>手动</td><td>×</td><td>&#10003;</td>
</tr>
<tr><td>自动</td><td>×</td><td>×</td></tr>
</tr>
<tr><td>增量备份</td><td>自动</td><td>×</td><td>×</td></tr>
</tbody></table>

### binlog 备份
<table>
<thead><tr><th colspan = "2" style="text-align:center" width="28%">备份类型</th><th>优势/劣势</th><th>对象</th><th>方式</th><th>下载</th><th>删除</th></tr></thead>
<tbody>
<tr>
<td>binlog 备份</td><td>增量备份</td><td><li>优势：记录增量数据，可通过 binlog 备份恢复到任一时间点<br><li>劣势：开启 binlog 备份会降低实例写性能</td><td>整个集群</td><td>自动</td><td>&#10003;</td><td>x</td></tr>
</tbody></table>

binlog 备份即在某个时间点上将集群的全量数据记录生成备份文件之后，产生的增量数据。TDSQL-C MySQL 版在执行大事务或大量 DML 时会产生较多的 binlog，此 binlog 备份会被上传至云端存储，然后控制台的 binlog 备份列表会显示上传到云端的 binlog 备份，binlog 备份用于存储操作日志。

TDSQL-C MySQL 版不再依赖 binlog 备份进行回档，而采用 redo log 进行回档，在关闭 binlog 的情况下仍可正常回档到任意时间点，关闭 binlog 可以对实例的写性能有30%以上的提升。

## 注意事项
- 手动备份任务限制频率为1小时1次，自动备份任务根据用户设置的备份开始时间进行，系统默认每天进行一次自动备份。
- 备份方式中，手动备份的文件支持在备份列表手动删除，释放掉备份空间，避免空间浪费和占用，没有手动删除的前提下，备份文件会保留在备份列表下，为避免浪费，请定期手动删除不需要的部分。
- 备份方式中，自动备份的文件不支持手动删除，可通过设置自动备份保留时间来实现到期后自动删除。
- binlog 备份大小可在日志备份列表查询，binlog 备份的总大小为每个 binlog 备份文件大小之和。

## 回档概述
TDSQL-C MySQL 版支持通过回档功能来恢复数据到指定的时间，可以最大程度地减少系统损失。
TDSQL-C MySQL 版支持库表级别回档到原集群以及整集群级别回档（克隆）到新集群，用户可以根据业务选择不同的回档方式。

## 回档方式
- 按备份文件回档：将集群恢复到任一备份文件的数据文件状态，备份文件选择范围由用户设置的数据备份保留时长决定。
- 按时间点回档：将集群恢复到任意时间点，时间点的选择范围由用户设置的 binlog 备份保留时长决定。
