通过数据库代理读写分离功能，在应用程序中配置数据库代理地址，就可以使写请求自动转发到读写实例，读请求自动转发到各个只读实例。

本文为您介绍如何开通/关闭 TDSQL-C MySQL 版读写分离功能。

## 前提条件
- 实例为读写实例。
- 已 [开通数据库代理](https://cloud.tencent.com/document/product/1003/76780)。
- 已 [创建只读实例](https://cloud.tencent.com/document/product/1003/45915)。

## 开通读写分离
1. 登录 [TDSQL-C MySQL 版控制台](https://console.cloud.tencent.com/cynosdb/mysql#/)。
2. 在上方选择地域，单击集群 ID 或**操作**列的**管理**，进入集群管理页。
3. 在集群管理页的**数据库代理**页，选择**读写分离**页，单击**立即开启**。
![](https://qcloudimg.tencent-cloud.cn/raw/dc3d38dad0a01c02dc2f49f15dda3ac4.png)
4. 在弹出的对话框，设置读写分离配置，单击**确定**。
>!
>- 仅状态为运行中的主实例和只读实例，才能加入数据库代理中。
>- 目前异地 RO 和延迟 RO 不允许挂载到数据库代理下。
>
   - **一致性设置**：提供了三种一致性级别，分别为：最终一致性、会话一致性、全局一致性。
   - **读权重分配**：为实例分配读权重，可选择系统自动分配或自定义，权重分配范围为0 - 100的整数。读权重分配配置后，会立即对所有连接生效。
     - 数据库代理将按照权重设置分配读请求的流量，如，两个只读库的权重分别为10和20，那么他们的读请求流量将按照1:2的比例分配。
     - 权重仅为读请求权重，写请求会直接路由到主库，不参与权重的计算。如，客户端发送了10条写语句和10条读语句，主库和只读库的权重比为1:1，这时主库会收到10条写语句和5条读语句，只读库收到5条读语句。
     - 选择系统自动分配权重时，系统会根据实例的 CPU 和内存规格来自动分配权重，此时仅能设置主实例的权重。
     - 如果只读实例的权重为0，则数据库代理不会对该只读实例建连，如果只读实例的权重从0改为非0，权重无法立即生效，只能对新连接生效。
   - **故障转移**：设置是否开启，推荐开启，当只读实例异常时，数据库代理会将读请求发送至主实例。
>?故障转移配置后，仅对新连接生效。
   - **自动添加只读实例**：设置是否开启，开启后，若您购买新的只读实例，会自动添加到数据库代理中。
     - 当读权重为系统自动分配时，新购只读实例按照规格大小默认权重分配。
     - 当读权重为自定义时，新购只读实例默认加入时权重为0，可通过数据库代理读写分离的调整配置修改。
![](https://qcloudimg.tencent-cloud.cn/raw/b6d93f04d56f7c370922826cefef3b18.png)

## 页面展示
数据库代理读写分离功能开启后，您可在**读写分离**页查看基本信息和读写分离架构图，右侧按钮可重新调整配置和关闭读写分离功能。
![](https://qcloudimg.tencent-cloud.cn/raw/fe99549b574cb2e8ed5ce24c5c69c1cf.png)

## 关闭读写分离
1. 登录 [TDSQL-C MySQL 版控制台](https://console.cloud.tencent.com/cynosdb/mysql#/)。
2. 在上方选择地域，单击集群 ID 或**操作**列的**管理**，进入集群管理页。
3. 在集群管理页的**数据库代理**页，选择**读写分离**页，在右侧单击**关闭读写分离**。

