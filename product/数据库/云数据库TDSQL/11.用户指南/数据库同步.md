## 操作场景
数据库同步功能支持将多个云数据库 MariaDB 或分布式数据库 TDSQL 同步到目标数据库，可以实现在不停止数据库实例的情况下，完成数据库的同步工作。

**使用范围**
<table>
<thead>
<tr>
<th>源实例类型</th>
<th>目标实例类型</th>
</tr>
</thead>
<tbody><tr>
<td rowspan= "3">云数据库 MariaDB</td>
<td>云数据库 MariaDB</td>
</tr>
<tr>
<td>云数据库 PostgreSQL</td>
</tr>
<tr>
<td>消息队列 Ckafka</td>
</tr>
<tr>
<td>分布式数据库 TDSQL</td>
<td>消息队列 Ckafka</td>
</tr>
</tbody></table>

>!一个同步任务只能选择一个 topic，否则导致出错。

## 操作步骤
1. 登录 [云数据库 MariaDB 控制台](https://console.cloud.tencent.com/tdsql/synctask)。
2. 在左侧导航选择【数据库同步】页，单击【创建同步任务】进入创建页。
![](https://main.qcloudimg.com/raw/b0450a2fd6aec62db6d30c88c9d5e291.png)
3. 输入任务名称、设置源实例信息和目标实例信息，单击【下一步】。
>?目标实例类型为消息队列 Ckafka 时，需创建服务预设角色并授权数据传输相关权限。 
>
![](https://main.qcloudimg.com/raw/5f22cdf1a8aabddd9ee38fe26c4b3cc5.png)
4. 选择表名匹配模式，单击【下一步】。
 - 精确匹配：系统将以默认精确匹配方式在源、目的库中匹配表名。
 - 正在匹配：系统将以默认正则方式在源、目的库中匹配表名“完全相同”的表。
 - 输入匹配库：输入数据库名字，表名字。
5. 确认设置，单击【下一步】。 
>?
>- 为保证目标表中记录不重复，建议您对源表和目标表加上主键。
>- 主键存在时将会依赖主键进行更新，主键不存在时不依赖主键，此时表结构不一致时将会失败（表结构一致意味着表的列名、列类型、列顺序完全一致）。
>- 同步遇到错误时，同步进程将自动重试直到成功（后台不提供 DEBUG 信息）。
>- 目标表有额外记录时，将会以追加的形式同步数据到目标表。
>- 源表使用 DDL 语句，包括 ALTER、CREATE TABLE、DROP、RENAME 五种将同步到目标库。
>- 如果源表和目标表有相同的行记录（无论是否有主键），将会以源表数据优先覆盖目标表数据。
>- 请保持目标数据库表结构与来源数据库表结构一致（字段被修改、删除可能会导致同步错误）。
>- 使用 pt-online-schema-change 修改源表结构时，将会同步 DML 到目标表（如果是多个实例同步到一个实例，将可能导致数据丢失）。
>- 同步进程将不会开启排它锁（写锁），您可以对目标库进行写操作。
>- 如果是分布式数据库 TDSQL 订阅到 Ckafka 中时，由于存在分表、广播表时，正则匹配可能匹配到多张相同表，这是正常现象，因为同步工具会分别解析每个分片。
>
6. 效验同步任务，全部通过后可保存并启动数据库同步任务，否则需要返回修改数据库同步任务。 
![](https://main.qcloudimg.com/raw/ca1bde83613ebcfd0cfe8f8d3d68fdb8.png)
7. 返回数据库同步列表，可查看数据库同步任务进程。
![](https://main.qcloudimg.com/raw/85dcb059da27bf0bc34d27714884588a.png)
 
