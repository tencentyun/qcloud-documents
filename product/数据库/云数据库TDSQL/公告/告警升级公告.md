## 背景
云数据库 MariaDB 于2021年04月01日起，对主机以及组件服务监控项进行了升级，对旧的告警策略类型进行了替换，覆盖了数百监控项指标和告警指标，您可以在云监控 [MariaDB](https://cloud.tencent.com/document/product/248/54397) 策略类型下配置告警策略。

原 MariaDB（旧）策略类型后续将不再维护，后端也将逐步把您已配置的 MariaDB 策略类型将全部迁移至新的告警策略类型中。建议您自主将告警迁移至新告警策略类型中，可以提前体验到产品新告警功能。后续新增告警策略，请配置在 MariaDB 策略类型下。

#### 新旧策略类型对比
| 策略类型      | 指标覆盖                        | 支持与维护                              |
| ------------- | -------------------------- | ----------------------- |
| MariaDB（旧）   | 22个指标 | 可以继续使用，但不再维护更新，系统将逐步自动将您的实例平滑迁移至新告警类型中|
| MariaDB |37个指标       | 已于2021年04月01日上线，持续维护         |

>!
>- MariaDB 策略类型将覆盖原有 MariaDB（旧）策略的所有指标，详情可参考 [新旧指标对照表](#jump)。
>- 新增的告警策略，可以参考 [新增指标说明](#jump2)。

## 告警策略迁移说明
在 MariaDB（旧）策略类型下线时，系统会自动将原有的 MariaDB（旧）策略类型的告警策略后台迁移至新的 MariaDB 策略类型下。
>?可能存在部分用户无法通过系统自动迁移告警至新告警策略类型中。对于这一部分实例和用户，我们将通过站内信、邮件、短信等方式通知到您，届时请按照下文的手动迁移步骤手动迁移告警。

#### 手动迁移步骤
1. 梳理已有告警指标以及告警策略。
  1. 登录 [云监控控制台](https://console.cloud.tencent.com/monitor/alarm2/policy)，在左侧菜单栏选择【告警配置】>【告警策略】，单击【高级筛选】。
  2.  在弹出页面，在“策略类型”选择“MariaDB（旧）”对应的告警策略类型，查询对应类别下的告警策略，并下载原“MariaDB（旧）”策略类型下已配置的告警策略。
![](https://main.qcloudimg.com/raw/915aa69f6ef27fe2fda9bb289f1ff40d.png)
2. 配置新告警策略。
  1. 在 [告警策略](https://console.cloud.tencent.com/monitor/alarm2/policy) 页面，单击【新建】。
  2. 在新建告警策略页面，“策略类型”选择【MariaDB】，根据步骤1下载的策略进行告警配置，配置方法可参考 [配置告警](https://cloud.tencent.com/document/product/248/50398)。
3. 验证“MariaDB”告警策略是否启用并能成功触发告警。
在新建告警策略页面的“指标告警”设置一个最小触发阈值，选择设定【接收组或接收人】，以及选择接受渠道（邮件、短信、微信），达到测试验证效果。例如，CPU 利用率，统计周期一分钟，当阈值大于等于1%，持续1周期即触发告警，每一分钟告警一次。
4. 新策略类型验证完成后删除原 MariaDB（旧）策略类型下配置的告警策略。
在 [告警策略](https://console.cloud.tencent.com/monitor/alarm2/policy) 页面，筛选条件中按“策略类型”选择“MariaDB（旧）”对应的告警策略进行查询，对照步骤1中下载策略表，进行删除。
如果您在迁移中遇到问题，请及时 [提交工单](https://console.cloud.tencent.com/workorder/category) 进行处理。

## [新旧指标对照表](id:jump)
<table>
<thead><tr><th><strong>原有策略类型</strong></th><th><strong>指标/事件告警</strong></th><th><strong>原有指标/事件告警名称</strong></th><th><strong>新策略类型</strong></th><th><strong>新指标/事件名称</strong></th></tr></thead>
<tbody><tr>
<td rowspan="22">云数据库 - MariaDB（旧）</td>
<td>指标告警</td><td>CPU 使用率	</td>
<td>MariaDB - 实例汇总</td><td>CPU利用率		</tr>
<tr>
<td>指标告警</td><td>主备切换	</td>
<td>MariaDB - 实例汇总</td><td>主从切换次数		</tr>
<tr>
<td>指标告警</td><td>	可用磁盘空间	</td>
<td>MariaDB - 实例汇总</td><td>	可用数据磁盘空间		</tr>
<tr>
<td>指标告警</td><td>	日志磁盘空间	</td>
<td>MariaDB - 实例汇总</td><td>	最小剩余 Binlog 日志磁盘空间		</tr>
<tr>
<td>指标告警</td><td>	查询数（SELECT）	</td>
<td>MariaDB - 实例汇总</td><td>	汇总 SELETE 请求数		</tr>
<tr>
<td>指标告警</td><td>	慢查询数	</td>
<td>MariaDB - 实例汇总</td><td>	慢查询数		</tr>
<tr>
<td>指标告警</td><td>	更新数（UPDATE）	</td>
<td>MariaDB - 实例汇总</td><td>	UPDATE 请求数		</tr>
<tr>
<td>指标告警</td><td>	插入数（INSERT)	</td>
<td>MariaDB - 实例汇总</td><td>	INSERT 请求数		</tr>
<tr>
<td>指标告警</td><td>	删除数（DELETE）	</td>
<td>MariaDB - 实例汇总</td><td>	DELETE 请求数		</tr>
<tr>
<td>指标告警</td><td>	内存可用大小	</td>
<td>MariaDB - 实例汇总</td><td>	可用缓存空间		</tr>
<tr>
<td>指标告警</td><td>	磁盘 IOPS	</td>
<td>MariaDB - 实例汇总</td><td>	IO 利用率		</tr>
<tr>
<td>指标告警</td><td>	活跃连接数	</td>
<td>MariaDB - 实例汇总</td><td>	汇总活跃线程数		</tr>
<tr>
<td>指标告警</td><td>	连接使用率	</td>
<td>MariaDB - 实例汇总</td><td>	最大 DB 连接使用率		</tr>
<tr>
<td>指标告警</td><td>	磁盘使用率	</td>
<td>MariaDB - 实例汇总</td><td>	数据磁盘空间利用率		</tr>
<tr>
<td>指标告警</td><td>	查询覆盖数	</td>
<td>MariaDB - 实例汇总</td><td>	REPLACE_SELECT 请求数		</tr>
<tr>
<td>指标告警</td><td>	innodb 磁盘读页次数	</td>
<td>MariaDB - 实例汇总</td><td>	汇总 innodb 磁盘读页次数		</tr>
<tr>
<td>指标告警</td><td>	innodb 缓冲池读页次数	</td>
<td>MariaDB - 实例汇总</td><td>	汇总 innodb 缓冲池读页次数		</tr>
<tr>
<td>指标告警</td><td>	innodb 缓冲池预读页次数	</td>
<td>MariaDB - 实例汇总</td><td>	汇总 innodb 缓冲池预读页次数		</tr>
<tr>
<td>指标告警</td><td>	innodb 执行 DELETE 行数	</td>
<td>MariaDB - 实例汇总</td><td>	innodb 执行 DELETE 行数		</tr>
<tr>
<td>指标告警</td><td>	innodb 执行 INSERT 行数	</td>
<td>MariaDB - 实例汇总</td><td>	innodb 执行 INSERT 行数		</tr>
<tr>
<td>指标告警</td><td>	innodb 执行 UPDATE 行数	</td>
<td>MariaDB - 实例汇总</td><td>	innodb 执行 UPDATE 行数		</tr>
<tr>
<td>指标告警</td><td>	已用日志磁盘空间	</td>
<td>MariaDB - 实例汇总</td><td>	已用 Binlog 日志磁盘空间		</tr>
</tbody></table>

## [新增指标描述](id:jump2)
<table>
<thead><tr><th><strong>策略类型</strong></th><th><strong>指标/事件告警</strong></th><th><strong>指标/事件告警名称</strong></th></tr></thead>
<tbody><tr>
<td rowspan="30">云数据库 - MariaDB</td>
<td>指标告警</td><td>	汇总 innodb 执行 READ 行数		</td></tr>
<td>指标告警</td><td>	最小备延迟		</td></tr>
<td>指标告警</td><td>	缓存命中率		</td></tr>
<td>指标告警</td><td>	REPLACE 请求数		</td></tr>
<td>指标告警</td><td>	耗时小于5ms请求数		</td></tr>
<td>指标告警</td><td>	耗时5到20ms请求数		</td></tr>
<td>指标告警</td><td>	耗时20到30ms请求数		</td></tr>
<td>指标告警</td><td>	耗时30ms以上请求数		</td></tr>
<td>指标告警</td><td>	SQL 总数		</td></tr>
<td>指标告警</td><td>	SQL 错误数		</td></tr>
<td>指标告警</td><td>	SQL 成功数		</td></tr>
<td>指标告警</td><td>	客户端总连接数		</td></tr>
<td>指标告警</td><td>	汇总主备节点总请求数		</td></tr>
<td>指标告警</td><td>	汇总当前打开连接数		</td></tr>
<td>指标告警</td><td>	汇总最大连接数		</td></tr>
</tbody></table>
