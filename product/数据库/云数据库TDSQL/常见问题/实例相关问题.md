### MariaDB 能申请只读实例吗 ？
当前未提供只读实例购买；提供两种方案为用户解决读写分离问题： 
https://cloud.tencent.com/document/product/237/2081 
https://cloud.tencent.com/document/product/237/5645

### mariadb实例版本有哪些？
__标准版（一主一从）__ 
- 提供主从双活（两个节点，一个 Master 节点，一个 Slave 节点）部署的高可用架构；
- 支持从机只读；
- 故障后节点自动恢复；
- 默认监控采样粒度：5 分钟/次
- 最大可配备份时长：30 天
- 操作日志备份：60 天
- 支持数据库审计；审计日志存储 15 天；规则配置个数（暂无限制）；

__标准版（一主两从）__ 
- 提供主从多活（三个节点，一个 Master 节点，两个 Slave 节点）部署的高可用架构；
- 支持从机只读；
- 故障后节点自动恢复；
- 默认监控采样粒度：5 分钟/次
- 最大可配备份时长：30 天
- 操作日志备份：60 天
- 支持数据库审计：审计日志存储 15 天；规则配置个数（暂无限制）；

__金融定制版（一主一从）__ 
- 提供主从多活（两个节点，一个 Master 节点，一个 Slave 节点）部署的高可用架构；
- 支持围拢部署方案（需联系对应商务）；
- 支持从机只读，从机只读时智能负载；
- 故障后节点自动恢复；
- 默认监控采样粒度：1 分钟/次
- 最大可配备份时长：3650 天（提交工单）；
- 操作日志备份：默认 60 天；归档存储 1 年
- 支持数据库审计：审计日志存储 15 天；
- 监管配合：有；

__金融定制版（一主两从）__ 
- 提供主从多活（三个节点，一个 Master 节点，两个 Slave 节点）部署的高可用架构；
- 支持围拢部署方案（需联系对应商务）；
- 支持从机只读，从机只读时智能负载；
- 故障后节点自动恢复；
- 默认监控采样粒度：1 分钟/次
- 最大可配备份时长：3650 天（提交工单）；
- 操作日志备份：默认 60 天；归档存储 1 年
- 支持数据库审计：审计日志存储 15 天；
- 监管配合：有；

### mariadb数据库实例如何升级？
__云数据库CDB for MariaDB(TDSQL)实例升级__ 
实例升级操作指将现有TDSQL实例的规格升级到更高规格，升级过程中会发生1次秒级闪断，建议您在业务低峰期升级。
- 升级过程不能中断
- 管理中心暂不支持降级操作，如有需要请提工单
1、 在“管理中心>云数据库>TDSQL”中选择选择相应的实例，点击“升级”，弹出升级弹窗
2、 根据需要选择目标规格，并支付响应费用，成功后系统将自动升级实例规格
升级界面如下：
![图片描述](//bot1024-1253841380.file.myqcloud.com/ff43af72c51e11e79dff5254000ab150.png)
升级费用=（目标规格单价-原规格单价）x剩余到期时间

 __分布式云数据库DCDB for TDSQL实例升级__ 
实例升级操作指将现有TDSQL实例的规格升级到更高规格，然而因分布式数据库是由多个分片组成，因此其实例升级有“新增分片，升级分片”两种方案，升级过程中服务不会终止，但某些分片会发生若干秒的只读现象，建议您在低峰期进行升级。详见“自动再均衡”

 __新增分片__ 
进入管理中心>分布式云数据库，点击“新增分片”按钮，通过弹出选择新增分片的规格和数量，即可升级。
进入管理中心>分布式云数据库，点击“新增分片”按钮，通过弹出选择新增分片的规格和数量，即可升级。
![图片描述](//bot1024-1253841380.file.myqcloud.com/23409390c51f11e79ca95254000ab150.png)

![图片描述](//bot1024-1253841380.file.myqcloud.com/29817828c51f11e7acc85254000ab150.png)

 __升级分片__ 
升级分片指不增加分片数量，但将单个分片的规格升级到更大。 当前版本暂不支持该能力，计划后续支持。
1、 进入管理中心>分布式云数据库，点击“管理”按钮，进入管理页面，选择分片管理，点击需要升级的分片，即可升级。
![图片描述](//bot1024-1253841380.file.myqcloud.com/38ad1dacc51f11e7acc85254000ab150.png)

![图片描述](//bot1024-1253841380.file.myqcloud.com/3ff2033ec51f11e7acc85254000ab150.png)

### 如何创建MariaDB(TDSQL) 数据库实例？
1.登录 腾讯云 管理控制台 并通过以下网址打开 控制台：https://console.cloud.tencent.com/tdsql

2.在 管控控制台 的右上角，点击新建实例；或直接打开售卖页面https://buy.cloud.tencent.com/tdsql
![图片描述](//bot1024-1253841380.file.myqcloud.com/ffc0c2e2c52211e79dff5254000ab150.png)

3.在购买页面上，根据需求指定数据库实例信息，点击【立即购买】；
购买时，注意以下设置：
- 计费模式：包年包月，即需要预先支付费用方可使用。
- 地域：实例实际部署的地域；建议您于需要对接的云服务器保持一致，以便延迟最低。
- 可用区：在同一地域内电力和网络互相独立的物理数据中心；建议您于需要对接的云服务器保持一致，以便延迟最低。
- 网络类型：实例所处的网络，一旦网络选定就不能轻易改变；建议您于需要对接的云服务器保持一致，以便延迟最低。
- 实例版本：请根据需要选择您期望的 [实例版本](https://cloud.tencent.com/document/product/237/6918) ；通常来讲，备机越多，可用性越高。
- 数据库版本：MariaDB(TDSQL)的数据库内核版本，由于 [10.0.10](https://mariadb.com/kb/en/library/mariadb-10010-changelog/) 与 [10.1.9](https://mariadb.com/kb/en/mariadb/mariadb-1019-changelog/) 之间存在功能差异，详见 [MariaDB官方版说明](https://mariadb.com/kb/en/mariadb/mariadb-1019-changelog/) 。
- 实例规格：实例规格代表不同的性能水平和价格基数,详见[产品价格]（https://cloud.tencent.com/document/product/237/2034）。
- 硬盘：硬盘默认采用SSD盘（本地盘），更多硬盘种类敬请期待。
- 指定项目：如果您期望不同您的不同团队管理不同数据库，请指定到不同团队所处的项目中。
- 购买数量：指一次性可购买的实例个数，为避免误操作，我们设置了一次购买上限，如果您期望购买更多台数，请多次购买。
- 购买时长：由于采用包年包月的售卖模式，您需要预估您数据库期望使用时长；目前腾讯云官网提供时间越长，费用越低的运营活动。
![图片描述](//bot1024-1253841380.file.myqcloud.com/1bf3568cc52311e79dff5254000ab150.png)
购买后将跳转到支付页面，支付完成后即可在腾讯云控制台TDSQL实例列表页查看到刚购买的实例。

### 如何将数据导入到MariaDB实例？
您可以通过腾讯云数据库迁移工具将业务数据迁移到CDB for MariaDB（TDSQL）中，迁移工具可以把同地域下不同类型的源数据库的数据迁移到MariaDB（TDSQL）中，目前支持的源库类型有：
1. 源数据库来自在腾讯云基础网络中云服务自建的MySQL实例（即将支持 [VPC网络](https://cloud.tencent.com/document/product/215/535) ）；
2. 源数据库在腾讯云的CDB for MySQL实例；
3. 源数据库在另外一个CDB for MariaDB（TDSQL）实例；
迁移步骤如下：
 __1.1. 进入迁移工具页面__ 
![图片描述](//bot1024-1253841380.file.myqcloud.com/51c5346ac53c11e7b75a5254000ab150.png)

 __1.2. 创建迁移任务__ 
![图片描述](//bot1024-1253841380.file.myqcloud.com/861ab0c8c53c11e7acc85254000ab150.png)
点击创建迁移任务，输入任务名称、源库和目标MariaDB（TDSQL）的信息。
![图片描述](//bot1024-1253841380.file.myqcloud.com/92a098e4c53c11e79dff5254000ab150.png)
然后选择要迁移的数据库，创建并检查迁移任务信息。
![图片描述](//bot1024-1253841380.file.myqcloud.com/9d3de130c53c11e79dff5254000ab150.png)
数据迁移：将选中数据库中的数据导出，然后在MariaDB（TDSQL）中导入。
增量同步：在进行数据导出导入后，设置MariaDB（TDSQL）为源库的备库，进行主备增量同步。

 __1.3. 校验迁移任务信息__ 
在创建完迁移任务后，您需要对迁移任务信息进行校验，只有所有校验项通过后才能启动迁移任务。任务校验存在3种状态：
- 通过：表示校验完全通过
- 警告：表示校验不通过，迁移过程中或迁移后可能影响数据库正常运行但不影响迁移任务的执行。
- 失败：表示校验不通过，无法进行迁移。如果校验失败，请根据出错的校验项，检查并修改迁移任务信息，然后重试校验。失败原因请参考：“校验失败说明”
![图片描述](//bot1024-1253841380.file.myqcloud.com/aed914aac53c11e78cea5254000ab150.png)

 __1.4. 启动迁移__ 
在校验通过后，您可以启动迁移任务，如果您设定了迁移任务的定时时间，则迁移任务会在设定的时间开始排队并执行，如果没有设置定时任务，则迁移任务会立即执行。
迁移启动后，您可以在迁移任务下看到对应的迁移进度信息。
![图片描述](//bot1024-1253841380.file.myqcloud.com/bd88471ec53c11e79dff5254000ab150.png)
注：由于系统设计限制，一次性提交或排队多个迁移任务将按排队时间串行执行。

 __1.5. 增量同步__ 
如果您在创建迁移任务时选择了增量同步选项，那么数据迁移完成后，我们会把目标MariaDB（TDSQL）库设置成源数据库的备库，通过主备同步来把迁移过程中源库的新增的数据同步到目标MariaDB（TDSQL）库中。此时，源库上的修改都会同步到目标MariaDB（TDSQL）中，你可以把业务切换到目标MariaDB（TDSQL）上，然后点击完成迁移。
点击完成迁移后，主备同步关系会断开。

 __1.6. 中止迁移__ 
在迁移过程中，如果您需要停止迁移，可以点击中止按钮进行中止。
![图片描述](//bot1024-1253841380.file.myqcloud.com/d7e7ef10c53c11e7acc85254000ab150.png)
注意：再次启动可能导致校验失败或任务失败，您可能需要手动清空目标库内的数据，才能再次启动迁移任务。

 __2.通过第三方工具迁入__ 
如果您的源库不在腾讯云上或者在VPC网络环境内，那么您可以通过第三方工具来先把源库的数据导出，然后上传到腾讯云服务器上，再把数据导入到MariaDB（TDSQL）。
常见的导入导出工具有：mysqldump、mydumper、MySQL GUI Tools等。

### mariadb数据库实例类型有哪些？
目前云数据库存在以下实例类型：
- 主实例：直接申请购买的实例，拥有云数据库的全部功能。
- 主实例（独享）：独享集群数据库模式下，在独享集群内申请的数据库实例，拥有云数据库的全部功能。
- 灾备实例：部署在异地（不同可用区）与主实例实时（异步）同步数据的实例，通常用于数据库容灾，仅拥有部分功能。
- 临时实例：由回档功能生成的临时存在的实例，用于回档后数据校验，可通过切换为主实例功能，将校验后的临时实例恢复为主实例。

### 如何自助升级mariadb云数据库实例规格？
登录云数据库的管理控制台后，可通过“升级”操作升级指定实例的实例规格。
![图片描述](//bot1024-1253841380.file.myqcloud.com/154ddb2cc5e111e79d355254000ab150.png)

### 如何重命名mariadb数据库实例？
您可以使用管理中心控制台重命名数据库实例，在重命名数据库时，您需要知道以下注意事项：
- 修改数据库实例名称，不会改变数据库的内网IP，也不会影响数据库连接。
- 重命名实例时，不能使用现有的数据库实例名称。
- 重命名后，数据库实例所属项目和所属网络将保持不变。
- 在实例处于其他任务流程中(例如：升级中、初始化中 等)将无法重命名实例。


### 如何将mariadb数据库实例还原至指定时间？
用户可以使用控制台回档功能对腾讯云平台中的数据库或表进行回档操作，回档是基于冷备+binlog，可进行实时数据回档。
云数据库回档功能通过定期镜像和实时流水重建到临时实例，回档能力为回档到指定时间（精确到秒），且可以保证所有数据的时间切片一致，期间原有数据库或表的访问不受影响。

### mariadb数据库如何自建只读实例？
关于如何自建只读实例，您可以参考 [文档](https://cloud.tencent.com/document/product/237/5645#1.1-.E6.A6.82.E8.BF.B02) 。

### mariadb如何重命名数据库实例？
您可以使用管理中心控制台重命名数据库实例，在重命名数据库时，您需要知道以下注意事项：
- 修改数据库实例名称，不会改变数据库的内网IP，也不会影响数据库连接。
- 重命名实例时，不能使用现有的数据库实例名称。
- 重命名后，数据库实例所属项目和所属网络将保持不变。
- 在实例处于其他任务流程中(例如：升级中、初始化中 等)将无法重命名实例。

### mariadb数据库如何为实例指定项目？
腾讯云云数据库支持将实例分配至不同的项目进行管理。
 __项目：是腾讯云为您的团队定义的一种资源划分方式，简单来说，您可以根据您的组织架构，为不同的团队分配不同的资源，而这样的划分方式在腾讯云中称为项目。__ 
需要注意的几点特性是：
- 只读实例、灾备实例属于主实例的关联实例，需要与主实例处于同一项目中。
- 数据库实例在项目间进行分配和移动，不会影响实例对外提供的服务。
- 用户须在新购实例时为实例指定所属的项目，缺省为【默认项目】。
- 已指定项目的实例可通过【分配至项目】功能重新指定到其他项目。

### mariadb数据库如何实现读写分离？
1、基于只读帐号的读写分离
只读帐号是一类仅有读权限的账户，其默认从数据库集群中的从机（或只读实例）中读取数据。TDSQL可以在【帐号管理】功能中，设置只读帐号和读策略，如下图：
![图片描述](//bot1024-1253841380.file.myqcloud.com/e37c4450c5e311e7bce45254000ab150.png)
在只读帐号设置选项中，您可以设置“只读请求分配策略”，定义在备机故障（或延迟较大）时的读策略。“只读备机延迟参数”，定义数据同步延迟时间，并与“只读请求分配策略”配合使用,如下图
![图片描述](//bot1024-1253841380.file.myqcloud.com/f16c06b8c5e311e7b75a5254000ab150.png)
配置建议：
假设您设计的是某交易系统
- 核心交易模块：设置常规帐号，可读写。
- 余额查询模块：设置只读帐号，默认读备机；请求分配策略：备机故障读主机，并将延迟参数设置在10秒内；以保证主从性能和用户查询的数据一致性。
- 批量查询模块：设置只读帐号，默认读备机；请求分配策略：备机故障报错，延迟参数可设置在30秒以上；以保证不影响主库性能。
另外，由于强同步机制是将数据写入从机事务日志后，即返回应答，这时从机库表数据可能并未更新，因此也会有延迟。

2、基于注释的读写分离
在每条需要从机“读”的SQL前，增加/slave/字段，并且mysql后面要增加-c 参数来解析注释mysql -c -e "/*slave*/sql"，即可自动将读请求分配到从机，示例如下：
``` 
//主机读//
select * from emp order by sal，deptno desc；
//从机读//
/*slave*/ select * from emp order by sal，deptno desc；
``` 

注意事项：
- 该功能仅支持从机读（select），不支持其他操作，非select语句将失败；
- mysql后面要增加-c 参数来解析注释
- /*slave*/必须为小写，语句前后无空格；
- 从机出现异常而影响到MAR（强同步）机制时，从机读操作将自动切换回主机。

### mariadb数据库如何自建自读实例？
关于mariadb数据库如何自建自读实例，您可以参考 [以下](https://cloud.tencent.com/document/product/237/8636#1.-.E6.A6.82.E8.BF.B0)  。

### 如何利用备份文件恢复mariadb数据库实例？
MariaDB(TDSQL)可以通过回档功能来查看历史数据，如果您需要在自己的机器上进行恢复，可以按照 [本文档](https://cloud.tencent.com/document/product/237/4190#1.E3.80.81.E5.87.86.E5.A4.87.E6.81.A2.E5.A4.8D.E6.89.80.E9.9C.80.E7.8E.AF.E5.A2.831) 的步骤进行操作恢复历史数据。
