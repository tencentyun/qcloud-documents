本文为您介绍通过跨可用区部署实例和异地搭建灾备实例实现两地三中心架构建设。

## 两地三中心部署架构
![](https://qcloudimg.tencent-cloud.cn/raw/33b7986db2cd0396b797b7cbfe36d7e7.png)
- 同城双中心：
地域 A 三区和地域 A 五区组成同城双中心，地域 A 三区宕机后可切换到地域 A 五区，以保护数据库。
- 两地：
地域 A 和地域 B 组成两地，即使在地域 A 的三区、五区的机房全部宕机后，业务也可切换到地域 B 的机房。

## 跨可用区部署
云数据库 MySQL 支持跨可用区部署，相比单可用区，多可用区部署方式具备更高的容灾能力，可以保护数据库，以防数据库实例发生故障或可用区中断，可以抵御机房级别的故障。

云数据库 MySQL 多可用区部署为数据库实例提供高可用性和故障转移支持。多可用区是在单可用区的级别上，将同一地域的多个单可用区组合成的物理区域。
![](https://qcloudimg.tencent-cloud.cn/raw/ebd1ca6fbdd49517cf726e87b3ddbeac.png)

### 前提条件
- 实例状态为运行中。
- 实例所在的地域需要包含两个及以上的可用区。
- 部署的可用区拥有足够计算资源。

### 支持的地域和可用区
云数据库 MySQL 多可用区部署目前支持广州、深圳金融、上海、上海金融、南京、北京、成都、中国香港、新加坡、雅加达、曼谷、孟买、首尔、东京、弗吉尼亚、法兰克福地区。对应城市支持的主备可用区可选范围以 [云数据库 MySQL 购买页](https://buy.cloud.tencent.com/cdb) 的主备可用区展示为准。
- 此功能会逐渐扩充支持地域和可用区。
- 如因业务需要，您可 [提交工单](https://console.cloud.tencent.com/workorder/category) 申请其他地域和可用区部署。

### 费用说明
本功能免费。实例从单可用区迁移至多个可用区，也不收取费用。

## 异地灾备实例
针对业务连续服务和数据可靠性有强需求或是监管需要的场景，云数据库 MySQL 提供跨地域灾备实例，帮助用户以较低的成本提升业务连续服务的能力，同时提升数据的可靠性。
异地灾备实例提供独立的数据库连接地址，灾备实例可提供读访问能力，用于就近接入、数据分析等场景，设备冗余成本低，且使用主备高可用架构，避免了数据库的单点风险。
![](https://qcloudimg.tencent-cloud.cn/raw/1e3d60d21ad53f40c2d523cf28cc4d21.png)

### 费用说明
灾备实例费用与主实例相同。

## 为云数据库 MySQL 实例建设两地三中心架构
### 步骤1：设置跨可用区部署
#### 购买实例时，为实例选择跨可用区部署
1. 登录 [MySQL 控制台](https://console.cloud.tencent.com/cdb/)，在实例列表，单击**新建**，进入购买页。
2. 在购买页，选择对应支持地域后，在**备可用区**选项，选择与主可用区不同区的备可用区。
>?主备机处于不同可用区，可能会增加2~3ms的同步网络延迟
>
![](https://qcloudimg.tencent-cloud.cn/raw/2dd1345ee9402c41da44959f51c452a8.png)
3. 确认无误后，单击**立即购买**，完成付款后，可在**实例详情页 > 可用性信息**查看该实例的主备可用区。

#### 已创建实例，单可用区变更为多可用区
1. 登录 [MySQL 控制台](https://console.cloud.tencent.com/cdb/)。
2. 在实例列表，单击需变更可用区的实例 ID 或**操作**列的**管理**，进入实例详情页。
3. 在实例详情页的**可用性信息 > 部署方式**下，单击**变更可用区**。
![](https://qcloudimg.tencent-cloud.cn/raw/c9b21a53d541f39234bdba04b0a4668e.png)
4. 在弹出的对话框，选择多可用区部署为**是**，选择备库可用区，单击**提交**。
![](https://qcloudimg.tencent-cloud.cn/raw/1e3e252d8f821e361fc0e736ef1fad09.png)

### 步骤2：设置异地灾备实例
>?仅支持1GB内存、50GB硬盘及以上规格，且 MySQL 5.6 及以上版本、InnoDB 引擎的高可用版主实例购买灾备实例，若主实例低于此规格，请先升级主实例规格。且主实例须已开启 GTID 功能。

#### 2.1 创建灾备实例
1. 登录 [MySQL 控制台](https://console.cloud.tencent.com/cdb/)，在实例列表，单击实例 ID 或**操作**列的**管理**，进入详情页。
2. 在实例详情页的基本信息中确认 GTID 功能开启，在实例架构图中单击**添加灾备实例**，进入灾备实例购买页。
![](https://main.qcloudimg.com/raw/d41ae3d97935763b180f2e8a26cb2364.png)
3. 在购买页中，设置灾备实例的计费模式、地域、同步策略等基本信息。
 - 同步策略为**立即同步**时，创建完灾备实例会立即同步数据。
 - 同步策略为**创建后同步**时，灾备实例创建成功后，需对灾备同步链接进行配置，详细操作参见下文 [创建同步链接](#cjtblj)。
>?
>- 创建时长受数据量的影响，期间主实例的控制台操作会被锁定，请妥善安排。
>- 目前只支持整个实例数据同步，请确保磁盘空间充足。
>- 请确保主实例状态为运行中并且没有任何运行相关变更任务执行，如升降配、重启等，否则同步任务有可能失败。  
4. 确认无误后，单击**立即购买**，待灾备实例发货。
5. 返回实例列表，待实例状态变为**运行中**，即可进行后续操作。

#### [2.2 创建同步链接（可选）](id:cjtblj)
>?如果您在购买时选择的**同步策略**为**创建后同步**，则在灾备实例创建成功后，需对灾备同步链接进行配置，可实现异地灾备。

1. 在主实例的实例详情页中，可查看灾备实例的同步状态，单击**创建同步任务**，为灾备实例创建与主实例的内网同步链路。
![](https://main.qcloudimg.com/raw/f2f941ccf588d54cb2687cc0a9d0a961.png)
2. 填写任务名称，确认源库信息和目标库信息，单击**保存并下一步**。
![](https://main.qcloudimg.com/raw/5a2b3ef40de69af903cc60396d8f1a84.png)
3. 选择需要同步的对象，支持同步整个实例或仅同步部分库表。目前暂不支持同步类型的选择。
![](https://main.qcloudimg.com/raw/ac3f2db7c68f708ac07bb597a420ae83.png)
4. 单击**保存并校验**后进入**校验任务**，校验成功后单击**启动任务**，即可在 MySQL 的**灾备同步**页面中查看任务详情。
![](https://main.qcloudimg.com/raw/4cc319646447bb20a5a76982a0783a49.png)

## 查看两地三中心架构
配置完成后数据库部署方式呈现如下两地三中心的架构：
![](https://qcloudimg.tencent-cloud.cn/raw/fea82123c3762337a9e3c06ab97cc429.png)
