云数据库 MySQL 将于2021年12月28日起，上线迁移可用区功能。该功能将实现业务的就近访问、资源扩容，实现地域下不同可用区资源更充分的利用。
您可以将云数据库 MySQL 实例迁移至同一地域内的其它可用区。迁移可用区后，实例的所有属性、配置和连接地址都不会改变。迁移所需时间跟实例的数据量有关。
例如：
- 假设您正在尝试修改实例的实例类型，但我们无法在当前可用区中启动新实例类型的实例。在这种情况下，您可以将实例迁移到我们能够在其中启动该实例类型的实例的可用区，
- 若当前的可用区已无资源进行扩容的情况下，您也可以将实例迁移至同地域内其他资源充足的可用区，以满足业务需要。

## 前提条件
- 实例状态为运行中。
- 实例所在的地域需要有多个可用区，才支持迁移可用区功能。

## 费用
本功能免费。即使将实例从单可用区迁移至多个可用区，也不收取费用。
## 功能说明
- 切换时实例可用区会受到短暂影响，请确保应用具有自动重连机制。
- 迁移可用区不会造成虚拟IP（VIP）的变更。
- 迁移可用区主实例与RO没有解藕，迁移后的主实例，依然能够同跨地域RO进行同步。
- RO实例可以选择可用区。
- RO实例不支持跨地域迁移。
- 迁移切换时不能通过RO组访问（剔除）。
- 如果目标实例在dts过程中在云平台有任务锁，无法进行跨区迁移
- 如果有正在执行的DTS任务，可用区迁移后，需要重启相应的DTS任务。
- 如果主实例在导出dumper过程中经历跨区迁移切换，DTS导出会失败。
- 双节点、三节点架构下迁移可用区，主备可用区的选择受地域及区域剩余资源限制，在控制台迁移时选择目标可用区，备可用区选项会自动更新。

## 迁移类型

| 迁移类型 | 场景 | 支持类型 |
|---------|---------|---------|
| 从一个可用区迁移至另一个可用区 |实例所在可用区出现满负载或者其它影响实例性能的情况。 |主实例、RO实例、灾备实例 |
| 从一个可用区迁移至多个可用区 | 提高实例的容灾能力，实现跨机房容灾。主备实例分别位于不同的可用区。相对于单可用区实例，多可用区实例可以承受更高级别的灾难。例如，单可用区实例可以承受服务器和机架级别的故障，而多可用区实例可以承受机房级别的故障。 |主实例、RO实例、灾备实例 |
| 从多个可用区迁移至一个可用区 | 为了满足特定功能的要求。 | 主实例、RO实例、灾备实例 |

## 操作步骤
1. 登录 [MySQL 控制台](https://console.cloud.tencent.com/cdb)，在实例列表，单击**实例 ID** 或操作列的**管理**，进入实例详情页面。
2. 在**实例详情页**>**基本信息项**>**地域/可用区**后单击**迁移可用区**，或者在**实例详情页**>**可用性信息**>**部署方式**后单击**变更可用区**。
![](https://qcloudimg.tencent-cloud.cn/raw/1a6ac85b1fa612e9b43ab60178e35d7f.png)
3. 弹出迁移实例设置窗口，确认您要迁移的实例信息，**目标可用区**下拉键可进行主可用区变更，选择**多可用区部署**为“是”，可修改备可用区。
4. 设置**数据校验延迟阈值**（主可用区变更时此设置才会出现）,阈值为：1 ~ 10秒 的整数。
>!数据一致性校验过程中可能产生延迟，需设置数据延迟阈值，当延迟超过设定值时，数据库一致性校验会暂停，直到恢复至指定阈值以下后会继续进行数据库一致性校验任务。该阈值设置较小时，有可能会导致迁移时间过长。
5. 选择**切换时间**。可选择维护时间内或迁移完成时进行切换，详细请参见 [设置实例维护时间](https://cloud.tencent.com/document/product/236/10929)。
6. 确认无误后，单击**提交**。
![](https://qcloudimg.tencent-cloud.cn/raw/2bdcef89a01d8c412a46d2fb1427931a.png)
