云数据库 MySQL 支持手动扩展当前实例的 CPU 上限，也可以根据设定的 CPU 平均使用率阈值和观测周期进行自动扩缩容，能更好的缓解突发请求带来的性能压力，适配业务高峰流量，保障线上业务稳定性。本文为您介绍性能弹性管理功能。
 >?性能弹性功能目前已在灰度中。
## 前提条件
- 实例架构为云数据库 MySQL 通用型双节点、三节点版或单节点本地盘（只读实例）。
- 计算规格不可超过32核。
- 腾讯云账户内需要有足够的余额支撑扩容。

## 功能流程说明
![](https://qcloudimg.tencent-cloud.cn/raw/12405a966d14ed58cdf5eea71b093a22.png)

## 计费公式
性能弹性管理功能采用按量计费，每小时扣费一次。
**计费公式 =（单核费用 x 增加的 CPU 核数）x 扩容时长（小时）**
**示例**
广州地域下某双节点实例的 CPU 规格为4核，触发性能自动扩容后增加至8核，扩容时间为1小时，广州地域的单价为0.54元/核/小时，则计费为：0.54（单价） x 4（额外增加的 CPU 核数） x 1（小时数） = 2.16元。
## 单核计费单价
<dx-tabs>
::: 单节点本地盘（只读实例）
| 地域 | 单价（元/核/小时） |
|---------|---------|
| 成都、重庆 | 0.205 |
| 广州、上海、北京 | 0.27 |
| 香港、东京、首尔、孟买 | 0.315 |
| 法兰克福、圣保罗 | 0.25 |
| 新加坡、雅加达、多伦多| 0.415 |
| 深圳金融、上海金融、北京金融 | 0.405 |
:::
::: 双节点实例
| 地域 | 单价（元/核/小时） |
|---------|---------|
| 成都、重庆 | 0.41 |
| 广州、上海、北京 | 0.54 |
| 香港、东京、首尔、孟买 | 0.63 |
| 法兰克福、圣保罗 | 0.5 |
| 新加坡、雅加达、多伦多| 0.83 |
| 深圳金融、上海金融、北京金融 | 0.81 |
:::
::: 三节点实例
| 地域 | 单价（元/核/小时） |
|---------|---------|
| 成都、重庆 | 0.615 |
| 广州、上海、北京 | 0.81 |
| 香港、东京、首尔、孟买 | 0.945 |
| 法兰克福、圣保罗 | 0.75 |
| 新加坡、雅加达、多伦多| 1.245 |
| 深圳金融、上海金融、北京金融 | 1.215 |
:::
</dx-tabs>

## 功能影响说明
自动扩容会在主库以及备库上同时进行。如果主库扩容后触发了主备切换，那么备库依然为扩容后的 CPU 资源，在满足缩容触发条件时，系统会自动回缩至原始计算规格。
## 自动扩容
开启**性能弹性管理** > **自动扩容**后，当观测窗口内数据库实例的 CPU 平均利用率达到设定的阈值时，在原始计算规格的基础上，系统会将 CPU 核数提升2倍。例如原始计算规格的 CPU 核数为4核，则会提升至8核，同时，实例的 IOPS 会同步上升，CPU 核数每提升1核，IOPS 增加1000。若主机中没有足够的 CPU 资源，则扩容不会进行，随即发送扩容失败事件。
>?仅支持在原始计算规格的基础上将 CPU 核数提升2倍，无法在提升后的 CPU 核数上继续提升。例如提升后的 CPU 核数为8核，此时无法再提升至16核。
## 自动缩容
开启**性能弹性管理** > **自动扩容**后，在设定的自动缩容观测窗口期间内，CPU 利用率低于设定的阈值时，系统会自动将 CPU 核数以及 IOPS 回缩至原始计算规格。
>?开启**性能弹性管理** > **自动扩容**功能后，系统会以最新的配置参数为准，对数据库实例进行监控，当数据库实例满足自动回缩条件时，系统会对数据库实例进行自动回缩。

## 开启自动扩容
1. 登录 [MySQL 控制台](https://console.cloud.tencent.com/cdb/instance)，在实例列表，单击实例 ID 或操作列的**管理**，进入实例详情页。
2. 在**实例详情** > **配置信息** > **性能弹性管理**后，单击**配置**。
![](https://qcloudimg.tencent-cloud.cn/raw/fe7dd3943f092b1de7fc9e202cf4f5b2.png)
3. 在性能弹性管理窗口下，完成如下配置，确认扩容费用，单击**立即扩容**。
![](https://qcloudimg.tencent-cloud.cn/raw/adbda640baae1c94129e7f5d550e5dd9.png)
<table>
<thead><tr><th>参数</th><th>说明</th></tr></thead>
<tbody>
<tr>
<td>性能扩容类型</td><td>选择自动扩容。</td></tr>
<tr>
<td>CPU 自动弹性扩容阈值</td><td>设置 CPU 平均利用率触发自动弹性扩容的阈值，系统支持选项为70%、80%、90%。</td></tr>
<tr>
<td>观测周期</td><td>设置观测周期，系统支持选项为1分钟、3分钟、5分钟、10分钟、15分钟、30分钟，表示指定时间周期内，系统会观测实例的 CPU 平均利用率是否达到设置的扩容阈值，如达到，则会触发系统自动弹性扩容。</td></tr>
<tr>
<td>CPU 自动弹性回缩阈值</td><td>设置 CPU 平均利用率触发自动弹性回缩的阈值，系统支持选项为30%、20%、10%。</td></tr>
<tr>
<td>观测周期</td><td>设置观测周期，系统支持选项为5分钟、10分钟、15分钟、30分钟，表示指定时间周期内，系统会观测实例的 CPU 平均利用率是否达到设置的回缩阈值，如达到，则会触发系统自动弹性缩容。</td></tr>
</tbody></table>
4. 待实例状态/任务从**配置弹性扩容策略中**变为**运行中**，即成功开启自动扩容。
>?开启自动扩容后，如需修改性能弹性扩容策略，您可在**实例详情** > **配置信息** > **性能弹性管理**后单击**修改**，进行重新配置。
>

## 关闭自动扩容
>?关闭自动扩容后，已扩容的 CPU 会立即回缩，回缩后不再根据扩容阈值进行扩容。
>
1. 登录 [MySQL 控制台](https://console.cloud.tencent.com/cdb/instance)，在实例列表，单击实例 ID 或操作列的**管理**，进入实例详情页。
2. 在**实例详情** > **配置信息** > **性能弹性管理**后单击**关闭**。
3. 在**结束扩容 CPU** 的弹窗中单击**确定**。
![](https://qcloudimg.tencent-cloud.cn/raw/15a7839d8c564458d06b96ecedf8cf0e.png)

## 开启手动扩容
1. 登录 [MySQL 控制台](https://console.cloud.tencent.com/cdb/instance)，在实例列表，单击实例 ID 或操作列的**管理**，进入实例详情页。
2. 在**实例详情** > **配置信息** > **性能弹性管理**后，单击**配置**。
![](https://qcloudimg.tencent-cloud.cn/raw/e0c2e1fc2aac4aee66c0bba51c1d78be.png)
3. 在性能弹性管理窗口下，完成如下配置，确认扩容费用，单击**立即扩容**。
![](https://qcloudimg.tencent-cloud.cn/raw/2d598eac0ec223756d1b5162124f7748.png)
<table>
<thead><tr><th>参数</th><th>说明</th></tr></thead>
<tbody>
<tr>
<td>性能扩容类型</td><td>选择手动扩容。</td></tr>
<tr>
<td>额外增加 CPU 核数</td><td>设置手动额外增加的 CPU 核数，上限为当前规格 CPU 核数，如8核16G最大额外 CPU 核数为8。</td></tr>
<tr>
<td>额外增加 IOPS</td><td>CPU 核数每提升1核，IOPS 同步增加1000。</td></tr>
</tbody></table>
4. 待实例状态/任务从**配置弹性扩容策略中**变为**运行中**，即成功开启手动扩容。
>?
>- 手动扩容开启后，实例 CPU 会根据额外增加的 CPU 核数立即扩容，在**配置信息** > **配置**后可看到当前实例的 CPU。
>手动扩容前：
>![](https://qcloudimg.tencent-cloud.cn/raw/5f5764d86ddacc8485e8a795df71377f.png)
>手动扩容后：
>![](https://qcloudimg.tencent-cloud.cn/raw/e98f9d8091a32757b449a9612e4d3149.png)
>- 开启手动扩容后，如需修改额外增加 CPU 核数，您可在**实例详情** > **配置信息** > **性能弹性管理**后单击**修改**，进行重新配置。
>![](https://qcloudimg.tencent-cloud.cn/raw/364f3ab90efad01af195dd554472a1a8.png)

## 关闭手动扩容
>?关闭手动扩容后，已扩容的 CPU 会立即回缩到实例扩容前的 CPU。
>
1. 登录 [MySQL 控制台](https://console.cloud.tencent.com/cdb/instance)，在实例列表，单击实例 ID 或操作列的**管理**，进入实例详情页。
2. 在**实例详情** > **配置信息** > **性能弹性管理**后单击**关闭**。
3. 在**结束扩容 CPU** 的弹窗中单击**确定**。
![](https://qcloudimg.tencent-cloud.cn/raw/5ed85e3879ac7908019ded6b66592b4e.png)
