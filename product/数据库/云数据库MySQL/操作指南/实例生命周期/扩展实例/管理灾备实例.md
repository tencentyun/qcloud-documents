
## 操作场景
针对业务连续服务和数据可靠性有强需求或是监管需要的场景，TencentDB 提供灾备实例，帮助用户以较低的成本提升业务连续服务的能力，同时提升数据的可靠性。

## 功能特点
* 提供独立的数据库连接地址，灾备实例可提供读访问能力，用于就近接入、数据分析等场景，设备冗余成本低。
* 使用主备高可用架构，避免了数据库的单点风险。
* 按小时计费，即开即用，即停即止。同时支持阶梯价，使用越久越优惠。
* **灾备实例通过内网专线同步，具有较低的同步时延和更高的稳定性，同步链路质量远优于公网网络。**
* 目前推广期专线费用免费，商业化收费时间将另行通知。


## 工作原理
* 腾讯云数据库用做灾备数据库的场景下，灾备实例是主实例数据库的复制备份。
* 当主实例发生变化，记录修改的 Log 日志信息会被复制到灾备实例，然后利用日志重放实现数据同步。
* 如果主实例发生故障，可在数秒内激活灾备实例，恢复完整读写功能。

## 前提条件
要创建灾备实例，主实例要求 MySQL 5.6 及以上版本，且已开启 GTID 功能。

## 功能限制
灾备实例暂不支持：转移项目、回档、SQL 操作、参数设置、更改字符集、帐号管理、更改端口、数据导入、回档日志、只读实例功能。

## 操作步骤
### 购买灾备实例
1. 在实例列表选择希望为其配置灾备的实例，单击【管理】。
![](https://main.qcloudimg.com/raw/de03b9ef53dfd65e2666238c01c2e75e.png)
2. 确认GTID功能开启，单击【添加灾备实例】，进入灾备实例购买页。
![](https://main.qcloudimg.com/raw/739a319176a4daa8ad464485cc784317.png)
3. 在购买页中，设置灾备实例的【计费模式】【地域】【同步策略】等基本信息，并确认实例信息无误后，单击【立即购买】，待灾备实例发货。
![](https://main.qcloudimg.com/raw/7b121c47168b5b35720f8f3ecb383f35.png)

### 创建同步链接
如果您在购买时选择的【同步策略】为【立即同步】，则灾备实例在发货成功后会立即自动同步数据，不需要创建同步链接，可直接跳过该步骤。如果您选择的是【创建后同步】，则在灾备实例发货成功后，需对灾备同步链接进行配置，可实现异地灾备。
![](https://main.qcloudimg.com/raw/ff746fc212e2fe1bbd85ff87433fdde5.png)


1. 在主实例【实例详情】页面中，可查看灾备实例的同步状态，单击【创建同步】，为灾备实例创建与主实例的内网同步链路。
![](https://main.qcloudimg.com/raw/f1bb8ccc5cc8e3e92b2a32af64262780.png)
2. 填写任务名称，确认源库信息和目标库信息，单击【下一步】
![](https://main.qcloudimg.com/raw/76da0e717c920fcfc798ca9b46471dcf.png)
3. 选择需要同步的对象，支持同步整个实例或仅同步部分库表。目前暂不支持同步类型的选择。
![](https://main.qcloudimg.com/raw/ad9ab45676ce05e59e2f9b29baad369d.png)
4. 单击【保存并校验】后进入【校验任务】，校验成功后单击【启动任务】，即可在 TencentDB【数据同步】页面中查看任务详情。
![](https://main.qcloudimg.com/raw/5c4d63bfe6beb450cf655694a0baa721.png)
![](https://main.qcloudimg.com/raw/aab47f44ef0ec0df7f95ff41861032d6.png)


### 管理灾备实例
- 查看灾备实例
	灾备实例可在其所在地域查看，可在实例列表筛选出该地域全部灾备实例。
![](https://main.qcloudimg.com/raw/0825d2340cf0b0fab1dd9129088f3aa7.png)

- 查看从属关系
	单击每个灾备实例或主实例右方的icon，即可查看从属关系。
![](https://main.qcloudimg.com/raw/4b98a6b2831c027af52a37050aa16f2d.png)
![](https://main.qcloudimg.com/raw/56951f11467e085bc2852b36af4d66d6.png)

- 查看同步延迟

	可在灾备实例的【实例详情】页面上部查看到主实例和灾备实例之间的同步延迟。
![](https://main.qcloudimg.com/raw/64ce409ce2aab6237b16306d9374324c.png)

- 灾备实例功能

	灾备实例提供实例详情、实例监控、备份管理、慢查询日志功能可在控制台查看
![](https://main.qcloudimg.com/raw/c580676b16fcbe39a7897aad3420b733.png)

### 灾备实例升级为主实例
1. 在实例列表选择需要将其升级为主实例的灾备实例，单击【管理】。
![](https://main.qcloudimg.com/raw/2bbe8abeeadc993eaa8ddda6905eee6a.png)
2. 进入管理页面后，单击【备份管理】 > 【切换为主实例】，即可将灾备实例升级为主实例。切换后将断开与主实例的同步连接，恢复实例数据库数据写入能力和完整的 TencentDB 功能。
>!同步连接断开后不可重连，请谨慎操作。

![](https://main.qcloudimg.com/raw/d350895ab7dc035d9f5589b6085a36e9.png)

### 从灾备实例切回主实例
在主实例所在地域恢复服务后，可由 TencentDB 服务人员协助您做反向数据同步和数据校验，验证完毕后即可回切。

## 特殊说明
1.如果回档或者灾备之前的冷备份没有该表，回档或者灾备是会失败的。
2.如果回档或者灾备，追 binlog 时候，涉及其他库表的复合操作，语句是有可能失败。
3.如果回档或者灾备，追 binlog 时候，表涉及了外键等约束，SQL 语句有可能会失败。
