## 操作场景

云数据库 Redis 支持标准架构和集群架构，为应对业务数据的持续增长，Redis 提供了标准架构升级至集群架构的功能，以满足标准架构在性能和容量不足时向集群架构升级。

## 升级说明
- Redis 4.0 及以上的版本，支持相同版本的实例从标准架构升级至集群架构，例如，支持 Redis 4.0 标准架构升级至 Redis 4.0 集群架构。
- 不支持跨版本架构升级，例如，Redis 4.0 标准架构升级至 Redis 5.0 集群架构。
- 不支持 Redis 2.8 版本升级架构。
- 不支持从集群架构降级至标准架构。
- 标准架构升级至集群架构后，会按照集群架构计费，费用会增加，具体费用请参见 [产品定价](https://cloud.tencent.com/document/product/239/9894)。

## 升级原理
- Redis 标准架构支持直接升级为集群架构（单分片），无需数据搬迁，3分钟内完成升级。
- Redis 4.0 及以上版本开始，从标准架构升级为集群架构，仅是将实例的运行模式从无 Slot（槽位）限制升级为有 Slot 限制，不涉及数据搬迁。

## 升级准备（兼容性检查）
由于兼容性问题，为避免迁移至集群架构导致业务故障，请在升级之前确认好兼容性：
- 集群架构数据是分布式存储的，和标准架构命令支持的最大差异在于单个命令是否支持多 Key 访问，集群架构命令支持情况分为支持、自定义命令、不支持，详细命令兼容性列表请参见 [命令兼容性](https://cloud.tencent.com/document/product/239/36152)。
- 兼容性检查方案，请参见 [标准架构迁移集群架构检查](https://cloud.tencent.com/document/product/239/43697)。

## 升级影响
- 升级流程通常在3分钟内可以完成。
- 升级过程中，存量连接会断开（闪断），业务需要有重连机制。

## 操作步骤
1. 登录 [Redis 控制台](https://console.cloud.tencent.com/redis)。
2. 在右侧实例列表页面上方，选择地域。
3. 在实例列表中，找到需升级版本的实例。
4. 单击其实例 ID，进入**实例详情**页面。
5. 在**实例详情**页面的**规格信息**区域，单击**架构版本**后面的**架构升级**。
![](https://main.qcloudimg.com/raw/145122e4cdaadcc047744a10e8690993.png)
6. 在弹出的对话框，根据下表的参数解释配置升级参数。
![](https://main.qcloudimg.com/raw/b8fc25e215303a59831e5df2bcf34507.png)
<table>
<thead><tr><th>参数名称</th><th>参数说明</th></tr></thead>
<tbody><tr>
<td>实例ID</td>
<td>待升级架构的实例 ID。</td></tr>
<tr>
<td>实例名称</td><td>待升级架构实例名称 。</td></tr>
<tr>
<td>兼容版本</td><td>待升级实例当前兼容 Redis 的版本。</td></tr>
<tr>
<td>架构版本</td>
<td>待升级实例的架构信息，当前仅支持标准架构升级集群架构，不支持从集群架构降级至标准架构。</td></tr>
<tr>
<td>内存容量</td><td>待升级实例的容量规格。</td></tr>
<tr>
<td>架构版本</td><td>请在下拉列表中选择升级的目标架构版本。</td></tr>
<tr>
<td>新规格预览</td><td>升级后实例规格预览信息。</td></tr>
<tr>
<td>切换时间</td>
<td><ul><li>立即切换：立即执行切换动作。</li><li>维护时间窗切换：在实例的维护时间窗内，执行切换动作，维护时间可在实例详情页的<strong>维护时间窗</strong>处修改。</li></ul></td></tr>
<tr>
<td>总费用</td>
<td>升级架构之后的费用。<ul><li> <strong>按量计费</strong>：实例升级架构之后每小时的计费单价。单击<strong>计费详情</strong>，可查看计费项目、计费公式，确认费用。</li> <li><strong>包年包月</strong>：实例升级架构后的总费用。</li></ul></td></tr>
</tbody></table> 
7. 升级到集群架构版本存在命令兼容性风险，单击**兼容性说明文档**，确认兼容风险后，单击**确定**，继续升级。
8. 支付完成后，返回实例列表，待实例状态变为**运行中**，在实例列表或实例详情中查看实例的架构版本已经为升级后的集群架构。

## 相关 API

| 接口名称                                                     | 接口功能         |
| :----------------------------------------------------------- | :--------------- |
| [UpgradeInstanceVersion](https://cloud.tencent.com/document/product/239/46334) | 升级实例架构版本 |

