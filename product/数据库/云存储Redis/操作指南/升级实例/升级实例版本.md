## 操作场景

云数据库 Redis 兼容 Redis 2.8、4.0、5.0 版本，支持进行兼容版本升级，帮助用户升级实例至更新版本，从而体验更丰富的功能。

## 升级说明
- 目前仅标准架构实例支持升级兼容版本，集群架构不支持。
- 支持低版本实例向高版本升级，例如，Redis 2.8 升级至 Redis 4.0，Redis 4.0 升级至 Redis 5.0。
- 支持跨版本升级，例如，Redis 2.8 升级至 Redis 5.0。
- 实例兼容版本升级，不涉及费用变更。
- 不支持降级兼容版本。

## 升级流程原理
![](https://qcloudimg.tencent-cloud.cn/raw/21b86c925f1841d0c54db61f0cf29dee.png)

1. 资源申请：申请新版本实例资源，包括 Proxy 资源、Redis 主节点和副本节点资源。
2. 同步数据：从低版本实例同步全量和增量数据至新版本实例。
3. 等待切换：等待数据同步完成，或者等待切换时间窗口。
4. 版本切换：到达切换条件（数据同步接近完成，并且符合切换时间窗口），用户停止旧版本实例写入，从旧版本实例解绑 VIP（Virtual IP Address），绑定 VIP 至新实例。
5. 升级完成：更新实例状态。

## 升级影响
版本升级过程主要为数据同步和实例切换两个过程：
- 数据同步过程中，对服务无影响。
- 数据切换过程中，实例将存在1分钟以内的只读状态（等待数据同步完成），以及连接闪断（秒级）的影响，需要业务具备自动重连的机制。

## 升级准备

- 待升级版本的实例处于正常状态下（运行中），并且当前没有任何任务执行。
- 已确认升级的目标版本。

## 操作步骤

1. 登录 [Redis 控制台](https://console.cloud.tencent.com/redis)。
2. 在右侧实例列表页面上方，选择地域。
3. 在实例列表中，找到需升级版本的实例。
4. 单击其实例 ID，进入**实例详情**页面。
5. 在**实例详情**页面的**规格信息**区域，单击**兼容版本**后面的**版本升级**。
![](https://main.qcloudimg.com/raw/c2d78452b2f9caab68c5f76a28225bba.png)
6. 在弹出的对话框，根据下表确认待升级实例的信息，配置升级的目标版本，单击**确定**。
<img src="https://qcloudimg.tencent-cloud.cn/raw/e16ba3454af100769f0d777ffc5b2c7a.png" style="zoom:67%;" />
<table>
<thead>
<tr><th>参数名称</th><th>参数说明</th></tr></thead>
<tbody><tr>
<td>实例ID</td><td>待升级实例的 ID。</td></tr>
<tr>
<td>实例名称</td><td>待升级实例的名称 。</td></tr>
<tr>
<td>兼容版本</td><td>待升级实例当前兼容 Redis 的版本。</td></tr>
<tr>
<td>架构版本</td>
<td>待升级实例的架构信息，当前仅支持标准架构升级版本。</td></tr>
<tr>
<td>内存容量</td><td>待升级实例的容量规格。</td></tr>
<tr>
<td>升级版本</td>
<td>请在下拉列表中选择升级的目标版本。支持低版本向高版本升级，且支持跨版本升级。</td></tr>
<tr>
<td>新规格预览</td><td>升级后实例规格预览信息。</td></tr>
<tr>
<td>切换时间</td>
<td><ul><li><strong>立即切换</strong>：数据同步接近完成（需同步的数据&lt;10MB），执行切换动作。</li><li><strong>维护时间窗切换</strong>：在实例的维护时间窗内，执行切换动作，如果在当前维护时间窗无法满足切换条件，将在下一次维护时间窗进行切换尝试。维护时间可在实例详情页的<strong>维护时间窗</strong>处修改。</li></ul></td></tr>
<tr>
<td>总费用</td><td>升级实例之后的费用，不涉及计费变更。</td></tr>
</tbody></table>
7. 返回实例列表，待实例状态变为**运行中**，在实例列表或实例详情中查看实例的版本已经为升级后的版本。

## 相关 API

| 接口名称                                                     | 接口功能     |
| :----------------------------------------------------------- | :----------- |
| [UpgradeInstanceVersion](https://cloud.tencent.com/document/product/239/46334) | 升级实例版本 |

