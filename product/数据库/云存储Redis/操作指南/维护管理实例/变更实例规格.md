
## 操作场景
云数据库 Redis 支持变更实例的规格，提供灵活的扩缩容操作。您可根据业务所处的实际情况灵活调整 Redis 实例的规格，从而更好满足资源充分利用和成本实时优化等需求。本文为您介绍在云数据库 Redis 控制台变更实例规格的过程。

变更实例规格支持在控制台一键式操作，扩容或缩容过程中无需停止服务，无需做任何处理。 

- 扩容或缩容节点：指调整实例节点的内存容量，以适应不断变化的内存需求，避免出现因为内存不够用而卡机的状况。
- 增加或删除副本：指调整实例的副本数量。副本是指非主节点的节点，所有的副本都会参与系统高可用支持，因此副本数越多可用性越高。当副本数大于等于1时，可以开启读写分离，通过副本节点扩展读性能。
- 增加或删除分片：针对集群架构实例的分片模式，将不同的 Key 分配到多个分片节点，调整分片节点的数量，  达到水平扩充系统性能的目的 。

## 版本说明

- 当前 Redis 4.0 、5.0 标准版实例均支持扩容或缩容节点容量、增加或减少副本数量。
- 当前 Redis 4.0 、5.0 集群版实例均支持扩容或缩容节点容量、增加或减少副本数量、增加或减少分片数量。
- 当前 Redis 2.8 标准版仅支持扩容或缩容节点容量。
- 多可用区部署实例不支持减少副本数量。增加副本的具体信息，请参见 [多可用区实例增加副本](https://cloud.tencent.com/document/product/239/71620)。

## 计费说明
### 包年包月

- 升级配置：系统将计算实例规格间的差价，并在云账户中扣除差价，后续将按照新的规格计费。 若账户余额不足则需要先进行充值。 
- 降级配置： 计算差价公式：**退还金额 = 原配置剩余价值 - 新配置购买价值** 
  - 原配置剩余价值：原配置有效订单金额 - 原配置已使用价值。
    - 原配置有效订单金额指生效中订单的付款金额，不包含折扣和代金券。
    - 原配置已使用价值：发起降配当天，已满整月，按已使用整月的包年包月价格及对应的官网折扣进行扣除；不满整月的，按已使用时长的按量计费价格进行扣除。已使用部分精确到秒。
  - 新配置购买价值：指新配置当前官方价格 × 剩余使用时长。

每月的计费详情，请参见 [产品定价](https://cloud.tencent.com/document/product/239/9894)。

### 按量计费

实例的计费周期为小时，系统按照第一阶梯在下一个整点按照实例新的配置规格进行计费， 每个整点（北京时间）进行一次结算。 按量计费根据使用时长不同，共分为三个阶梯，具体信息，请参见 [计费概述](https://cloud.tencent.com/document/product/239/30822)。每个阶梯的计费详情，请参见 [产品定价](https://cloud.tencent.com/document/product/239/9894)。

## 前提条件

- 已 [创建云数据库 Redis 实例](https://cloud.tencent.com/document/product/239/30871)。
- 实例及其所关联的实例处于正常状态下（运行中），并且当前没有任何任务执行。
- 已计算变配后的规格需求，并了解相应费用，请确保您的腾讯云账号余额充足。

## 内存版（标准架构）扩缩容

>!
>- 配置变更后，实例将按照新的规格计费。
>- 内存版（标准架构）扩容时，本机剩余容量不足以满足扩容需求，则会发生迁移，迁移过程中不影响业务访问，迁移完成后仅2.8版本会发生闪断，建议该版本业务侧有重连机制。
>- 因内存版（标准架构）最大容量为64GB，所以当内存版（标准架构）容量达到64GB时，无法再进行扩容。
>- 为避免缩容失败，缩容后的实例容量要求大于或等于现有数据量的1.3倍，缩容后系统会自动进行退费。
>- 云数据库 Redis 4.0、5.0版本的256MB规格为入门尝鲜版本，仅适用于测试环境验证使用，目前可用区只支持：
广州（六区、七区）、上海（二区、三区、四区、五区）、北京（一区、二区、三区、四区、五区、六区、七区）、深圳金融（一区、二区、三区），且支持1GB及以上规格平滑缩容至256MB规格。

1. 登录 [Redis 控制台](https://console.cloud.tencent.com/redis)。
2. 在右侧实例列表页面上方，选择地域。
3. 在实例列表中，找到需变更配置的实例。
4. 在其**操作**列，进行扩容或缩容、增加或减少副本的操作。
  - 选择**配置变更** > **扩容节点**，在**云数据库 Redis 配置变更**页面，扩容节点的容量大小。
  - 选择**配置变更** > **缩容节点**，在**云数据库 Redis 配置变更**页面，缩容节点的容量大小。缩容节点的配置参数与扩容节点类似，其中**扩容后容量**指缩容之后每个分片的容量规格，缩容后的实例容量要求大于或等于已使用容量的1.3倍，请您对比缩容前后的容量规格，确认是否满足要求。
![](https://qcloudimg.tencent-cloud.cn/raw/8cb852b1ff1980d128d3c49c9786dfc2.png)
<table>
<thead><tr><th>参数名称</th><th>参数解释</th></tr></thead>
<tbody><tr>
<td>已使用容量</td><td>当前实例已经使用的容量。</td></tr>
<tr>
<td>最小内存规格</td><td>当前实例最小的内存规格要求，防止磁盘被写满。</td></tr>
<tr>
<td>扩容后容量</td><td>扩容或缩容之后的每个分片的容量规格。</td></tr>
<tr>
<td>对比</td>
<td>对比当前配置与之后的配置：包括分片数、分片规格、副本数、总容量、连接总数、最大流量。</td></tr>
<tr>
<td>配置变更费用</td>
<td><ul> <li> <strong>按量计费</strong>：实例调整配置后每小时的计费单价。单击<strong>计费详情</strong>，可查看计费项目、计费公式，确认费用。</li> <li><strong>包年包月</strong>：实例调整配置后的总费用。</li></ul></td></tr>
</tbody></table>
  - 选择**配置变更** > **增加副本**，在**云数据库 Redis 配置变更**页面，在**副本数量**后面的下拉列表选择调整后的副本数量。其余参数与扩容节点的参数类似。多可用区实例增加副本的具体操作，请参见[ 多可用区实例增加副本](https://cloud.tencent.com/document/product/239/71620)。
  - 选择**配置变更** > **删除副本**，在**云数据库 Redis 配置变更**页面，在**副本数量**后面的下拉列表选择调整后的副本数量。其余参数与扩容节点的参数类似。
![](https://qcloudimg.tencent-cloud.cn/raw/fcc556bab2157a241ba21046cfb8d6cb.png)
5. 确认调整配置，单击**确定**。
6. 返回实例列表，待实例状态变更为**运行中**，即可正常使用。

## 内存版（集群架构）扩缩容
>!
>- 配置变更后，实例将按照新的规格计费。
>- 为避免缩容失败，缩容后的实例容量要求大于或等于现有数据量的1.3倍，缩容后系统会自动进行退费。
>- 分片的新增和删除操作，系统将自动均衡 Slot 配置，并且迁移数据，迁移操作可能会失败，建议在业务低峰期进行操作， 避免迁移操作对业务访问造成影响。

1. 登录 [Redis 控制台](https://console.cloud.tencent.com/redis)。
2. 在右侧实例列表页面上方，选择地域。
3. 在实例列表中，找到需变更配置的实例。
4. 在其**操作**列，进行扩容或缩容、增加或减少副本、增加或减少分片的操作。
   - 选择**配置变更** > **扩容节点**，在**云数据库 Redis 配置变更**页面，扩容实例每个分片节点的容量大小。
   - 选择**配置变更** > **缩容节点**，在**云数据库 Redis 配置变更**页面，缩容每个分片节点的容量大小。缩容节点的配置参数与扩容节点类似，其中**分片大小**指缩容之后每个分片的容量规格，缩容后的实例容量要求大于或等于已使用容量的1.3倍，请您对比缩容前后的容量规格，确认是否满足要求。
![](https://qcloudimg.tencent-cloud.cn/raw/e63c67ba78611f4b30060259cc7c5d4f.png)
<table>
<thead><tr><th>参数名称</th><th>参数解释</th></tr></thead>
<tbody><tr>
<td>已使用容量</td><td>当前集群实例已经使用的容量。</td></tr>
<tr>
<td>最小内存规格</td><td>当前集群实例每个分片最小的内存规格要求，防止磁盘被写满。</td></tr>
<tr>
<td>分片大小</td><td>扩缩容之后的每个分片的容量规格。</td></tr>
<tr>
<td>对比</td>
<td>对比当前配置与扩容之后的配置：包括分片数、分片规格、副本数、总容量、连接总数、最大流量。</td></tr>
<tr>
<td>配置变更费用</td>
<td><ul> <li> <strong>按量计费</strong>：实例调整配置后每小时的计费单价。单击<strong>计费详情</strong>，可查看计费项目、计费公式，确认费用。</li> <li><strong>包年包月</strong>：实例调整配置后的总费用。</li></ul></td></tr>
</tbody></table>
   - 选择**配置变更** > **增加副本**，在**云数据库 Redis配置变更**页面，在**副本数量**后面的下拉列表选择调整后的副本数量。其余参数与扩容节点的参数类似。多可用区实例增加副本的具体操作，请参见 [多可用区实例增加副本](https://cloud.tencent.com/document/product/239/71620)。
   - 选择**配置变更** > **删除副本**，在**云数据库 Redis配置变更**页面，在**副本数量**后面的下拉列表选择调整后的副本数量。其余参数与扩容节点的参数类似。
![](https://qcloudimg.tencent-cloud.cn/raw/b25b6cd85857f6a73febc0b4ba8697e0.png)
   - 选择**配置变更** > **增加分片**，在**云数据库 Redis 配置变更**页面，在**分片数量**后面的下拉列表选择调整后的分片数量。其余参数与扩容节点的参数类似。
   - 选择**配置变更** > **删除分片**，在**云数据库 Redis 配置变更**页面，在**分片数量**后面的下拉列表选择调整后的分片数量。其余参数与扩容节点的参数类似。
![](https://qcloudimg.tencent-cloud.cn/raw/81ea83a4f9889119ffd36ec3508fd513.png)
5. 确认调整配置，单击**确定**。
6. 返回实例列表，待实例状态变更为**运行中**，即可正常使用。

## 相关 API

| 接口名称                                                     | 接口功能       |
| :----------------------------------------------------------- | :------------- |
| [UpgradeInstance](https://cloud.tencent.com/document/api/239/20013) | 升级实例的配置 |

