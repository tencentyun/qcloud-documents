## 操作场景

云数据库 Redis 通过账号机制提供读写权限控制和路由策略控制，以满足复杂业务场景中对业务权限的控制。目前仅云数据库 Redis 内存版（不含2.8兼容版本）支持账号设置。

- 账号分类
  - 默认账号：只有密码的账号。在创建实例时，设置的访问数据库的密码。具体信息，请参见 [创建实例](https://cloud.tencent.com/document/product/239/30871)。
  - 自定义账号：带账号名的账号，自定义账号的鉴权方式为`账号名@密码`，作为访问 Redis 的密码参数。连接示例：`redis-cli -h 1.1.1.1 -p 6379 -a readonlyuser@password`。
- 账号匹配优先级
  - 存在默认账号带 @ 分隔符的情况时，会优先匹配默认账号，再匹配自定义账号，自定义账号的匹配将以第一个 @ 符号为分隔符。
  - 云数据库 Redis 对免密码认证方式和原始 Redis 社区版有所不同，实例开通免密码访问后，如果访问参数密码不为空，认证将会失败，原始社区版会认证成功。
- 权限设置
  - 只读权限：账号只有读取数据的权限，无修改数据的权限。
  - 读写权限：账号具有读和写数据的权限。
- 只读路由策略
  - 通过只读路由策略配置，您可以将指定账号的**读请求**分发到指定节点（主节点或副本节点）。
  - 没有开通副本只读的实例，不支持路由到副本节点，可在**节点管理**页开通**副本只读**功能。
  - 存在访问副本节点账号的实例，不允许关闭**副本只读**功能，如需关闭**副本只读**功能，需要先删除该账号。

## 前提条件

- 云数据库 Redis 实例已创建，且在运行中。
- 已规划待定义的账号及其密码、读写权限、只读路由策略等信息。

## 创建自定义账号

1. 登录 [Redis 控制台](https://console.cloud.tencent.com/redis)。
2. 在右侧**实例列表**页面上方，选择地域。
3. 在实例列表中，找到目标实例。
4. 单击目标实例的实例 ID，进入**实例详情**页面。
5. 单击**账号管理**页签，单击**创建账号**。
![](https://qcloudimg.tencent-cloud.cn/raw/fd3ac23077b5706bc7eb154d0c9bf936.png)
6. 在**创建账号**对话框，设置自定义账户名称及其密码信息，如下图所示。
![](https://qcloudimg.tencent-cloud.cn/raw/5663206d14e0f343bee74bc6898b7788.png)
<table>
<thead><tr><th>界面参数</th><th>参数解释</th></tr></thead>
<tbody><tr>
<td>账号名称</td>
<td>自定义访问数据库的名称。<ul><li>仅由字母、数字、下划线、中划线组成。</li><li>长度不能大于32位。</li></ul></td></tr>
<tr>
<td>密码</td>
<td>设置自定义账号的密码。请根据界面帮助信息提示设置密码复杂度。</td></tr>
<tr>
<td>确认密码</td>
<td>再次输入密码。</td></tr>
<tr>
<td>命令权限</td>
<td>请在下拉列表中，选择账户权限，支持选择<strong>只读</strong>与<strong>读写</strong>权限。</td></tr>
<tr>
<td>只读路由策略</td>
<td>指定账号的<strong>读请求</strong>分发至<strong>主节点</strong>或<strong>副本节点</strong>。未开启副本只读，不支持选择副本节点。具体操作，请参见 <a href="https://cloud.tencent.com/document/product/239/19543">开关读写分离</a>。</td></tr>
</tbody></table>
7. 单击**确定**，完成创建，可使用该自定义账户访问数据库。具体连接方式，请参见 [连接实例](https://cloud.tencent.com/document/product/239/30877)。

## 删除自定义账号

1. 登录 [Redis 控制台](https://console.cloud.tencent.com/redis)。
2. 在右侧**实例列表**页面上方，选择地域。
3. 在实例列表中，找到目标实例。
4. 单击目标实例的实例 ID，进入**实例详情**页面。
5. 单击**账号管理**页签，在账号列表中，找到需删除的自定义账号。
6. 在其**操作**列，单击**删除**。
7. 在**删除账号**对话框，确定需删除的账号信息，单击**确定**。
> ?
> - 默认账号即仅有密码的账户, 该账号不能删除。
> - 账号删除后, 使用该账号的存量连接不会被断开, 新建连接使用该账号将无法验证。

## 修改账号权限

1. 登录 [Redis 控制台](https://console.cloud.tencent.com/redis)。
2. 在右侧**实例列表**页面上方，选择地域。
3. 在实例列表中，找到目标实例。
4. 单击目标实例的实例 ID，进入**实例详情**页面。
5. 单击**账号管理**页签，在账号列表中，找到需修改权限的自定义账号。
6. 在其**操作**列，单击**修改权限**。
7. 在**修改权限**对话框，在**命令权限**后面的下拉列表中，选择账号的读写权限；在**只读路由策略**后面的下拉列表中，选择只读路由分发的节点，如下图所示。
![](https://qcloudimg.tencent-cloud.cn/raw/637c844b6b7d5b4587a315613cf8abf3.png)
> ?
> - 默认账号的命令权限只能为读写，不支持设置为只读。
> - 未开启副本只读，只读路由策略不支持选择副本节点。具体操作，请参见 [开关读写分离](https://cloud.tencent.com/document/product/239/19543)。
8. 单击**确定**，完成设置。

## 相关 API

| API 接口                                                      | 接口含义           |
| ------------------------------------------------------------ | ------------------ |
| [CreateInstanceAccount](https://cloud.tencent.com/document/api/239/38926) | 创建实例自定义账号 |
| [ModifyInstanceAccount](https://cloud.tencent.com/document/api/239/38923) | 修改实例子账号     |
| [DeleteInstanceAccount](https://cloud.tencent.com/document/api/239/38925) | 删除实例自定义账号 |
| [DescribeInstanceAccount](https://cloud.tencent.com/document/api/239/38924) | 查看实例账号信息   |

