
## 操作场景
云数据库 Redis 旧集群版（即2018年1月1日之前购买的集群）版本较低，存在一定的稳定性风险，建议您迁移至全新的 Redis 4.0 内存版（标准架构）或4.0内存版（集群架构）。
Redis 4.0 版本能够体验更灵活的规格配置，更高的性能以及更完善的功能，我们将协助您尽快将 Redis 旧集群版实例升级至 Redis 4.0 内存版（标准架构）或4.0内存版（集群架构），请参见 [Redis 内存版（标准架构）](https://cloud.tencent.com/document/product/239/36151) 和 [Redis 内存版（集群架构）](https://cloud.tencent.com/document/product/239/18336)。如您在迁移中遇到问题，可 [提交工单](https://console.cloud.tencent.com/workorder/category) 进行反馈。

>!Redis 旧集群版实例无法热迁移到内存版（标准架构）或内存版（集群架构）， 为保证迁移过程不丢失数据，从迁移开始时，需要停止对 Redis 集群的写入。
您可以通过设置安全组禁止所用业务访问，或修改密码为新密码的方式来保证业务不再写入，可在监控页面查看 QPS 是否降为0。

## 前提条件
- 已购买新内存版（标准架构）或者内存版（集群架构）实例。
>?数据量小于12GB，且后续数据增长不超过60GB，QPS 不超过4W的情况，或是需要事务支持的情况，建议选择 Redis 4.0 内存版（标准架构），否则建议选择 Redis 4.0 内存版（集群架构），Redis 4.0 内存版（集群架构）不支持事务命令，其他命令完全兼容 Redis 旧集群版。
- 已备好一台 CVM 供数据导入使用，CVM 的磁盘空间需要足够存储现有实例的数据。
- 已安装好数据导入工具 redis-port，工具使用说明和下载地址请参见 [工具介绍](https://cloud.tencent.com/document/product/239/33786)。

## 操作步骤
1. 停止业务写入 Redis 旧集群版实例。
2. 在 Redis 控制台创建旧集群版实例的备份数据，等待实例完成备份，备份时长根据数据量而定，备份完成后会生产一个 RDB 文件。
3. 数据备份完成后，在备份列表中可以看到之前备份的文件，单击【导出】生成 RDB 文件，RDB 文件生成后会生成对应的下载链接，单击下载链接复制内网地址，从内网 CVM 下载备份文件，不支持跨可用区下载。
4. 初始化新购买的 Redis 4.0 内存版（标准架构）或 4.0 内存版（集群架构）的密码，使用 redis-port 工具将下载的 RDB 文件导入至新实例。示例如下：
```
./redis-restore dump.rdb -t 127.0.0.1:6379
```
5. 数据导入完成后，可在控制台实例详情页的配置信息，查看实际的内存使用量，确认数据是否导入成功。
6. 迁移应用到新实例，只需将代码中的旧集群版的 IP 更新为新实例的 IP 即可。

