## crs-port 简介
云数据库 Redis 支持通过 crs-port 工具进行实例数据导入导出，支持如下特性：
- 支持导入 RDB 文件至 Redis 2.8 主从版、4.0 集群版，支持导入 Redis 4.0 及其以下版本的 RDB 文件。
- 支持导出 Redis 2.8 单机版、主从版的数据。


## crs-port 工具下载
[Linux 版本 crs-port下载](	https://main.qcloudimg.com/raw/10743947474194d516a06e74f6591750/crs-port)
更新日期：2018年08月21日

## RDB 文件导入
命令：
``` 
crs-port restore -n 16 -i /data/dump.rdb -t 192.168.0.1:6379 -A pwd
```

参数说明：
- -n ：并发数，该值建议取 CPU 总核数的2倍到4倍。
- -i ：指定导入文件所在路径。
- -t ：要导入的目标 CRS 实例的 IP 和端口。
- -A ：目标 CRS 实例的链接密码。
- --setdb=N ：指定导入到目标实例的某个库中，N 的范围 [0,15]。
- --filterdb=N ：指定导入源文件中某个库的数据到目标实例，N 的范围 [0, 15]。

### 注意事项
- 出现`【ERROR】 restore error: ERR Target key name is busy. for key: xxx `时，表示该 Key 已经存在于数据库中，可从两个方面解决：
 - 使用工具前需要清空目标 CRS 实例，否则会报错，请使用控制台清空实例将实例清空。
 - 如果其他地方有写入（可以清空实例后，观察 qps 来判断），停止其他的写入。
- 需要确保执行脚本的机器时间正确，否则可能导致数据不一致。
- 出现报错后数据将不会回滚，写入到目标数据空，建议再次发起导入之前操作清理数据。
- crs-port 只支持整个实例导出，需如指定库，添加导入参数： --filterdb=N。
- dump RDB 文件会压缩，得到的 RDB 文件会比当前使用量小。
- 用 crs-port 导入的服务器内存配置务必保证内存配置大于导出实例的已用内存数据大小。（例如源实例已用量20GB，导出 RDB 文件会压缩为12GB，需要服务器配置大于20GB）。


## dump RDB 文件
云数据库 Redis 实例的导出数据为 RDB 文件（仅支持 Redis 2.8单机版、2.8主从版），命令格式如下:
``` 
crs-port dump -n 16 -f 192.168.0.1:6379 -P pwd -o /data/dump.rdb
```

参数说明：
- -n ：并发数，该值建议取 CPU 总核数的2倍到4倍。
- -f ：源 Redis 服务的 IP 和端口。
- -P ：源 Redis 服务的密码，如无密码，可不指定该参数。
- -o ：指定文件输出路径。

