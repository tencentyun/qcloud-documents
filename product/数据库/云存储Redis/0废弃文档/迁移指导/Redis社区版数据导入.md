### 1.	crs-port 简介
云数据 Redis 产品支持通过工具（crs-port）进行实例数据导入导出，支持如下特性：
- 支持导入RDB文件到云数据库 Redis 2.8 标准版、4.0 集群版，支持导入 Redis4.0 及以下版本的 RDB 文件；
- 支持导出云数据 Redis2.8 标准版和单机版本的数据；


### 2.	crs-port 工具下载
[Linux版本 crs-port下载](	https://main.qcloudimg.com/raw/8d28dd072a60f1a4b7ed3bc0fe5a3d16/crs-port)
更新日期：2018.08.21

### 3.	RDB 文件导入
命令：
``` 
crs-port restore -n 16 -i /data/dump.rdb -t 192.168.0.1:6379 -A pwd
```

参数说明
- -n【并发数】 该值建议取 CPU 总核数的 2 倍到 4 倍。
- -i  指定导入文件所在路径。
- -t  要导入的目标 CRS 实例的 IP 和端口。
- -A 目标 CRS 实例的链接密码。
- --setdb=N 指定导入到目标实例的某个库中，N 的范围 [0,15]。
- --filterdb=N 指定导入源文件中某个库的数据到目标实例，N 的范围 [0, 15]。

#### 3.1 注意事项
- 当出现【ERROR】 restore error: ERR Target key name is busy. for key: xxx 时表示该 key 已经存在于数据库中，此时可以从两个方面解决：
A 使用工具前需要清空目标 CRS 实例，否则会报错，请使用控制台清空实例将实例清空；
B 如果其他地方有写入（可以清空实例后，观察 qps 来判断），停止其他的写入；
- 需要确保执行脚本的机器时间正确，否则可能导致数据不一致。
- 出现报错后数据将不会回滚，写入到目标数据空，建议再次发起导入之前操作清理数据。
- crs-port 只支持整个实例导出，需要的话可以指定库 导入添加参数： --filterdb=N。
- dump RDB 文件会压缩，得到的 rdb 文件会比当前使用量小。
- 用crs-port导入的服务器内存配置务必保证内存配置大于导出实例的已用内存数据大小。（例如源实例已用量20G，导出rdb文件会压缩为12G，需要服务器配置大于20G）。


### 4.	dump RDB 文件
导出云数据库Redis实例的数据为RDB文件（仅支持云数据库Redis 2.8标准版、2.8单机版），命令格式如下:
``` 
crs-port dump -n 16 -f 192.168.0.1:6379 -P pwd -o /data/dump.rdb
```

参数说明
- -n【并发数】该值建议取 CPU 总核数的 2 倍到 4 倍。
- -f 源 Redis 服务的 IP 和端口。
- -P 源 Redis 服务的密码，如无密码不指定该参数即可。
- -o 指定文件输出路径。

