## 操作场景

云数据库 Redis 旧集群版（即2018年1月1日之前购买的集群）版本较低、架构老旧，存在一定的稳定性风险，为保证业务最大的稳定性，建议您迁移至全新的 Redis 集群版。
新版本能够体验更灵活的规格配置，更高的性能以及更完善的功能，我们将于2018年10月15日到2019年1月30日协助您将 Redis 旧集群版实例升级至 Redis 2.8 标准版或 4.0 集群版，2.8 标准版介绍请参见 [Redis 标准版](https://cloud.tencent.com/document/product/239/17950)，4.0 集群版介绍请参见 [Redis 集群版](https://cloud.tencent.com/document/product/239/18336)。
>?Redis 旧集群版实例无法热迁移到标准版或者集群版， 为保证迁移过程不丢失数据，从迁移开始时，需要停止对集群 CRS 的写入。
可以通过设置安全组禁止所用业务访问，或者修改密码为新密码的方式来保证业务不再写入，可在监控页面查看 QPS 是否降为0。

## 前提条件
- 已购买好新标准版或者集群版实例。
>? 如数据量小于12GB，且后续数据增长不超过60GB，QPS 不超过4W，建议使用 Redis 2.8 标准版，否则建议购买  Redis 4.0 集群版，Redis 4.0 集群版**不支持事务命令**（如果需要事务支持，请选择 2.8 标准版），其他命令完全兼容Redis旧集群版。
Redis 2.8 标准版刊例价76元/GB/月，Redis 4.0 集群版刊例价84元/GB/月，可根据实际情况进行选择。
- 已备好一台 CVM 供数据导入使用，CVM 的磁盘空间需要足够存储现有实例的数据。
- 已安装好数据导入工具 crs-port，工具使用说明和下载地址请参见 [工具地址](https://cloud.tencent.com/document/product/239/611)。

## 操作步骤
1. 停止业务写入 Redis 旧集群版实例。
2. 创建 Redis 旧集群版实例的备份数据，等待实例完成备份，备份时长根据数据量而定，备份完成后会生产一个 RDB 文件。
![](https://main.qcloudimg.com/raw/afe562ddc91ac10f56d714ad62c94777.png)
3. 数据备份完成后，在备份列表中可以看到之前备份的文件，单击【导出】生成 RDB 文件，RDB 文件生成后会生成对应的下载链接，单击下载链接复制内网地址，从内网 CVM 下载备份文件，**不支持跨可用区下载**。
![](https://main.qcloudimg.com/raw/2f63deeea54d0eb2666b85f52dfcbec1.png)
4. 初始化新购的 Redis 2.8 标准版或 4.0 集群版的密码，**新实例的密码不再支持“实例ID:实例密码”的密码格式，客户端的访问只带密码即可**，使用 crs-port 工具将下载的 RDB 文件导入至新实例。
```
crs-port restore -n 16 -i /data/dump.rdb -t 192.168.0.1:6379 -A passwd
```
5. 数据导入完成后，通过控制台确认数据是否导入成功，可以查看实际的内存使用量。
![](https://main.qcloudimg.com/raw/436b86476c50f5b4591e8247e420856f.png)
6. 迁移应用到新实例，**只需将代码中的旧集群版的 IP 更新为新实例的 IP 即可**。
