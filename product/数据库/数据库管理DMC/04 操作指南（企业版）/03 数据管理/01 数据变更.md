## 操作场景

DMC 支持通过 SQL 语言对数据库进行数据变更。数据变更支持的 SQL 语言包括 CREATE、INSERT、UPDATE、DELETE、TRUNCATE 等。

## 操作流程

数据变更操作流程如下：

1. **提交工单申请**：选择实例和数据库、选择执行方式、输入执行 SQL 等。
2. **预览与 SQL 检查**：提交工单后，系统自动进行 SQL 检查，检查顺序依次为 SQL 语法检查、预执行、SQL 自动审核。如果 SQL 语法有误、预执行失败或存在待改进项，需要手动处理后才可进入**审批**步骤。
3. **审批**：SQL 检查完成后，进行人工审批。
4. **执行**：审批结束后，进行人工执行或手动执行 SQL。
5. **完成**：执行完成后，查看执行结果和执行日志。

## 操作步骤

1. 登录 [DMC 控制台](https://dms.cloud.tencent.com/v3/cooperations/#/)。
2. 在顶部菜单栏，选择**数据管理** > **数据变更**。
3. 在**提交工单申请**页面，配置工单参数，配置完成后单击**提交**。
<img src="https://qcloudimg.tencent-cloud.cn/raw/e00bac5bb9ae85b6160cb7dec00ec9e8.png" style="zoom:50%;" />
<br>主要配置参数说明如下：
<table>
<thead><tr><th>参数项</th><th>说明</th></tr></thead>
<tbody><tr>
<td>执行实例</td>
<td>选择待变更的数据库实例。</td></tr>
<tr>
<td>执行数据库</td>
<td>选择待变更的数据库。</td></tr>
<tr>
<td>执行方式</td>
<td>选择审批执行方式，包括<strong>审批通过后自动执行</strong>和<strong>审批通过后手动执行</strong>。</td></tr>
<tr>
<td>执行 SQL</td>
<td>在文本框中，输入可执行的 SQL 语句。<br>多条 SQL 语句之间请用英文分号（;）隔开。</td></tr>
</tbody></table>
提交工单申请后，系统会自动进行 SQL 检查。
4. 在**工单管理**页面，查看工单状态，状态不同对应的操作不同。
   需要进一步操作的状态包括**SQL 检查不通过**、**预执行失败**、**SQL 检查完成**、**审批中 ( DBA 审批 )**。
   - **SQL 检查不通过**：表明执行 SQL 语法有误。请在工单对应操作列单击**修改**，查看工单详情和错误信息，并单击**修改 SQL**，修改完成后重新提交，直至工单状态更新为审批中即可执行下一步。
    <img src="https://qcloudimg.tencent-cloud.cn/raw/d4d873a6c4486c5cf5a97c6368076ce6.png" style="zoom:50%;" />
   - **预执行失败**：表明预执行 SQL 失败。请在工单对应操作列单击**修改**，查看工单详情和失败信息，并单击**修改 SQL**，修改完成后重新提交，直至工单状态更新为审批中即可执行下一步。
     <img src="https://qcloudimg.tencent-cloud.cn/raw/94f239e5f37404a2b1b79561b73bf924.png" style="zoom:50%;" />
   - **SQL 检查完成**：表明执行 SQL 部分需要改进。请在工单对应操作列单击**提交审批**，查看工单详情和检查信息。支持**修改 SQL** 或**直接提交审批**。
     - **修改 SQL**：请单击**修改 SQL**，修改完成后单击**提交**。
     - **直接提交审批**：请在 **SQL 变更工单**对话框中单击**提交审批**。
     ![](https://qcloudimg.tencent-cloud.cn/raw/c6f7484776fea4550a830d426771f846.png)
   - **审批中 ( DBA 审批 )** ：表明执行 SQL 正确无需修改。请执行下一步。
5. 在**工单管理**页面，在工单对应的**操作**列单击**审批**。
   数据变更默认审批模板的审批人为 DBA。
6. 在弹出的 **SQL 变更工单**对话框，查看工单详情、SQL 检查结果，无误后，在页面下方单击**审批通过**，在弹出的对话框中单击**确认**。
   如果有问题请单击**审批驳回**。
   <img src="https://qcloudimg.tencent-cloud.cn/raw/ed68adb36bed9adff96bcc01f962f997.png" style="zoom:50%;" />
7. （可选）在**工单管理**页面，在待执行的工单对应的**操作**列单击**执行**，在 **SQL 变更工单**页面，单击**立即执行**。
   如果提交工单申请时**执行方式**选择**审批后自动执行**，则自动执行提交工单时输入的 SQL 语句，无需执行该步骤。
8. 在**工单管理**页面，在已执行的工单对应的**操作**列单击**查看详情**。
   查看工单详情、执行结果（执行失败或执行成功）及执行日志。
   <img src="https://qcloudimg.tencent-cloud.cn/raw/0535a4a477be8ef81ab2fa367436e7e2.png" style="zoom:50%;" />

