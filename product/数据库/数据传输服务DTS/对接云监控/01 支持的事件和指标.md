## 概述
DTS 支持通过云监控平台对数据迁移、数据同步、数据订阅任务过程中的事件和指标进行监控并设置报警规则，在事件触发或者指标发生异常时，云监控平台及时通知用户采取措施。  

> ?当前仅支持 MySQL 到 MySQL 迁移、同步和订阅过程中的事件监控和指标监控。

## 支持的事件
对一些特别重要的事件，DTS 支持默认告警配置，即任务创建后系统自动进行事件监控，不需要用户配置，在事件触发后自动通知用户。

| **事件场景** | **事件名称**     | **是否默认告警** | **说明**                                             |
| ------------ | ---------------- | ---------------- | ---------------------------------------------------- |
| 数据迁移     | 数据迁移任务中断 | 默认告警         | 数据迁移任务过程中，当任务中断或者异常时，触发告警。 |
| 数据同步     | 数据同步任务中断 | 默认告警         | 数据同步任务过程中，当任务中断或者异常时，触发告警。 |
| 数据订阅     | 数据订阅任务中断 | 默认告警         | 数据订阅任务过程中，当任务异常时，触发告警。         |

## 数据迁移支持的指标

> ?当前仅支持在增量迁移阶段获取实时监控的指标数据。

| **指标名称**  | **单位** | **说明**            |
| ------------------ | ------- | ---------------------------------- |
| 源实例数据抽取 RPS | Count/s | DTS 每秒读取的源实例的数据行数。 |
| 目标数据装载 RPS  | Count/s | DTS 每秒迁移到目标实例的数据行数。 |
| 数据迁移延迟时间 | s    | 目标实例和源实例的时间延迟。<br>计算方法：源实例当前时间减去目标实例当前正在执行的最新一条源实例 Binlog Event 中记录的时间。<br/>“数据迁移延迟时间”的计算依赖于源库的增量 Binlog，所以当源库长时间没有 DDL 或者 DML 操作时，该指标会逐步增大，无法反应真实的同步延迟时间（如出现值为“-1”，表示存量数据迁移完成，一直没有增量数据的刷新）。如遇到这种情况，用户可以通过在源端执行 SQL 语句来让该指标刷新，进而得到真实的指标数据。 |
| 数据迁移延迟数据量 | MBytes | 目标实例和源实例的数据差距。 <br>计算方法：源实例最新的 Binlog Event 文件位点减去目标实例当前正在执行的最新一条源实例 Binlog Event 的文件位点。 当这两个位点跨越 Binlog 文件时，该值有估算成分。<br/>当源库长时间没有 DDL 或者 DML 操作时，该指标会逐步增大，无法反应真实的同步延迟时间（如出现值为“-1”，表示存量数据迁移完成，一直没有增量数据的刷新）。 |

## 数据同步支持的指标

> ?当前仅支持在增量同步阶段获取实时监控的指标数据。

| **指标名称**  | **单位** | **说明**            |
| ------------------ | ------- | ---------------------------------- |
| 源实例数据抽取 RPS | Count/s | DTS 每秒读取的源实例的数据行数。 |
| 目标数据装载 RPS  | Count/s | DTS 每秒迁移到目标实例的数据行数。 |
| 数据同步延迟时间  | s    | 目标实例和源实例的时间延迟。<br>计算方法：源实例当前时间减去目标实例当前正在执行的最新一条源实例 Binlog Event 中记录的时间。<br/>“数据同步延迟时间”的计算依赖于源库的增量 Binlog，所以当源库长时间没有 DDL 或者 DML 操作时，该指标会逐步增大，无法反应真实的同步延迟时间（如出现值为“-1”，表示存量数据迁移完成，一直没有增量数据的刷新）。如遇到这种情况，用户可以通过在源端执行 SQL 语句来让该指标刷新，进而得到真实的指标数据。 |
| 数据同步延迟数据量 | MBytes | 目标实例和源实例的数据差距。 <br>计算方法：源实例最新的 Binlog Event 文件位点减去目标实例当前正在执行的最新一条源实例 Binlog Event 的文件位点。 当这两个位点跨越 Binlog 文件时，该值有估算成分。<br/>当源库长时间没有 DDL 或者 DML 操作时，该指标会逐步增大，无法反应真实的同步延迟时间（如出现值为“-1”，表示存量数据同步完成，一直没有增量数据的刷新）。 |

## 数据订阅（Kafka版）支持的指标

| **指标名称**    | **单位** | **说明**                                                     |
| --------------- | -------- | ------------------------------------------------------------ |
| Binlog 解析延迟 | Count    | 数据订阅服务已解析的 Binlog Event 与源库最新产生的 Binlog Event 之间的 GTID 个数差距。 |
| 每秒解析事务数  | Count/s  | DTS 每秒从源库 Binlog 抽取解析的事务数。                     |

## 数据订阅支持的指标

| **指标名称**       | **单位** | **说明**                                                     |
| ------------------ | -------- | ------------------------------------------------------------ |
| 数据解析 GTID      | Count    | 订阅服务正在解析的 Binlog 与源库最新产生的 Binlog 之间的 GTID 差距个数。 |
| SDK 确认延时       | s       | SDK 每消费一条消息，会向服务端回复确认，该指标为 SDK 生产和消费的时间差，即 SDK 最后一次回复的消息在源库产生的时间，与订阅服务器的机器时间差。 |
| 每秒事务数         | Count/s  | 消费端每秒处理的事务数。                                     |
| 待确认队列使用率   | %        | 客户端已经消费完成的消息，会向服务端发送确认，等待向服务端确认的消息会加入待确认队列，该指标为客户端缓存的消费队列中，待向服务端确认的消息队列占比。<br>当待确认队列占满时，该指标值为100%，出现该情况表明客户端有某条消息因为自身程序异常没有调用到 AckAsComsumed。 |
| 内部解析队列使用率 | %        | 客户端在消费消息之前，会将消息进行解析并放在内部解析队列中，该指标用于反映解析队列的使用率。 |
| 消息队列使用率     | %        | 客户端运行时，将消息从订阅服务端下载并缓存到消息队列中，该指标用于反映消息队列的使用率。 |
