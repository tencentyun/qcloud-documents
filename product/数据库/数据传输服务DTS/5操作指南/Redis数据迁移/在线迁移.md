## Redis 迁移工具使用说明
## 自建迁移概述
在线迁移工具暂不支持的迁移类型：主从版、集群版、新一代 Redis 三者实例间的迁移
#### 迁移术语

| 术语 | 解释 |
|---------|---------|
| 源实例 | 迁移的源实例 |
| 目标实例 | 迁移的目标实例，即用户购买的腾讯云 redis |
| CVM 自建实例迁移 | 用户在腾讯云服务器上部署的 redis 服务迁移至腾讯云 redis |
| 外网实例迁移 | 用户在外网环境下部署的 redis 服务迁移至腾讯云 redis |

#### 迁移注意事项
1. 目前仅支持迁移到腾讯云 redis 的主从版本；
2. 为保障迁移效率，CVM 自建实例迁移不支持跨地域迁移；
3. 由于 rdb 协议限制，暂不支持自建实例 redis 3.2 版本的迁移；
4. 外网实例迁移时，请确保源实例服务在外网环境下可访问；
5. 进行迁移任务时，只允许迁移正常运行状态下的实例，且未初始化密码或者有其他任务在执行中的实例，是不能够迁移的；
6. 目的实例必须是没有数据的空实例，迁移过程中，会锁住实例，不能对实例进行写入操作；
7. 迁移成功时，由业务侧验证数据后，可断开源实例连接，将连接切换到目标实例。

## 迁移过程
#### 新建迁移任务
进入迁移任务列表页面后，单击【新建任务】，进入创建迁移任务页。
![](https://mc.qcloudimg.com/static/img/bcf597d496292b67635a5f84d5ca1583/image.png)

#### 迁移任务设置
任务名称： 为任务指定名称
定时执行：可为您的迁移任务指定开始时间
![](https://mc.qcloudimg.com/static/img/6d45bf22f31923704b6055f3f94f1781/image.png)

>注：
> 1，修改定时任务，校验通过后，需要重新单击定时启动，任务才会定时启动。
> 2，如果任务是过了定时启动的时间，定时启动会变为立即启动，单击立即启动，会立刻启动任务。

#### 填写基本信息
以下以云服务器 CVM 上的 Redis 实例为例说明，外网实例迁移下同

| 字段 | 描述 | 用途 | 必填 |
|---------|---------|---------|---------|
| 任务名称 | 迁移任务的名称 |方便用户管理任务 | 是 |
| CVM 实例 ID | 源 redis 实例所在的腾讯云服务器 ID |迁移任务会根据 CVM 实例 ID，检查云服务器运行情况 | 是 |
| CVM 内网 IP |源 redis 实例所在的腾讯云服务器的内网 IP |迁移任务会检查 CVM 内网 IP | 是 |
| 端口 | 源实例端口号 |迁移任务会访问源实例服务 | 是 |
| 密码 | 源实例密码 |访问源实例服务时，有 auth 鉴权 | 否 |
| 实例 Id | 目标实例 Id |同步数据到目标实例 | 是 |

>注：现在支持源无密码的迁移。

![](https://mc.qcloudimg.com/static/img/a42a402f82cf1bb2d3086e3e41265ec6/image.png)


#### 参数设置
系统在迁移开始会设置这些参数，迁移结束会恢复参数的历史值。单击【下一步：校验任务】进行参数校验（为保证迁移效率，建议使用默认值）。
![](https://main.qcloudimg.com/raw/af8381c236e912ae4798b296c5cdbe0a.png)

参数校验中，校验成功后，单击【启动】。
 ![](https://main.qcloudimg.com/raw/7bd1e80ac17d3a0c6250ebcd15852c75.png)
>注：
1.出现告警项也可以进行数据迁移，不过需要了解告警内容是否对数据有影响
2.特别注意，如果网络不可达，请检查源实例所在服务的安全组，需要将安全组放通全部端口

#### 启动迁移任务
参数校验成功后，任务还处于未启动状态，单击右侧【立即启动】按钮。启动任务后，任务会再做一次参数校验，此时只能够取消任务、查看任务、查看校验情况。
![](https://main.qcloudimg.com/raw/935db808f97440ed4f6067e95d18a7ff.png)

启动任务后，会再次校验参数，任务状态为"校验中"。
![](https://main.qcloudimg.com/raw/861ed166a2e473c491c79a92a2fd2fb4.png)

参数校验成功后，数据开始迁移。
![](https://main.qcloudimg.com/raw/e7b074825acfa8abae2260deb9afcc7d.png)

数据同步阶段，会展示数据偏移量，源实例、目标实例 key 变化情况。


#### 完成迁移任务 
当源目标和目的实例的 key 同步一致时，单击右侧【完成】，确定，即可完成数据同步操作。
断开同步前，可以在目标实例上验证数据，如果验证无误，即可完成迁移任务。
![](https://main.qcloudimg.com/raw/b4b428f3d5cb801488aa25864730edcf.png)

 
 
