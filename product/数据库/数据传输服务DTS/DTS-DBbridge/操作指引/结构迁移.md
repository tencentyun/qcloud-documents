本文为您介绍结构迁移的操作、结构迁移页面和结构迁移对象转换规则的详情。

<span id = "ksjgqy"></span>
## 开始结构迁移
1. 登录 [DTS-DBbridge控制台](https://cloud.tencent.com/document/product/571/45866#.E6.AD.A5.E9.AA.A4.E4.B8.80.EF.BC.9A.E7.99.BB.E5.BD.95.E6.8E.A7.E5.88.B6.E5.8F.B0)，在左侧导航选择【数据迁移管理】页面，单击“操作”列的【详情】，进入该通道的基本信息页面。
2. 通道基本信息页面，展示迁移的五个阶段，单击【结构迁移】，进入结构迁移页面。
![](https://main.qcloudimg.com/raw/917cb7f8fb876d29e844d1d90c37cb47.png)
3. 在结构迁移页面，单击【开始结构迁移】，进入开始结构迁移页面。
![](https://main.qcloudimg.com/raw/444e73545ac0fb4bd5f904a3f40066be.png)
4. 在弹出页面，选择是否设置分布式表，分布键等，选择完成后，单击【提交】开始迁移。
 - 是否设置分布式表：只要有一个表需要设置分布式表，就需要选择【是】。
 - 分步键：只给出可以设置分区键的字段类型。
 - 分区模式：给出可功能选择的分布模式 Shard、replication。
![](https://main.qcloudimg.com/raw/0724651fa8e691a0e2bed619b40fcb5f.png)


## 结构迁移页面
1. 登录 [DTS-DBbridge控制台](https://cloud.tencent.com/document/product/571/45866#.E6.AD.A5.E9.AA.A4.E4.B8.80.EF.BC.9A.E7.99.BB.E5.BD.95.E6.8E.A7.E5.88.B6.E5.8F.B0)，在左侧导航选择【数据迁移管理】页面，单击“操作”列的【详情】，进入该通道的基本信息页面。
2. 通道基本信息页面，展示迁移的五个阶段，单击【结构迁移】，进入结构迁移页面。
![](https://main.qcloudimg.com/raw/917cb7f8fb876d29e844d1d90c37cb47.png)

结构迁移页面主要有【基本信息】、【迁移对象查看】、【迁移对象转换】三个页面。
### 基本信息页面
 - “迁移信息”栏：通过进度条显示迁移的进度。
 - “基本信息”栏：统计需要评估的总对象数据、总数据量、迁移执行时间。
  - 任务状态：包含未开始、启动中、进行中、异常、成功。
  - 开始时间是启动评估的时间，而非创建时间；如果评估在进行中，则完成时间为空，如果评估成功，则显示完成时间。
  - 任务状态为“异常”、“成功”时，可以进行【重新开始结构迁移】。
 - “运行日志”栏：显示迁移任务执行过程中的执行日志，包括正常日志、error 日志、warning 日志等。
![](https://main.qcloudimg.com/raw/f3c0cd4de91c8f3d1097859004f2bd82.png)

### 迁移对象查看页面
在结构迁移过程中，可以进入【迁移对象查看】页面，查看当前结构对象迁移情况。

迁移对象按“模式名”和“对象类型”进行统计，显示该模式下不同对象类型的迁移总数，有多少迁移成功、多少迁移失败、剩下多少未迁移。
![](https://main.qcloudimg.com/raw/c6d8383799355df24dcf63d6ea8501fd.png)

#### 查看结构迁移失败对象
1. 对于迁移失败，可在【迁移对象查看】页面，单击“迁移失败数量”，进入迁移失败对象页面。
2. 在迁移失败对象页面，可会显示迁移结果（成功/失败），失败会给出失败原因（错误信息）。
![](https://main.qcloudimg.com/raw/fdec7882f6fc13657ad35dfce130bbab.png)
 - 单击“操作”列的【详情】，可以查看具体结构对象转换情况。
 - 单击“操作”列的【手动订正】，可进入到失败具体信息弹窗，进行手动转换 SQL 并执行迁移。
    - 异构数据库之间不同 SQL 语句的对比，“源SQL语句”是数据源的 SQL，“转换后目标语句”是用户应用迁移规则模板改造后的 SQL。
    - 转换后目标语句，支持用户手动修改。
    - 单击【再次执行】，可立刻执行手动修改后的目标 SQL。
![](https://main.qcloudimg.com/raw/79c5236fa117acdeedfd1bc93460924a.png)


### 迁移对象转换页面
迁移对象转换页面，显示所有需要迁移结构对象的转换情况。
![](https://main.qcloudimg.com/raw/2e80d092fdf114d9501ae07d2126afd9.png)
- 单击左侧的树状类别，可以查看该对象类型具体对象列表。
- 单击“操作”列的【查看】，可以查看该对象的转换情况。
在弹出对话框，可看源 SQL 语句和应用迁移规则后转换的目标 SQL 语句。
![](https://main.qcloudimg.com/raw/86a30980c414e2d3ffac0e5cd6a31775.png)


## Oracle 结构迁移对象转换规则
### Oracle 到 TDSQL 对象转换规则

| Oracle 对象 | TDSQL 对象                                            |
| ------------------ | ------------------------------------------------------------ |
| 普通表             | 同类转换，进行数据类型转换，关键字转换                       |
| 全局临时表       | 同类转换，进行关键字转换                                     |
| 视图                | 同类转换，进行关键字转换，内置函数转换，SQL 语法转换          |
| 序列                | 不支持转换                                                   |
| 函数               | 同类转换，进行关键字转换，内置函数转换，SQL 语法转换          |
| 存储过程         | 同类转换，进行关键字转换，内置函数转换，SQL 语法转换          |
| 物化视图          | 转换成基表 + 存储过程 + event 的形式                              |
| 触发器            | 同类转换，每个事件拆分为1个触发器                            |
| 包                  | 整体转换为数据库，包中的函数转换为函数、包中的存储过程转换为存储过程，都存放在该 Schema 下 |
| 同义词             | 转换成视图                                                   |
| 数据库链接       | 不支持转换                                                   |
| 类型（Type）   | 不支持转换                                                   |


### Oracle 到 TBase 对象转换规则

| Oracle 对象 | TBase 对象                                          |
| ------------------ | ------------------------------------------------------------ |
| 普通表            | 同类转换，进行数据类型转换，关键字转换                       |
| 全局临时表      | 同类转换，进行关键字转换                                     |
| 视图               | 同类转换，进行关键字转换，内置函数转换，SQL 语法转换          |
| 序列               | 同类转换，进行关键字转换                                     |
| 函数               | 同类转换，进行关键字转换，内置函数转换，SQL 语法转换          |
| 存储过程         | 转换成函数，进行关键字转换，内置函数转换，SQL 语法转换        |
| 物化视图         | 同类转换，进行关键字转换，内置函数转换，SQL 语法转换          |
| 触发器            | 转换成函数 + 触发器，进行关键字转换，内置函数转换，SQL 语法转换 |
| 包                 | 整体转换为 Schema，包中的函数与存储过程都转换为函数存放在该 Schema 下 |
| 同义词             | 转换成视图                                                   |
| 数据库链接         | 转换成 FDW                                                    |
| 类型（Type）     | 关键字转换                                                   |
