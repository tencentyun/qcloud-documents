
## 操作场景
设置目标库只读，是指在迁移过程中，DTS 回收目标数据库中的除迁移帐号外的所有写权限（同时禁止为用户授权），以限制对目标库的写入，待迁移完成后，再放开写权限。DTS 数据迁移过程中，对目标库进行写入可能会导致源和目标库的数据不一致，设置目标库只读可以避免因为双写导致的数据不一致问题。
>?当前用户如需体验该功能，请 [提交工单](https://console.cloud.tencent.com/workorder/category) 申请。

## 注意事项
因开启目标库只读功能，DTS 会回收目标库的写权限，所以目标库中的帐号数越多，任务处于**准备运行**和**完成中**的状态时间越长。

## 操作步骤

**当前目标库只读与账号迁移功能冲突，如果用户需要设置目标端只读，并迁移帐号，需要分两个迁移任务进行操作**。根据您是否需要迁移账号，请参考如下指导进行操作。

- 设置目标库只读，不迁移账号，请直接执行任务二。
- 设置目标库只读，迁移账号，请执行任务一和任务二。

#### 任务一：账号迁移
>?如下仅对设置目标库只读相关的操作进行差异介绍，用户配置时需要参考 [基础迁移操作指导](https://cloud.tencent.com/document/product/571/58688)，包括对迁移账号的授权，关注操作限制，注意事项等等。

在源数据库中创建一个空的 test 库，然后创建一个全量迁移任务，迁移对象选择迁移帐号和指定对象的 test 库，将源库的帐号迁移到目标库后，结束任务。

1. 在源数据库中创建一个空的 test 库。
2. 登录 [DTS 控制台](https://console.cloud.tencent.com/dts/migration)，在左侧导航选择**数据迁移**页，单击**新建迁移任务**，进入新建迁移任务页面。
3. 在新建迁移任务页面，选择迁移的源数据库类型和所属地域，目标数据库类型和所属地域，规格等，然后单击**立即购买**。
4. 配置迁移任务。
    在**设置源和目标数据库**页面，完成任务设置、源库设置和目标库设置，测试源库和目标库连通性通过后，单击**新建**。
   ![](https://qcloudimg.tencent-cloud.cn/raw/9379ea38fc750ee5818cc5a41ff010df.png)
5. 在**设置迁移对象及选择迁移对象**页面，设置迁移类型，对象等，单击**保存**。
 - 迁移类型：选择**全量迁移**。
 - 数据一致性检测：选择**不检测**。
 - 迁移对象：选择**指定对象**，并勾选 test 库。
 - 是否迁移账号：勾选。
 - 高级迁移对象：
   ![](https://qcloudimg.tencent-cloud.cn/raw/6ba3c4526486abef7bbc4d12eca65d8c.png)     
6. 在**校验任务**页面，DTS 会检查源库的账号信息，并对符合要求的账号进行迁移。
>?账号迁移的详细要求请参考 [账号迁移](https://cloud.tencent.com/document/product/571/65702)。
>
![](https://qcloudimg.tencent-cloud.cn/raw/99697d83ced516835cba2c89d743021e.png)
7. 待任务状态为**已完成**，创建第二个迁移任务。

#### 任务二：设置目标库只读

迁移除账号外的其他对象，并设置目标库只读。

1. 购买迁移任务，在新建迁移任务页面，选择迁移的源数据库类型和所属地域，目标数据库类型和所属地域，规格等，然后单击**立即购买**。
2. 配置迁移任务。
   在**设置源和目标数据库**页面，完成任务设置、源库设置和目标库设置，测试源库和目标库连通性通过后，单击**新建**。接入类型需要和任务一中选择的接入类型保持一致。
3. 在**设置迁移对象及选择迁移对象**页面，设置迁移类型，对象等，单击**保存**。
 - 迁移类型：根据实际情况选择。
 - 数据一致性检测：根据实际情况选择是否需要检测。
 - 迁移对象：选择**整个实例**。
 - 高级迁移对象：根据实际情况选择。
 - 目标库只读：勾选。
 - 是否迁移账号：不勾选。
    <img src="https://qcloudimg.tencent-cloud.cn/raw/0531b5c2dc10791f19007bcaf0a00dc0.png" style="zoom:40%;" />
4. 校验任务。
5. 返回数据迁移任务列表，任务进入准备运行状态，运行1分钟 - 2分钟后，数据迁移任务开始正式启动。
目标库中的帐号数越多，这里任务的**准备运行**和**完成中**状态时间越长。

