## 问题现象
用户在创建备份计划任务或者恢复数据库任务时，源数据库或者目标数据库连通性测试失败。

## 可能原因
- Telnet 测试不通过，可能原因如下。
  - [源数据库所在服务器设置了安全组或防火墙](#1)。
  - [源数据库对来源 IP 地址进行了限制](#2)。
  - [源数据库端口未放通](#3)。
  - 网络问题，如网段冲突，参数配置错误等，选择 [VPN/专线](https://cloud.tencent.com/document/product/1513/64041) 接入、[云联网](https://cloud.tencent.com/document/product/1513/64042) 接入方式的可以参考相应链接指导进行检查。

- Telnet 测试通过，Database Connect 失败。
  - 备份帐号授权问题。请参考各备份场景中准备工作的要求，重新对备份帐号授权。
  - 帐号或密码不正确。

## 处理方法
### [源数据库所在网络或服务器设置了安全组或者防火墙](id:1)
安全组功能与防火墙功能类似，安全组是针对云上数据库的网络安全设置。

请根据现场情况，进行以下检查步骤：
- 查看源数据库所在的服务器是否配置了防火墙策略，如果有设置，请关闭服务器的防火墙，然后登录重新执行校验任务。
  - Windows 系统：打开控制面板找到 Windows 防火墙。 
  - Linux 系统：请执行 `iptables -L` 命令查看。

- 查看数据库配置的安全组是否限制了 DBS 的 IP 地址段。
  1. 登录源数据库，在实例列表，单击实例 ID，进入实例管理页面。
  2. 在实例管理页面，选择**安全组**页，查看是否存在禁止 DBS 的 IP 地址段的策略。如果有，修改 DBS 的 IP 地址段的策略，配置为**允许**。
![](https://main.qcloudimg.com/raw/9ca243d120eba0f8014e8019ffc31fba.png)

### [源数据库对来源 IP 地址进行了限制](id:2) 
#### MySQL 修复方法
- 在给备份账号进行源数据库的授权时，授权的 IP 中需要包含 DBS 的 IP，否则会发生 IP 受限问题。示例如下：
```
root@10.0.0.0/8  //授权用户通过指定10.0.0.0/8访问，其他 IP 会受限（错误配置）
root@%           //授权用户访问所有的 IP，其中需要包含 DBS 的 IP（正确配置）
```
请在源数据库中执行以下 SQL 语句，重新给备份用户进行授权。
```
mysql> grant all privileges on . to '[\$UserName]'@'%';  //[\$Username] 为备份任务中填写的数据库帐号
mysql> flush privileges;
```

- 如果源数据库为自建数据库，需要检查 bind-address 配置，如果不是0.0.0.0，则 IP 受限，请参考如下指导修改。
a. 在 `/etc/my.cnf` 文件中增加如下内容。
>?`my.cnf` 配置文件的默认路径为 `/etc/my.cnf`，现场以实际情况为准。
>
```
bind-address=0.0.0.0 #全部地址或者指定的 IP 地址
```
b. 重启数据库。
```
service mysqld restart
```
c. 验证配置是否生效。
```
netstat -tln
```
d. 重新执行校验任务。

### [网络端口未放通](id:3)
MySQL 数据库默认端口为3306，需要确认该端口已放通。如果用户修改了默认端口，请按实际情况修改放通的端口。
