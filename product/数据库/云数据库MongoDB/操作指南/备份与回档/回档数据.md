本文为您介绍云数据库 MongoDB 对备份的数据进行恢复的具体操作。

## 背景信息
当您需要对备份的数据进行恢复操作时，可以在控制台进行库表回档。当您需要恢复整个实例的数据时，可以进行克隆实例的操作。

## 版本说明
分片集群当前版本均不支持库表回档，只能克隆整个实例。具体操作，请参见 [克隆实例](#klsl)。

## 使用须知
- 实例的 oplog 空间为固定集合（Capped Collection），当集合空间用完后，再插入的元素就会覆盖最初始的头部的元素。oplog 空间被覆盖可能导致备份和恢复失败，以及无法保证数据恢复的时间点，请根据业务详情合理设置 oplog 空间大小。
- 请关注实例管理页**系统监控**里的**oplog时间差**监控指标，在业务有频繁写入、更新和删除操作时，该指标越小，oplog 被覆盖的风险越大。

## 使用限制
- 单个实例一次最多可选择2000个库表进行回档 。
- 分片集群不支持库表回档，仅支持克隆实例。
- 物理备份当前不支持库表回档。
- 可以回档7天内任意时间的数据。

## 前提条件
- 已 [申请云数据库 MongoDB 实例](https://cloud.tencent.com/document/product/240/3551)。
- 云数据库 MongoDB 副本集实例或分片实例的状态为**运行中**。
- 已通过逻辑备份 [备份数据](https://cloud.tencent.com/document/product/240/7108)。

## 操作步骤
### [克隆实例](id:klsl)
1. 登录 [MongoDB 控制台](https://console.cloud.tencent.com/mongodb)。
2. 在左侧导航栏 **MongoDB** 的下拉列表中，选择**副本集实例**或者**分片实例**。副本集实例与分片实例操作类似。
3. 在右侧实例列表页面上方，选择地域。
4. 在实例列表中，找到目标实例。
5. 单击目标实例 ID，进入**实例详情**页面。
6. 选择**备份与回档**页签，进入**备份任务列表**页面。
7. 在**备份任务列表**中，找到需要恢复的备份文件。
8. 在其**操作**列，单击**克隆**。
9. 在**云数据库 MongoDB 克隆实例**页面，选择新实例的计费模式、配置规格等。具体信息，请参见 [创建 MongoDB 实例](https://cloud.tencent.com/document/product/240/3551)。
10. 确认费用，单击**立即购买**。返回实例列表页面，待实例完成创建，即可使用。

### 库表回档
1. 在**实例详情**页面，选择**备份与回档**页签。
2. 在**备份与回档**页签，进入**备份任务列表**页面。
3. 在**备份任务列表**中，找到需要恢复的备份文件。
4. 在其**操作**列，单击**库表回档**。
![](https://qcloudimg.tencent-cloud.cn/raw/44d5a5c48f779430800e4a5e97b569a5.png)
5. 在**回档库表**配置向导的**批量选择库表**页面，根据如下表格，选择回档库表信息。
<table>
<thead><tr><th>参数</th><th>是否必选</th><th>参数解释</th></tr></thead>
<tbody><tr>
<td><strong>搜索实例</strong></td>
<td>否</td>
<td>选择备份数据回档的目标实例。您可以选择已克隆的新建实例名称，也可以选择当前实例。恢复备份数据至克隆的实例，克隆的实例必须是同地域的不同可用区。</td></tr>
<tr>
<td><strong>回档方式</strong></td>
<td>否</td>
<td>默认为<strong>部分库表回档</strong>。</td></tr>
<tr>
<td><strong>选择回档库表</strong></td>
<td>是</td>
<td>选择需要回档的数据库和表。</td></tr>
</tbody></table>
6. 单击**下一步：设置回档时间和库表名**，设置回档时间以及回档后的库表名。
7. 单击**完成**，选择**回档任务列表**页签，查看回档任务进度。
8. 等待任务执行完成，确认回档数据。

