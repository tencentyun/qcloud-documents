
为防止因系统故障等因素而导致的数据丢失，云数据库 MongoDB 支持对数据进行备份，在系统恢复后并进行数据回档，以保证数据完整性。

## 背景信息
**备份类型**
- 自动备份：指根据系统默认的备份策略（例如默认的备份时间间隔和备份方式）定时自动备份数据。
- 手动备份：指根据业务运维排障需求，立即执行备份任务的操作。

**备份方式**
- 物理备份：备份实例中数据库相关的实际物理文件，备份速度快，备份成功率高，恢复简单。不具备移植性，备份环境和恢复环境必须是完全相同的。
- 逻辑备份：备份时，连接数据库实例，使用 mongodump 工具将数据库的操作日志存储到逻辑备份文件中实现数据备份。恢复时，再通过操作日志回放操作记录还原数据，备份速度慢， 可移植性比较强，可以把数据库的逻辑备份恢复到不同版本数据库。 

## 使用限制
- 物理备份当前不支持库表回档。
- 备份可以连续覆盖7天的数据，即可以回档7天内任意时间的数据。

## 使用须知
- 实例备份过程中不影响业务使用。
- 备份文件存储在腾讯云对象存储（Cloud Object Storage，COS）中，不会占用云数据库 MongoDB 实例的存储空间。关于对象存储服务的更多信息，请参见 [对象存储](https://cloud.tencent.com/document/product/436)。 

## 版本说明
<table>
<thead><tr><th>版本</th><th>实例类型</th><th>自动备份</th><th>手动备份</th></tr></thead>
<tbody><tr>
<td rowspan="2">3.2版本</td><th>副本集</th><td><ul><li>默认备份方式：逻辑备份</li><li>支持备份方式：逻辑备份与物理备份</li></ul></td><td><ul><li>默认备份方式：逻辑备份</li><li>支持备份方式：逻辑备份与物理备份</li></ul></td></tr>
<tr>
<th>分片集群</th><td><ul><li>默认备份方式：逻辑备份</li><li>支持备份方式：逻辑备份与物理备份</li></ul></td><td><ul><li>默认备份方式：逻辑备份</li><li>支持备份方式：逻辑备份与物理备份</li></ul></td></tr>
<tr>
<td rowspan="2">3.6版本</td><th>副本集</th><td><ul><li>默认备份方式：逻辑备份</li><li>支持备份方式：逻辑备份</li></ul></td><td><ul><li>默认备份方式：逻辑备份</li><li>支持备份方式：逻辑备份</li></ul></td></tr>
<tr>
<th>分片集群</th><td><ul><li>默认备份方式：逻辑备份</li><li>支持备份方式：逻辑备份</li></ul></td><td><ul><li>默认备份方式：逻辑备份</li><li>支持备份方式：逻辑备份</li></ul></td></tr>
<tr>
<td rowspan="2">4.0版本</td>
<th>副本集</th><td><ul><li>默认备份方式：逻辑备份</li><li>支持备份方式：逻辑备份</li></ul></td><td><ul><li>默认备份方式：逻辑备份</li><li>支持备份方式：逻辑备份</li></ul></td></tr>
<tr><th>分片集群</th><td><ul><li>默认备份方式：逻辑备份</li><li>支持备份方式：逻辑备份与物理备份</li></ul></td><td><ul><li>默认备份方式：逻辑备份</li><li>支持备份方式：逻辑备份与物理备份</li></ul></td></tr>
<tr>
<td rowspan="2">4.2版本</td>
<th>副本集</th><td><ul><li>默认备份方式：逻辑备份</li><li>支持备份方式：逻辑备份与物理备份</li></ul></td><td><ul><li>默认备份方式：逻辑备份</li><li>支持备份方式：逻辑备份与物理备份</li></ul></td></tr>
<tr>
<th>分片集群</th>
<td><ul><li>默认备份方式：逻辑备份</li><li>支持备份方式：逻辑备份与物理备份</li></ul></td><td><ul><li>默认备份方式：逻辑备份</li><li>支持备份方式：逻辑备份与物理备份</li></ul></td></tr>
</tbody></table>

## 计费说明
当前免费，后续备份空间收费将另行通知。

## 前提条件
- 已 [申请云数据库 MongoDB 实例](https://cloud.tencent.com/document/product/240/3551)。
- 云数据库MongoDB副本集实例或分片实例的状态为**运行中**。

## 操作步骤
### 调整自动备份策略
1. 登录 [MongoDB 控制台](https://console.cloud.tencent.com/mongodb)。
2. 在左侧导航栏 **MongoDB** 的下拉列表中，选择**副本集实例**或者**分片实例**。副本集实例与分片实例操作类似。
3. 在右侧实例列表页面上方，选择地域。
4. 在实例列表中，找到目标实例。
5. 单击目标实例 ID，进入**实例详情**页面。
6. 选择**备份与回档**页签，进入**备份任务列表**页面。
7. 选择**自动备份设置**页签，单击**编辑**。
8. 根据如下表格的参数说明，重新编辑**备份方式**、**备份时间间隔**、**备份时间间隔**与**备份异常是否通知**。
9. 单击**保存**，备份任务将在一分钟后启动 。
<table>
<thead><tr><th>参数</th><th>说明</th></tr></thead>
<tbody><tr>
<td>数据备份保留</td><td>默认备份数据保留7天。</td></tr>
<tr>
<td>备份方式</td><td><ul><li>（可选）选择备份方式。</li><li>MongoDB 3.6版本与4.0版本副本集实例不支持设置该参数。</li></ul></td></tr>
<tr>
<td>备份时间间隔</td><td><ul><li>默认为<b>每24小时备份一次</b>，即每天备份一次。</li><li>支持<b>每12小时备份一次</b>和<b>每24小时备份一次。</b></li></ul></td></tr>
<tr>
<td>备份开始时间</td>
<td><ul><li>默认开始时间为01:00-02:00，即系统会在每天01:00-02:00时间段内开始备份任务。</li><li>支持选择不同时间段开始备份数据，您可以根据实际业务情况设定。</li><li>具体的开始时间会随着备份任务具体调度而变化。</li></ul></td></tr>
<tr>
<td>备份异常是否通知</td>
<td><ul><li>指备份任务执行异常时是否通知用户。</li><li>通知方式为腾讯云监控事件，事件通知为白名单方式，如需开通请 <a href="https://console.cloud.tencent.com/workorder/category">提交工单</a>。</li>MongoDB 的云监控支持事件，请参见 <a href="https://cloud.tencent.com/document/product/248/14363">事件列表</a>。</ul></td></tr>
</tbody></table>      

### 手动备份
1. 登录 [MongoDB 控制台](https://console.cloud.tencent.com/mongodb)。
2. 在左侧导航栏 **MongoDB** 的下拉列表中，选择**副本集实例**或者**分片实例**。副本集实例与分片实例操作类似。
3. 在右侧实例列表页面上方，选择地域。
4. 在实例列表中，找到目标实例。
5. 单击目标实例 ID，进入**实例详情**页面。
6. 在实例**实例详情**页面的右上角，单击**手动备份**。
7. （可选）在弹出的对话框，选择**备份方式**。MongoDB 3.6版本与4.0版本副本集实例不支持设置该参数。
8. 添加备注信息，单击**确定**。

### 下载备份文件
1. 登录 [MongoDB 控制台](https://console.cloud.tencent.com/mongodb)。
2. 在左侧导航栏 **MongoDB** 的下拉列表中，选择**副本集实例**或者**分片实例**。副本集实例与分片实例操作类似。
3. 在右侧实例列表页面上方，选择地域。
4. 在实例列表中，找到目标实例。
5. 单击目标实例 ID，进入**实例详情**页面。
6. 选择**备份与回档**页签，进入**备份任务列表**页面。
7. 在**备份任务列表**，找到需备份的文件，单击其**操作**列的**下载**。
8. 在**生成备份文件**对话框，认真阅读备份提示信息，单击**确定**。
9. 选择**下载文件列表**页签，查看备份任务进度。
10. 待任务执行完成，通过如下方式备份数据至本地查看。
  - 外网方式：在**操作**列，单击**外网下载**，直接通过浏览器下载备份到本地。
  - 内网方式：复制内网地址，在 CVM 服务器中，通过wget命令格式：`wget -c '内网地址' -O backup.tar` 进行内网高速下载。如何登录 CVM，请参见 [登录 CVM](https://cloud.tencent.com/document/product/213/2936#.E6.AD.A5.E9.AA.A43.EF.BC.9A.E7.99.BB.E5.BD.95.E4.BA.91.E6.9C.8D.E5.8A.A1.E5.99.A8)。

## 相关 API
| 接口                       | 说明                                                         |
| -------------------------- | ------------------------------------------------------------ |
| DescribeDBBackups          | [查询实例备份列表](https://cloud.tencent.com/document/product/240/54174) |
| CreateBackupDBInstance     | [备份实例](https://cloud.tencent.com/document/product/240/46599) |
| DescribeBackupDownloadTask | [查询备份下载任务信息](https://cloud.tencent.com/document/product/240/54174) |
| CreateBackupDownloadTask   | [创建备份下载任务](https://cloud.tencent.com/document/product/240/54175) |

