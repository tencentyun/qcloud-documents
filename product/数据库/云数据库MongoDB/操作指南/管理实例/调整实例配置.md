云数据库 MongoDB 提供了灵活地扩缩容操作，您可以对当前实例进行变配操作，使当前实例的配置与您的业务需求更加匹配。

## 背景信息
- 当您已购买的实例配置不符合（高于或低于）当前业务需求时，您可根据其业务所处的实际情况（业务初期、业务快速发展期、业务高峰期、业务低谷期等）快速调整其 MongoDB 实例的规格，从而更好地满足资源的充分利用和成本实时优化。

- 系统默认每个副本集集群是1主2从的架构。当您已购买的集群的节点数量不符合（高于或低于）当前业务需求时，您可以根据实际情况及时调整节点数量，使当前实例的配置与您的业务需求更加匹配。

- 分片集群的每一个分片是一个副本集，每一个副本集实例由一个 Primary 节点和一个或多个 Secondary 节点组成。当您已购买的分片集群的分片数量低于当前业务需求（例如视频直播 、双十一秒杀促销活动）时，您可以根据实际业务场景，横向扩展实例的分片数量，以满足当前的业务需求。

## 版本说明
- 当前 MongoDB 4.2、4.0、3.6和3.2版本均支持调整实例的容量规格。
- MongoDB 4.2版本副本集实例不支持变更实例的节点数。
- MongoDB 4.2版本分片实例不支持调整实例的单分片节点数与分片数量。

## 计费说明
调整实例配置，将按照新配置开始计费，请保证腾讯云账号余额充足。具体信息，请参见 [变配计费说明](https://cloud.tencent.com/document/product/240/64503)。

## 注意事项
1. 当前实例没有任何任务执行，才能发起调整配置的操作。
2. 调整配置过程中可能出现1 - 2次闪断现象，每次约10秒，建议程序有自动重连功能。
3. 调整配置过程中，可能会涉及到数据的搬迁，实例可正常访问。
4. 调整配置过程中，无法取消本次调整配置操作。
5. 调整配置过程中，可能发生短暂请求延迟的现象，请您适当调整业务超时时间。

## 使用须知
1. 调整配置时，建议同时调整 oplog，oplog 容量至少占节点容量的10%。如果 oplog 过小，容易被冲掉，oplog 被冲会影响回档功能。
2. 实例降配时，oplog 会初始化为新存储规格的10%。
3. 调整配置前后实例的名称、内网地址与端口均不发生变化。
4. 新增节点加入集群开始同步数据，业务不受影响。
5. 当前分片实例只能增加分片数量，不能减少。新增分片加入集群开始同步数据，业务不受影响。

## 前提条件
- 已 [申请云数据库 MongoDB 实例](https://cloud.tencent.com/document/product/240/3551)。
- 如果为按量计费实例，请确保您的腾讯云账号余额充足。
- 实例及其所关联的实例处于正常状态下（运行中），并且当前没有任何任务执行。

## 操作步骤
### 调整规格容量
1. 登录 [MongoDB 控制台](https://console.cloud.tencent.com/mongodb)。
2. 在左侧导航栏 **MongoDB** 的下拉列表中，选择**副本集实例**或者**分片实例**。副本集实例与分片实例操作类似。
3. 在右侧实例列表页面上方，选择地域。
4. 在实例列表中，找到目标实例。
5. 在目标实例的**操作**列，在**配置调整**的下拉列表中，选择**配置调整**。
6. 在**配置调整**页面，可以重新调整节点规格、节点容量、Oplog 容量。
7. 在**切换时间**选项中，选择切换实例规格的具体时间。
   - 选择**调整完成时**，立即执行调整实例规格任务。
   - 选择**维护时间**，在维护时间段内执行切换实例规格任务。
>!**维护时间**一般设置在业务低峰期，需要对实例进行定期维护。选择**调整完成时**立即调整实例配置，可能涉及节点迁移或者主从切换，主从切换时间点将不可控，强烈建议调整实例配置在**维护时间**内进行。更多信息，请参见 [设置实例维护时间](https://cloud.tencent.com/document/product/240/19910)。
8. 单击**计费详情**，可查看计费项目、计费公式，确认**费用**。
9. 确认无误，单击**提交**。

### 调整节点数量
#### 调整节点数（副本集实例）
1. 登录 [MongoDB 控制台](https://console.cloud.tencent.com/mongodb)。
2. 在左侧导航栏 **MongoDB** 的下拉列表中，选择**副本集实例**。
3. 在右侧实例列表页面上方，选择地域。
4. 在实例列表中，找到目标实例。
5. 在目标实例的**操作**列，选择**配置调整** > **调整节点数**。
6. 在**调整节点数**对话框，认真阅读调整节点数的注意事项。
7. 在**节点数**后面的输入框，重新选择变配的主备节点数量。具体如下：
   - **3**：不支持降级。
   - **5**：支持降级为**3**节点。
   - **7**：支持降级为**3**节点或**5**节点。
8. 确认费用信息，单击**确定**，完成操作。

#### 调整单分片节点数（分片实例）
1. 登录 [MongoDB 控制台](https://console.cloud.tencent.com/mongodb)。
2. 在左侧导航栏 **MongoDB** 的下拉列表中，选择**分片实例**。
3. 在右侧实例列表页面上方，选择地域。
4. 在实例列表中，找到目标实例。
5. 在目标实例的**操作**列，选择**配置调整** > **调整单分片节点数**。
6. 在**调整单分片节点数**对话框，认真阅读调整节点数的注意事项。
7. 在**节点数**后面的输入框，重新选择变配的主备节点数量。具体如下：
   - **3**：不支持降级。
   - **5**：支持降级为**3**节点。
   - **7**：支持降级为**3**节点或**5**节点。
8. 确认费用信息，单击**确定**，完成操作。

### 调整分片数量（分片实例）
1. 登录 [MongoDB 控制台](https://console.cloud.tencent.com/mongodb)。
2. 在左侧导航栏 **MongoDB** 的下拉列表中，选择**分片实例**。
3. 在右侧实例列表页面上方，选择地域。
4. 在实例列表中，找到目标实例。
5. 在目标实例的**操作**列，选择**配置调整** > **调整分片数**。
6. 在**调整分片数**对话框，认真阅读调整分片数的注意事项。
7. 在**节点数**后面的输入框，重新选择分片数量，取值范围：[2,19]。
8. 单击**计费详情**，可查看计费项目、计费公式，确认**费用**。
9. 确认无误，单击**提交**。

## API
| API 接口名称                                                  | API 接口功能描述      |
| ------------------------------------------------------------ | -------------------- |
| [ModifyDBInstanceSpec](https://cloud.tencent.com/document/product/240/38565) | 调整云数据库实例配置 |

