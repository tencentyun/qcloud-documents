## 操作场景

当您已购买的实例配置不符合（高于或低于）当前业务需求时，您可根据其业务所处的实际情况（业务初期、业务快速发展期、业务高峰期、业务低谷期等）快速调整其 MongoDB 实例的规格，从而更好地满足资源的充分利用和成本实时优化。

实例的配置变更包括：调整实例的计算规格、存储容量以及节点数量。分片集群也支持调整分片数量以及单分片的节点数量。变配之前，请您先了解云数据库支持的 [产品规格](https://cloud.tencent.com/document/product/240/64125)， 帮助您选择适合自身业务的规格。 

## 版本说明

- 当前 MongoDB 4.2、4.0、3.6和3.2 版本均支持调整实例的内存与容量规格。
- MongoDB 4.2 版本副本集实例不支持变更实例的节点数。
- MongoDB 4.2 版本分片实例不支持调整实例的单分片节点数与分片数量。
- MongoDB 3.2 版本分片实例不支持调整实例的分片数量。

## 计费说明

调整实例配置，将按照新配置开始计费，请保证腾讯云账号余额充足。具体信息，请参见 [变配计费说明](https://cloud.tencent.com/document/product/240/64503)。

## 前提条件

- 已 [申请云数据库 MongoDB 实例](https://cloud.tencent.com/document/product/240/3551)。
- 如果为按量计费实例，请确保您的腾讯云账号余额充足。
- 实例及其所关联的实例处于正常状态下（运行中），并且当前没有任何任务执行。

## 调整计算规格与存储容量
>?
>- 调整实例的内存与容量是把您所选择的配置的节点加入集群开始同步数据，同步数据期间服务不受影响，数据同步完成后删除老的节点，然后选举新的主节点，在选举过程中整个实例的服务会有10秒左右的闪断，建议您在业务代码里做好容灾处理并选择业务低谷时调整。
>- 调整过程中，可能出现1 - 2次闪断现象，每次约10秒，建议程序有自动重连功能。
>- 调整过程中， 若您将 writeconcern 关注等级设置为 write majority ，可能发生短暂请求延迟的现象，请您适当调整业务超时时间。
>- 调整配置后实例的名称、内网地址与端口均不发生变化。
>- 调整配置任务一旦发起，无法中途取消本次操作。

1. 登录 [MongoDB 控制台](https://console.cloud.tencent.com/mongodb)。
2. 在左侧导航栏 **MongoDB** 的下拉列表中，选择**副本集实例**或者**分片实例**。
   副本集实例与分片实例操作类似。
3. 在右侧实例列表页面上方，选择地域。
4. 在实例列表中，找到目标实例。
5. 在目标实例的**操作**列，在**配置调整**的下拉列表中，选择**配置调整**。
6. 在**配置调整**页面，可以重新调整节点内存、节点中容量、Oplog 容量。如下图（以分片实例）所示。
![](https://qcloudimg.tencent-cloud.cn/raw/41dc7ba968f0aee2952f075a7835d5f9.png)
<table class="table-striped">
<tbody>
<tr><th>参数名称</th><th>参数解释</th><th>参数示例</th></tr>
<tr>
<td>实例名称</td>
<td>当前待变更配置的实例名称</td>
<td>test-4dot2-XXX</td></tr>	
<tr>
<td>到期时间</td>
<td>实例的到期时间，针对包年包月计费提醒实例到期时间。</td>
<td>	
2022-04-24 19:23:43</li></ul></td></tr>
<tr>
<td>实例架构</td>
<td>实例的集群架构说明。具体信息，请参见 <a href="https://cloud.tencent.com/document/product/240/64126">系统架构</a>。</td>    
<td>分片集群实例，有2个片，每片由3个存储节点构成副本集，整个实例共6个存储节点</td></tr>	
<tr>
<td>当节点内存/总容量</td>
<td>当前实例单个节点的内存以及总容量。对于分片集群，节点的总容量为单个分片的节点容量。如何查询实例的 CPU 核数，请参见 <a href="https://cloud.tencent.com/document/product/240/64125">产品规格</a> 中的 mongod 规格，例如当前节点内存为4GB，对应CPU 2核。</td>   
<td>4GB/1230GB</td></tr>
<tr>
<td>节点内存</td>
<td>在下拉列表重新选择单个节点的内存，默认为节点当前内存。如何选择规格，请参见 <a href="https://cloud.tencent.com/document/product/240/64125">产品规格</a> 中的 mongod 规格。例如，节点内存选择8GB，对应CPU 4核。</td>    
<td>8GB</td></tr>
<tr>
<td>节点总容量</td>
<td>在滑轴上调整单个节点的总容量，默认为当前节点的总容量。如何选择规格，请参见 <a href="https://cloud.tencent.com/document/product/240/64125">产品规格</a> 中的 mongod 规格。例如，4核8GB对应可选的存储容量范围为【20,3000】，单位为：GB。</td>    
<td>1230GB</td></tr>
<tr>
<td>Oplog 容量</td>
<td>建议同时在 Oplog 容量的滑轴上同时调整其容量：<ul><li>Oplog 容量至少占节点容量的10%。</li><li>如果 Oplog 过小，容易被冲掉，Oplog 被冲会影响回档功能。</li><li>实例降配时，Oplog 会初始化为新存储规格的10%。为防止调整规格后 Oplog 首次写入时间被覆盖而影响回档，降配前请进行手工备份。</li></ul></td>   
<td>123GB</td></tr>
<tr>
<td>切换时间</td>
<td><ul><li>选择<b>调整完成时</b>，立即执行调整实例规格任务。调整实例内存与容量可能涉及节点迁移或者主从切换，主从切换时间点将不可控，可能导致断连或重启。</li><li>选择<b>维护时间</b>，在维护时间段内执行切换实例规格任务。关于维护时间的更多信息，请参见 <a href="https://cloud.tencent.com/document/product/240/19910">设置实例维护时间</a>。</li></ul></td>    
<td>维护时间</td></tr>
<tr>
<td>费用</td>
<td><ul><li><b>按量计费</b>：实例调整配置后每小时的计费单价。单击<b>计费详情</b>，可查看计费项目、计费公式，确认费用。</li><li><b>包年包月</b>：实例调整配置后每月的费用。</li></ul>调整配置后的计费详情，请参见 <a href="https://cloud.tencent.com/document/product/240/64503">变配计费说明</a>。</td>    
<td>x,xx.xx元</td></tr>
</tbody></table>
8. 确认无误，单击**提交**。

## 调整节点数量
>?
>- 新增节点加入集群开始同步数据，业务不受影响。
>- 务必做好容灾处理，建议在维护时间内发起变配任务。维护时间的更多信息，请参见 [设置实例维护时间](https://cloud.tencent.com/document/product/240/19910)。
>- 切勿同时发起调整节点数、调整节点计算规格与存储的任务。
>- 节点数调整后，将按照新规格开始计费。
>- 调整节点数量后实例的名称、内网地址与端口均不发生变化。
>- 调整配置任务一旦发起，无法中途取消本次操作。

1. 登录 [MongoDB 控制台](https://console.cloud.tencent.com/mongodb)。
2. 在左侧导航栏 **MongoDB** 的下拉列表中，选择**副本集实例**。
3. 在右侧实例列表页面上方，选择地域。
4. 在实例列表中，找到目标实例。
5. 在目标实例的**操作**列，选择**配置调整** > **调整节点数**。
6. 在**调整节点数**对话框，了解调整节点数的注意事项，确认调整节点数的实例名称、到期时间等。
<img src="https://qcloudimg.tencent-cloud.cn/raw/6c9bf8bcfc647e880ddb49f5045c8de9.png" style="zoom:50%;" />
<table class="table-striped">
<tbody>
<tr><th>参数名称</th><th>参数解释</th><th>参数示例</th></tr>
<tr>
<td>实例名称</td>
<td>当前待调整节点数的实例名称。</td>
<td>test-4dot2-XXXX</td></tr>	
<tr>
<td>到期时间</td>
<td>实例的到期时间，针对包年包月计费提醒实例到期时间。</td>
<td>2022-04-24 19:23:43</li></ul></td></tr>
<tr>
<td>实例架构</td>
<td>实例的集群架构说明。具体信息，请参见 <a href="https://cloud.tencent.com/document/product/240/64126">系统架构</a>。</td>    
<td>副本集实例，有3个存储节点</td></tr>	
<tr>
<td>当前节点规格</td>
<td>当前副本集节点的规格信息，包括CPU核数、内存、存储容量、节点数量。</td>   
<td>2核4GB 内存，20GB 存储，共3个节点</td></tr>
<tr>
<td>节点数</td>
<td>在下拉列表重新选择实例的节点数量，默认为节点当前的节点数。<ul><li><b>3</b>：不支持降级，只能升为5节点或7节点。</li><li><b>5</b>：支持降级为3节点或升级为7节点。</li></li><li><b>7</b>：支持降级为3节点或5节点。</li></ul></td>    
<td>5</td></tr>
<tr>
<td>费用</td>
<td><ul><li><b>按量计费</b>：实例调整配置后每小时的计费单价。单击<b>计费详情</b>，可查看计费项目、计费公式，确认费用。</li><li><b>包年包月</b>：实例调整配置后每月的费用。</li></ul>调整配置后的计费详情，请参见 <a href="https://cloud.tencent.com/document/product/240/64503">变配计费说明</a>。</td>    
<td>x.xx元/小时</td></tr>
</tbody></table>
7. 确认费用信息，单击**确定**，完成操作。

## 调整单分片节点数（分片实例）

>?
>- 请务必做好容灾处理，建议在维护时间内。维护时间的更多信息，请参见 [设置实例维护时间](https://cloud.tencent.com/document/product/240/19910)。
>- 切勿同时发起调整单分片节点数、调整分片数和调整节点计算规格与存储的任务。
>- 新增节点加入集群开始同步数据，业务不受影响。
>- 节点数调整后，将按照新规格开始计费。
>- 调整节点数量后实例的名称、内网地址与端口均不发生变化。
>- 调整配置任务一旦发起，无法中途取消本次操作。

1. 登录 [MongoDB 控制台](https://console.cloud.tencent.com/mongodb)。
2. 在左侧导航栏 **MongoDB** 的下拉列表中，选择**分片实例**。
3. 在右侧实例列表页面上方，选择地域。
4. 在实例列表中，找到目标实例。
5. 在目标实例的**操作**列，选择**配置调整** > **调整单分片节点数**。
6. 在**调整单分片节点数**对话框，了解调整节点数的注意事项。
7. 在**节点数**后面的输入框，重新选择变配的主备节点数量。具体如下：
   - **3**：不支持降级。
   - **5**：支持降级为**3**节点。
   - **7**：支持降级为**3**节点或**5**节点。
8. 确认费用信息，单击**确定**，完成操作。

## 调整分片数量（分片实例）

> ?
> - 务必做好容灾处理，建议在维护时间内发起变配任务。维护时间的更多信息，请参见 [设置实例维护时间](https://cloud.tencent.com/document/product/240/19910)。
> - 切勿同时发起调整单分片节点数、调整分片数和调整节点计算规格与存储的任务。
> - 当前分片实例只能增加分片数量，不能减少。新增分片加入集群开始同步数据，业务不受影响。
> - 分片数调整后，将按照新规格开始计费。
> - 调整分片数量后实例的名称、内网地址与端口均不发生变化。
> - 调整配置任务一旦发起，无法中途取消本次操作。

1. 登录 [MongoDB 控制台](https://console.cloud.tencent.com/mongodb)。
2. 在左侧导航栏 **MongoDB** 的下拉列表中，选择**分片实例**。
3. 在右侧实例列表页面上方，选择地域。
4. 在实例列表中，找到目标实例。
5. 在目标实例的**操作**列，选择**配置调整** > **调整分片数**。
6. 在**调整分片数**对话框，了解调整分片数的注意事项。<br>
<img src="https://qcloudimg.tencent-cloud.cn/raw/2857063fdfe74e1b2a9253f70220ecdd.png" style="zoom:50%;" />
<table class="table-striped">
<tbody>
<tr><th>参数名称</th><th>参数解释</th><th>参数示例</th></tr>
<tr>
<td>实例名称</td>
<td>当前待调整节点数的实例名称。</td>
<td>test-4dot2-XXX</td></tr>	
<tr>
<td>到期时间</td>
<td>实例的到期时间，针对包年包月计费提醒实例到期时间。</td>
<td>2022-04-24 19:23:43</li></ul></td></tr>
<tr>
<td>实例架构</td>
<td>实例的集群架构说明。具体信息，请参见 <a href="https://cloud.tencent.com/document/product/240/64126">系统架构</a>。</td>    
<td>分片集群实例，有2分片，单片有5个存储节点</td></tr>	
<tr>
<td>当前节点规格</td>
<td>当前分片集群实例单个分片节点规格信息，包括 CPU 核数、内存、存储容量、节点数量。</td>   
<td>2核4GB内存，250GB存储，共10个节点</td></tr>
<tr>
<td>分片数</td>
<td>在下拉列表重新选择实例的分片数量，默认为实例当前的分片数。取值范围为【2,19】。</li></ul></td>   
<td>3</td></tr>
<tr>
<td>费用</td>
<td><ul><li><b>按量计费</b>：实例调整配置后每小时的计费单价。单击<b>计费详情</b>，可查看计费项目、计费公式，确认费用。</li><li><b>包年包月</b>：实例调整配置后每月的费用。</li></ul>调整配置后的计费详情，请参见 <a href="https://cloud.tencent.com/document/product/240/64503">变配计费说明</a>。</td>    
<td>x.xx元/小时</td></tr>
</tbody></table>
7. 确认无误，单击**提交**。

## 相关 API

| API 接口名称                                                 | API 接口功能描述     |
| ------------------------------------------------------------ | -------------------- |
| [ModifyDBInstanceSpec](https://cloud.tencent.com/document/product/240/38565) | 调整云数据库实例配置 |


