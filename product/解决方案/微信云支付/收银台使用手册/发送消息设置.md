## 用途
发送消息，即向与插件配合的收银软件发送相关指令，使得收银软件根据该消息做出响应。向收银软件发送消息的目的是为了减少对收银软件的人工操作，进而提高收银效率。但是带来方便的同时，服务商需要考虑到商户环境的复杂性（很难保证100%执行），一般情况下不建议使用该功能，请服务商慎重选择。由于该功能造成服务商运营成本的增加，在经常发送错误的情况下，请服务商取消使用该功能，避免重复处理。

## 消息类型
- 键盘消息：键盘消息模拟的是键盘按键，按键的组合以及可以形成响应的快捷键，一般收银软件为了操作方便，都配置了相应的快捷键，通过键盘消息，可以模拟收银软件相应的快捷键。当然，键盘消息也可以模拟键盘输入。
- 鼠标消息：模拟鼠标左键的点击，例如收银软件的按钮，都可以通过鼠标点击完成。
- 金额回填：支付成功，可以将金额回填到收银软件。
- 订单号回填：支付成功，可以将订单号回填到收银软件。

## 	设置步骤
消息的设置是根据收银软件实际操作需求和步骤来指定的，发送消息有多种选项，这些选项也是为了方便制定操作而设置的。
- 扫码和快捷键使用相同的消息：插件模式下拉起支付窗口存在通过快捷键和扫码两种方式，设置扫码和快捷键是否相同选项，使这两种方式可自定义不同的快捷键。
- 使用相同的快捷键消息：支付平台包括微信支付、支付宝、现金、银行卡、会员卡，当选择不同时可以给每种支付类型设定不同的快捷键组合，如果这些支付方式支付完成之后收银软件操作没有什么区分，可以设置相同快捷键。
- 发送键盘消息间屏蔽用户输入：为了防止用户发送消息期间的误操作，设置了该选项，这样用户的输入在发送快捷键期间无效。

理解了各种配置参数，下面以一款收银软件为例，介绍如何具体设置消息。
![](https://main.qcloudimg.com/raw/fdd3c433b1669f9719b5b9325a130ee9.png)
一般收银软件都是先输入商品，然后进入结算页面、选择支付方式、入账，最后完成本次收银。当存在支付插件时，可能会在录入商品之后或者进入结算页面之后，通过扫码或者快捷键方式切换到支付插件，获取金额后进行支付，支付成功后，由收银人员继续完成收银软件之后的收银步骤。当已使用“发送消息”功能时，便可借助这些消息，帮助收银人员完成收银。

本示例收银软件正常收银步骤如下：
1. 录入商品，然后按空格键或者单击**收款**处进入结算页面。
![](https://main.qcloudimg.com/raw/316758008bf3c7aebeedf665554b9dc1.png)
2. 选择支付方式，然后录入金额，完成后单击**确认**完成收款。
![](https://main.qcloudimg.com/raw/c02058fdc8b9963b11a8a744d6861b55.png)
在使用云支付收银台发送消息模拟这些步骤的时候，我们通过图像获取金额。
![](https://main.qcloudimg.com/raw/7c93db2ffc04274d13d3d03406e9ec0e.png)
发送消息页面中，“收银软件窗口”配置项为需要接收消息的窗口列表，可选择不配置。如需配置，可在收银软件调出需要接收消息的收银软件窗口，重启收银软件，在列表中找到相应的接收消息的窗口即可（可解决部分收银软件发送消息偶然接收不到的问题）。
3. 设置空格键盘消息，键盘消息只需要在键盘消息框中按下相应的键盘按键“空格键”，如果收银软件的收银入账是组合快捷键，则需要在键盘上按下组合快捷键，如 Ctrl+C。或通过鼠标点击消息，商户要根据实际情况选择。
![](https://main.qcloudimg.com/raw/514ecfb7e13190e4edc078893dc1be13.png)
进入收款界面，设置支付方式选择为鼠标消息，鼠标消息需要标定点击区域，一般标定在按钮中央，圈定合适大小的方形即可。
 ![](https://main.qcloudimg.com/raw/44d2b504e732884aa0f3fb2fd0e668dd.png)
4. 设置金额回填，金额回填也需要标定范围，标定回填位置是为了通过鼠标点击和清除操作让回填位置获取焦点和清除原先的金额，然后模拟键盘输入消息。这个位置的选取相当重要，选择不当影响回填金额的正确性，金额输入框由于存在各种设置的规则，应该根据金额输入框的规则合适选取。

 例如下面的金额回填，默认进入收款会选中回填金额，金额可以删除，输入框范围比较大，这里就可以圈定黑色区域。
![](https://main.qcloudimg.com/raw/b7e39c0d2600ee079c0c1c102ac99a28.png)
 ![](https://main.qcloudimg.com/raw/84487841df50359cfea84a04a4c8a7c9.png)
5. 设定鼠标消息**确认**收银。
![](https://main.qcloudimg.com/raw/0f527bbb2a7c3aaa2a582aa4aab9482f.png)
6. 设置其他的快捷键，具体如下。
 ![](https://main.qcloudimg.com/raw/3102d8ffa1ca2167351ff5a327894cc8.png)
设置完成后结合云支付收银台进行收银测试，如果出现问题，可根据实际情况修改。如未出现问题，即可进行自动化收银。

以上实例仅供参考。具体需根据实际收银软件操作步骤，完成收银操作。

## 常见问题
1. 由于收银软件本身的特点，设置完成后一定要测试每个步骤是否都能成功。
2. 由于电脑的差异性，每个操作步骤的反应时间不同，在设置时需要设置合适的消息时间间隔，如果不知道该如何设置可设置为较长的时间间隔。
 ![](https://main.qcloudimg.com/raw/18a80e2119215e6b755b5a84a985d2e9.png)
3. 金额回填位置选取要根据金额框实际的情况进行选择，具体如下。
 ![](https://main.qcloudimg.com/raw/a891cbc9a998d8382469f02b5f7445ae.png)
在实际操作中可能无法删除原来的金额，造成回填金额不正确，可能入错账或者不能完成之后的操作。

 观察金额回填框的特点，可以同步“退格（BackSpace）”键删除里面的内容，估计最大收银金额。可在金额回填前，设定一个鼠标消息+多个“退格”消息，然后再金额回填，就可以保证回填的正确性。鼠标消息还是金额回填原来的位置，设定5 - 7个退格消息。设定后如下图：
 ![](https://main.qcloudimg.com/raw/cbd6a8f5653a0d0afba04f92d9c2d8b2.png)
4. 存在发送消息失败的情况
发送消息是和收银软件配合使用的，由于收银软件运行情况不可预知，该功能只是为了辅助收银操作，很难保证100%执行，一般情况下不建议使用该功能，请服务商慎重选择。
