## 前提条件
- [注册](https://cloud.tencent.com/register?&s_url=https%3A%2F%2Fcloud.tencent.com%2F) 并 [登录](https://cloud.tencent.com/login?s_url=https%3A%2F%2Fcloud.tencent.com%2F) 腾讯云账号，并且完成账号实名认证。
- 已开通腾讯云直播服务，单击开通 [云直播](https://console.cloud.tencent.com/live/livestat)。
- 已开通腾讯云点播服务，单击开通 [云点播](https://console.cloud.tencent.com/vod/overview)。



## 实践步骤

[](id:step1)
### 步骤1：创建录制模板
使用录制功能需要先创建录制模板，直播录制功能的配置均保存在录制模板中。通过创建不同配置的录制模板，可以实现不同格式、不同录制文件时长等效果。

- **通过控制台创建**：
 1. 进入云直播控制台，选择 **功能模板** > [**直播录制**](https://console.cloud.tencent.com/live/config/record)。
 2. 单击 **创建录制模板** 新增录制模板，选择需要的录制文件类型（至少选择一种格式），更多详情请参见 [创建录制模板](https://cloud.tencent.com/document/product/267/20384)。
 3. 单击 **保存** 即可成功创建模板。
- **通过 API 创建**：
调用 [CreateLiveRecordTemplate](https://cloud.tencent.com/document/product/267/32614) 接口创建录制模板，模板创建成功后会返回对应的模板 ID。


[](id:step2)

### 步骤2：选择录制方案

云直播根据不同的场景，提供了以下几种调用直播录制功能的方案：

[](id:step2_s1)
#### 方案一：指定域名全局录制
通过控制台或者调用 API，将直播录制模板绑定到推流域名，只要通过该域名推流就会自动进行录制。

- **适用场景**：秀场直播、电商直播、在线课堂、视频监控等全录制场景。
- **操作流程**：
 - 在创建录制模板成功后，在弹框中单击 **去绑定域名** 并选择推流域名即可。
 - 在[**域名管理**](https://console.cloud.tencent.com/live/domainmanage) 中，选择需要绑定的推流域名进入域名详情，选择 **模板配置** > **录制配置**，绑定已创建的推流域名，详情请参见 [关联录制模板](https://cloud.tencent.com/document/product/267/35251)。
 - 通过 [CreateLiveRecordRule](https://cloud.tencent.com/document/product/267/32615) 接口传入录制模板的模板 ID 和推流域名，即可完成录制模板绑定推流域名。

[](id:step2_s2)
#### 方案二：指定单个流录制
通过 API 将直播录制模板绑定到某个指定的直播流，从而实现录制某个直播流。

- **适用场景**：活动直播、展会直播、赛事直播、连麦直播等单个活动特殊录制场景
- **操作流程**：通过 [CreateLiveRecordRule](https://cloud.tencent.com/document/product/267/32615) 接口创建录制规则，传入录制模板的模板 ID 和需要绑定的域名、路径和流名称 StreamName（需精准匹配），即可完成录制模板绑定指定直播流。

[](id:step2_s3)
#### 方案三：按指定时间段录制
您可以通过调用 API 控制录制的开始与结束时间，在指定的时间内触发录制任务进行录制。

- **适用场景**：新闻直播、活动直播等有直播流程比较明确的录制场景。
- **操作流程**：通过 [CreateRecordTask](https://cloud.tencent.com/document/product/267/45983) 接口创建录制任务，指定录制模板的模板 ID 和需要绑定的域名、路径和流名称 StreamName（需精准匹配），设置需要进行录制的开始和结束时间，则到达开始时间即开始录制。

[](id:step2_s4)
#### 方案四：精彩片段录制（支持录制混流直播）
在直播过程中碰到精彩画面，可以通过调用 API 实时进行直播录制。

- **适用场景**：赛事直播、游戏直播等只需要录制部分片段的场景（或者通过全局录制后再进行剪辑）。
- **操作流程**：通过 [CreateRecordTask](https://cloud.tencent.com/document/product/267/45983) 接口创建录制任务，指定录制模板的模板 ID 和需要绑定的域名、路径和流名称 StreamName（需精准匹配），设置需要进行录制的结束时间，创建成功后即开始录制任务

[](id:step2_s5)
#### 方案五：录制纯音频
若推流为纯音频，您可以配置 AAC 纯音频录制。

- **适用场景**：音频直播、音频连麦等场景。
- **操作流程**：创建录制模板时，选择录制文件类型为 AAC 纯音频录制，并关联对应的推流地址即可。

>! 创建绑定规则后约**5分钟 - 10分钟**生效，绑定规则的修改不影响正在推流的直播，只对新推的直播流生效。


[](id:step3)
### 步骤3：开始直播推流
1. 根据 [步骤2](#step2) 将录制模板关联推流域名后，通过该推流地址生成对应的推流域名并进行 [直播推流](https://cloud.tencent.com/document/product/267/32732)。
2. 直播结束后，录制生成的文件会存储到 [云点播](https://console.cloud.tencent.com/vod/overview) 平台。

>? 
>- 若录制模板中选择录制至子应用，则存储到对应子应用下。
>- 若需要回调录制文件地址信息，需要在推流前创建回调模板，填写录制回调地址后保存，并绑定需要回调的推流域名，详情请参见 [录制事件通知](https://cloud.tencent.com/document/product/267/47026)。

[](id:step4)
### 步骤4：查询、获取录制视频文件
支持通过以下方式查询、获取录制文件：

- **通过录制回调获取**：在直播推流前配置好回调模板（模板需要配置录制回调地址），生成录制文件时会通过回调将文件地发给回调服务器。更多详情请参见 [录制事件通知](https://cloud.tencent.com/document/product/267/47026)。
- **通过云点播控制台获取**：在点播控制台进行查询，具体请参见 [查看视频](https://cloud.tencent.com/document/product/266/36451)。
- **通过云点播 API 获取**：调用 [SearchMedia](https://cloud.tencent.com/document/product/266/31813) 接口进行文件查询。



[](id:step5)
### 步骤5：处理录制文件

[](id:step5_s1)
#### 方案一：直播录制 + 自动转码 + 视频加速播放
- **适用场景**：直播录制后快速将录制文件自动进行转码和视频加速，供用户进行点播播放，适用于大部分不需要视频二次加工的直播场景
- **操作流程**：
 1. 客户进行直播推流。
 2. 文件自动录制到点播。
 3. 获取点播 FileId 和视频回调信息。
 4. 使用用户配置的模板进行自动转码。
 5. 转码完成后，获取播放地址进行后续播放。


[](id:step5_s2)
#### 方案二：直播录制 + 手动转码 + 视频加速播放

- **适用场景**：部分用户希望将直播录制的视频仅先存储到点播，且先不进行后续的转码操作，则可在新建录制到点播时，不添加其他操作。如果后续希望对视频进行转码，则可进行手动触发转码操作。同时，可配合点播云剪辑功能进行使用，效果更佳。
- **操作流程**：
 1. 客户进行直播推流。
 2. 文件自动录制到点播。
 3. 获取点播 FileId。
 4. 配置任务流和进行视频二次剪辑。
 5. 转码和处理完成后获取视频地址进行后续播放。


[](id:step5_s3)
#### 方案三：直播录制 + 自适应码流 + 视频加速 + 超级播放器

- **适用场景**：部分用户对视频安全有极高的诉求，普调的 HLS 加密无法满足加密诉求，通过自适应和超级播放器的组合使用，可以有效完成视频安全升级，对在线教育、企业培训类客户场景适配度很高。
- **操作流程**：
 1. 客户进行直播推流。
 2. 文件自动录制到点播。
 3. 获取点播 FileId。
 4. 配置转码模板，或者任务流转出自适应码流。
 5. 设置超级播放配置。
 6. 通过 FileId 进行视频的播放。

