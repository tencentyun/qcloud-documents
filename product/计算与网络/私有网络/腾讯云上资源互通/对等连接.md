## 简介
VPC 对等连接是一种连接两个私有网络的服务，可以使私有网络 IP 在对等 VPC 之间路由流量，就像它们属于同一网络一样。您可以实现同地域或跨地域的相同/不同用户的私有网络互联，通过在两端配置路由策略，可以实现不同私有网络的流量互通。对等连接不依赖某个独立硬件，因而不存在单点故障或带宽瓶颈。

## 对等连接互通性不传递
对等连接使私有网络之间两两建立互联，但是这种互通关系不发生传递。例如，如下图所示，VPC 1 与 VPC 2 建立了对等连接，VPC 1 和 VPC 3 也建立了对等连接。然而由于对等连接的不传递性，VPC 2 和 VPC 3 的流量不能互通。
![](//mccdn.qcloud.com/static/img/9127397dcb1df231bfd8d32bcd628223/image.png)
>注：即使建立了对等连接，如果两端没有配置发包、回包路由，也无法实现通信。

## 同地域对等连接和跨地域对等连接
私有网络支持同地域和跨地域的对等连接，由于对等连接两端的物理距离不同，底层实现架构不一样，因此两者功能和计费上存在一些差异，对比如下：

| 比较项 | 同地域对等连接 | 跨地域对等连接 |
|---------|---------|---------|
| 底层架构 | 基于腾讯云单地域内的本地内网 | 基于腾讯云跨地域的内部 MPLS 网络 |
| 带宽 | 无带宽上限 | 	最大 10Gbps，带宽上限可设定 |
| 计费规则 | 	免费 | 	根据对等连接两端所在地域和实际使用网络带宽按天计费，详见[价格总览](https://www.qcloud.com/doc/product/215/%E4%BB%B7%E6%A0%BC%E6%80%BB%E8%A7%88) |	
| 可用性 | 99.95%以上，无单点故障 | 	99.95%以上，无单点故障 |	
| 跨账号连接 | 支持 | 支持 |	
| 访问权限 | 对等连接双方云服务器均可访问对端云服务器、数据库、负载均衡等全部资源 | 对等连接双方云服务器均可访问对端云服务器、数据库、负载均衡等全部资源 |	
| 功能限制 |对等连接两端 VPC 网段不可重复；多个对等连接间互不影响 | 对等连接两端 VPC 网段不可重复；<br><font color="red">一个 VPC 连接多个 VPC 时多个对端 VPC 网段也不可重复</font> |	

同地域对等连接主要用于打通同地域处于不同私有网络中的应用。
跨地域的对等连接的典型应用场景是：
- 全球同服
跨地域对等连接以可用性超 99.95%、丢包率小于 0.2% 的高性能打通世界各地的网络连接，用户将可以在北京、上海、广州、香港、北美等多地实现私有网络的高效互通，轻松实现全球同服。
- 跨地域容灾
跨地域互通连接不同地域的私有网络，快速部署两地三中心容灾方案。无需复杂专线建设，即可享受高品质专线服务，满足金融级网络容灾需求。

## 建立和删除流程
### 对等连接建立流程
![](//mccdn.qcloud.com/static/img/9527bab04ca5213bdd72dbec99c9e9ef/image.png)

### 对等连接删除流程
![](//mccdn.qcloud.com/static/img/0e0ae950ebface4e307cd510de2b885e/image.png)

## 使用约束
关于对等连接，有以下几点您需要注意：
- 要使对等连接两端实现真正的通信，您必须在发起端和接收端的相关路由表上配置指向对端的路由规则。
- 跨地域的对等连接费用由对等连接申请方支付。
- 如果对方不接受对等连接请求，申请将在7天后自动过期失效。
- 请不要接受来自您不了解账户的对等连接申请，此类用户可能对您的网络带来风险。
- 对等连接的两端私有网络 CIDR 不可以重叠，重叠时创建会报错。
- 跨地域对等连接时，一个 VPC 的多个对等网络间 CIDR 不可重叠，重叠时会报错。
- 对等连接任意一方可以随时中断对等连接。中断后两个私有网络间流量则立即中断。
- 同地域对等连接无带宽上限，跨地域对等连接用户需要设定带宽上限。

| 资源 | 限制 | 说明|
|---------|---------|---------|
| 跨地域对等连接带宽上限 |10Gbps |如果需更大带宽请提起工单。同地域对等连接带宽无上限。|
| 每个私有网络支持的对等连接数 |10 |　|
| 对等连接不支持地域 |华东地区（上海金融）| 　|
>注：非大陆地域（香港和多伦多）对等连接服务需要您提工单申请，因为跨境通信需要对用户资料和使用场景进行审核。

更多VPC其他服务限制可以查看[VPC其它服务限制](https://www.qcloud.com/doc/product/215/4926)。

## 计费模式
1) 同地域对等连接：免费。
2) 跨地域对等连接：
- 按天后付费日结，由对等连接发起方支付。
- 计算双方出流量当日带宽峰值，乘以所在阶梯的单价。
- 带宽峰值计算方式：每5分钟采集一次，取当日最大值作为每日带宽峰值。
详情请参照下表：
<table>
        <tbody><tr>
            <th style="width: 10%;" rowspan="2">功能</th>
            <th style="width: 25%;" rowspan="2">计费模式</th>
						<th style="width: 25%;" rowspan="2">配置</th>
            <th style="width: 40%;" colspan="3">价格</th>
        </tr>
				 <tr>
            <th>北京<br>上海<br>广州</th>
						<th>香港</th>
            <th>北美</th>
        </tr>
				<tr>
            <td rowspan="5">跨地域对等连接</td>
						<td rowspan="5">带宽峰值（出 max + 入 max）<br><br>按天计费（元 / Mbps / 天）<br><br>峰值带宽按每 5min 平均带宽计<br></td>
						<td>0Mbps - 20Mbps</td>
						<td>20</td>
						<td>120</td>
						<td>120</td>
        </tr>
				<tr>
				<td>20Mbps - 100Mbps</td>
						<td>12</td>
						<td>80</td>
						<td>80</td>
				</tr>
				<tr>
				<td>100Mbps - 500Mbps</td>
				<td colspan="3" rowspan="3">　　　　　　　请与商务洽谈<br>
				</tr>
				<tr>
				<td>500Mbps - 2000Mbps</td>
				</tr>
			 <tr>
				<td >大于2000Mbps</td>
				</tr>
				<tr>
        <td>同地域对等连接</td>
				<td colspan="5" >　　　　　　　　　　　　　　　　　　　　　免费</td>
</tbody></table>

有关私有网络服务的更多价格信息，可以查看[私有网络价格总览](https://www.qcloud.com/doc/product/215/3079)。

## 操作指南
### 创建对等连接通信
- 同账号创建对等连接通信需要2步：
  第一步：创建对等连接。
	第二步：在两端设置路由表。
	
- 跨账号创建对等连接通信需要3步：
  第一步：创建对等连接。
  第二步： 接受对等连接。
  第三步：在两端设置路有表。

下面对创建对等连接通信的步骤进行详细描述。
#### 第1步：创建对等连接
1) 登录[腾讯云控制台](https://console.qcloud.com/)，点击导航条【私有网络】。
2) 在私有网络控制台选择【对等连接】选项卡，点击【新建】创建对等连接。
3) 在新建弹出框中输入名称、选择本端地域及私有网络、选择地域及对端账户类型并选择对端私有网络。
- 当对端账户类型为“我的账户”时，直接从下拉列表中选择。
- 当对端账户类型为其他账户时，需要手动输入对端账户的QQ号和私有网络的ID。

4) 选择带宽上限
- 同地域对等连接带宽无上限，不可修改。
- 跨地域对等连接可以选择带宽上限。如果用户需要更大的跨地域带宽，请通过工单发起请求。

5) 同账户内私有网络进行连接，新建后对等连接立即生效；与其他账户私有网络创建对等连接，需要对端接受此对等连接后生效。
>注：跨地域的对等连接费用由对等连接申请方支付

#### （可选）第二步：接受对等连接
1) 登录[腾讯云控制台](https://console.qcloud.com/)，点击导航条【私有网络】，在私有网络控制台选择【对等连接】选项卡
2)	查看您对等连接列表中待接受的对等连接，在操作栏中点击【接受】按钮。
3)	对等连接完成建立。
>注：对等连接建立后，本端和对端私有网络无法直接互访，您还需在双方私有网络中添加指向对等连接的路由，才可以互通。

#### 第三步：为对等连接配置路由表
1) 登录[腾讯云控制台](https://console.qcloud.com/)，点击导航条【私有网络】，在私有网络控制台选择【路由表】选项卡。
2) 选择您对等连接本端指定子网的关联路由表，点击 ID 进入路由表详情页。
3) 添加路由。目的端中填入对等连接网络流量指向的对端 CIDR ，下一跳类型选择【对等连接】，下一跳选择已建立的对等连接。
4) 保存路由表。
路由表配置完成后，对等连接即可进行通信。

### 拒绝对等连接
您可以拒绝您收到的“待接受”状态的对等连接申请。除了您信任的账户以外，您可以拒绝任何不必要的请求。

1) 登录[腾讯云控制台](https://console.qcloud.com/)，点击导航条【私有网络】，在私有网络控制台选择【对等连接】选项卡
2) 查看您对等连接列表中待接受的对等连接，在操作栏中点击【拒绝】按钮。
3) 对等连接已拒绝并消失。

### 删除对等连接
对等连接的任何一方都可以随时删除对等连接，对等连接删除后立即失效。对等连接删除后将一同删除路由表中包含此对等连接的路由项。

1) 登录腾讯云控制台，点击导航条【私有网络】。
2) 在私有网络控制台选择【对等连接】选项卡，查看您对等连接列表中已连接的对等连接，在操作栏中点击【删除】按钮。
3) 确认删除后，对等连接即被删除。

## API概览
您可以使用API操作来设置和管理您的对等连接，有关 VPC 内其他资源的更多内容，可以查看 [VPC 所有 API 概览](https://www.qcloud.com/doc/api/245/909)。
 
| 接口功能 | Action ID |  功能描述 |
|---------|---------|---------|
| 创建同地域对等连接 | [CreateVpcPeeringConnection](https://www.qcloud.com/doc/api/245/%e5%88%9b%e5%bb%ba%e5%90%8c%e5%9c%b0%e5%9f%9f%e5%af%b9%e7%ad%89%e8%bf%9e%e6%8e%a5) | 创建同地域对等连接。 |
| 删除同地域对等连接 | [DeleteVpcPeeringConnection](https://www.qcloud.com/doc/api/245/%e5%88%a0%e9%99%a4%e5%90%8c%e5%9c%b0%e5%9f%9f%e5%af%b9%e7%ad%89%e8%bf%9e%e6%8e%a5) | 删除同地域对等连接。 |
| 修改同地域对等连接 | [ModifyVpcPeeringConnection](https://www.qcloud.com/doc/api/245/%e4%bf%ae%e6%94%b9%e5%90%8c%e5%9c%b0%e5%9f%9f%e5%af%b9%e7%ad%89%e8%bf%9e%e6%8e%a5%e5%b1%9e%e6%80%a7) | 修改同地域对等连接。 |
| 接受同地域对等连接 | [AcceptVpcPeeringConnection](https://www.qcloud.com/doc/api/245/%e6%8e%a5%e5%8f%97%e5%90%8c%e5%9c%b0%e5%9f%9f%e5%af%b9%e7%ad%89%e8%bf%9e%e6%8e%a5) | 接受同地域对等连接。 |
| 驳回同地域对等连接 | [RejectVpcPeeringConnection](https://www.qcloud.com/doc/api/245/%e9%a9%b3%e5%9b%9e%e5%90%8c%e5%9c%b0%e5%9f%9f%e5%af%b9%e7%ad%89%e8%bf%9e%e6%8e%a5) | 驳回同地域对等连接。 |
| 启用过期同地域对等连接 | [EnableVpcPeeringConnection](https://www.qcloud.com/doc/api/245/%e5%90%af%e7%94%a8%e5%90%8c%e5%9c%b0%e5%9f%9f%e8%bf%87%e6%9c%9f%e5%af%b9%e7%ad%89%e8%bf%9e%e6%8e%a5) | 启用过期同地域对等连接。 |
| 创建跨地域对等连接 | [CreateVpcPeeringConnectionEx](https://www.qcloud.com/doc/api/245/%e5%88%9b%e5%bb%ba%e8%b7%a8%e5%9c%b0%e5%9f%9f%e5%af%b9%e7%ad%89%e8%bf%9e%e6%8e%a5) | 创建跨地域对等连接。 |
| 删除跨地域对等连接 | [DeleteVpcPeeringConnectionEx](https://www.qcloud.com/doc/api/245/%e5%88%a0%e9%99%a4%e8%b7%a8%e5%9c%b0%e5%9f%9f%e5%af%b9%e7%ad%89%e8%bf%9e%e6%8e%a5) | 删除跨地域对等连接。 |
| 修改跨地域对等连接 | [ModifyVpcPeeringConnectionEx](https://www.qcloud.com/doc/api/245/%e4%bf%ae%e6%94%b9%e8%b7%a8%e5%9c%b0%e5%9f%9f%e5%af%b9%e7%ad%89%e8%bf%9e%e6%8e%a5%e5%b1%9e%e6%80%a7) | 修改跨地域对等连接。 |
| 接受跨地域对等连接 | [AcceptVpcPeeringConnectionEx](https://www.qcloud.com/doc/api/245/%e6%8e%a5%e5%8f%97%e8%b7%a8%e5%9c%b0%e5%9f%9f%e5%af%b9%e7%ad%89%e8%bf%9e%e6%8e%a5) | 接受跨地域对等连接。 |
| 驳回跨地域对等连接 | [RejectVpcPeeringConnectionEx](https://www.qcloud.com/doc/api/245/%e9%a9%b3%e5%9b%9e%e8%b7%a8%e5%9c%b0%e5%9f%9f%e5%af%b9%e7%ad%89%e8%bf%9e%e6%8e%a5) | 驳回跨地域对等连接。 |
| 启用过期跨地域对等连接 | [EnableVpcPeeringConnectionEx](https://www.qcloud.com/doc/api/245/%e5%90%af%e7%94%a8%e8%b7%a8%e5%9c%b0%e5%9f%9f%e8%bf%87%e6%9c%9f%e5%af%b9%e7%ad%89%e8%bf%9e%e6%8e%a5) | 启用过期跨地域对等连接。 |
| 查询对等连接 | [DescribeVpcPeeringConnections](https://www.qcloud.com/doc/api/245/%e6%9f%a5%e8%af%a2%e5%af%b9%e7%ad%89%e8%bf%9e%e6%8e%a5) | 查询对等连接。 |







