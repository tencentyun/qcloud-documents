## 使用场景 
通过事件集提供的链路追踪能力，用户可以查看每条投递到 EventBridge 的事件详情，并查看事件在 EventBridge 中的完整处理链路，方便对于每条事件进行跟踪与管理。

## 前提条件 
链路追踪会将您的事件处理日志上报至 CLS 的指定日志集，并将日志内容集成在事件总线控制台，方便您做检索与查看，为保证功能正常使用，请确认您已开启 CLS 服务并且创建了相关服务角色，详情见 [权限说明](https://cloud.tencent.com/document/product/614/47110)。

## 功能介绍
### 产品维度
事件集维度，用户可以在事件集上，完成相关链路追踪功能配置绑定。

### 上报类型
#### 默认投递	
- 上报到 EB 默认日志集，日志集自动配置默认索引。
- 日志集默认配置 3 天存储。
- 上报基础事件日志信息，包含云服务告警事件的全部事件日志，以及自定义事件经过规则匹配成功后，投递到目标的投递失败日志。

#### 自定义投递
- 投递到自定义的日志集，请注意开启**全文索引**。
- 可以按照实际业务需求，选择合适的投递方案，支持投递方案如下： 
    - 事件经过规则匹配成功后，上报投递到目标的全部日志（包含成功日志 & 失败日志）。
    - 事件经过规则匹配成功后，只上报投递到目标的投递失败日志。
    - 事件经过规则匹配成功后，只上报投递到目标的投递成功日志。
    - 事件经过规则匹配成功后，上报投递到目标的全部日志（包含成功日志 & 失败日志）& 事件规则匹配失败日志。
    - 事件经过规则匹配成功后，只上报投递到目标的投递失败日志 & 事件规则匹配失败日志。
    - 事件经过规则匹配成功后，只上报投递到目标的投递成功日志 & 事件规则匹配失败日志。

#### 补充说明
- 对于单一事件 ID，如果规则匹配失败且开启了相关投递，规则维度直接上报。
- 对于单一事件 ID，如果规则匹配成功，会在目标维度上报投递结果（成功/失败）。
- 如果上报 CLS 失败（平台错误/超限错误等），该条日志将被丢弃。



## 操作步骤 
### 创建流程
1. 登录 [事件总线控制台](https://console.cloud.tencent.com/eb/)，选择左侧导航栏中的**事件集**。
2. 选择**新建事件集**，在新建事件集的同时，完成上报方式的配置。您可以根据实际情况，选择**默认投递**、**自定义投递**或者**暂不开启**。如下图所示：
![](https://qcloudimg.tencent-cloud.cn/raw/6cd88e7693637d2418e65517623721ef.png)
3. 完成创建后，根据实际需要绑定事件源连接器。选择事件集详情页中的**管理事件规则**，进入事件规则页面。如下图所示：
![](https://qcloudimg.tencent-cloud.cn/raw/5949863986d51b45f1c052b21264701d.png)
4. 单击**新建事件规则**，根据页面提示和实际需求，填写相关信息，完成规则和目标的绑定，如下图所示：
![](https://qcloudimg.tencent-cloud.cn/raw/d0d27d70588a8012e84c1f8bf32fccd7.png)
5. 单击**确定**即可完成创建，创建完成后，发送事件，即可在事件集详情的**事件查询**页面查看相关日志。如下图所示：
![](https://qcloudimg.tencent-cloud.cn/raw/2a131d583a130c0322020e90c5694b80.png)

### 日志检索
在事件查询页面，您可以用多种方式进行日志的筛选检索，具体说明如下： 
#### 云服务事件集
1. 登录 [事件总线控制台](https://console.cloud.tencent.com/eb/)，选择左侧导航栏中的**事件集**。
2. 选择事件集名称，进入事件集事件查询页。如下图所示：
![](https://qcloudimg.tencent-cloud.cn/raw/3b560f93a9229923118398839867fc6a.png)
 您可以通过选择上方对应字段，完成日志的筛选。
 <table>
<thead>
<tr>
<th>字段</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>时间范围</td>
<td>默认展示 15 分钟内事件日志，最多可选择 3 天，需要更多日志，请在 CLS 控制台进行筛选。</td>
</tr>
<tr>
<td>事件筛选</td>
<td>对于云服务事件集，支持筛选全部事件或只展示云服务告警事件。</td>
</tr>
<tr>
<td>事件源&amp;事件类型</td>
<td>可以选择已有云服务事件源，或自定义填写，如果选择<strong>自定义</strong>，需要填写完整 <code>type</code> 字段（示例：<code>cvm:ErrorEvent:GuestOom</code>）。</td>
</tr>
<tr>
<td>事件规则</td>
<td>当一个事件集绑定多条规则时，您可以根据指定规则进行筛选，查看对应规则的事件投递日志。</td>
</tr>
<tr>
<td>事件 ID</td>
<td>通过事件 ID，查询唯一指定事件的轨迹和事件详情。</td>
</tr>
</tbody></table>
 
 
 
#### 自定义事件集
1. 登录 [事件总线控制台](https://console.cloud.tencent.com/eb/)，选择左侧导航栏中的**事件集**。
2. 选择事件集名称，进入事件集事件查询页。如下图所示：
![](https://qcloudimg.tencent-cloud.cn/raw/1b4a4cf153b35c1999d7e9e229c77eea.png)
 您可以通过选择上方对应字段，完成日志的筛选。
 <table>
<thead>
<tr>
<th>字段</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>时间范围</td>
<td>默认展示 15 分钟内事件日志，最多可选择 3 天，需要更多日志，请在 CLS 控制台进行筛选。</td>
</tr>
<tr>
<td>事件类型</td>
<td>对于自定义事件集，需要填写完整 <code>type</code> 字段（示例：<code>cvm:ErrorEvent:GuestOom</code>）。</td>
</tr>
<tr>
<td>事件规则</td>
<td>当一个事件集绑定多条规则时，您可以根据指定规则进行筛选，查看对应规则的事件投递日志。</td>
</tr>
<tr>
<td>事件 ID</td>
<td>通过事件 ID，查询唯一指定事件的轨迹和事件详情。</td>
</tr>
</tbody></table>

 
#### 事件详情
1. 登录 [事件总线控制台](https://console.cloud.tencent.com/eb/)，选择左侧导航栏中的**事件集**。
2. 选择事件集名称，进入事件集事件查询页。单击事件列表中的**查看详情**，即可看到该事件的完整内容、投递结果、耗时等详细信息，如下图所示：
![](https://qcloudimg.tencent-cloud.cn/raw/b751c83574bdf6e30c1f7d6fbdf2d3c8.png)
  - 耗时计算方式为**目标投递时间-进入事件集时间**，如果投递失败产生重试，耗时中会加上重试间隔。
  - 对于同一事件在统一规则下的追踪记录，最多展示10条结果（前5条+最后5条）。

## 免费额度
链路追踪能力本身不计费，但因为将日志上报到了 CLS 服务，CLS 日志服务本身为独立计费产品，可能产生一定费用，具体计费方式参考 [日志服务计费概述](https://cloud.tencent.com/document/product/614/45802)。为了尽量降低用户使用成本，对于 EB 服务角色为用户创建的 **EB 默认日志集**，EB 提供了全地域 1GB 数据量，30天存储的免费额度，具体额度如下： 
<table>
<thead>
<tr>
<th>计费项</th>
<th>额度/天</th>
</tr>
</thead>
<tbody><tr>
<td>写流量</td>
<td>256MB</td>
</tr>
<tr>
<td>索引流量</td>
<td>1GB</td>
</tr>
<tr>
<td>日志存储</td>
<td>7.5GB</td>
</tr>
<tr>
<td>索引存储</td>
<td>30GB</td>
</tr>
<tr>
<td>分区</td>
<td>1个</td>
</tr>
</tbody></table>
此免费额度为 EB 默认日志主题独享，扣费顺序为<b>全网默认免费额度 > EB 日志集独享免费额度 > 正常按量扣费</b>。
