## 概述
云原生 etcd 支持您通过控制台开启账号鉴权，管理etcd账号和角色。
> 注意，在 etcd 最佳实践中，使用账号、角色鉴权将一定程度影响性能，非必要不建议使用。如果您仅需要对数据访问进行鉴权，建议使用默认开启的 HTTPS 证书认证。

## 前提条件
- 已 [创建 etcd 集群](https://cloud.tencent.com/document/product/457/58178)。
- 具有集群的 ForwardEtcd 操作权限，管理员可在[策略管理](https://console.cloud.tencent.com/cam/policy)中为用户授予该权限，详见：[授权用户在控制台管理数据和账号](./账号授权.md@授权用户在控制台管理数据和账号)

## 账号管理

> 账号鉴权特性的开启或关闭等实例配置变更操作会触发etcd后端节点的滚动更新，更新过程中服务可正常使用，但读写性能会有短暂影响。

- 开启鉴权
1. 在控制台【账号管理】中，点击开启账号授权,开启鉴权对应 etcd auth enable 设置：
![](https://qcloudimg.tencent-cloud.cn/raw/21a4e7498519c9160f4bc98bfdddfb54.png)


2. 由于开启账号鉴权后需用提供账号认证信息才能访问 etcd 服务，因此如果您还未创建 root 账号，则需要先创建root账号。
![](https://qcloudimg.tencent-cloud.cn/raw/3b3ebe5ce27bb9ebb13b12dcff7eeea6.png)
root 账号将被默认授予 root 角色权限，拥有etcd实例所有权限，不可修改。

3. 开启成功后，控制台账号鉴权状态显示为：已开启
![](https://qcloudimg.tencent-cloud.cn/raw/88f87df9aa2a28c48a6e20f23ed1d2f2.png)

- 账号管理
> etcd 创建账号管理并不强依赖开启鉴权，可以在没开启鉴权的情况下创建和管理账号，但未开启鉴权情况下，无需账号密码即可访问服务。

1. 在控制台点击 “创建用户” ，进入用户创建页面：
![](https://qcloudimg.tencent-cloud.cn/raw/3e57614302a685294a3f53b471ecfdab.png)
2. 点击下一步为 创建的用户分配角色，如果没有合适的角色，可在管理角色中创建：
![](https://qcloudimg.tencent-cloud.cn/raw/a7315d81e88b8873381dedcf21e40079.png)

- 角色管理

> etcd 包含两个特殊默认角色，root用户使用的root角色，以及未显式指定角色用户将默认绑定的guest角色，guest角色权限范围需要显式设置。更多关于etcd用户与角色的介绍，详见：[etcd authentication](https://etcd.io/docs/v3.5/op-guide/authentication/rbac/)

1. 创建角色，在控制台点击 管理角色，进入角色管理页面：
![](https://qcloudimg.tencent-cloud.cn/raw/120256bbe7cbb69190f9c4e6d1e87d38.png)
2. 点击创建角色，进入角色创建页面：
![](https://qcloudimg.tencent-cloud.cn/raw/4bdcb129357d0fe4210695dd5539c372.png)
3. 为角色设置名称和权限，权限需要点击添加才能生效：
![](https://qcloudimg.tencent-cloud.cn/raw/a6e1758a95ee8e56ac577e54a386a7b6.png)
设置权限支持prefix、range两种格式，由于etcd 实现 prefix和range均通过同一接口：RangeRequest，因此最终权限均以[key，range_end\) 格式展示：

>注意：
> - key需要输入完整key值，而不是子目录(控制台的目录效果是为了便于展示的渲染效果，etcd API V3没有目录概念)
> - 由于range区间为[\)(左闭右开)， prefix 以 range 格式表达的结束位为当前 key + 1，例如：授权以 /a 开头的所有 key，则实际表达结果为 [/a,/b)

更多关于格式的介绍，参考：[RangeRequest](https://etcd.io/docs/v3.4/dev-guide/api_reference_v3/#message-rangerequest-etcdserveretcdserverpbrpcproto)
![](https://qcloudimg.tencent-cloud.cn/raw/aae8549ac664f52a23c2aad2a854e9ad.png)

## 管理员账号校验

用户开启账号鉴权后，用户可通过API或命令行工具修线下改root账号密码，而云原生 etcd 默认使用 root 账号进行集群节点管理、数据备份与恢复等管理操作鉴权，一旦 root 密码被线下修改，云原生 etcd 服务将无法完成这些操作，因此控制台将提示用户提供新的 root 密码，以便服务后台能顺利工作。
![](https://qcloudimg.tencent-cloud.cn/raw/c38f46e85d932f751ac96b9362bc3514.png)