
## 操作场景

本文为您介绍如何在腾讯云容器服务控制台中创建托管 etcd 集群，您可根据以下指引进行 etcd 集群的创建。

## 前提条件


1. 首次使用云原生 etcd 服务需要您为该服务授权名为 TKE_QCSLinkedRoleInEtcdService 的服务相关角色。
2. 云原生 etcd 服务中使用了云硬盘、对象存储等多种云资源，首次使用之前需确保已经获取相关云资源使用权限。此外，集群创建过程中也会用到私有网络、子网、安全组等资源。

## 操作步骤

1. 登录 [容器服务控制台](https://console.cloud.tencent.com/tke2/overview)，单击左侧导航栏**云原生etcd**。
2. 进入“etcd 集群”列表页面，在页面上方选择需创建 etcd 集群的地域，单击**新建**。如下图所示：
![](https://main.qcloudimg.com/raw/eb41336659b7e41552495b6ab3b5a6d8.png)
创建 etcd 集群详细步骤如下：



### 集群信息

1. 在“集群信息”页面，根据以下提示设置集群信息。如下图所示：
![](https://main.qcloudimg.com/raw/658a73c024d8bf43771ea0748595548b.png)
	- **集群名称**：创建的 etcd 集群名称，不超过60个字符。
	- **etcd 版本**：选择 etcd 版本。
	- **所在地域**：选择您希望部署该实例的地域。当前仅支持部署在北京、上海、广州等地域。集群创建后地域无法修改，建议您根据所在地理位置选择靠近业务的地域，可降低访问延迟、提高数据传输速度。
	- **集群网络**：选择当前地域下已有的私有网络，若在该地域下无可用的私有网络资源，可跳转到私有网络控制台新建，详情请参见 [私有网络 VPC](https://cloud.tencent.com/document/product/215/20046)。
	- **高可用部署 **[](id:HA-deploy)：为了确保集群的高可用性，支持将集群节点随机部署在不同可用区。开启高可用部署，要求至少有3个可选可用区的子网数量。
	- **节点子网**：选择为 etcd 节点分配所选子网地址范围内的 IP 地址，请尽量选择 IP 数量充足且与其他产品使用无冲突的子网。
<dx-alert infotype="notice" title="">
高可用部署要求至少有3个 etcd 集群节点，若您开启了**高可用部署**，请确保可用子网至少分布在3个不同的可用区。
</dx-alert>
	- **内网访问**：etcd 集群的对外访问地址默认分配在该所选子网中，请尽量选择 IP 数量充足且与其他产品使用无冲突的子网。
	- **安全组**：安全组具有防火墙的功能，用于设置节点的网络访问控制。支持以下设置：
		- 新建并绑定默认安全组，出/入站规则默认放通 0.0.0.0/0 和 ::/0 的所有端口。
		- 添加安全组，可根据业务需要选择自定义配置的安全组规则。更多信息请参见 [容器服务安全组设置](https://cloud.tencent.com/document/product/457/9084)。
	- **集群描述**：创建集群的相关信息，该信息将显示在集群的“基本信息”页面。
![](https://main.qcloudimg.com/raw/5c04ef3573c0421a8f6f6289d6adb36d.png)
	- **数据备份**：设置备份可有效保护集群数据安全，支持设置备份间隔和最大备份数目。集群创建成功后将自动为您创建对象存储 COS 存储桶并按照实际资源使用情况计费，计费方式请参见 [对象存储计费概述](https://cloud.tencent.com/document/product/436/16871)。
		- **备份间隔**：支持以小时为单位设置备份间隔。
		- **最大备份个数**：支持设置最大备份个数（上限为1000），超过该数目后最新备份信息将无法上传至对象存储 COS 存储桶。
	- **监控告警**：云原生 etcd 集成云原生监控服务实现集群的监控、分析和告警，详情请参见 [云原生监控概述](https://cloud.tencent.com/document/product/457/54318)。
		- **已有 Prometheus**：支持选择已有 Prometheus 实例，要求该实例与 etcd 集群位于相同 VPC 下。
	- **启用Https**：支持开启 HTTPS 双向认证及鉴权，为保障集群数据的安全传输，建议开启。
		- **客户端证书认证**：启用 HTTPS 的情况下，支持开启客户端证书认证。
	- **自动压缩**：为防止集群性能下降或空间耗尽，可开启自动压缩功能实现对历史数据的定时清理。目前支持**周期性压缩**和**根据 revision 压缩**两种压缩模式。
		- **周期性压缩**：支持根据“时分秒”来设置压缩周期。
		- **根据 revision 压缩**：支持根据保留 revision 数量来设置压缩周期。
2. 单击**下一步**，进入到节点配置步骤。


### 节点配置

1. 在“节点配置” 页面，根据以下提示设置节点信息。如下图所示：
![](https://main.qcloudimg.com/raw/3572fa21eb5280620bdb7e10c784fb27.png)
	- **节点数量**：选择集群内的节点数目。若开启了 **[高可用部署](#HA-deploy)**，则需要至少3个节点数量。
	- **节点规格**：根据业务需要选择节点规格。
	- **硬盘类型**：支持高性能云硬盘和 SSD 云硬盘，硬盘容量默认为50G，硬盘计费信息请参见 [云硬盘价格总览](https://cloud.tencent.com/document/product/213/2255)。
<dx-alert infotype="notice" title="">
建议测试环境下的节点规格选择1核2G。生产环境下根据业务性能、规模需求建议选择2核4G或4核8G。
</dx-alert>
2. 单击**下一步**，进入到信息确认步骤。

### 信息确认

1. 检查并确认集群配置信息。
2. 单击**创建**即可完成创建。
3. 您可在“etcd 集群”列表页面查看集群创建进度。当集群状态为“运行中”时，表示当前集群已成功创建并处于可用状态。如下图所示：
![](https://main.qcloudimg.com/raw/b7bf5e56c47010eec174d57a524a8a7c.png)
