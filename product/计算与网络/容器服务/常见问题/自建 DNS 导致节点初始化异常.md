
## 背景信息
在使用容器服务 TKE 的自定义镜像时，为了能够解析到业务内部的相关服务，用户在自定义镜像中修改了 DNS 的解析顺序或将腾讯官方的 DNS 解析地址完全替换为自建 DNS。

## 操作影响
上述情况可能会导致节点在注册进集群的过程中，无法解析到腾讯云的官方资源库，进而大概率出现节点初始化失败、网络、存储等相关组件功能异常等情况。
- 节点初始化：在节点初始化流程中可能会报错误信息 “Failed to resolve address, dns may be changed”。
- 网络组件：网络组件如 IPAMD 功能依赖腾讯云内网 DNS 解析，解析不到腾讯云的官方资源库可能会导致网络组件功能不可用。
- 存储组件：存储组件如 CBS-CSI 的 mount / unmount 失败。

>? 集群内的相关组件安装需要依赖腾讯云官方资源库，解析地址为：
> `nameserver 183.60.83.19`
> `nameserver 183.60.82.98`

## 解决措施
### 将腾讯云 DNS Nameserver 配置为自建 DNS 的上游
建议将 `/etc/resolv.conf` 配置中的 nameserver 添加到自建 DNS 服务器的上游，因为部分服务依赖腾讯云内部 DNS 解析，如果未将其设为自建 DNS 的上游，可能导致部分服务无法正常工作。本文以 [BIND 9](https://www.isc.org/bind/) 为例修改配置文件，将上游 DNS 地址写入 forwarders 中，示例如下：
```yaml
options {
        forwarders {
                183.60.83.19;
                183.60.82.98;
        };
        ...
```
完成上述操作后的 24 小时内，节点初始化流程的自动重试策略会不断尝试执行节点初始化工作直到解析到腾讯云官方资源库；超过 24 小时后，需要用户删除节点重新创建。若上述解决措施不生效，请 [提交工单](https://console.cloud.tencent.com/workorder/category) 来寻求帮助。

>! 自建 DNS Server 和请求源不在同个 Region，可能会导致部分不支持跨域访问的腾讯域名失效。 
