## CMQ队列模型(Queue)操作指南

使用腾讯云 CMQ 时，用户首先需要熟悉以下三个标识符：队列名称、消息 ID 和接收句柄。

### 1. 队列名称
创建新队列时，用户必须提供在此地域范围内唯一的队列名称，不同地域间队列名称可以重复。腾讯云 CMQ 使用地域和队列名称唯一标识一个队列，每当用户要对队列执行操作时，都需要提供这两个参数。

### 2. 消息 ID

每条消息都会收到一个由腾讯云系统分配的消息 ID，该 ID 可由 SendMessage 接口请求中返回给用户。此标识符用于识别消息。需要注意的是，删除消息时用户需要消息的接收句柄，而不是消息 ID。消息 ID 有形如“Msg-XXXXXXXX”的样式。

### 3. 接收句柄

每当收到来自队列的消息时，用户都会收到该消息的接收句柄。消息句柄始终与接收消息的操作相关联，与消息本身无关。要删除消息或更改消息属性，用户则必须提供接收句柄，而不是消息 ID。这意味着，必须始终先接收消息，然后才能删除/更改它。

> 注：如果多次接收某条消息，则每次接收该消息时，用户都会获得不同的接收句柄。在请求删除该消息时，您必须提供最近收到的接收句柄，否则可能无法删除该消息。

了解消息队列中标识符的概念后，CMQ队列模型的操作指南如下：

### 1. 创建队列（Queue）

1) 队列名称：QueueName，为队列的名称
2) 队列创建时间：Queue的创建时间
3) 队列最近修改时间：LastModifyTime修改Queue属性的最近时间
4) 消息接收长轮询等待时间：PollingWaitSeconds,长轮询等待时，一个消息消费请求只会在取到有效消息或长轮询超时时才返回响应，类似于Ajax请求的长轮询；单位秒，有效值范围为0-30秒。默认值设为0s
5) 取出消息隐藏时长：该项为队列的VisibilityTimeout 属性，单位为秒，有效值范围1-43200秒，也即1秒到12小时。每条Message都有个默认的VisibilityTImeout，worker在接收到消息后，timeout就开始计时了。如果Worker在timeout时间内没能处理完Message，那么消息就有可能被其他Worker接收到并处理。默认值默认设为30s
6) 消息最大长度: 队列的MaxMsgSize属性， 限定允许发送到该队列的消息体的最大长度；单位为byte， 有效值范围为1024-65536 也即1K到64K。默认值为64K
7) 消息生命周期：队列的msgRetentionSeconds属性， 消息在本队列中最长的存活时间，从发送到该队列开始经过此参数指定的时间后，不论消息是否被取出过都将被删除；单位为秒，有效值范围60-1296000秒，也即1分钟到15天。
8) 队列API请求地址：该地址为消费者（subscriber），主动到CMQ消息队列拉取消息（Pull）的访问地址，该地址须配合密钥一起使用。队列的属性配置，参数修改，也通过该地址

### 2. 生产者向Queue生产消息

1) Queue名称
2) Queue资源id
3) 发布内容：为消息的主体内容，客户自定义填写，CMQ不会进行任何编码、修改

### 3. 拉取消息、查看消息详情

1) 消息句柄：为本条消息获取成功时产生的临时句柄ReceiptHandle，用于删除和修改接受后处于Inactive的消息，下次可消费时间之前有效。
2) 消息创建时间：接收到的消息发送到队列的时间。
3) 被消费次数：该项目为接收到的消息总共被消费过的次数。
4) 首次消费时间：该项目为接收到的消息第一次被消费的时间。
5) 下次可消费时间：该项目为NextVisibleTime，由于设置了队列的VisibilityTimeout 属性，该选项的时间为，已被接收到的消息下次可被再次消费的时间。
6) 消息内容：接收到的消息正文，为生产者发送的原文，CMQ不会进行任何编码、修改
