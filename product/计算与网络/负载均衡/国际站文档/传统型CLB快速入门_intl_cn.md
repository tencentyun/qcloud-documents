本文档将指引您如何初步使用腾讯云负载均衡：创建一个名为 `clb-test`的传统型公网负载均衡实例，并将来自客户端的请求转发到后端两台云服务器上。

## 前提条件
1. 负载均衡只负责转发流量，不具备处理请求的能力。因此，您需要有处理用户请求的云服务器实例。
在本示例中，只要具有两台云服务器实例即可，您也可以自行规划云服务器数量。本例中已经在广州地域下创建了云服务器实例 `rs-1` 和 `rs-2`。有关如何创建云服务器实例，请参考 [购买并启动云服务器实例](https://cloud.tencent.com/document/product/213/4855)。
2. 本文以 HTTP 转发为例，云服务器上必须部署相应的 Web 服务器，如 Apache、Nginx、IIS等。
为了验证结果，示例在 `rs-1` 上部署了 Apache 并返回一个带有 “Hello Tomcat! This is rs-1!” 的 HTML，在 `rs-2` 上部署了 Apache 并返回一个带有 “Hello Tomcat! This is rs-2!” 的 HTML。有关如何在云服务器上部署服务的更多内容，请参考[Linux（CentOS）下部署 Java Web](待发布)及[Windows 下安装配置 PHP](https://cloud.tencent.com/document/product/213/10182)。
3. 访问云服务器的公网 IP + 路径，如果可以显示出您部署好的页面的话，则证明服务部署成功。

> 注：
> - 云服务器上必须购买公网带宽，因为当前的带宽属性在 CVM 上，而非 CLB 上。
> - 示例中后端服务器部署的服务返回值不同，实际情况下，为保持所有用户均有一致体验，后端服务器上一般是部署完全相同的服务。

## 购买传统型负载均衡实例
1. 登录腾讯云 [负载均衡服务购买页](https://buy.cloud.tencent.com/lb)。
2. 本例地域选择与云服务器相同的【广州】，实例类型选择【传统型】，网络属性选择【公网】，网络选择【Default-VPC(默认)】，实例名称填写【clb-test】。
3. 单击【立即购买】按钮，完成付款。
有关负载均衡实例的更多内容，请参考 [购买属性指引](待发布) 。
![](https://main.qcloudimg.com/raw/fbe58e6536dbd0b24d383f892dc6446d.png)
4. 在【LB 实例列表】页，选择对应的地域即可看到新建的实例。
![](https://main.qcloudimg.com/raw/181110567fc16a3ad9a3547ef8e53dc1.png)

## 创建负载均衡监听器
负载均衡监听器通过指定协议及端口来负责实际转发。本文以负载均衡转发客户端的 HTTP 请求配置为例。
1. 登录[腾讯云控制台](https://console.cloud.tencent.com/)，单击【云产品】-【网络】-【负载均衡】进入负载均衡控制台。
2. 在【LB 实例列表】中找到已创建的传统型的负载均衡实例 `clb-test`，单击实例 ID 进入负载均衡详情页。
3. 在【基本信息】部分，您可以单击名称后的小图标修改实例名称。
4. 在【监听器管理】中的【监听器】下，单击【新建】按钮新建负载均衡监听器。
![](https://main.qcloudimg.com/raw/f0e2d9431fd7eebfffd96e4392e3a70a.png)
5. 在弹出框中配置以下内容：
  - 名称自定义为“Listener1”；
  - 监听协议端口为 `HTTP：80`；
  - 后端端口为 `80`；
  - 均衡方式选择 `按权重轮询`；
  - 不勾选会话保持；
  - 开启健康检查。
  - 单击【完成】按钮完成负载均衡监听器的创建。
![](https://main.qcloudimg.com/raw/84f8d4b675e1095d3efa193f3ded0281.png)

有关负载均衡监听器的更多内容，请参考 [负载均衡监听器概述](https://cloud.tencent.com/document/product/214/6151)。

## 绑定后端云服务器
1. 在【LB 实例列表】中找到刚才创建的 `clb-test`，单击 ID 进入负载均衡详情页。
2. 在【监听器管理】的【绑定云主机】模块中，单击【绑定云主机】按钮。
![](https://main.qcloudimg.com/raw/6fd77c5e62f56f73ada410d8fad8de09.png)
3. 在弹出框中选择与 CLB 同地域下的云服务器实例 `rs-1` 和 `rs-2`，并设置权重均为默认值 `10`。
4. 单击【确定】按钮完成绑定。
![](https://main.qcloudimg.com/raw/014e181f64fcc1e22e6bd90f3ebe5bc6.png)
5. 展开监听器【Listener1】，可以查看后端 CVM 的健康检查状态，当状态为“健康”时表示 CVM 可以正常处理负载均衡转发的请求。
![](https://main.qcloudimg.com/raw/9f43f89b03bd0845749cb1c90413c97d.png)

## 验证负载均衡服务
在浏览器中输入负载均衡的服务地址和端口 http://vip:80，测试负载均衡服务。如下表示本次请求被 CLB 转发到了 rs-1 这台 CVM 上，CVM 正常处理请求并返回。
![](https://main.qcloudimg.com/raw/5df0db4039dfb4864af5db6b9c6cc3c1.png)

此监听器的轮询算法是“按权重轮询”且两台 CVM 的权重都是 10，刷新浏览器，再次发送请求，可以看到本次请求被 CLB 转发到了 rs-2 这台 CVM 上。
![](https://main.qcloudimg.com/raw/ac62269e1fa5373f65c76f9134d96589.png)

> 注：
> - 如果用户关闭会话保持功能，选择轮询的方式进行调度，则请求依次分配到不同后端服务器上。
> - 如果用户开启会话保持功能，或关闭会话保持功能但选择 ip_hash 的调度方式，则请求持续分配到同一台后端服务器上去。

## 购买域名并解析到负载均衡实例（可选）
1. 打开 [腾讯云域名注册页面](https://dnspod.cloud.tencent.com) 进行域名查询和注册。本例以 qcloudtest.com 为例，详情请参考[域名注册](https://cloud.tencent.com/document/product/242/9595)。
2. 登录[腾讯云控制台](https://console.cloud.tencent.com/)，单击【云产品】-【域名与网站】-【云解析】。
3. 单击您所购买的【域名】，在【域名解析管理】页面单击【添加记录】按钮，为域名添加 A 记录，输入以下内容：
  - 记录类型：`A记录`；
  - 主机记录：即域名前缀。本例以解析所有前缀为例，设为 `*.qcloudtest.com`；
  - 线路类型：默认；
  - 记录值：点击【关联云资源】，在弹出框勾选刚刚创建的 `clb-test`；
  - TTL：设置为默认值 `600s`；
  - 添加完毕后，单击【保存】。

云解析需要一段时间将该记录在 Internet 上传播。为测试域名是否解析正常，可以在添加完解析记录一段时间后，直接访问绑定后的CNAME域名（如本例中的www.qcloudtest.com ）来验证负载均衡。
