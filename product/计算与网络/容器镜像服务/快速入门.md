本文将介绍如何从零开始，购买容器镜像服务企业版实例，并配置网络访问策略，最终实现容器镜像的推送及拉取。  
若您需要使用容器镜像服务个人版，请参考 [镜像仓库基本教程](https://cloud.tencent.com/document/product/457/9117)。

## 步骤1：注册腾讯云账号
如果您已在腾讯云注册，可忽略此步骤。  
如未注册，请前往 [注册页面](https://cloud.tencent.com/register?s_url=https%3A%2F%2Fcloud.tencent.com%2F)。

## 步骤2：购买企业版实例<span id="domain"></span>
>?容器镜像服务企业版目前处于内测阶段，如果您尚未获得容器镜像服务企业版内测资格，请 [申请使用](https://cloud.tencent.com/apply/p/8mvsqz6j8e3)。  
> 
1. 登录 [容器镜像服务控制台](https://console.cloud.tencent.com/tcr)，进入“实例列表”页面。
2. 单击【新建】，在“新建实例”窗口中参考以下信息配置您独享的企业级实例。如下图所示：
![](https://main.qcloudimg.com/raw/f3cbb8a924c69273b43d0d889a605641.png)
	- **实例名**：输入自定义实例名称。该名称全局唯一，请避免与自己或他人现有实例名称重复。该名称将直接用于该实例 Registry 服务的访问域名，**创建后不可修改**，请谨慎选择。建议组合使用公司、实例所在地域或项目的缩写。
	- **实例地域**：选择您希望部署该实例的地域。**实例创建后地域将无法更改**，请尽量选择您主要业务所在的地域。
	- **实例规格**：选择您希望购买的实例规格。不同实例规格具有不同的实例性能及配额，免费内测阶段暂支持购买【标准版】实例。
	- **实例域名**：自动生成的实例访问域名，前缀与实例名一致。**实例创建后，实例域名无法修改**。使用 `docker login` 命令登录实例时，即使用该域名。
3. 完成配置后单击【确定】即可开始创建企业版实例。
您可在“[实例列表]()”页面查看实例的创建进度，预计1分钟完成创建。
4. 在“实例列表”页面，查看实例状态为“运行中”，则表示该实例已成功创建并正常运行，您可参考以下步骤开始配置实例的访问控制策略及登录实例。


## 步骤3：配置网络访问策略<span id="network"></span>
> !为保护您的数据安全，实例创建后默认拒绝全部公网及内网访问，请首先完成网络访问策略配置。
>
选择左侧导航栏中的【访问控制】，按需参考以下步骤配置实例的公网及内网的访问策略：


### 公网访问
1. 在“[公网访问]()”页面上方，选择需要配置公网访问策略的实例。
2. 单击右上角的【开启公网访问入口】即可开启实例的公网访问入口，允许 Docker 客户端通过公网访问实例。如下图所示：
![](https://main.qcloudimg.com/raw/2a2f54458a85504fef2965086d3f8106.png)
3. 待入口开通后，单击【添加公网白名单】。
4. 在弹出的“新建公网访问白名单规则”窗口中，配置需放通的公网 IP 并单击【确定】。
>!为保障您的实例安全，不支持配置 `0.0.0.0/0` 放通全部 IP 地址端。


### 内网访问
1. 在“[内网访问]()”页面上方，选择需配置内网访问策略的实例。
2. 单击【新建】并在弹出的“新建内网访问白名单”窗口中，通过选择已有的私有网络（VPC）实现 VPC 内集群通过内网访问实例。如下图所示：
>?
>- 请选择您集群所在的 VPC，并选择该 VPC 下的一个子网。
>- 新建内网访问链路将占用该子网下的一个 IP 地址。
>
![](https://main.qcloudimg.com/raw/ad436d54207ae94cb133d200e9a41bcc.png)
3. 单击【确定】即可完成设置。


## 步骤4：创建镜像仓库
1. 选择左侧导航栏中的【[命名空间]()】，进入“命名空间”列表页面。
2. 在页面上方选择需创建命名空间的实例，并单击【新建】。
>?命名空间用于管理实例内的镜像仓库，不直接存储容器镜像，可映射为企业内团队、项目或是其他自定义层级。
>
3. <span id="step3"></span>在弹出的“新建命名空间”窗口中，填写信息配置命名空间并单击【确定】。如下图所示：
![](https://main.qcloudimg.com/raw/7762dc90e53b7ba6f24a51d7537cf4f1.png)
4. 单击左侧导航栏中的【[镜像仓库]()】，进入“镜像仓库”列表页面。
5. 单击【新建】并在弹出的“新建镜像仓库”窗口中，填写配置信息并单击【确定】。如下图所示：
其中，“命名空间”请选择 [步骤3](#step3) 中已创建的命名空间。
![](https://main.qcloudimg.com/raw/4598ee358512e06aa6f97705fd53dd4e.png)

## 步骤5：推送拉取镜像
通过以上步骤，您已经创建了实例及镜像仓库，可通过以下步骤实现向镜像仓库内推送及拉取镜像。
>?此步骤需要您使用一台安装有 Docker 的云服务器或物理机，并确保访问的客户端已在 [配置网络访问策略](#network) 定义的公网或内网允许访问范围内。  

### 登录 Registry 实例
1. 选择左侧导航栏的【[实例列表]()】，单击实例名进入实例管理页面。
2. 选择【访问凭证】页签，即可在“凭证信息”中获取登录实例的用户名，单击【重新生成】获取临时登录密码。
3. 在命令行工具中执行以下命令，登录实例。
访问域名可根据 [购买企业版实例](#domain) 中已创建的实例进行修改。
```
docker login demo-tcr.tencentcloudcr.com
```
4. 按照系统提示输入用户名及临时密码，密码默认不显示。
命令行工具显示 `Login Succeeded` 即表示登录成功。



### 推送容器镜像
您可在本地构建新的容器镜像或从 DockerHub 上获取一个公开镜像用于测试。
本文以 DockerHub 官方的 Nginx 最新镜像为例，在命令行工具中依次执行以下指令，即可推送该镜像。
```
docker tag nginx:latest demo-tcr.tencentcloudcr.com/team-01/demo-repo:latest
```
```
docker push demo-tcr.tencentcloudcr.com/team-01/demo-repo:latest
```

### 拉取容器镜像
本文以已成功推送的 Nginx 镜像为例，在命令行中执行以下命令，即可拉取该镜像。
```
docker pull demo-tcr.tencentcloudcr.com/team-01/demo-repo:latest
```

## 出现问题？
如果您在使用过程中出现问题，可参考 [常见问题](https://cloud.tencent.com/document/product/1141/39292) 进行问题定位及解决，也可通过 [提交工单](https://console.cloud.tencent.com/workorder/category) 将问题反馈给我们，我们将尽快为您处理。
