本文将介绍如何从零开始，购买容器镜像服务企业版实例，并配置网络访问策略，最终实现容器镜像的推送及拉取。  
若您需要使用容器镜像服务个人版，请参考 [镜像仓库基本教程](https://cloud.tencent.com/document/product/457/9117)。
>?容器镜像服务企业版目前处于内测阶段，如果您尚未获得容器镜像服务企业版内测资格，请 [申请使用](https://cloud.tencent.com/apply/p/8mvsqz6j8e3)。  
>

## 步骤1：注册腾讯云账号
如果您已在腾讯云注册，可忽略此步骤。  
如未注册，请前往 [注册页面](https://cloud.tencent.com/register?s_url=https%3A%2F%2Fcloud.tencent.com%2F)。

## 步骤2：购买企业版实例<span id="domain"></span>
>?若您的企业当前已获得内测资格，但尚未开通本服务，则需首先开通服务，并授权容器镜像服务访问您的对象存储及私有网络资源。服务开通需要主账号或具有管理员权限的子账号进行操作，如果当前正在使用子账号进行操作，请先为该账号分配相应权限，具体可参考 [企业版授权方案示例](https://cloud.tencent.com/document/product/1141/41417)。
>
1. 登录 [容器镜像服务控制台](https://console.cloud.tencent.com/tcr)，进入“实例列表”页面。
2. 单击【新建】，在“新建实例”窗口中参考以下信息配置您独享的企业级实例。如下图所示：
![](https://main.qcloudimg.com/raw/f3cbb8a924c69273b43d0d889a605641.png)
 - **实例名**：输入自定义实例名称。该名称全局唯一，请避免与自己或他人现有实例名称重复。该名称将直接用于该实例 Registry 服务的访问域名，**创建后不可修改**，请谨慎选择。建议组合使用公司、实例所在地域或项目的缩写。
 - **实例地域**：选择您希望部署该实例的地域。**实例创建后地域将无法更改**，请根据容器集群资源所在地进行选择。
 - **实例规格**：选择您希望购买的实例规格。不同实例规格具有不同的实例性能及配额，免费内测阶段暂支持购买【标准版】实例。
 - **实例域名**：自动生成的实例访问域名，前缀与实例名一致。**实例创建后，实例域名无法修改**。使用 `docker login` 命令登录实例时，即使用该域名。
3. 完成配置后单击【确定】即可开始创建企业版实例。
您可在实例列表页面查看实例的创建进度，预计1分钟内可完成创建。
4. 当实例状态转变为**运行中**时，则表示该实例已成功创建并在正常运行，您可参考以下步骤开始配置实例的访问控制策略并登录实例完成镜像的推送及拉取。


## 步骤3：配置网络访问策略<span id="network"></span>
> !为保护您的数据安全，实例创建后默认拒绝全部公网及内网访问。在准备登录实例、推送及拉取镜像之前，请首先进行网络访问策略配置。
>
选择控制台左侧导航栏中的【访问控制】，按需选择【公网访问】或【内网访问】，并参考以下步骤配置相应的访问策略：

### 公网访问
1. 在“公网访问”页面上方，确认已选择新建的实例。
2. 单击右上角的【开启公网访问入口】，按钮状态将变为【开启中】。如下图所示：
开启公网访问将允许 Docker 客户端通过公网访问镜像仓库。
![](https://main.qcloudimg.com/raw/66b810a8afe6a205bf9ea8fef06b089b.png)
3. 当按钮状态由【开启中】转变为【关闭公网访问入口】时，即说明已经成功公网访问入口，此时可单击列表左上方的【添加公网白名单】添加公网访问放通策略。
4. 在弹出的“新建公网访问白名单”窗口中，配置需放通的公网 IP 地址或地址段，并可选填写该规则的备注信息。如下图所示：
建议不要直接填写 `0.0.0.0/0` 以放通全部来源的公网访问，或在实例正式启用前删除该规则。
![](https://main.qcloudimg.com/raw/5e930c1fe29ce5a2e87848bc63b6e52d.png)

### 内网访问
1. 在“内网访问”页面上方，确认已选择新建的实例。
2. 单击【新建】，在弹出的“新建内网访问白名单窗口”中配置私有网络及子网信息。如下图所示：
请选择您希望访问镜像仓库的容器集群所在的私有网络，并选择该私有网络内任意一个仍有内网 IP 可供占用的子网。
![](https://main.qcloudimg.com/raw/e5d902a26068ed059c64c6de52654808.png)

## 步骤4：创建镜像仓库
1. 选择左侧导航栏中的【命名空间】，进入“命名空间”列表页面并单击【新建】。
>?命名空间用于管理实例内的镜像仓库，不直接存储容器镜像，可映射为企业内团队、项目或是其他自定义层级。
>
2. 在弹出的“新建命名空间”窗口中，参考以下提示配置命名空间信息并单击【确定】。如下图所示：
![](https://main.qcloudimg.com/raw/9d3ce4e075a0fc7e6ee16b9cbbda3932.png)
 - **名称**：建议使用企业内团队或项目进行命名，单个实例内命名空间名称不可重复。
 - **访问级别**：可选择【私有】或【公开】，命名空间内的镜像仓库及 Helm Chart 仓库将继承该属性，命名空间创建后仍可修改该属性。
3. 单击左侧导航栏中的【镜像仓库】，进入“镜像仓库”列表页面。
4. 单击【新建】并在弹出的“新建镜像仓库”窗口中，配置镜像仓库信息并单击【确定】。如下图所示：
其中，命名空间可选择已创建的命名空间，名称支持多级路径，详细描述支持 Markdown 语法。
![](https://main.qcloudimg.com/raw/8caefd017f02897b6e1cc36820a016f0.png)

## 步骤5：推送拉取镜像
通过以上步骤，您已经创建了实例及镜像仓库，接下来可通过以下步骤实现向镜像仓库内推送及拉取镜像。
>?此步骤需要您使用一台安装有 Docker 的云服务器或物理机，并确保访问的客户端已在 [配置网络访问策略](#network) 定义的公网或内网允许访问范围内。  

### 登录 Registry 实例
1. 选择左侧导航栏的【实例列表】，单击实例名进入实例管理页面。
2. 选择【访问凭证】页签，单击【生成临时登录指令】。
>?本文以获取实例临时登录指令为例，您还可以 [获取长期访问凭证](https://cloud.tencent.com/document/product/1141/41829#.E8.8E.B7.E5.8F.96.E9.95.BF.E6.9C.9F.E8.AE.BF.E9.97.AE.E5.87.AD.E8.AF.81)。
>
3. 在弹出的“临时登录指令”窗口中，单击【复制登录指令】。
4. 在命令行工具中执行已获取的登录指令，登录实例。示例如下：
```
docker login demo-tcr.tencentcloudcr.com --username 1xxx1019xxxx --password eyJhbGciOiJSUzI1NiIsImtpZCI6IlZCVTY6VTVGVzpP...
```
命令行工具显示 `Login Succeeded` 即表示登录成功。



### 推送容器镜像
您可在本地构建新的容器镜像或从 DockerHub 上获取一个公开镜像用于测试。
本文以 DockerHub 官方的 Nginx 最新镜像为例，在命令行工具中依次执行以下指令，即可推送该镜像。请将 `demo-tcr`、`project-a` 及 `nginx` 依次替换为您实际创建的实例名称、命名空间名称及镜像仓库名。
```
docker tag nginx:latest demo-tcr.tencentcloudcr.com/project-a/nginx:latest
```
```
docker push demo-tcr.tencentcloudcr.com/project-a/nginx:latest
```

### 拉取容器镜像
本文以已成功推送的 Nginx 镜像为例，在命令行中执行以下命令，即可拉取该镜像。
```
docker pull demo-tcr.tencentcloudcr.com/project-a/nginx:latest
```

## 出现问题？
如果您在使用过程中出现问题，可参考 [常见问题](https://cloud.tencent.com/document/product/1141/39292) 进行问题定位及解决，也可通过 [提交工单](https://console.cloud.tencent.com/workorder/category) 将问题反馈给我们，我们将尽快为您处理。
