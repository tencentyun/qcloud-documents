
## 操作场景
腾讯云容器镜像服务（Tencent Container Registry，TCR）支持托管分发容器镜像，并提供镜像构建功能实现代码变更自动触发镜像构建，推送及托管。如果客户需要快速迭代业务应用，并采用自动化流水线生成镜像，将会不断生成大量镜像版本，且旧有镜像版本大多不再需要。单个镜像仓库内过多镜像版本将给版本管理带来负担，而且将可能触及仓库内镜像版本数配额。因此 TCR 实现了镜像版本保留功能，此功能允许用户自定义创建版本保留规则，可定时触发该规则，并自动清理保留规则外的镜像版本。

版本保留规则支持两种保留策略，保留最新推送的#个版本和保留#天内推送的版本，并支持模拟执行。

## 前提条件

在创建并管理 TCR 企业版实例的镜像仓库前，您需要完成以下准备工作：
- 已成功 [购买企业版实例](https://cloud.tencent.com/document/product/1141/51110)。
- 如果使用子账号进行操作，请参考 [企业版授权方案示例](https://cloud.tencent.com/document/product/1141/41417) 提前为子账号授予对应实例的操作权限。

## 操作步骤
### 创建版本保留规则
1. 登录 [容器镜像服务](https://console.cloud.tencent.com/tcr) 控制台，选择左侧导航栏中的【版本保留】。
在“版本保留”页面即可查看当前实例内的版本保留规则列表。如需切换实例，请在页面上方的“实例名称”下拉列表中进行选择。
2. 单击【新建规则】，在“新建版本保留规则”窗口中，参考以下提示进行规则配置。如下图所示：
![](https://main.qcloudimg.com/raw/570d6aa9783e8b588fcd8044afcde05a.png)
 - **所属实例**：当前已选择实例。
 - **命名空间**：版本保留规则生效的命名空间，单个命名空间内暂只能创建一条规则。
 - **保留版本**：默认不过滤，即命名空间内全部仓库及版本。
 - **保留策略**：支持配置保留最新推送的#个版本，保留#天内推送的版本两种模式，并在指定版本数或天数。
 - **执行周期**：版本保留规则的执行周期，支持手动执行，或每天、每周、每月执行。
 - **启用规则**：默认启用。
3. 单击【确定】即可创建版本保留规则。
 
### 管理版本保留规则
1. 版本保留规则成功创建后即可在“版本保留”页面查看已创建的版本保留规则，您可执行以下操作管理版本保留规则。如下图所示：
![](https://main.qcloudimg.com/raw/daf3997f9a183fc4cf5eec44d7968c7a.png)
- **查看规则执行日志**：单击规则名称，即可查看该规则触发日志，详情请参见 [查看执行日志](#CheckLog)。
- **配置**：重新配置实例版本保留规则，不可修改生效的命名空间。
- **删除**：删除该实例版本保留规则。

### 查看执行日志[](id:CheckLog)
1. 单击指定版本保留规则名称，即可查看该规则的触发日志。如下图所示：
![](https://main.qcloudimg.com/raw/b24aeba8bb7bca21ee8238c9439f2d33.png)
 - **任务ID**：实例内唯一的版本保留执行任务 ID。
 - **创建时间**：版本保留执行任务创建的时间。
 - **任务耗时**：完成全部版本保留执行任务消耗的时间。
 - **执行方式**：手动或自动，点击”立即执行“ 或 ”模拟执行“ 为手动方式，通过规则定义的周期自动执行，则为自动方式。
 - **执行类型**：真实执行或模拟执行，模拟执行可用于确认规则是否生效，但不实际清理镜像版本。
 - **执行状态**：任务完成状态。
2. 可点击指定任务 ID 查看任务详情，并可点击具体仓库查看执行日志。
