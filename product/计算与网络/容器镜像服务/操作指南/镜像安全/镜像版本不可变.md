
## 操作场景
腾讯云容器镜像服务（Tencent Container Registry, TCR）企业版支持对托管的容器镜像版本进行保护。容器镜像安全是云原生应用交付中的关键一环，为托管在 TCR 的镜像开启版本不可变功能，可确保相同版本的镜像仅被成功推送一次，进而有效降低生产环境下由误操作引起的版本覆盖风险。TCR 支持命名空间级别的版本保护，用户可以根据业务需求的细粒度定义该功能所覆盖的仓库和镜像版本。



## 操作步骤

### 创建版本不可变规则

1. 登录 [容器镜像服务控制台](https://console.cloud.tencent.com/tcr)，选择左侧导航栏中的**版本管理** > **版本不可变**。
2. 在“版本不可变”页中，选择实例所在地域、实例名称。
3. 单击**新建规则**，在“新建版本不可变规则”窗口中，参考以下提示进行规则配置。如下图所示：
![](https://main.qcloudimg.com/raw/a1f8abde8caabdeea7d79ca1792a17ee.png)
<table>
<tr><th style="width: 20%">配置项</th><th>配置说明</th></tr>
</tr>
<tr>
<td>所属实例</td>
<td>当前已选择实例。</td>
</tr>
<tr>
<td>命名空间</td>
<td>当前实例需要开启版本保护的命名空间。单个命名空间内仅支持创建一条规则。</td>
</tr>
<tr>
<td rowspan=2>不可变规则</td>
<td ><b>latest</b>：当前命名空间下所有仓库中，除 latest 版本外，其余镜像版本均不可被覆盖。</td>
</tr>
<tr>
<td><b>自定义</b>：自定义配置需要匹配的仓库和镜像版本。<br><ul><li><b>仓库匹配</b>：选择镜像仓库的过滤类型，并根据 <a href="https://cloud.tencent.com/document/product/1141/41811#.E7.9B.B8.E5.85.B3.E6.93.8D.E4.BD.9C">正则指引</a> 填写需要过滤的仓库名称。</li><li><b>版本匹配</b>：选择镜像版本的过滤类型，并根据 <a href="https://cloud.tencent.com/document/product/1141/41811#.E7.9B.B8.E5.85.B3.E6.93.8D.E4.BD.9C">正则指引</a> 填写需要过滤的版本名称。</li></ul></td>
</tr>
<tr>
<td>启用规则</td>
<td>规则默认创建时生效。
<dx-alert infotype="notice" title="">
规则状态启用即代表规则生效，您可在配置中开启/关闭该规则。
</dx-alert>
</td>
</tr>
</table>

4. 单击**确定**即可创建规则。



### 管理版本不可变规则
成功创建后即可在“版本不可变”页面查看规则，您可执行以下操作管理版本不可变规则。如下图所示：
![](https://main.qcloudimg.com/raw/a3efc5b03c30b5b18bda32e99cb12c74.png)
- **配置**：重新配置实例版本不可变规则，不支持修改生效的命名空间。
- **删除**：删除该实例下的版本不可变规则。


