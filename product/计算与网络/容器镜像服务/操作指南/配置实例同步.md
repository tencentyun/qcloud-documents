
## 操作场景
腾讯云容器镜像服务（Tencent Container Registry，TCR）支持在不同地域的不同实例间同步容器镜像及 Helm Chart，可实现单点推送，全球自动同步分发，方便企业在全球多个地域快速部署更新容器业务。

实例同步功能允许用户自定义创建同步规则，可指定某个实例内的部分资源同步至另一个实例内的指定位置。具体而言，可选择同步资源类型，如容器镜像，Helm Chart，或是全部同步；可过滤同步资源路径，通过正则表达式过滤仓库及版本；可选择是否覆盖已有的同名镜像，避免历史数据覆盖丢失。

## 前提条件

在创建并管理 TCR 企业版实例的镜像仓库前，您需要完成以下准备工作：
- 已成功 [创建企业版实例](https://cloud.tencent.com/document/product/1141/40716)。
- 如果使用子账号进行操作，请参考 [企业版授权方案示例](https://cloud.tencent.com/document/product/1141/41417) 提前为子账号授予对应实例的操作权限。

## 操作步骤
### 创建同步规则
1. 登录 [容器镜像服务](https://console.cloud.tencent.com/tcr) 控制台，选择左侧导航栏中的【实例同步】。
在“实例同步”页面即可查看当前实例内的实例同步规则列表。如需切换实例，请在页面上方的“实例名称”下拉列表中进行选择。
2. 单击【新建】，在“新建实例同步规则”窗口中，参考以下提示进行规则配置。如下图所示：
![](https://main.qcloudimg.com/raw/9d1b5760b185d49058bc937642d7651a.png)
 - **名称**：实例规则名称，支持小写字母，数字，及 “- . _” 三种符号，且以字母数字开头。
 - **描述**：规则描述，支持中文。
 - **同步源**：
   - **源实例**：当前所选实例即为源实例，可返回 “实例同步” 页面修改。
   - **命名空间**：当前实例所需要同步的命名空间，暂不支持选择全部命名空间。
   - **仓库名称**：同步的仓库，支持正则表达式筛选，不填写则默认是命名空间内全部仓库。
   - **版本Tag**：同步的版本，支持正则表达式筛选，不填写则默认是符合条件的仓库内所有版本。
   - **仓库类型**：同步资源的类型，可同时同步容器镜像和 Helm Chart，或只同步其中一种资源。
 - **同步目标**：
   - **目标实例**：数据同步的目标实例，可选择平台内任一实例，含其他地域实例及源实例。
   - **命名空间**：仓库同步至目标实例后所在的命名空间，不填写则默认是与源实例中同名的命名空间。如果没有命名空间将新建。
 - **覆盖镜像**：如果目标实例内已有同名的容器镜像，是否覆盖，建议不覆盖。
1. 单击【确定】即可创建同步规则。
 
### 管理同步规则
成功创建后即可在“实例同步”页面查看已创建的同步规则，此时您可执行以下操作同步规则进行管理。如下图所示：
![](https://main.qcloudimg.com/raw/635ae131a006db99afdd62ec12250ec6.png)
- **查看同步日志**：点击实例规则名称即可查看该规则触发日志。
- **修改规则状态**：新建的实例同步规则默认启用，可点击切换按钮关闭或再次启用该规则。
- **触发同步**：手动触发同步，将扫描实例内所有符合规则的仓库并进行同步。
- **配置**：重新配置实例同步规则，可配置全部参数。
- **删除**：删除该实例同步规则

### 查看同步日志
单击指定实例同步规则名称，即可弹出该规则的触发日志界面。如下图所示：
![](https://main.qcloudimg.com/raw/47d5a117d809d37758f02b57df24109a.png)
- **任务ID**：实例内唯一的同步任务ID。
- **创建时间**：同步任务创建的时间。
- **任务耗时**：完成全部同步任务消耗的时间。
- **成功比例**：资源同步完成比例，单次同步任务可能同时同步多个仓库。
- **同步仓库数**：当前任务需要同步的仓库数量。
- **同步状态**：任务完成状态，如果单次同步任务所需同步的容器镜像及 Helm Chart 较多，可能同步状态会保持在同步中较久。
