## 离线迁移

### 上传 COS 和迁移为什么耗时太久？

上传的耗时与镜像文件的大小、带宽的大小等因素有关。建议使用压缩的镜像格式（qcow2 或 vhd），可以节省传输和迁移的时间。

### 为什么迁移任务失败了？

 - 目前腾讯云的服务迁移支持的镜像格式有：qcow2，vhd，vmdk，raw，请确认您的镜像格式满足上述之一。
 - 请确认您的镜像文件已经完整上传到 COS 中，并保证文件没有损坏。
 - 迁移需要保证目的云服务器/云硬盘处于正常使用期，处于到期状态的设备将无法完成迁移。

### 如何排查迁移任务提示的错误原因？

 - 如果提示“镜像文件校验失败”，通常为当前迁移任务的目标系统盘或数据盘没有源盘的存储空间大，目标系统盘或数据盘存储空间没有镜像文件大等原因，请重新调整目标系统盘或数据盘的大小后，再重试。
 - 如果提示“获取镜像文件元数据失败”，通常为镜像文件受损或者镜像文件格式不支持等原因，请检查制作/导出镜像、上传镜像等阶段是否出错，或者提供 qcow2，vhd，vmdk，raw 格式的镜像文件，再重试。
 - 如果提示“任务超时”，“系统错误”，“其他原因”等，或者重试迁移任务却依然失败，可 [联系我们](https://cloud.tencent.com/document/product/213/39047) 解决。


## 在线迁移

### 在线迁移一般性问题相关

#### 支持哪些操作系统和磁盘类型？

- Linux 的主流操作系统（如Centos/Ubuntu等）均可。
- 与磁盘类型和用量无关。

#### 在线迁移和导入镜像的区别是什么？

在线迁移类似导入镜像，可以实现将源端的系统迁入腾讯云。其中，最主要的区别在于在线迁移无需手动制作镜像、导出/导入镜像才能上云，而是只需在源端机器上直接传输系统和数据即可上云。

#### 在线迁移会迁移源端公网 IP 吗？

不会。在线迁移只会同步源端系统和数据，公网 IP 无法迁移。

#### 迁移工具是否支持断点续传？

支持，在数据传输阶段中断后，可以再次运行工具便可恢复传输。

#### 迁移完成后工具还需保留吗？

不需要。迁移完成之后，您可以在源服务器中直接删除。

#### 迁移速度和费用是多少？

- 速度：主要依赖于目的子机带宽，测试时我们1核1G内存，按量计费带宽为12Mbps的子机，实际迁移速率大概是9Mbps。可参见 [迁移时间预估教程]() 。
- 费用：迁移工具的使用是免费的。迁移过程中会因为带宽等资源产生少量计费，产生的费用可根据流量和时长计费规则进行查看，具体请看官网价格。

#### 是否支持多台子机同时迁移？

支持。多台服务器的迁移可以并行进行，因为迁移到各自不同的目的端子机，相互并无关系。

#### 如何检查和安装 Virtio？

检查和安装 Virtio，操作详情可参考 [Linux 系统检查 Virtio 驱动](https://cloud.tencent.com/document/product/213/9929)。

#### 如何安装 Rsync？

可根据源服务器的操作系统选择相应的命令安装Rsync。

- CentOS：**yum -y install rsync**。
- Ubuntu、Debian：**apt-get -y install rsync**。
- SUSE：**zypper install rsync**。
- 其他linux发行版：参见对应发行版官网的安装文档。

#### 如何关闭 SELinux？

编辑/etc/selinux/config文件设置`SELINUX=disabled` 。

### 控制台在线迁移相关

#### 工具在哪里下载？

[点此下载](https://go2tencentcloud-1251783334.cos.ap-guangzhou.myqcloud.com/latest/go2tencentcloud.zip) 控制台在线迁移工具压缩包，并参考 [控制台在线迁移使用指引]() 进行操作。

#### 如何导入迁移源？

1. 下载并解压 [控制台在线迁移工具]() 。
2. 执行源端主机相对应架构的可执行文件，即可导入迁移源至在线迁移控制台。如：
   - 32位源端主机执行 go2tencentcloud_x32
   - 64位源端主机执行 go2tencentcloud_x64

#### 如何更新迁移源或者重新导入迁移源？

如果您的迁移源磁盘等信息发生变化，您想更新迁移源的信息，或者重新导入迁移源， 那么您需要先删除迁移源后，再重新运行客户端导入迁移源。

#### 如何删除迁移源？

在在线迁移控制台上选择要删除的迁移源，单击删除即可删除迁移源。如果您的迁移源关联了尚未完成的迁移任务， 那么您需要先暂停并删除迁移任务之后，在删除迁移源。

#### 迁移到目标云服务器时目标实例如何选择？

建议目标云服务器的操作系统尽量和源端主机的操作系统类型一致。例如，CentOS 7 系统的对源端主机迁移时，选择一台 CentOS 7 系统的云服务器作为迁移目标。

#### 迁移任务什么状态为未完成状态？

只有迁移任务状态为 **成功** 时，迁移任务才属于完成状态，其余均为未完成状态。

#### 如何删除迁移任务？

1. 当迁移任务 **未开始** 时， 您可以直接点击迁移任务操作列的删除直接删除迁移任务。
2. 当迁移任务 **成功** 时，您可以直接点击迁移任务操作列的删除直接删除迁移任务。
3. 当迁移任务 **失败** 时，如果您需要删除迁移任务，则需要保持迁移源在线，然后点击迁移任务操作列的删除来删除迁移任务，此时任务会处于删除中，迁移工具会自动清理迁移任务产生的资源，然后删除迁移任务。

#### 如果迁移时间过长，您想取消迁移怎么办？

如果迁移时间过长，您想取消迁移任务， 此时可以先在控制台暂停迁移任务， 暂停成功之后，在点击删除来删除迁移任务，则可取消本次迁移。

#### 如果中转实例被销毁了怎么办？

迁移至目标腾讯云镜像时，如果创建的中转实例被误销毁了，您可以删除当前的迁移任务，重新为迁移源新建并启动迁移任务。

#### 迁移报错或失败怎么办？

迁移报错或失败的原因很多，通常有几种：

1. 迁移至目标云服务器时，目标云服务器安全组没有开放80、443端口。

   解决方式：修改目标云服务器的安全组规则，开放80、443端口。

2. 迁移至目标云服务器时，目标云服务器磁盘容量不足。

   解决方式：为服务器挂载容量足够的磁盘重新选择容量足够的云服务器，重新创建迁移任务发起迁移。

3. 迁移至目标腾讯云镜像，创建中转实例报错，如日志报Failed create transit instance, maybe no available source in target region.

   解决方式：可能为迁移任务的目标区域没有可用的资源，此时可选择其他区域迁移，或者使用迁移至指定云服务器解决。

如果您的问题仍未解决或者不属于以上几种，可以保留当时的迁移日志文件（默认是迁移工具目录下的 log 文件），并 [联系我们](https://cloud.tencent.com/document/product/213/39047) 解决。

#### 迁移完成后的成品是什么？

迁移任务完成之后会按照您迁移任务的设定的目标类型产生对应的迁移成品。

- 目标类型选择 **云服务器镜像** ：迁移完成之后会为迁移源生成的目标腾讯云镜像，您可点击迁移任务的迁移结果列的云服务器镜像ID，即可跳转到 [云服务器镜像页面](https://console.cloud.tencent.com/cvm/image/index) ，并使用该镜像创建云服务器。创建云服务器镜像时也会同步创建与之关联的 **云服务器快照**。
- 目标类型选择 **云服务器实例** ：迁移完成之后会将迁移源迁移至目标腾讯云云服务器实例。

#### 迁移Linux服务器后怎么检查系统？

请检查目标云服务器能否正常启动、目标云服务器数据与源端主机是否一致、网络是否正常或者其他系统服务是否正常等等。

#### 迁移完成后，再次迁移该如何操作呢？

在在线迁移控制台上重新为迁移源新建并启动迁移任务。



### 迁移工具在线迁移相关

#### 工具在哪里下载？

[点此下载](https://go2tencentcloud-1251783334.cos.ap-guangzhou.myqcloud.com/latest/go2tencentcloud.zip) 迁移工具压缩包，并参考 [迁移工具在线迁移使用指引](https://cloud.tencent.com/document/product/213/38783) 进行操作。

#### 如何使用工具？

迁移工具需要拷贝到源服务器，针对机器的情况对配置文件作出修改后即可运行迁移工具。对于批量迁移，您可以通过写脚本进行批量处理。

#### 迁移报错或失败怎么办？

迁移报错或失败的原因很多，通常有几种：

1. 目标云服务器安全组没有开放80、443端口。
2. 源端迁移时有数据盘，但是没有配置 user.json 里的 DataDisks 字段迁移源端数据盘，所有数据发往目标云服务器系统盘，导致磁盘容量不足。
3. 在 [内网迁移场景](https://cloud.tencent.com/document/product/213/38783#intranetMigration) 下，没有执行第三阶段的迁移，使目标云服务器退出迁移模式。

如果您的问题仍未解决或者不属于以上几种，可以保留当时的迁移日志文件（默认是迁移工具目录下的 log 文件），并 [联系我们](https://cloud.tencent.com/document/product/213/39047) 解决。
