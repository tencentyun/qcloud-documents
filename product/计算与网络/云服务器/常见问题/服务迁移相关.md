## 离线迁移

### 上传 COS 和迁移为什么耗时太久？
上传的耗时与镜像文件的大小、带宽的大小等因素有关。建议使用压缩的镜像格式（qcow2 或 vhd），可以节省传输和迁移的时间。

### 为什么迁移任务失败了？
 - 目前腾讯云的服务迁移支持的镜像格式有：qcow2、vhd、vmdk 及 raw，请确认您的镜像格式满足上述之一。
 - 请确认您的镜像文件已经完整上传到 COS 中，检查 COS 权限，确保临时链接的有效性及文件没有损坏。
 - 迁移需要保证目的云服务器/云硬盘处于正常使用期，处于到期状态的设备将无法完成迁移。
 
### 如何排查迁移任务提示的错误原因？ 
- 如果提示**“获取镜像文件元数据失败”**，通常为镜像文件受损或者镜像文件格式不支持等原因，请检查制作/导出镜像、上传镜像等阶段是否出错，或者提供 qcow2、vhd、vmdk 或 raw 格式的镜像文件，再重试。
- 如果提示**“解压镜像失败”**，通常为镜像制作错误问题，请检查镜像压缩包的正确性或再次导出镜像，并确保目的盘容量大于源盘，再重试。
- 如果提示**“目标设备存储空间过小”**，通常为当前迁移任务的目标系统盘或数据盘没有源盘的存储空间大，目标系统盘或数据盘存储空间没有镜像文件大等原因，请重新调整目标系统盘或数据盘的大小，确保目标盘容量大于源盘容量，再重试。
- 如果提示**“访问 cos 镜像文件失败”**，通常为 COS 权限问题，请确保 COS 文件所在地域与当前地域一致，检查 COS 权限并确保临时链接的有效性，再重试。
- 如果提示**“迁入目的盘失败”**，通常可能的原因如下：
 - 目的盘容量过小。
 - 镜像在制作过程中出现错误。
 请逐一排查后重试。
- 如果提示**“任务超时”**、**“系统错误”**、**“其他原因”**等，或者重试迁移任务却依然失败，可通过 [联系我们](https://cloud.tencent.com/document/product/213/39047) 解决。
 

## 在线迁移一般性问题

### 在线迁移支持哪些操作系统和磁盘类型？
- Linux 的主流操作系统（如 Centos 或 Ubuntu 等）均可。
- 与磁盘类型和用量无关。


### 在线迁移和导入镜像的区别是什么？
在线迁移类似导入镜像，可以实现将源端的系统迁入腾讯云。其中，最主要的区别在于在线迁移无需手动制作镜像、导出/导入镜像才能上云，而是只需在源端机器上直接传输系统和数据即可上云。


### 在线迁移会迁移源端公网 IP 吗？
不会。在线迁移只会同步源端系统和数据，公网 IP 无法迁移。


### 迁移工具是否支持断点续传？
支持，在数据传输阶段中断后，可以再次运行工具便可恢复传输。


### 迁移完成后工具还需保留吗？
不需要。迁移完成之后，您可以在源服务器中直接删除。


### 迁移速度和费用是多少？
- 速度：主要依赖于目标子机带宽，测试使用1核1G内存，按量计费带宽为12Mbps的子机，实际迁移速率大概是9Mbps。具体计算方法可参见 [迁移时间预估教程](https://cloud.tencent.com/document/product/213/65716)。
- 费用：迁移工具本身免费。迁移过程中会因为带宽等资源产生少量计费，产生的费用可根据流量和时长计费规则进行计算，具体请参见官网价格。


### 是否支持多台子机同时迁移？
支持。多台服务器的迁移可以并行进行，因为迁移到各自不同的目的端子机，相互并无关系。


### 如何检查和安装 Virtio？
检查和安装 Virtio，操作详情可参考 [Linux 系统检查 Virtio 驱动](https://cloud.tencent.com/document/product/213/9929)。


### 如何安装 Rsync？[](id:installRsync)
可根据源服务器的操作系统，选择相应的命令安装 Rsync。
- CentOS：`yum -y install rsync`
- Ubuntu、Debian：`apt-get -y install rsync`
- SUSE：`zypper install rsync`
 其他 Linux 发行版请参见对应发行版官网的安装文档。
 
 
### 如何关闭 SELinux？[](id:closeSELinux)
编辑 `/etc/selinux/config` 文件，并设置 `SELINUX=disabled`。


## 控制台在线迁移相关问题

### 工具在哪里下载？
[点此下载](https://go2tencentcloud-1251783334.cos.ap-guangzhou.myqcloud.com/latest/go2tencentcloud.zip) 控制台在线迁移工具压缩包，并参考 [控制台在线迁移使用指引](https://cloud.tencent.com/document/product/213/65711) 进行操作。


### 如何导入迁移源？
1. 下载并解压 [控制台在线迁移工具](https://go2tencentcloud-1251783334.cos.ap-guangzhou.myqcloud.com/latest/go2tencentcloud.zip) 。
2. 执行源端主机相对应架构的可执行文件，即可导入迁移源至在线迁移控制台。
 - 32位源端主机执行 `go2tencentcloud_x32`
 - 64位源端主机执行 `go2tencentcloud_x64`


### 如何更新迁移源或者重新导入迁移源？
如果您的迁移源磁盘等信息发生变化，需更新迁移源的信息，或重新导入迁移源。则请先删除迁移源后，再重新运行客户端导入迁移源。


### 如何删除迁移源？
登录 [在线迁移控制台](https://console.cloud.tencent.com/cvm/csm/online?rid=1)，单击迁移源所在行右侧的**删除**后进行确认即可删除。如果您的迁移源关联了尚未完成的迁移任务，则请暂停并删除迁移任务后，再删除迁移源。


### 迁移前如何选择目标云服务器实例？
建议目标云服务器的操作系统尽量和源端主机的操作系统类型一致。例如，CentOS 7 系统的对源端主机迁移时，选择一台 CentOS 7 系统的云服务器作为迁移目标。


### 迁移任务什么状态时才表示已完成？
仅迁移任务状态为“成功”时代表完成状态，其余均为未完成状态。


### 如何删除迁移任务？
请对应迁移任务的实际状态进行以下操作：
- 当迁移任务“未开始”或“成功”时，您可以直接单击迁移任务所在行右侧的**删除**直接删除迁移任务。
- 当迁移任务“失败”时，如果您需要删除迁移任务，则需要保持迁移源在线，单击迁移任务所在行右侧的**删除**来删除迁移任务。此时任务会处于“删除中”，迁移工具会自动清理迁移任务产生的资源，并删除迁移任务。


### 如果迁移时间过长，想取消迁移怎么办？
此时请登录 [在线迁移控制台](https://console.cloud.tencent.com/cvm/csm/online?rid=1) 暂停迁移任务，暂停后单击迁移任务所在行右侧的**删除**来删除迁移任务，即可取消本次迁移。


### 如果中转实例被销毁了怎么办？
迁移至目标腾讯云镜像时，如果创建的中转实例被误销毁，您可以删除当前的迁移任务，重新为迁移源新建并启动迁移任务。


### 使用控制台迁移报错或失败怎么办？
迁移报错或失败的原因很多，通常有以下几种：


- 迁移至目标云服务器时，目标云服务器安全组没有开放80、443端口。
**解决方式**：修改目标云服务器的安全组规则，开放80、443端口。
- 迁移至目标云服务器时，目标云服务器磁盘容量不足。
**解决方式**：为服务器挂载容量足够的磁盘，并重新选择容量足够的云服务器，重新创建迁移任务发起迁移。
- 迁移至目标腾讯云镜像，创建中转实例报错。例如，日志报错 “Failed create transit instance, maybe no available source in target region”。
**解决方式**：可能为迁移任务的目标区域没有可用的资源，此时可选择其他区域迁移，或者使用迁移至指定云服务器解决。

如果您的问题仍未解决或者不属于以上几种，可以保留当时的迁移日志文件（默认是迁移工具目录下的 log 文件），并 [联系我们](https://cloud.tencent.com/document/product/213/39047) 解决。



### 迁移完成后会得到什么？
迁移任务完成后，平台会按照您迁移任务的设定的目标类型产生对应的迁移成品。
- 目标类型选择**云服务器镜像**：迁移完成后会为迁移源生成的目标腾讯云镜像，您可单击迁移任务所在行的**云服务器镜像 ID**，在 [云服务器镜像页面](https://console.cloud.tencent.com/cvm/image/index) 查看镜像详情，并可使用该镜像快速创建云服务器。成功创建云服务器镜像后，将会同步创建与该镜像关联的**云服务器快照**。
- 目标类型选择**云服务器实例**：迁移完成后会将迁移源迁移至目标腾讯云云服务器实例。


### 迁移 Linux 服务器后怎么检查系统？
请检查目标云服务器能否正常启动、目标云服务器数据与源端主机是否一致、网络是否正常或其他系统服务是否正常等。


### 迁移完成后，如需再次迁移该如何操作？
登录 [在线迁移控制台](https://console.cloud.tencent.com/cvm/csm/online?rid=1)，重新使用迁移源新建并启动迁移任务。


## 在线迁移工具相关问题


### 工具在哪里下载？
[点此下载](https://go2tencentcloud-1251783334.cos.ap-guangzhou.myqcloud.com/latest/go2tencentcloud.zip) 迁移工具压缩包，并参考 [使用工具迁移操作指引 ](https://cloud.tencent.com/document/product/213/38783) 进行操作。


### 如何使用工具？
需将迁移工具下载或上传至源服务器，并针对机器实际情况修改配置文件后运行迁移工具。若您需进行批量迁移，可通过编写脚本实现批量处理。


### 使用工具迁移报错或失败怎么办？

迁移报错或失败的原因很多，通常有以下几种：
- 目标云服务器安全组没有开放80、443端口。
- 源端迁移时有数据盘，但是没有配置 user.json 里的 DataDisks 字段迁移源端数据盘，所有数据发往目标云服务器系统盘，导致磁盘容量不足。
- 在 [内网迁移场景](https://cloud.tencent.com/document/product/213/65714#intranetMigration) 下，没有执行第三阶段的迁移，使目标云服务器退出迁移模式。

如果您的问题仍未解决或者不属于以上几种，可以保留当时的迁移日志文件（默认是迁移工具目录下的 log 文件），并 [联系我们](https://cloud.tencent.com/document/product/213/39047) 解决。



  

