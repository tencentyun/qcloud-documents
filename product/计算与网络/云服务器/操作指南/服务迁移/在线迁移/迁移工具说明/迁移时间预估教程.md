## 概述

本文档介绍使用在线迁移将您的源服务器上的系统、应用程序等从自建机房（IDC）或云平台等源环境迁移至腾讯云云服务器时的迁移时间预估。

迁移时间主要受迁移过程中数据传输速度的影响，可通过测试迁移源端主机和迁移目标地域主机之间传输速度，预估迁移时间。

## 迁移时间预估

### 场景1

如果迁移任务的目标类型是目标云服务器时，那么迁移时间预估主要为实际数据传输时间。

例如，您的源端主机待迁移的所有磁盘数据实际占用量为50GB, 出口带宽100Mbps, 那么迁移时间可进行一下估算：

1. 单位换算。

   - 实际宽带速度换算为MB/s，100Mbps = 100/8 = 12.5MB/s
   - 实际磁盘数据量换算为MB，50GB = 50*1024 = 51200MB

1. 实际数据迁移时间估算。

   51200 / 12.5 = 4096秒 = 1.14小时

则可预估总迁移时间为1.14个小时。

### 场景2

如果迁移任务的目标类型时目标云服务器镜像，那么迁移时间主要包括实际数据传输时间以及制作镜像时间。

例如，您的源端主机待迁移的所有磁盘数据实际占用量为50GB, 出口带宽100Mbps, 那么迁移时间可进行一下估算：

1. 单位换算。

   - 实际宽带速度换算为MB/s，100Mbps = 100/8 = 12.5MB/s
   - 实际磁盘数据量换算为MB，50GB = 50*1024 = 51200MB

1. 实际数据迁移时间估算。

   51200 / 12.5 = 4096秒 = 1.14小时

1. 制作镜像时间, 制作速度约为160MB/s。

   51200 / 150 = 320秒 = 0.089小时

则可预估总迁移时间为1.14+0.089=1.23个小时。



## 附录1：测试数据传输速度

数据传输速度可使用工具 **iperf3** ，通过 **iperf3** 可以测试客户端到服务器传输数据的带宽、速率等。

### 传输速度影响因素

1. 源端主机的出口带宽和目标实例的入口带宽。

   例如：源端主机出口带宽为50Mbps，目标实例入口带宽为100Mbps，那么理论上实际传输速度不超过50Mbps

2. 迁移时并不会一直将带宽占满。迁移时可以动态调整目的实例（或中转实例）的入网带宽；

2. 源端主机与目标实例如果处于不同地域时的传输速度比同地域下慢。

> ? 
>
> - 通过控制台在线迁移时，如果迁移目标是云服务器镜像，迁移时会创建一台中转实例（名称为do_not_delete_csm_instance），带宽上线为50Mpbs。
> - 迁移时您可以在控制台动态调整目的实例（或中转实例）的入网带宽，控制迁移速度。

### 迁移至腾讯云Linux云服务器速度测试

例如，迁移至腾讯云Centos 7.5, 传输速度测试步骤如下：

> ? 通过控制台在线迁移时，如果迁移目标是云服务器镜像，迁移时会创建一台Centos 7.5的中转实例。

1. 在迁移目标地域创建一台按量计费的Centos 7.5 实例。

   > ? 如果迁移目标是云服务器镜像，建议选择可用的标准型，cpu、内存配置较低的机型，与实际迁移时场景更接近。

2. 分别在目标测试实例和源端主机上安装 iperf3 工具。

   - 在目标 Centos 7.5 实例上安装 iperf3 工具。

     ```sh
     yum -y install iperf3
     ```

   - 在源端主机主机上安装  iperf3 工具。 可根据源端主机 Linux 发行版本使用对应的安装命令安装 iperf3 工具。

3. 启动目标Centos 7.5 测试实例的 iperf3 为服务端。

   ```sh
   iperf3 -s
   ```

   如下图，表示启动成功：

   ![image-20211104171137336](https://user-images.githubusercontent.com/38848479/140471910-64406f24-9754-40c0-b3d0-3b18ae406176.png)

> ? iperf3 服务端默认端口为TCP 5201，需要为测试Centos 7.5实例安全组入向添加并放行 TCP 5201端口。

4. 在源端主机中启动 iperf3 为客户端。

   ```sh
   iperf3 -c [目标实例IP]
   ```

   如下图测试结果，可知源端主机与测试 Centos 7.5 实例之间传输速度大概为111Mbps。

   <img width="983" alt="image-20211104173308644" src="https://user-images.githubusercontent.com/38848479/140471934-6fc49a49-14df-4f86-9ae5-143a08b23407.png">





