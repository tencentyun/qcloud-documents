## 概述

本文档介绍使用在线迁移控制台将源服务器上的系统、应用程序等从自建机房（IDC）或云平台等源环境迁移至腾讯云的操作步骤。方便实现企业上云、跨云平台迁移、跨账号/区域迁移或部署混合云等业务需求。

源服务器形式可以是物理服务器、虚拟机或其他云平台云服务器。其他云平台包括但不限于 AWS、Google Cloud Platform、VMware、阿里云和华为云等虚拟机平台。

使用工具迁移至腾讯云请参见 [使用工具迁移操作指引]() 。

## 1. 准备事项

- 已在腾讯云上准备好账号。
- 如果您使用子账号进行控制台迁移，则需要使用主账号登陆CAM [访问管理](https://console.cloud.tencent.com/cam/policy)，给子账号授予 QcloudCSMFullAccess 权限。
- 在CAM [访问管理](https://console.cloud.tencent.com/cam/capi) 中创建并获取API密钥。
- [下载]() 控制台迁移工具压缩包。
- 建议暂停源端服务器上的应用程序，以避免迁移时对现有应用程序可能产生的影响。

## 2. 获取控制台迁移工具  
[点此获取]() 控制台迁移工具压缩包。

## 3. 备份数据
- 源端主机：可以选择源服务器快照功能等方式备份数据。
- 目标云服务器：可以选择 [创建快照](https://cloud.tencent.com/document/product/362/5755) 等方式备份数据。

## 4. 迁移前的检查

迁移前，需要检查源端主机, 如果迁移任务的迁移目标是目标云服务器时还需要检查目标云服务器。如果迁移目标是云服务器镜像时，只需要检查源端主机即可。检查内容如下：

<table>
  <tr><th>Linux 源端主机</th><td><ol  style="margin: 0;"><li>检查和安装 Virtio，操作详情可参考 <a href="https://cloud.tencent.com/document/product/213/9929">Linux 系统检查 Virtio 驱动</a>。</li><li>检查是否安装了 rsync，可执行 <code>which rsync</code> 命令进行验证。</li><li>检查 SELinux 是否已打开。如果 SELinux 已打开，请关闭 SELinux。</li><li>向腾讯云 API 发起迁移请求后，云 API 会使用当前 UNIX 时间检查生成的 Token，请确保当前系统时间无误。</li></ol></td></tr>
	<tr><th style="width: 15%;">目标云服务器（可选）</th><td><ol  style="margin: 0;"><li>存储空间：目标云服务器的云硬盘（包括系统盘和数据盘）必须具备足够的存储空间用来装载源端的数据。</li><li>安全组：安全组中不能限制443端口和80端口。</li><li>带宽设置：建议尽可能调大两端的带宽，以便更快迁移。迁移过程中，会产生约等于数据量的流量消耗，如有必要请提前调整网络计费模式。</li><li>目标云服务器和源端主机的操作系统类型是否一致：操作系统不一致会造成后续制作的镜像的信息与实际操作系统不符，建议目标云服务器的操作系统尽量和源端主机的操作系统类型一致。例如，CentOS 7 系统的对源端主机迁移时，选择一台 CentOS 7 系统的云服务器作为迁移目标。</li></ol></td></tr>
</table>

> ? 
>
> - 源端主机检查可以使用工具命令自动检查，如 `sudo ./go2tencentcloud_x64 --check`。
> - go2tencentcloud 迁移工具在开始运行时，默认自动检查。如果需要略过检查强制迁移，请将 client.json 文件中的`Client.Extra.IgnoreCheck`字段配置为`true`。
> - go2tencentcloud 迁移工具详细信息，请参见 [迁移工具说明](https://cloud.tencent.com/document/product/213/38783)。

## 5. 开始迁移

1. 排除源端主机上不需迁移的文件和目录。（可选）  
   在 Linux 源端主机编辑 rsync\_excludes\_linux.txt 文件，排除不需要迁移的文件和目录。

2. 导入迁移源。
   例如，在64位 Linux 源端主机下，以 root 权限执行以下命令运行工具。

   ```shell
   chmod +x go2tencentcloud_x64
   sudo ./go2tencentcloud_x64
   ```

   如下图提示，输入账户 API 访问密钥的 SecretId 和 SecretKey，并按 Enter 键。

   ![image-20211203190755481](https://user-images.githubusercontent.com/38848479/144597160-f0cc7e0c-3de4-4eb6-93c9-358315d66e85.png)

   > ? 您也可以执行前，在 user.json 文件配置账户 API 访问密钥。
   
   当迁移工具界面出现如下图时，表示迁移源已经成功导入控制台，可在控制台查看迁移源。

   ![image-20211203190845375](https://user-images.githubusercontent.com/38848479/144597223-8af952a7-21cf-4c62-97ee-ab1791b55102.png)

   控制台可查看刚才导入的迁移源，状态为 **在线** ，如下图：

   ![image-20211203191022829](https://user-images.githubusercontent.com/38848479/144597278-f426d207-e079-41e6-93ff-955950398d61.png)

   如果未提示 Import source server successfully， 表示导入迁移源失败， 可查看日志解决问题之后重新运行迁移工具导入迁移源。

   > ? 迁移源导入成功之后，请勿关闭迁移工具直至迁移完成。否则，迁移源离线之后，无法完成迁移。

3. 前往在线迁移控制台创建迁移任务。

   - 登陆 [在线迁移控制台](https://console.cloud.tencent.com/cvm/csm/online?rid=17) ，根据迁移工具界面的迁移源ID，找到对应目标迁移源， 单击操作列的 **创建迁移任务** 。

   - 在创建迁移任务页面配置本次的迁移任务，点击确定即可创建迁移任务。迁移任务配置参数详情参见  [迁移任务配置说明](#jobSettings)。

     例如，将一台 Linux 源端主机迁移到腾讯云上海地区，并生成目标云服务器镜像，迁移任务配置如下图：

     ![image-20211207170309270](https://user-images.githubusercontent.com/38848479/145032271-603629aa-8be1-486e-a224-a154a7810adc.png)

4. 启动迁移任务。

   创建迁移任务之后，可在控制台迁移任务页面查看迁移任务,  如下图：

   ![image-20211203191552955](https://user-images.githubusercontent.com/38848479/144597352-9126a161-3bb2-4e28-99e1-b667e9024bdb.png)

   单机操作列的 **开始** 即可开始迁移任务，此时任务状态会变为 **迁移中** ，如下图：

   ![image-20211203191628496](https://user-images.githubusercontent.com/38848479/144597408-53c0fb3d-9366-4f5b-9173-941cfc0ef290.png)

   > ? 预约执行的任务也可跳过本步骤，等到任务预约执行时间，迁移任务会自动开始执行。

5. 等待迁移任务结束。

   当迁移任务状态为 **成功** 时，表示迁移成功完成。如下图：

   ![image-20211203192304225](https://user-images.githubusercontent.com/38848479/144597447-802c72ab-9c7d-4a9d-b9f7-e1703fbbbbd3.png)
   
   > ?  由于传输数据耗时受源端数据大小，网络带宽等因素影响，请耐心等待迁移流程的完成。迁移工具支持数据传输的断点续传。

## 迁移后的检查

1. 如果迁移结果失败，请检查日志文件（默认为迁移工具目录下的 log 文件）的错误信息输出、指引文档或者 [服务迁移类 FAQ](https://cloud.tencent.com/document/product/213/32962) 进行排查和修复问题。然后在迁移任务操作列点击 **重试** 即可重新开始迁移任务。

2. 如果迁移结果成功：

   - 如果迁移目标为云服务器，请检查目标云服务器能否正常启动、目标云服务器数据与源端主机是否一致、网络是否正常或者其他系统服务是否正常等等。
   - 如果迁移目标为云服务器镜像，可点击迁移任务的迁移结果列的云服务器镜像ID，即可跳转到 [云服务器镜像页面](https://console.cloud.tencent.com/cvm/image/index) ，并使用该镜像创建云服务器。

3. 如有任何疑问、迁移异常等问题请查看 [服务迁移类 FAQ](https://cloud.tencent.com/document/product/213/32962) 或者 [联系我们](https://cloud.tencent.com/document/product/282/1558) 解决。
