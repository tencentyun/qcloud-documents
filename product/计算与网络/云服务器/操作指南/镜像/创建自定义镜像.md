## 操作场景

创建镜像时，您可以选择在公共镜像或服务市场镜像中启动实例，并将该镜像连接到您的实例中，自行部署软件环境。在实例正常运行的情况下，您可以根据自己的实际需求，在其基础上创建新的自定义镜像。创建新的自定义镜像后，您可以使用该镜像启动更多与原实例具有相同自定义项的新实例。

>! 
> - 创建自定义镜像的同时系统默认会创建相关快照，删除此快照之前需要先删除关联的镜像。当前快照已经商业化，保留自定义镜像会产生一定的快照费用。快照收费策略请参阅 [关于快照商业化的公告](https://cloud.tencent.com/document/product/362/17935)。
> - 对于2018年7月之后基于公共镜像创建的云盘子机，支持在线制作镜像（即实例不关机的情况下制作镜像）。
> - 其他实例在制作自定义镜像时，请先将实例关机，以保证镜像与当前实例部署环境完全一致。
>

## 注意事项

- 每个地域暂支持10个自定义镜像。
- 以下目录/文件会被清空：
 - /var/log/  
 - /root/.bash_history、/home/ubuntu/.bash_history（Ubuntu 系统）
- Linux 实例制作自定义镜像时，请确认 /etc/fstab 不包含数据盘配置，否则会导致使用该镜像创建的实例无法正常启动。如果制作自定义镜像的 Linux 实例有挂载数据盘，则需要注释或删掉 /etc/fstab 中自行配置的数据盘的相关配置。
- 制作过程需要持续十分钟或更长时间，具体时间与实例的数据大小有关，请提前做好相关准备，以防影响业务。

## 操作步骤

### 使用控制台从实例创建

1. 登录 [云服务器控制台](https://console.cloud.tencent.com/cvm)。
2. 在实例的管理页面，选择需要制作镜像的实例，单击【更多】>【实例状态】>【关机】。如下图所示：
![关机](https://main.qcloudimg.com/raw/4e7f90adcd5ad6a6d20662d7f6175c75.png)
3. 待实例关机后，在该台实例行中，单击【更多】>【制作镜像】。如下图所示：
![](https://main.qcloudimg.com/raw/f54b6446016d38f0e9967b93215a547b.png)
4. 在弹出的 “制作自定义镜像” 窗口中，输入 “镜像名称” 和 “镜像描述”，单击【制作镜像】，进行创建。
>? 您可单击控制台右上方的 <img src="https://main.qcloudimg.com/raw/31b31c7b27848f0378932f17273feff3.png" style="margin: 0;"></img>，查看镜像的创建进度。
>
5. 待镜像完成创建后，单击左侧导航栏中的【[镜像](https://console.cloud.tencent.com/cvm/image)】，进入镜像管理页面。
6. 在镜像列表中，选择您创建的镜像，单击【创建实例】，即可购买与之前相同镜像的服务器。如下图所示：
![自定义镜像](https://main.qcloudimg.com/raw/72c11e2a8590cce35bedadc2dea2d65a.png)

### 使用 API 创建

您可以使用 CreateImage 接口创建自定义镜像。具体内容可以参考 [创建镜像 API](https://cloud.tencent.com/document/api/213/16726)。

## 最佳实践

### 数据盘数据迁移

如果您需要在启动新实例时同时保留原有实例数据盘上的数据，您可以先对数据盘做 [快照](https://cloud.tencent.com/document/product/362/5754)，并在启动新实例时使用该数据盘快照创建新的云硬盘数据盘。
更多相关信息，请参阅 [快照创建云硬盘](https://cloud.tencent.com/document/product/362/5757)。




