除了使用 [创建自定义镜像](/doc/product/213/4942) 功能外，腾讯云同时支持使用导入功能。可将本地或其他平台的服务器系统盘镜像文件导入至 CVM 自定义镜像中。导入后可以使用该导入镜像创建云服务器或对已有云服务器重装系统。
<a id="导入准备"></a>
## 导入准备
### 准备镜像文件
您需提前准备好符合导入限制的镜像文件。
 - **Linux 系统类型镜像限制：**

| 镜像属性 | 条件 |
|---------|---------|
| 操作系统 | <li>基于CentOS、Ubuntu、Debian、CoreOS、OpenSUSE、SUSE发行版的镜像 <br><li>支持 32 位和 64 位 |
| 镜像格式 | <li>支持RAW、VHD、QCOW2、VMDK镜像格式 <br><li>使用<code>qemu-img info imageName &#124; grep 'file format'</code>查看镜像格式|
| 镜像大小 | <li>镜像实际大小不超过50G，使用<code>qemu-img info imageName &#124; grep 'disk size'</code>查看镜像实际大小。<br><li>镜像vsize不超过500G，使用<code>qemu-img info imageName &#124; grep 'virtual size'</code>查看镜像vsize <br><li>注意，导入镜像时审查大小以转换为QCOW2格式后的镜像信息为准  |
| 网络 | <li> 腾讯云默认为实例提供`eth0`网络接口 <br><li>腾讯云暂不支持IPV6 <br><li>用户可以在实例内通过metadata服务查询实例的网络配置，详见 [实例元数据](/document/product/213/4934)  |
| 驱动 | <li>镜像必须安装虚拟化平台 KVM 的 virtio 驱动，详情参考 [Linux导入镜像检查virtio驱动](/document/product/213/9929) <br><li>镜像建议安装cloudinit，详情参考[Linux导入镜像安装cloudinit](/document/product/213/12587) <br><li>如因某些原因，镜像无法安装cloudinit，请根据[强制导入](/document/product/213/12849)步骤自行配置实例 |
| 内核限制 | <li>镜像最好是原生内核，修改可能会导致云服务器无法导入 |

 - **Windows 系统类型镜像限制：**

| 镜像属性 | 条件 |
|---------|---------|
| 操作系统 | <li>Microsoft Windows Server 2008 R2（标准版、数据中心版、企业版)，Microsoft Windows Server 2012 R2（标准版） <br><li>支持 32 位和 64 位 |
| 镜像格式 | <li>支持RAW、VHD、QCOW2、VMDK镜像格式。<br><li>使用<code>qemu-img info imageName &#124; grep 'file format'</code>查看镜像格式。 |
| 文件系统类型 | <li>仅支持使用 MBR 分区的 NTFS 文件系统 <br><li>不支持 GPT 分区 <br><li>不支持逻辑卷管理 |
| 镜像大小 | <li>镜像实际大小不超过50G，使用<code>qemu-img info imageName &#124; grep 'disk size'</code>查看镜像实际大小 <br><li>镜像vsize不超过500G，使用<code>qemu-img info imageName &#124; grep 'virtual size'</code>查看镜像vsize <br><li>注意，导入镜像时审查大小以转换为qcow2格式后的镜像信息为准 |
| 网络 | <li> 腾讯云默认为实例提供`本地连接`网络接口 <br><li>腾讯云暂不支持IPV6 <br><li>用户可以在实例内通过metadata服务查询实例的网络配置，详见 [实例元数据](/document/product/213/4934)  |
| 驱动 | <li>镜像必须安装虚拟化平台 KVM 的 virtio 驱动。Windows系统默认未安装 virtio 驱动，用户可安装 [Windows virtio驱动](http://windowsvirtio-10016717.file.myqcloud.com/InstallQCloud.exe)后导出本地镜像 |
| 其他 | <li>导入的 Windows 系统镜像 **不提供** [Windows激活](/doc/product/213/%E6%AD%A3%E7%89%88%E6%BF%80%E6%B4%BB) 服务 |

## 导入步骤
 1. 登录 [云服务器控制台](https://console.cloud.tencent.com/cvm/) 
 2. 单击左侧导航窗格中的【镜像】
 3. 单击【自定义镜像】，再单击【导入镜像】按钮
 4. 按步骤要求，先 [开通对象存储 COS](https://console.cloud.tencent.com/cos4/index)，再 [创建 bucket 存储桶](/doc/product/436/6232) ，上传镜像文件到 bucket 并 [获取镜像文件 URL](/doc/product/436/6260) ，单击【下一步】
 5. 按照实际情况，填写表单，将请确保录入的对象存储文件 URL 准确，单击【开始导入】
 6. 导入成功或失败，会以站内信的的形式通知

## 导入失败
在控制台进行导入镜像操作后，会因为一些原因导致任务失败。在任务失败的情况下，可以根据以下内容进行排查。

### 注意事项
在根据本文排查失败原因之前，请确保已经在 [站内信管理页面](https://console.cloud.tencent.com/messageCenter/messageConfig) 消息订阅栏中订阅产品服务相关通知，以保证可以接收到包含失败原因的站内信、短信和邮件。
>** 注意：**
> 未在消息中心订阅产品服务相关信息，将无法接受到导入成功/失败的站内信。

### 失败原因排查
详细错误提示以及错误说明请参见 [错误码](#errorcode)。

#### InvalidUrl：COS 链接无效
出现报错 InvalidUrl，错误提示：导入镜像页面输入了错误的 COS 链接，可能原因如下：
* 输入了不是 [腾讯云对象存储](https://console.cloud.tencent.com/cos4/index) 的镜像链接。

* COS 文件的访问权限为私有读，但是签名已失效。
**注意：**带有签名的 COS 文件链接仅能被访问一次。

* 输入了其他地域的 COS 链接。
**注意：**导入镜像服务通过内网访问本地域的 COS 服务器。

* 用户的镜像文件已被删除。

在收到 COS 链接无效的报错后，可根据上述原因排查问题。

#### InvalidFormatSize：格式或大小不符合条件
出现报错 InvalidFormatSize，错误提示：预导入镜像的格式或大小不符合腾讯云导入镜像功能的限制，限制如下：
* 导入镜像支持`qcow2`，`vhd`，`vmdk`，`raw` 4 种格式的镜像文件。
* 导入镜像的实际文件大小不得超过 50GB（按转换为 qcow2 格式的镜像文件为准）。
* 导入镜像的系统盘大小不得超过 500GB。

在收到格式或大小不符合条件的报错后：
- 可以根据 [Linux 镜像制作 ](https://cloud.tencent.com/document/product/213/17814)的镜像格式转换内容将镜像文件转换为合适的文件格式、精简镜像内容以满足大小限制后重新导入镜像。

- 也可以使用 [服务迁移-实例导入](https://console.cloud.tencent.com/csm/importOfflineCvm) 功能迁移实例，该功能最大支持 500GB 的镜像文件迁移。

#### VirtioNotInstall：未安装 virtio 驱动
出现报错 VirtioNotInstall，错误提示：预导入镜像未安装 virtio 驱动。腾讯云使用 KVM虚拟化技术，要求用户导入的镜像内已安装 virtio 驱动。除了少部分用户定制的 Linux 操作系统外，大部分的 Linux 操作系统已经安装 virtio 驱动；Windows 操作系统则需要用户手动安装 virtio 驱动：
* Linux 镜像导入，可以参考文档 [Linux 系统检查 virtio 驱动](https://cloud.tencent.com/document/product/213/9929)。
* Windows 镜像导入，可以参考文档 [Windows 镜像制作](https://cloud.tencent.com/document/product/213/17815) 安装 virtio 驱动。

#### CloudInitNotInstalled：未安装 cloud-init 程序
出现报错 CloudInitNotInstalled，错误提示：预导入镜像未安装 cloud-init 程序。腾讯云使用开源程序 cloud-init 初始化子机，因此未安装 cloud-init 程序将导致用户子机初始化失败。

* Linux 镜像导入，可以参考文档 [Linux 系统安装 cloud-init](https://cloud.tencent.com/document/product/213/12587)。
* Windows 镜像导入，请检查安装 cloudbase-init 程序。
* 安装 cloud-init/cloudbase-init 后请根据文档替换配置文件已使得子机启动时从正确的数据源拉取数据。

#### PartitionNotPresent：分区信息丢失
出现报错 PartitionNotPresent，错误提示：导入的镜像不完整。请检查制作镜像时是否包含引导分区。

#### RootPartitionNotFound：根分区丢失
出现报错 RootPartitionNotFound，错误提示：未检测到导入的镜像包含根分区。请检测镜像文件，曾经出现过的原因如下，供参考：
* 上传了安装包文件。
* 上传了数据盘镜像。
* 上传了引导分区镜像。
* 上传了错误的文件。

#### InternalError：未知错误
出现报错 InternalError，错误提示：导入镜像服务没有收录该错误原因，请联系客服处理该类问题，技术人员将第一时间解决问题。
<a id="errorcode"></a>
## 错误码
 
|错误码|错误原因|建议处理方式|
|-----|-----|-----|
|InvalidUrl|COS 链接无效|检查 COS 链接与导入镜像链接是否相同 |
|InvalidFormatSize|格式或大小不符合条件|镜像需要满足 [导入准备](#导入准备) 中关于`镜像格式`和`镜像大小`的限制 |
|VirtioNotInstall|未安装virtio驱动|镜像需要安装virtio驱动，参考 [导入准备](#导入准备) 中的`驱动`部分|
|PartitionNotPresent|未找到分区信息|镜像损坏，可能是错误的镜像制作方式导致的 |
|CloudInitNotInstalled|cloud-init未安装|linux镜像需要安装cloud-init,参考[导入准备](#导入准备)中的`驱动`部分 |
|RootPartitionNotFound|未检测到根分区|镜像损坏，可能是错误的镜像制作方式导致的 |
|InternalError|其他错误|请联系客服处理问题 |

