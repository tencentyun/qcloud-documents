本文档介绍 Windows 云服务器因 CPU 或内存占用率高导致无法登录的排查方法和解决方案。
>? 以下操作步骤以 Windows server 2012 R2 为例，根据操作系统版本的不同，详细操作步骤略有区别。

## 可能原因

CPU 或内存使用率过高，容易引起服务响应速度变慢、服务器登录不上等问题。而引起 CPU 或内存使用率过高的原因可能由硬件因素、系统进程、业务进程或者木马病毒等因素导致。您可以使用 [云监控](https://cloud.tencent.com/document/product/248/13466)，创建 CPU 或内存使用率阈值告警，当 CPU 或内存使用率超过阈值时，将及时通知到您。

## 排查思路

1. 定位消耗 CPU 或内存的具体进程。
2. 对 CPU 或内存占用率高的进程进行分析。
 - 如果是异常进程，可能是病毒或木马导致，您可以自行终止进程，或者使用安全软件进行查杀。
 - 如果是业务进程，则需要分析是否由于访问量变化引起，是否存在优化空间。
 - 如果是腾讯云组件进程，请 [提交工单](https://console.cloud.tencent.com/workorder/category) 联系我们进行进一步定位处理。

## 定位工具

**任务管理器**：Windows 自带的应用程序和进程管理工具，展示有关电脑性能和运行软件的信息，包括运行进程的名称，CPU 负载，内存使用，I/O 情况，已登录的用户和 Windows 服务的信息。
- **进程**：系统上所有正在运行的进程的列表。
- **性能**：有关系统性能的总体统计信息，例如总体 CPU 使用量和正在使用的内存量。
- **用户**：当前系统上有会话的所有用户。
- **详细信息**：进程选项卡的增强版，显示进程的 PID、状态、CPU、内存的使用情况等进程的详细信息。
- **服务**：系统中所有的服务（包括并未运行的服务）。


## 故障处理

### 使用 VNC 方式登录云服务器
>?  由于云服务器负载高时会导致无法建立远程连接，推荐 [使用 VNC 方式登录 Windows 实例](https://cloud.tencent.com/document/product/213/35704)。 
>
1. 登录 [云服务器控制台](https://console.cloud.tencent.com/cvm/index)。
2. 在实例的管理页面，找到目标云服务器实例，单击【登录】。如下图所示：
![](https://main.qcloudimg.com/raw/038fce530c6c6827796e51d896306a93.png)
3. 在弹出的 “登录Windows实例” 窗口中，选择【其它方式（VNC）】，单击【立即登录】，登录云服务器。
4. 在弹出的登录窗口中，选择左上角的 “发送远程命令”，单击 **Ctrl-Alt-Delete** 进入系统登录界面。如下图所示：
![](https://main.qcloudimg.com/raw/2dec43fa6ddb5e442da59c75f7a34b0f.png)

### 查看进程占用情况

1. 在云服务器中，右键单击 “任务栏”，选择【任务管理器】。如下图所示：
![](//mc.qcloudimg.com/static/img/12539e5b76898e30bbb3bf510b0a5262/image.png)
2. 在打开的 “任务管理器” 中，即可查看资源占用情况。如下图所示：
>?  您可单击 CPU 或内存，以升序/降序对进程进行排序。
>
![](https://main.qcloudimg.com/raw/f4e85ae575a486ea9d6641ce9a7a8e21.png)

### 进程分析

根据任务管理器中的进程，分析与排查问题，以采取对应解决方案。
#### 占用大量 CPU 或内存资源的进程为系统进程
如果您发现系统进程占用了大量 CPU 或内存资源，请排查以下内容：
1. 检查进程名称。
 部分病毒会使用与系统进程相似的名称，例如 svch0st.exe、explore.exe、iexplorer.exe 等。
2. 检查进程对应的可执行文件的所在位置。
 系统进程一般位于 `C:\Windows\System32` 目录下，并且会有完善的签名和介绍。您可以在任务管理器中，右键单击待查看的进程，选择【打开文件位置】，即可查看具体可执行文件的位置。例如 `svchost.exe`。如下图所示：
![](https://main.qcloudimg.com/raw/09dca00652a301e804f9411658e4c46e.png)
 - 如果进程位置不在 `C:\Windows\System32` 目录下，则表示该云服务器可能中了病毒，请手动或者使用安全工具进行查杀。
 - 如果进程位置在 `C:\Windows\System32` 目录下，请重启系统或关闭不需要且安全的系统进程。

常见的系统进程如下：
 - System Idle Process：系统空间进程，显示 CPU 空闲时间百分比
 - system：内存管理进程
 - explorer：桌面和文件管理
 - iexplore：微软的浏览器
 - csrss：微软客户端/服务端运行时子系统
 - svchost：系统进程，用于执行 DLL
 - Taskmgr：任务管理器
 - Isass：本地安全权限服务

#### 占用大量 CPU 或内存资源的进程为异常进程
如果您发现一些命名很奇怪的进程占用了大量 CPU 或内存资源，则可能为木马病毒进程，例如 xmr64.exe（挖矿病毒）等。建议您使用搜索引擎进行搜索，确认是否为木马病毒进程。
 - 如果是木马病毒进程，请使用安全工具进行查杀，必要时考虑备份数据，重装系统。
 - 如果不是木马病毒进程，请重启系统或关闭不需要且安全的进程。

#### 占用大量 CPU 或内存资源的进程为业务进程
如果您发现业务进程占用了大量 CPU 或内存资源，例如 IIS、HTTPD、PHP、Java 等，建议进一步分析。
例如，判断当前业务量是否较大。
- 若业务量较大，建议您 [升级服务器配置](https://cloud.tencent.com/document/product/213/2178)；若不升级服务器配置，可以考虑业务程序是否存在优化空间，请进行优化。
- 若业务量不大，则需要进一步结合业务报错日志来分析。例如，参数配置不当导致空耗资源。

#### 占用大量 CPU 或内存资源的进程为腾讯云组件进程

请 [提交工单](https://console.cloud.tencent.com/workorder/category) 联系我们进行进一步定位处理。

