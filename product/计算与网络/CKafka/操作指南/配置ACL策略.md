## 操作场景

该任务指导您在使用消息队列 CKafka 时，通过控制台配置 SASL 鉴权和 ACL 规则，增强对公网/内网传输中的用户访问控制，增加对 Topic 等资源的生产消费权限控制。

>?
>- Kafka 提供了多种安全认证机制，主要分为 SSL 和 SASL2 大类，其中 SASL/PLAIN 是基于账号密码的认证方式，比较常用。CKafka 支持 SASL_PLAINTEXT 认证（参考  [添加路由策略-公网域名接入](https://cloud.tencent.com/document/product/597/36348)）。
>- ACL 访问控制列表（Access Control List），帮助用户定义一组权限规则，允许/拒绝用户 user 通过 IP 读/写 Topic 资源。


## 操作步骤

### 配置 ACL 策略

1. 登录 [CKafka 控制台](https://console.cloud.tencent.com/ckafka) 。
2. 在顶部菜单栏，选择地域后，单击目标实例“ID/名称”。
3. 在实例详情页面，单击顶部【用户管理】页签。
4. 在用户管理页面，单击【新建】，填写用户名和密码信息，创建用户。
5. 单击顶部【ACL策略管理】。
6. 在 ACL 策略详情页面，单击【批量配置】，为用户授予权限。
>?
>- 若只设置允许规则，则除允许的规则外的其他IP都无法连接实例。
>- 若只设置拒绝规则，则除拒绝的规则外的其他IP都可以连接实例。
>- 若同时设置允许规则和拒绝规则，则只有允许规则中的IP可以连接实例，其他IP都无法连接实例。 
<dx-tabs>
::: 2.4.2版本实例
支持**批量勾选**和**按前缀模糊匹配**两种方式为用户授予权限。
- **批量勾选：**选择多个需要配置相同 ACL 策略的 Topic，批量勾选模式只支持配置一条策略。
- **按前缀模糊：**按 Topic 名称前缀模糊匹配需要配置相同 ACL 策略的 Topic，需要指定模糊匹配规则名称。设置后，新增按指定前缀命名的 Topic 时，系统自动配置指定 ACL 策略。
>?模糊匹配规则最多支持设置五条。  

![](https://main.qcloudimg.com/raw/8349bf070e1591ba133289677c97a9b2.png)
:::
::: 其他版本实例
支持**批量勾选**为用户授予权限。
     选择多个需要配置相同 ACL 策略的 Topic，批量勾选模式只支持配置一条策略。
		![](https://main.qcloudimg.com/raw/99f730464416e66b78de79553e60ebe7.png)
:::
</dx-tabs>
    
   > ?
   > - 开通路由只影响接入时的验证方式，设置的 ACL 权限则是全局的。
   > - 如果您在开通公网访问路由的同时还使用了 PLAINTEXT 方式接入 Kafka，那么之前为 Topic 设置的 ACL 仍然会生效。
   >   如果希望 PLAINTEXT 方式的访问不受影响，请为 PLAINTEXT 需要访问的 Topic 添加全部用户的可读写的权限。
   > - 如果该 Topic 已经在有其他云产品在使用（例如：日志服务 CLS 的日志投递、云函数 SCF 消息转储、大数据 EMR 组件的消费等），开启 ACL 策略相当于对这些联动能力的权限加以限制，会直接导致这些能力不可用，请一定谨慎操作。对于此类情况建议生产同一份数据到另一个 Topic 做分别处理，不要在同一个 Topic 上配置统一的 ACL 策略。

### 查看模糊匹配规则

1. 在 ACL 策略管理页面，选择【模糊匹配规则】。
2. 在模糊匹配规则列表，单击操作列的【详情】，可查看模糊匹配规则详情。

### 删除模糊匹配规则

1. 在 ACL 策略管理页面，选择【模糊匹配规则】。
2. 在模糊匹配规则列表，单击操作列的【删除】，可删除模糊匹配规则。

## 后续处理

完成授权后，用户可以通过 SASL 接入点接入消息队列 CKafka 并使用 PLAIN 机制消费消息（参考 [SDK 文档](https://cloud.tencent.com/document/product/597/54816)）。
