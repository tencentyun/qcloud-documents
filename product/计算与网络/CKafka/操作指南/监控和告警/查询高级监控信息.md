CKafka专业版支持高级监控功能，您可以在控制台查看核心服务、生产、消费和Broker GC等指标，方便运维人员在使用CKafka时进行排障处理。

本章节为您介绍如何在控制台查看高级监控指标，并说明高级监控指标含义。

## 监控指标说明

### 核心服务监控

| 监控指标     | 指标说明                                                     | 正常值范围                                                   |
| ------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 网络繁忙程度 | 用于衡量实例当前网络并发处理剩余的IO资源，越接近1越空闲。    | 该值一般在0.5~1之间波动，小于0.3表示负载较高。               |
| 请求队列深度 | 反映当前未处理的生产请求个数，如果该值过大可能是同一时间请求量过大，CPU 负载过高或者磁盘 IO 出现瓶颈。 | 如果持续等于2000，表示集群负载比较高。小于2000的时可忽略。   |
| 未同步副本数 | 集群中存在的未同步的副本个数，当实例存在未同步副本，表示集群的健康度可能存在问题。 | 曲线如果长期大于5（原因是有一些腾讯云内置的 Topic 的分区可能会处于离线状态，跟业务无关），表示需要处理集群。 偶尔 Broker 波动，值凸起后，一段时间后，又回归平稳，属于正常现象。 |
| ZK断连次数   | Broker 和 Zookeeper 之间的长连接断开重连的次数。网络波动，集群负载较高有可能会引起连接断开和重连，发生时会发生 leader 切换。 | 无正常值范围。zk断连次数是累加的，次数越大不表示集群有问题，指标仅供参考。 |
| ISR扩充次数  | Kafka ISR 扩充次数，即存在未同步副本的情况下，当未同步副本追上 leader 数据，会重新加入 ISR，此时该次数就会加1。 | 无正常值范围，当集群出现波动时，会出现扩充。如果非长时间大于0，无需关注。 |
| ISR缩小次数  | Kafka ISR 收缩次数，即当出现 Broker 宕机，Zookeeper 重连的情况，会出现 ISR 缩小的次数统计。 | 无正常值范围，当集群出现波动时，会出现收缩。如果非长时间大于0，无需关注。 |

### 生产监控

| 监控指标     | 指标说明                                                     | 正常值范围                                                   |
| ------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 生产总时耗   | 表示生产请求的总耗时，由请求队列耗时，本地耗时，延时回包耗时等指标汇总而成。<br/>在每一个时间点，总耗时不等于以下五个耗时的累加，因为每个指标都是各自取平均得到的，故不累加相等。 | 一般值在0~100ms之间，数据量大的时候0 - 1000ms的耗时属于正常范围，只要不长时间大于1000ms，可以不用处理。 |
| 请求队列耗时 | 生产请求在接收请求队列内等待的时间，表示请求包等待后续的进程处理。 | 一般值在0 - 50ms之间，数据量大的时候0~200ms的耗时属于正常范围，只要不长时间大于200ms，可以不用处理。 |
| 本地处理耗时 | 生产请求在Leader Broker 处理的时间，即从请求队列拿出请求包，写入到本地 page cache 的时间。 | 一般值在0 - 50ms之间，数据量大的时候0 - 200ms的耗时属于正常范围，只要不长时间大于200ms，可以不用处理。 |
| ack 等待耗时  | 生产请求等待数据同步的耗时，当客户端 ack = -1 的时候该值才会大于0，即只要 ack = 1 或者0，该值都是0。 | 一般值在0 - 200ms之间，数据量大的时候0 - 500ms的耗时属于正常范围，只要不长时间大于500ms，可以不用处理。跨可用区的实例当 ack =-1 时，该值会比非跨可用区的实例高，具体参考 [跨可用区部署](https://cloud.tencent.com/document/product/597/52786)。 |
| 延时回包耗时 | 生产请求被系统延时回包的耗时，当实例的流量没超过购买流量时，该值都为0，如果被限流，则会大于0。 | 当实例不超限时，该值长期为0，如果超限，会根据超限的比例，延时0 - 5分钟，即该值最大为5分钟。 |
| 回包队列耗时 | 消费请求在回包队列的等待耗时，表示请求包在等待被发送给客户端。 | 一般值在0 - 50ms之间，数据量大的时候0 - 200ms的耗时属于正常范围。只要不长时间大于200ms，可以不用处理。 |

### 消费监控

| 监控指标     | 指标说明                                                     | 正常值范围                                                   |
| ------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 消费总时耗   | 表示消费的总耗时，由请求队列耗时，本地耗时等指标汇总而成。<br/>在每一个时间点，总耗时不等于以下五个耗时的累加，因为每个指标都是各自取平均得到的，故不累加相等。 | 一般值会在于500ms - 1000ms之间（客户端默认的 fetch.max.wait.ms=500ms），数据量大的时候500 - 5000ms的耗时属于正常范围。 |
| 请求队列耗时 | 消费请求在请求队列内等待的时间，表示请求包等待后续的进程处理。 | 一般值在0 - 50ms之间，数据量大的时候0 - 200ms的耗时属于正常范围，只要不长时间大于200ms，可以不用处理。 |
| 本地处理耗时 | 消费请求在 Leader Broker 拉取数据的时间，即从本地磁盘读取数据。 | 一般值在0 - 500ms之间，数据量大的时候0 - 1000ms的耗时属于正常范围，只要不长时间大于1000ms，可以不用处理，因为消费有可能会有读冷数据的情况，此时耗时会较高。 |
| 消费等待耗时 | 客户端默认的 fetch.max.wait.ms=500ms，即表示客户端允许在读不到数据的时候，服务端等待多久返回包给客户端。 | 一般值会在于500ms左右（客户端默认的 fetch.max.wait.ms=500ms），该值的大小取决于客户端的参数设置。 |
| 延时回包耗时 | 消费请求被系统延时回包的耗时，当实例的流量没超过购买流量时，该值都为0，如果被限流，则会大于0。 | 当实例不超限时，该值长期为0，如果超限，会根据超限的比例，延时0~5分钟，即该值最大为5分钟。 |
| 回包队列耗时 | 消费请求在回包队列的等待耗时，表示请求包在等待被发送给客户端。 | 一般值会在于0 - 50ms之间，数据量大的时候0 - 200ms的耗时属于正常。只要不长时间大于200ms，就可以不用处理。 |

### Broker GC 监控

| 监控指标       | 指标说明             | 正常值范围                                           |
| -------------- | -------------------- | ---------------------------------------------------- |
| 年轻代回收次数 | Broker Yong GC 的次数 | 正常在0 - 300之间，如果持续高于300，则需要调整 GC 参数。 |
| 老年代回收次数 | Broker Full GC 的次数 | 正常为0，如果有出现大于0的情况，则需要处理。         |

## 查看监控数据

1. 登录 [CKafka 控制台](https://console.cloud.tencent.com/ckafka)。
2. 在实例列表中，单击需要查看的“实例 ID/名称”，进入实例详情页。
3. 在实例详情页顶部，单击【监控】>【高级监控】，选择要查看的指标页签，设置好时间范围，可以查看监控数据。
