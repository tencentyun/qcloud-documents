
日志分析可查看基于登录账号的云防火墙在过去6个月所存储的全部流量日志详情，同时日志分析支持基于检索语句的日志检索与查询，并提供报表与统计分析服务。本文档将为您介绍如何使用日志分析功能。

## 查看日志分析数据
1. 登录 [云防火墙控制台](https://console.cloud.tencent.com/cfw/search)，在左侧导航栏中，单击**日志分析**，进入“日志分析”页面。
2. 为了方便对指定单位时间范围内的日志检索操作，您可以将鼠标在页面上的蓝色日志数量柱形图上滑动，快速选定时间范围，单击蓝色日志数量柱形图，可进一步对日志进行放大搜索。
>?
>- 还原：在柱形图右上角单击**还原**，时间选择器会回到初始时间范围（今天）。
>- 切换时间选择器的选项、切换日志类型及重新输入检索框等重新出发检索的操作，都会使柱形图回归当前时间选择器范围的初始时间（今天）。
>
![](https://main.qcloudimg.com/raw/8cb13848515500ed0a2f9ead5ffaedda.png)
3. 日志列表会根据“展示字段”模块内容，按照从上到下的顺序展示每个流量日志的字段详情。当“展示字段”中仅有 source 字段时，日志列表中展示的字段顺序将会为“隐藏字段”的顺序。
![](https://main.qcloudimg.com/raw/330f77a2540349a5897a06cae6ed3913.png)
	- **显示**：将鼠标移动至隐藏字段上方，在隐藏字段右侧，单击**显示**，该隐藏字段将出现在展示字段中，对应右侧日志列表将展示该字段内容。
![](https://main.qcloudimg.com/raw/220fafde48b670be8a36e0edd3078f14.png)
	- **隐藏**：将鼠标移动至展示字段上方，在展示字段右侧，单击**隐藏**，该隐藏字段将在展示字段中删除，对应右侧日志列表将不再展示该字段内容。
	![](https://main.qcloudimg.com/raw/791e13b1a0338a754cda8e47a9d485f6.png)
	
## 日志投递
通过日志投递功能，您可以将云防火墙日志自动投递到指定的 Ckafka 实例中。接下来将为您介绍，如何使用日志分析中的日志投递功能。
### 背景信息
- 日志投递功能可以按照不同的云防火墙日志类型，分别投递到指定的 Ckafka topic 中。
- 日志投递功能支持两种网络接入方式，分别是：公网域名接入和支撑环境接入。
	- 公网域名接入是通过公网进行日志投递的。
	- 支撑环境接入是通过腾讯云内网进行日志投递，性能更高。

### 前提条件
- 需要 先 [购买腾讯云消息队列 Ckafka 实例](https://console.cloud.tencent.com/ckafka/index?rid=1)，按照云防火墙带宽来配置 Ckafka 实例的带宽规格。
- 根据 [消息队列 Ckafka 文档](https://cloud.tencent.com/document/product/597) 指引，联系 [腾讯云客服](https://cloud.tencent.com/act/event/connect-service) 开通“公网域名接入”或“支撑环境接入”白名单。
- 仅支持使用一个消息队列 Ckafka 账号进行日志投递。

### 配置步骤
1. 登录 [云防火墙控制台](https://console.cloud.tencent.com/cfw/search)，在左侧导航栏中，单击**日志分析**，进入“日志分析”页面。
2. 在日志分析页面左上角，单击**日志投递**。
![](https://main.qcloudimg.com/raw/9d4a9d6fbebc5cf94088796e7f84e839.png)
3. 在日志投递页面进行初始配置。
	1. 选择网络接入方式分为：公网域名接入及支撑环境接入。
		- **方式1**：选择公网域名接入，选择消息队列实例和公网域名，并输入所选消息队列实例的用户名和密码。
		![](https://main.qcloudimg.com/raw/4345d6365d7c332f7a87519c43f9fdbd.png)
		- **方式2**：选择支撑环境接入，支撑环境接入指您在腾讯云已选购可以与 Ckafka 结合使用的产品，并选择消息队列实例和 IP 端口。
![](https://main.qcloudimg.com/raw/3812d4583e136effc49246c855368ffd.png)
	2. 选择网络接入方式后，可以在日志投递页面绑定 Ckafka topic。
>?日志投递功能支持多种云防火墙日志类型的投递，不同类型的日志需要投递到不同的 Ckafka topic 中。每个 Ckafka topic 只能被一个云防火墙日志类型所绑定。
>
	![](https://main.qcloudimg.com/raw/156122fa58a4cea5c02f91cd5056268c.png)
	3. 配置完成后，单击**确定**，将提示配置日志投递成功，表示日志投递已经配置成功。
4. 初始化配置完成后，即可查看日志投递详情。
![](https://main.qcloudimg.com/raw/52490834e21ae6809d957ad315a99b17.png)
	- **基本信息**：展示了 Ckafka 实例的基本信息。
>!您需要关注“健康状态”字段，当提示“不健康”时，需要单击**查看监控**，查看 Ckafka 服务是否异常，或者是否配额不足。
	- **日志投递开关**：用于控制指定的日志类型，启动或停止日志投递任务。
		- 方式1：您可以在各项日志类型的右侧”投递开关“列，通过“开关”按钮单独控制日志投递任务。
		- 方式2：使用批量操作，目前支持“全部启动”和“全部关闭”两种操作。
	- **重新绑定 Ckafka topic**：在日志类型的右侧的操作栏，单击**编辑**进行单独配置，可以重新选择指定 Ckafka 实例中，未被其他防火墙日志类型绑定的 Ckafka topic。
>?每个 Ckafka topic 只能被一个云防火墙日志类型所绑定。
	- **查看监控**：在日志类型的右侧的操作栏，单击**查看监控**，会跳转至消息队列 Ckafka 控制台的监控页面，您可以查看网络流量、峰值带宽、消息条数、磁盘占用等情况。
	- **重新配置**：在日志类型列表上方，单击**重新配置**，将会允许您重新选择投递的消息队列实例、网络接入方式以及用户名/密码。
>!重新配置，会中断当前的投递进程。
	- **修改密码**：在日志类型列表上方，单击**修改密码**，可修改 Ckafka 的用户名和密码。

