## 操作场景

DataHub 提供简单的数据处理功能，通过传入数据和配置项，可以实现对数据格式化处理，然后返回处理完成的结构化数据，分发给离线/在线处理平台，构建数据源和数据处理系统间的桥梁。

## 操作步骤

### 创建规则

1. 登录 [CKafka 控制台](https://console.cloud.tencent.com/ckafka) 。

2. 在左侧导航栏单击**数据处理**，选择好地域后，单击**新建任务**。

3. 填写任务基本信息。

   ![](https://qcloudimg.tencent-cloud.cn/raw/f3c4e237c9306b8cabefdf2f54340524.png)

   - 任务名称：只能包含字母、数字、下划线、“-”、“.”。

   - 源 Topic：源 CKafka Topic。

   - 目标 Topic：目标 CKafka Topic。

   - 起始位置：选择转储时历史消息的处理方式，topic offset 设置。

4. 单击**下一步**，设置数据处理规则。

   ![](https://qcloudimg.tencent-cloud.cn/raw/0a8d0534202c9fabe2dd17e821861c51.png)

   - 原始数据：支持**从源 Topic 拉取**或者**自定义**。

     > ?原始数据必须为 JSON 格式。

   - 解析格式：支持 **JSON**，**分隔符**和**正则提取**三种解析方式。

     - JSON
     - 分隔符：支持 `空格`、`制表符`、`,`、`;`、`|`、`自定义`。
     - 正则提取：需填写正则表达式。

5. 选择好解析模式后，单击**确认**按钮，开始解析数据。

6. 解析完成后，设置好过滤器规则和数据处理方式。

   > ?输出格式目前支持 JSON。

   ![](https://qcloudimg.tencent-cloud.cn/raw/8196c3564af922ca79e38edd5f3bd7c7.png)

   - 过滤器：仅输出符合过滤器规则的数据。过滤器的匹配模式支持**前缀匹配**、**后缀匹配**、**包含匹配（contains）**、**除外匹配（except）**、**数值匹配**和**IP匹配**。详情参考[过滤器规则说明]()。

   - 数据处理：TYPE 有**默认、系统预设、映射、自定义**四种。
     - TYPE = 默认：VALUE 从解析结果中映射，不可编辑。
     - TYPE = 系统预设：可以选择系统预设的 VALUE ，目前支持 DATE（时间戳）。
     - TYPE = 映射：可以选择已有的 KEY，最终输出的 VALUE 值由指定的 KEY 映射而来。
     - TYPE = 自定义：可以输入自定义 VALUE 

7. 单击**测试**，查看测试结果。

   ![](https://qcloudimg.tencent-cloud.cn/raw/033c4d1f5c1c1de85795b2f99a8bdf3e.png)

8. 设置失败处理规则。

   ![](https://qcloudimg.tencent-cloud.cn/raw/993888f6826b6bb4b91057315404ff33.png)

   - 重试间隔：处理失败重试间隔时间，重试间隔时间的取值范围为60s～1h。

   - 重试次数：处理失败最大重试次数，超过最大次数后将作为失败消息处理。重试次数 * 时间间隔 <= 6h。

   - 失败消息处理：处理失败消息的处理方式，支持**丢弃**、**保留**和投递到**死信队列**（需指定死信队列 Topic）。

9. 单击**提交**，完成数据处理规则创建。

### 编辑规则

1. 在 **[数据处理](https://console.cloud.tencent.com/ckafka/datahub-process)** 任务列表页面，单击目标任务的**ID**，进入任务基本信息页面。
2. 单击**处理规则**模块右上角的**编辑规则**，可修改数据处理规则。

### 更改配置

1. 在 **[数据处理](https://console.cloud.tencent.com/ckafka/datahub-process)** 任务列表页面，单击目标任务的**ID**，进入任务基本信息页面。

2. 单击**配置信息**模块右上角的**更改配置**，修改数据处理规则配置。

   ![](https://qcloudimg.tencent-cloud.cn/raw/a126d5b9ece14fe855e17a63e349c7ca.png)

### 查看监控

1. 在 **[数据处理](https://console.cloud.tencent.com/ckafka/datahub-process)** 任务列表页面，单击目标任务的**ID**，进入任务基本信息页面。

2. 进入任务基本信息页面。

3. 在任务详情页顶部，单击**监控**，选择要查看资源，设置好时间范围，可以查看对应的监控数据。

   - 单击![img](https://main.qcloudimg.com/raw/9ba57bbd3b8ef3efc4f687d63d27a46d.png)，可查看监控指标同环比。
   - 单击![img](https://main.qcloudimg.com/raw/34bdbdbdabb7b5720bf17d78c636a4ad.png)，可刷新获取最新的监控数据。
   - 单击![img](https://main.qcloudimg.com/raw/8f2bf7f4df9ddd959f0ecb69fdda8e4c.png)，可将图表复制到 Dashboard，关于 Dashboard 请参考 [什么是 Dashboard](https://cloud.tencent.com/document/product/248/47161)。
   - 选中![img](https://main.qcloudimg.com/raw/af20129df7be46f33ab7d3598f6e9213.png)，可在图表上显示图例信息。

   ![](https://qcloudimg.tencent-cloud.cn/raw/fbf2e7b6dcf92221d5030199768d8e9b.png)

### 暂停任务

> ? 该操作是异步任务，有延迟，任务状态可能不会立刻改变。

在 **[数据处理](https://console.cloud.tencent.com/ckafka/datahub-process)** 页面，单击目标任务的操作栏的**暂停**，可暂停任务。

### 恢复任务

> ？
>
> 处于暂停状态的任务可以重新启动，并继续处理数据。

在 **[数据处理](https://console.cloud.tencent.com/ckafka/datahub-process)** 页面，单击目标任务的操作栏的**恢复**，可将暂停任务恢复。

### 删除任务

> ?
>
> - 删除任务表示停止数据处理并删除任务记录，不会影响到已经处理的数据和相关的 CKafka 实例。
>
> - 任务一旦删除不可恢复，请您谨慎操作。

在  **[数据处理](https://console.cloud.tencent.com/ckafka/datahub-process)** 页面，单击目标任务的操作栏的**删除**，在二次确认弹窗中单击**确认**，可删除任务。



