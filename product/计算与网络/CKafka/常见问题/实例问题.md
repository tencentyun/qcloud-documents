### 如何选择实例的规格？

可以借助控制台的 "[迁移上云](https://console.cloud.tencent.com/ckafka/migration) - 规格计算器" 来计算所需的产品规格：
<img src="https://main.qcloudimg.com/raw/2aa46d3744ac7406833549da41333ed3.jpg" width="550px">

消息队列 CKafka 实例按照规格分为标准版和专业版，两个版本的对比参考 [产品规格](https://cloud.tencent.com/document/product/597/59253)。

请根据自身需要选择产品规格，不同规格的计费规则请参考 [计费概述](https://cloud.tencent.com/document/product/597/11745)。

### 实例升配有哪些模式？主要有什么区别？

标准版和专业版的多种迁移模式，都是无损的，不停服，客户端无感知的。

标准版是共享集群，当集群的空余资源足够的时候，升配模式是以提高配额的形式进行的。不会涉及到数据迁移，故正常几分钟内就升配完成。如果集群空余资源不足，就会提示资源不足，需要提工单进行后台迁移并调配资源，然后再在控制台进行正常的标准版升配流程。

专业版是独占的集群，当系统算法计算到当前独占的资源池不够升配后的资源配额的时候，需要自动化的添加资源到资源池，并对实例的数据进行迁移。故专业版升配存在两种模式：

- 资源足够时，即时升配提高配额的模式，几分钟内升配完成。
- 资源不足时，数据迁移的模式，视集群堆积的数据大小，可能需要几分钟到几个小时。

当需要数据迁移时，可自定义迁移时间：

![](https://main.qcloudimg.com/raw/bdf595851782261be3237bc17d8abbc3.jpg)

当需要数据迁移时，会有迁移模式和定时迁移两种选项，迁移模式分为如下两种：

- 稳定模式：CKafka 将限制升配过程中数据迁移速度，最大程度保留实例的带宽属性，适合于不希望干扰业务的场景。
- 高速模式：CKafka 将不对升配过程中数据迁移的速度进行限制，会影响实例的生产消费带宽，适合于业务低峰或者允许停服的场景。

因为迁移需要占用集群的带宽和磁盘资源，在业务高峰的时候，客户可能担心迁移会影响业务。故可以设置定时迁移，例如设置到半夜进行升配。升配操作详情请参考 [升配实例](https://cloud.tencent.com/document/product/597/40414)。

### 实例是否支持数据压缩？

当前 CKafka 支持开源的 snappy 和 lz4 的消息压缩格式。由于 Gzip 压缩对于 CPU 的消耗较高，暂未支持。开启压缩在某些情况下可能会加大服务端的压力，例如生产者的版本较高，消费者的版本协议较低，在消费的时候，会出现向下的协议转换。导致服务端压力升高。所以建议如果需要压测，建议客户关闭消息压缩参数进行测试。

配置开启方法：Producer 的配置文件中参数 compression.type = snappy 或者 lz4，默认为关闭 none。

建议优先选择Snappy压缩。开启压缩后，可能会导致服务端CPU升高，导致生产消费耗时变高。需谨慎使用。

