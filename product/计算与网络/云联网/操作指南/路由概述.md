创建云联网后，系统会自动为您创建路由表，并自动控制路由条目来管理云联网上的流量。您不能手动添加或删除路由，但可以启用或禁用路由。  

您可通过如下视频了解云联网的路由概念和路由限制。
<div class="doc-video-mod"><iframe src="https://cloud.tencent.com/edu/learning/quick-play/2684-52041?source=gw.doc.media&withPoster=1&notip=1"></iframe></div>

## 路由自动添加
云联网路由自动添加逻辑如下，涉及三个阶段：
1. 自动添加路由前：即路由接收逻辑，决定哪些路由可被添加至云联网路由表。
2. 自动添加路由时：即路由默认生效逻辑，决定哪些添加至云联网的路由可生效。
3. 自动添加路由后：即路由优先级逻辑，决定流量根据哪条生效路由转发。

### 1. 自动添加路由前
- 关联实例为公有云 VPC：子网新建时，传递目的端为子网网段，下一跳为 VPC 的路由至云联网。
- 关联实例为专线网关，传递目的端为 IDC 网段，下一跳为专线网关的路由至云联网。传递路由方式分为两种：
 1. 手动填写（静态）：手动填写需要传递至云联网中的 IDC 网段，下一跳为对应的专线网关，便于您做网段收敛和过滤。
 2. 动态学习（BGP）：通过 BGP 协议动态学习路由，下一跳为对应的专线网关，便于实时感知 IDC 侧路由变化。目前支持根据 AS-PATH 控制发布至云联网的路由：
   - AS-PATH 长度一致时，云联网接收所有路由。
   - AS-PATH 长度不一致时，云联网接收 AS-PATH 更短的路由。

>?
>- 动态学习（BGP）处于灰度阶段，如有需求请提 [工单申请](https://console.cloud.tencent.com/workorder/category?level1_id=6&level2_id=168&source=0&data_title=%E7%A7%81%E6%9C%89%E7%BD%91%E7%BB%9CVPC&step=1)。
>- AS-PATH 相关说明如下：
>  1. AS-PATH 信息可在专线网关侧查看。
>  2. 支持32位字符，字符异常时，将删除该路由，并上报字符异常事件，您可配置事件告警。
>  3. AS-PATH 长度30，长度超限将截断并上报截断事件，您可配置事件告警。
>  4. 经过专线网关-云联网-专线网关的 AS-PATH 将增加3个 AS 号（45090，139341，45090）。

### 2. 自动添加路由时
- 检查策略：如果与已有路由重叠，默认后加入的路由失效（尽量不影响存量路由），您确认影响后可调整为有效。
- 不检查策略：不做特殊处理，所有路由全部生效，ECMP 路由除外，ECMP 路由参见如下第3条中 [网段相同](#same) 的路由逻辑。
>?不检查策略处于灰度阶段，如有需求请提 [工单申请](https://console.cloud.tencent.com/workorder/category?level1_id=6&level2_id=168&source=0&data_title=%E7%A7%81%E6%9C%89%E7%BD%91%E7%BB%9CVPC&step=1)。

### 3. 自动添加路由后
- 网段重叠，但不相同：根据最长掩码匹配原则，网段更精细，优先级更高，例如，路由 A 的目的端网段为 <code>10.0.1.0/20</code>，路由 B 的目的端网段为 <code>10.0.1.0/24</code>，当路由 A 和路由 B 均启用时，根据最长掩码匹配规则，会优先匹配路由 B。
<span id="same"></span>
- 网段相同：下一跳均为专线网关的路由支持 ECMP，例如，允许同时开启多条目的端网段均为<code>10.0.1.0/20</code>的路由；其它情况的路由不支持 ECMP（即无法同时开启），例如，下一跳均为 VPC，或为 VPC 和专线网关的路由中，存在两条或两条以上目的端网段为<code>10.0.1.0/20</code>的路由，则仅能开启其中的一条路由。
>?在云联网-专线网络架构中，入方向路由说明如下，具体详情请参见[ 专线网关概述](https://cloud.tencent.com/document/product/216/49570)。
>- 2020 年 9 月 15 日零点前创建的云联网专线网关，向专用通道发布的路由为子网 CIDR，若专用通道为 BGP 模式，IDC 侧通过 BGP 协议学习到 VPC 子网 CIDR。
>- 2020 年 9 月 15 日零点后创建的云联网专线网关，向专用通道发布的路由为 VPC CIDR，若专用通道为 BGP 模式，IDC 侧通过 BGP 协议学习到 VPC CIDR。
>

## 路由自动删除
<table>
<thead>
<tr>
<th>路由下一跳类型</th>
<th>路由删除触发条件</th>
</tr>
</thead>
<tbody><tr>
<td>公有云 VPC</td>
<td>VPC 实例解绑或子网删除</td>
</tr>
<tr>
<td>专线网关</td>
<td>1. 专线网关解绑<br>2. 专线网关侧路由变更： <br>&nbsp;i. 手动填写（静态）：删除<br>&nbsp;ii. 动态学习（BGP）：对端路由更新</td>
</tr>
</tbody></table>
