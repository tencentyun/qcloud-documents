路由表由多条路由策略组成，用于控制私有网络内子网的出流量走向。每个子网只能关联一个路由表，一个路由表可以关联多个子网。您可以创建多个路由表，为不同流量走向的子网关联不同的路由表。您可通过如下视频了解路由表的相关信息。
<div class="doc-video-mod"><iframe src="https://cloud.tencent.com/edu/learning/quick-play/2354-35381?source=gw.doc.media&withPoster=1&notip=1"></iframe></div>

## 类型
路由表有默认路由表和自定义路由表两种类型： 
- **默认路由表**：用户创建私有网络时，系统会自动为其生成一个默认路由表。在之后的子网创建过程中，如果用户没有选择自定义路由表，子网会自动关联该默认路由表。您可以在默认路由表中添加、删除和修改路由策略，但无法删除该默认路由表。
- **自定义路由表**：您可以在私有网络中创建自定义路由表，自定义路由表可以被删除。您可以为具有相同路由策略的子网建立一个自定义路由表，并将路由表与需要遵循其路由策略的所有子网关联。
![](https://main.qcloudimg.com/raw/a86260ffb40bec52c9f64a307d956691.png)  
>?您可以在 [创建子网](https://cloud.tencent.com/document/product/215/36517) 时关联路由表，或在子网创建后，[更换子网关联路由表](https://cloud.tencent.com/document/product/215/53531)。
>

## 路由策略
路由表通过路由策略来实现流量走向控制，路由策略由目的端、下一跳类型和下一跳组成：
- **目的端**：目的端即为您要转发到的目标网段。目的网段描述仅支持网段格式，如果您希望目的端为单个 IP，可设置掩码为`32`（如`172.16.1.1/32`）。另外，目的端不能为路由表所在私有网络内的 IP 段，原因是 Local 路由已表示此私有网络内默认内网互通。
>?当您在 VPC 中部署了 [容器服务](https://cloud.tencent.com/document/product/457/6759)，在配置 VPC 子网路由表策略时，目的端不能在 VPC 的 CIDR 范围内，也不能包含容器网段。
>例如某 VPC CIDR 为172.168.0.0/16，容器网络 CIDR 为192.168.0.0/16，那么配置 VPC 子网路由表策略时，目的端网段不能在172.168.0.0/16范围内，也不能包含192.168.0.0/16。
>
- **下一跳类型**：私有网络的数据包的出口。私有网络下一跳类型支持 “NAT 网关”、“对等连接”、“VPN 网关”、“专线网关”、“云服务器”等类型。
- **下一跳**：指定具体跳转到的下一跳实例（使用下一跳 ID 标识），如私有网络内的某个具体 NAT 网关。


### 路由策略优先级
当路由表中存在多条路由策略时，路由优先级由高至低分别为：
- 私有网络内流量：私有网络内流量最优先匹配。
- 最精确路由（最长前缀匹配）：当路由表中有多条条目可以匹配目的 IP 时，采用掩码最长（最精确）的一条路由作为匹配项并确定下一跳。
- 公网 IP：路由策略均匹配失效时，通过公网 IP 对 Internet 进行外访。
**场景举例：**
当一个子网关联了 NAT 网关，且子网内云服务器有公网 IP（或弹性公网 IP）时，会默认通过 NAT 网关访问 Internet（因为最精确路由的优先级高于公网 IP），但您可以设置路由策略，实现通过云服务器公网 IP 访问 Internet，详情请参见 [调整 NAT 网关和 EIP 的优先级](https://cloud.tencent.com/document/product/552/30012)。

## 等价路由 
等价路由 ECMP（Equal-CostMultipathRouting），是指到达同一目的地址存在多条相同代价的不同路径。在数据包传输时，如果使用传统的路由技术，去往同一目的地址的数据包仅能利用其中一条路径，而其他路径处于备份或者无效状态，当一条路径故障时，切换路径也需要耗费一定的时间，而等价路由可以在网络环境下同时使用多条路径，不仅增加了传输带宽，也实现了多路径流量负载均衡和冗余链路备份的目的。

通常建议 ECMP 用于链路间差异不大的情况下，例如去往某目的地址配置了两条 ECMP 路径，路径 A 带宽为2Mbps，路径 B 带宽为3Mbps，那么网络总带宽可达到4Mbps，即增加了传输带宽，且 A 和 B 链路间可以实现流量负载；但如果路径 B 带宽为100Mbps，那么总网络带宽也只能达到 4Mbps，因此请根据业务实际情况，配置 ECMP 路由。

VPC支持部分同类型路由形成ECMP，不同类型间均不支持ECMP，情况如下：

| 下一跳类型     | 是否支持同类型形成 ECMP  | ECMP 支持的最大数量 |
| -------------- | ----------------------- | --------------------------- |
| NAT 网关        | 否                       | N/A                 |
| 云服务器公网 IP | 否                     | N/A                 |
| 云服务器       | 是                    | 同类型最多8个       |
| 对等连接       | 否                     | N/A                 |
| 专线网关       | 是                     | 同类型最多8个       |
| 云联网         | 否                     | N/A                 |
| 高可用虚拟 IP   | 是                    | 同类型最多8个       |
| VPN 网关        | 是                      | 同类型最多8个       |

### 应用场景
等价路由通常用于，当网关承载带宽有限时，可通过路由实现网关间的流量负载。例如某用户在云上 VPC 和云下 IDC 业务通信带宽需要2000Mbps，但目前 VPN 带宽最大为1000Mbps，那么可以创建两个1000Mbps规格的 VPN 网关，建立两条 VPN 隧道来实现流量分担，两条 VPN 链路可以满足总带宽达到2000Mbps的需求。

## 主备路由
主备路由是指去往同一目的地址配置了2条或多条路径，而只有1条路径处于活跃状态，其他路径则处于备用或无效状态。例如 VPC 去往某 IDC 配置了两条路由，即路径 A 和路径 B，数据包仅通过主路径 A 去往目的地址，路径 B 处于无效备用状态；当路径 A 发生链路故障时，可使能路径 B 生效，流量则从路径 A 切到路径 B，保证了业务的可用性，这种情况下称路径 A、B 为主备路由。

VPC 路由表在添加路由策略时，根据下一跳类型定义了不同的优先级，即去往同一目的端，可以配置下一跳为不同类型的网关，形成主备路由，再结合 VPC 网络探测功能，探测链路质量和可达性，通过配置告警及时发现链路异常，快速切换主备路由，以满足业务高可用。
>?
>+ 路由优先级功能目前处于内测中，如有需要，请提交 [工单申请](https://console.cloud.tencent.com/workorder/category)。
>+ VPC 路由表中根据不同的下一跳类型定义了不同的优先级，目前默认路由优先级为：云联网 > 专线网关 > VPN 网关 > 其他。
>+ 暂不支持控制台修改优先级，如需调整，请提交 [工单申请](https://console.cloud.tencent.com/workorder/category)。

VPC 不同类型路由支持主备情况如下：

| 下一跳类型         | 是否支持主备                                            |
| ------------------ | ------------------------------------------------------- |
| NAT 网关            | 否                                                      |
| 云服务器公网 IP     | 否                                                      |
| 云服务器           | 是，支持与云联网/VPN 网关/专线网关/高可用虚拟 IP 形成主备  |
| 对等连接（同地域） | 否                                                      |
| 对等连接（跨地域） | 否                                                      |
| 专线网关           | 是，支持与云联网/VPN 网关/高可用虚拟 IP/云服务器形成主备  |
| 云联网             | 是，支持与 VPN/专线网关/高可用虚拟 IP/云服务器形成主备    |
| 高可用虚拟 IP       | 是，支持与云联网/VPN 网关/专线网关/云服务器形成主备      |
| VPN 网关            | 是，支持与云联网/专线网关/高可用虚拟 IP/云服务器形成主备 |


### 应用场景
主备路由通常用于，当某一网关链路故障时，可通过主备路由实现流量的平滑切换。例如：
+ VPC 型专线网关（主）& VPC 型 VPN 网关（备）
  **场景描述**：用户通过 VPC 型专线网关打通云上 VPC 和自建 IDC 的通信，同时通过 VPN 网关创建 VPN 备用通道来实现 IDC 与 VPC 通信链路的备份。
  ![](https://main.qcloudimg.com/raw/6371959ca33fe42ac9dfc3c62529bb87.png)
+ 云联网型专线网关（主）& VPC 型 VPN 网关（备）
  **场景描述**：用户通过云联网型专线网关打通云上 VPC 和自建 IDC 的通信，同时通过 VPN 网关创建 VPN 备用通道来实现 IDC 与 VPC 通信链路的备份。
	![](https://main.qcloudimg.com/raw/92f84ee71e0a12212b95641bf76b5bee.png)
