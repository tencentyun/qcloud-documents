## 操作场景

VPC 通道的作用是将部署在 VPC 内的服务通过 API 网关开放给外部访问，VPC 通道提供了负载均衡能力，可同时对接 VPC 内的多个服务。

## 方案优势

- 无需购买内网 CLB，仅使用 API 网关即可开放 VPC 内服务，VPC 通道功能本身不收费，成本低廉。
- 使用 VPC 的内部子网通信，网络时延低，性能佳。

## 前提条件

- 已购买 [API 网关专享实例](https://cloud.tencent.com/document/product/628/55510)。
- 已创建 [云服务器](https://console.cloud.tencent.com/cvm) 等 VPC 内资源。

>!目前 VPC 通道仅支持专享实例下挂载的 API，不支持共享实例。


## 操作步骤

### 步骤1：创建 VPC 通道

1. 登录 [API 网关控制台](https://console.cloud.tencent.com/apigateway)。
2. 在左侧导航栏，单击【VPC 通道】，进入 VPC 通道列表页。
3. 单击页面左上角的【新建】，新建一个 VPC 通道。

| 参数         | 是否必填 | 说明                                                         |
| ------------ | -------- | ------------------------------------------------------------ |
| VPC 通道名称 | 否       | 当前 VPC 通道的名称，最长50个字符，支持 a-z、A-Z、0-9、_     |
| 所属 VPC     | 是       | 选择要对接的后端资源所在的 VPC                               |
| 描述         | 否       | 当前 VPC 通道的备注信息                                      |
| 负载均衡算法 | 否       | 目前仅支持加权轮训算法                                       |
| 协议         | 是       | API 网关与后端资源交互的协议，支持 HTTP 协议和 HTTPS 协议        |
| Host Header  | 否       | 用于指定后端请求的 Host 请求头，通常为后端服务域名和端口号     |
| 节点列表     | 是       | API 网关转发到的后端节点列表，支持最多200个节点，每个节点需要填写节点地址、端口、权重 |
| 重试次数     | 是       | API 网关请求节点失败的重试次数，默认为5次，支持填写1-100间的正整数 |

![](https://main.qcloudimg.com/raw/5c71c6adbde441c01cbfe8cba590a59b.png)

### 步骤2：创建后端对接 VPC 内资源的 API，关联 VPC 通道

1. 登录 [API 网关控制台](https://console.cloud.tencent.com/apigateway/index?rid=1) ，在左侧导航栏单击【服务】。
2. 在服务列表中，单击一个**挂载在专享实例下服务**的服务名，查看该服务。
3. 在服务信息中，单击【管理 API】标签页，根据后端业务类型选择创建【通用 API】。
4. 单击【新建】，填写 API 前端配置，填写完成后点击【下一步】按钮。
5. 填写后端配置，选择 API 后端类型为“VPC 内资源”，选择对接方式为“通过 VPC 通道”，选择步骤1中创建的 VPC 通道。
6. 完成后续配置，成功创建一个后端对接 VPC 内资源的 API。

![](https://main.qcloudimg.com/raw/6d1487f4b5ff233db93d5fa314ed7ca9.png)

### 步骤3：调用 API

对步骤2中创建的 API 发起调用，已经能够调用成功。

## 注意事项

- 在“VPC 通道详情—已关联 API Tab 页”，可以看到当前哪些 API 使用了此 VPC 通道作为后端。删除 VPC 通道前需要先删除这些 API，避免影响调用。
- 专享实例运行在 VPC 中，当“专享实例所在 VPC”与“VPC 通道所对接 VPC”不一致时，您需要通过 [云联网](https://console.cloud.tencent.com/vpc/ccn) 将两个 VPC 打通，否则将影响调用。
