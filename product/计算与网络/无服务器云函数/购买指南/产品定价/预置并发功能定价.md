## 预置并发闲置费用

**预置并发闲置费用 = 闲置实例数 × 配置内存 × 闲置时长 × 预置并发闲置量定价**

- **闲置实例数**：云函数以10秒为粒度，统计10秒内该版本的最大并发数，由当前已启动的预置实例数减去最大并发数，即为闲置实例数。计算公式如下为：闲置实例数 = max（已启动的预置实例数 - 并发数, 0）
- **配置内存**：云函数预置并发配置的内存大小。
- **闲置时长**：预置并发闲置的时长。
- **预置并发闲置量定价**：详情请参见 [产品定价](https://cloud.tencent.com/document/product/583/12281)。

>? 预置并发闲置量的计算单位为 GBs（GB-秒）。

预置并发功能只对已经配置并启动、但未使用的实例收取少量闲置费用，**对于已配置且在使用的实例不收取额外费用**。即只有当前版本的预置数量大于版本并发数时，会收取超出部分的闲置费用。未超出的部分不额外收费。

## 计费示例


闲置实例数乘以配置内存，再乘以闲置时长得到预置并发闲置费用。如下图所示，图中阴影蓝色部分即为预置并发闲置部分。
![img](https://main.qcloudimg.com/raw/c06afa0c4d18c09972847c33b202f1a0.png)

### 案例1
内存为128MB的函数版本，其预置并发配额为12800MB（10个），假设每秒平均调用50次，函数每次生成一个1KB大小的文件并上传至用户自建的外部站点上。在10秒内，该版本的并发数为8个，即：

- 闲置实例数 = max(10 - 8, 0) = 2
- 配置内存 = 128MB
- 闲置时长 = 10s
- 预置并发闲置量定价 = 0.00005471元/GBs

**预置并发闲置费用** = 2 × 128 / 1024GB × 10s × 0.00005471元/GBs = 0.00013678元

**资源使用量及调用次数定价**：

- 资源使用量 = 0.00011108元/GBs
- 调用次数 = 0.0133元/万次
- 外网出流量 = 0.8元/GB

**按量计费费用**：

- 资源使用量：（128*8 / 1024）×10× 50 = 500GBs，小于2万GBs，不产生费用
- 调用次数：50 × 10  = 500次，小于10万次（事件函数和 Web 函数各5万次），不产生费用
- 流量：1 × 50 × 10= 500KB ，小于0.5GB，不产生费用

在这种情况下，**按量计费费用**为0。

**总费用** = 按量计费费用 + 预置并发闲置费用 = 0 + 0.00013678元 = 0.00013678元


### 案例2
A 函数版本配置内存为256MB，假设每分钟平均调用50次，函数每次生成一个1KB大小的文件并上传至用户自建的外部站点上。在18:01配置了100预置实例。由于业务出现增长，在18:07将预置配置提升到120。在18:10时又将预置配置降低到80。**以18:01这1分钟为例**，这1分钟预置实例为100个，实际并发为30个，则：

- **闲置实例数** = 100 - 30 = 70
- **资源闲置量** = 闲置实例数 × 配置内存 × 闲置时长 = 70 × 256MB × 60s = 70 ×（256 / 1024）GB × 60s = 1050GBs

**预置并发闲置费用** = 资源闲置量 × 预置并发闲置量定价 = 1050GBs × 0.00005471元/GBs = 0.057元

**按量计费费用**：

- 资源使用量：（256*8 / 1024）×60× 50 = 3000GBs，小于2万GBs，不产生费用
- 调用次数：50 × 60  = 3000次，小于10万次（事件函数和 Web 函数各5万次），不产生费用
- 流量：1 × 50 × 60= 3000KB ，小于0.5GB，不产生费用

在这种情况下，**按量计费费用**为0。

**总费用**=按量计费费用+预置并发闲置费用=0 + 0.057元 = 0.057元

同上述案例计算方式，可计算 A 函数这10分钟的详细计费，得出这10分钟内累积闲置费用为0.153元，总计费为0.153元，如下表所示：

| 计算项         | 18:01 | 18:02 | 18:03 | 18:04 | 18:05 | 18:06 | 18:07 | 18:08 | 18:09 | 18:10 | 总计  |
| :------------- | :---- | :---- | :---- | :---- | :---- | :---- | :---- | :---- | :---- | :---- | :---- |
| 预置并发配置数 | 100   | 100   | 100   | 100   | 100   | 100   | 120   | 120   | 120   | 80    | -     |
| 该版本并发数   | 30    | 66    | 88    | 100   | 120   | 150   | 180   | 160   | 100   | 30    | -     |
| 闲置实例数     | 70    | 34    | 12    | 0     | 0     | 0     | 0     | 0     | 20    | 50    | -     |
| 闲置费用       | 0.057 | 0.028 | 0.010 | 0.000 | 0.000 | 0.000 | 0.000 | 0.000 | 0.016 | 0.041 | 0.153 |
| 按量计费费用   | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     | 0     |
