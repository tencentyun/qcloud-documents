## 概述

[应用与服务编排工作流](https://cloud.tencent.com/product/asw)（Application Services Workflow，ASW）是一个用来协调分布式任务执行的编排产品 。在 ASW 中设定好任务执行步骤，可以将多个腾讯云服务按步骤进行调度，完成各种业务应用场景。ASW 能简化开发和运行业务流程所需要的任务协调、状态管理以及错误处理等繁琐工作，更简单、更高效的构建与更新应用。 

## 使用方式
ASW 提供基本控制单元，例如分支、并行、循环等，让您使用少量的代码即可完成云函数的编排，实现复杂的函数业务场景。以下以ASW 编排sum云函数为例，介绍操作流程：

### 创建函数

使用 ASW 工作流编排云函数，需要首先在 [云函数控制台](https://console.cloud.tencent.com/scf/list?rid=1&ns=default) 中定义云函数。本章节中，您将学习如何在云函数控制台创建一个求和函数。详情请参考 [创建云函数](https://cloud.tencent.com/document/product/583/19806)。

1. 登录 [云函数控制台](https://console.cloud.tencent.com/scf/list?rid=1&ns=default)，单击左侧导航栏的【函数服务】。
2. 在主界面上方函数服务区域选择广州，并单击【新建】，进入函数创建流程。
3. 在新建函数页面，基本信息中填写以下信息：

 - 函数名称：sum。 
 - 运行环境：Python 3.6。
 - 创建方式：选择空白函数，单击【下一步】进入函数配置。

4. 在函数配置页面中的 **Cloud Studio** 窗格中，删除原有代码，复制如下所示的代码。
   <dx-codeblock>
   ::: python

# -*- coding: utf8 -*-

import json 
def main_handler(event, context):
    sum = 0
    for i in event["values"]:
        sum += i
    return sum
:::
</dx-codeblock>

![](https://main.qcloudimg.com/raw/9af11dca8cb6d239f3e047d6f1b3ef26.png)

5. 单击【保存】，此刻，您已经成功创建了一个云函数。下一步中，您将学习如何将新建的云函数导入到工作流中。


### 创建工作流

1. 登录 [应用与编排服务流控制台](https://console.cloud.tencent.com/asw)。

2. 在工作流页面，单击【新建】，进入创建工作流页面。
   ![](https://main.qcloudimg.com/raw/2aaf3e46046af03aebd8bf12feac7c69.png)

3. 单击【代码创建】，在【代码】区进行编辑工作流定义代码。输入以下工作流定义：

   ```
       {
         "Comment": "",
         "StartAt": "sum",
         "States": {
           "sum": {
             "Type": "Task",
             "Comment": "调用求和函数",
             "Resource": "qrn:qcs:asw:ap-guangzhou:123456789:sdk:json:qcloud:scf:Invoke/sum/$DEFAULT/default",
             "End": true
           }
         }
       }
   ```

   其中 **Type**  定义了工作流当前运行节点为任务 (Task)节点 ，**Resource** 定义了您调用的函数资源，格式如下：

   ```
     "qrn:qcs:asw:{函数所在区域}:{Appid}:sdk:json:qcloud:scf:Invoke/{函数名称}/{函数版本别名}/{函数命名空间}"
   ```

   >? 更多工作流定义参考 [任务 (Task)节点 ](https://cloud.tencent.com/document/product/1272/51544)。

   ![](https://main.qcloudimg.com/raw/6c72046937412718bcf953d3c164daee.png)

   > ? 代码编辑区可以通过右上角“全屏”按钮设置为全屏。

   单击【下一步】，进入【配置基本信息】页面。  

4. 在【配置基本信息】页面，输入工作流名称，运行角色选择**创建新的角色**，类型选择**标准工作流** 。

   ![](https://main.qcloudimg.com/raw/3b40eb3b1b7c7abd38d3e8320844c53a.png)

   > 1. 【选择已有角色】需要先创建角色，并给角色授权相关策略。更多详情参考 [运行角色](https://cloud.tencent.com/document/product/1272/52420)。
   > 2. 【工作流类型】分为标准工作流和快速工作流。更多详情参考[工作流类型](https://cloud.tencent.com/document/product/1272/52418)。
   > 3. 【日志投递】可以选择是否开启。开启日志投递后，工作流运行日志将会投递到cls中。更多详情参考[日志投递](https://main.qcloudimg.com/raw/de51313c87942df6c0b1cd76c467a139.png)。

5. 单击【完成】，即可在【工作流列表页】查看创建好的工作流。


### [运行工作流](id:span)

工作流创建完成后，您可以在【工作流列表页】查看创建好的工作流。在本章节中，您将学习如何运行工作流。

1. 在工作流列表，单击【名称】链接进入工作流。
   ![](https://main.qcloudimg.com/raw/fb4daf6cf9f1451539d8c6d7a9427c39.png)
2. 您可以在界面中看到工作流的基本信息。单击【执行】下的【开始执行】 。
   ![](https://main.qcloudimg.com/raw/07329d351b0cc3d6f634775ea1512988.png)
3. 在弹出的【开始执行】窗口中，以 JSON 格式输入工作流需要的输入内容。例如：

```json
   {"values": [1, 2, 3, 4, 5]}
```

4. 单击【确定】，完成状态执行后，可以在详情页查看执行结果：
   ![](https://main.qcloudimg.com/raw/e9ad25757d6563a352ee0548acad8588.png)

5. 滑动至页面最下方，在【执行历史记录】下，您可以查看子节点的运行情况。

  ![](https://main.qcloudimg.com/raw/c28af1c157fb6864515c9553b603e5aa.png)

6. 单击【资源】中的云函数链接，可以直接跳到云函数控制台，查看函数执行详情。

![](https://main.qcloudimg.com/raw/68dfc963cd03642b79ecd12829408956.png)

7. 单击【重新执行】，即可重新执行工作流。

## 应用场景
### 音视频处理

使用 ASW 工作流可以帮助您将多个任务编排成一个完整的处理流程。如转码，截图，内容识别，内容审核等。通过云函数，可以将转码任务进行切片并行处理，大大提高任务处理的吞吐量，满足高实时性、高并发能力的视频应用、社交应用场景。

### ETL 作业处理

一些数据处理系统中，常常需要周期性/计划性地处理庞大的数据量，使用 ASW 工作流可以快速搭建一个高可用的数据处理流水线。例如，证券公司每12小时统计一次该时段的交易情况并整理出该时段交易量 top5，每天处理一遍秒杀网站的交易流日志获取因售罄而导致的错误从而分析商品热度和趋势等。ASW 工作流利用云函数对交易数据做并行处理，将结果写回数据库服务，并生成一系列不同纬度报表。利用函数近乎无限扩容的能力，可以轻松地进行大容量数据的计算，完成数据建模分析。

### 基因数据处理

ASW 工作流可以将多个批量计算分布式作业串联或并行编排，可靠地支持执行时间长、并发量大的大规模计算。例如将基因数据进行二级分析，以识别生物样品与标准基因组参考相比的变异，最终产出相关性结果。ASW 工作流可以提升执行可靠性，提高资源利用率，优化成本。

### 自动化运维

自动化运维常见有步骤繁琐时间长短不一、单机脚本可靠性低、依赖复杂、人工效率低等常见的挑战，另外进度无法可视化。ASW 结合云函数可以很好的解决这类问题。例如自动化的软件部署从构建 Docker 容器、上传容器镜像，开始并追踪各节点下拉镜像并启动新版本镜像的容器，每一步函数产生的日志会被保存到日志服务可供查询分享。基于 ASW 的自动化运维比单机运维脚本具有高可用、自带的错误处理机制和进度图形化的特点。

### AI 机器训练

ASW 工作流可以将一系列的 AI 能力进行编排，完成一个复杂的 AI 作业场景训练。您可以使用 ASW 工作流来加速安全，有弹性的机器学习应用程序的交付，同时减少您必须编写和维护的代码量。