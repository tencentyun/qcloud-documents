## 客户介绍

国内某连锁餐饮企业，目前在深圳、广州、上海、苏州、佛山、惠州、东莞、昆明、重庆等地拥有140多家直营门店。同是也是红山资本成员企业，是红杉资本在中国投资的餐饮企业之一。

#### 客户痛点

- 2017年，企业业务系统信息孤岛严重，有二次开发困难，大量用户用的系统语言和接口都不一样。
- 2017年底，团队自研推出了小程序点餐系统，和后台业务系统打通，亟待解决多个系统之间的互联互通问题。另外业务系统耦合度高、业务拆分困难、系统稳定性差，各种紧急的业务需求和活动无法及时满足。
![](https://main.qcloudimg.com/raw/5594d7222fa48c6a1731e87e34d7082b.jpg)



#### 新餐饮介绍

在上述痛点下，企业开始对数字化新餐饮进行调研，新餐饮本身也是人货场的重构，主要为实现日常经营管理所有的数据能够全流程在线化，主要分为以下四块：

- 点餐、下单、支付、制作、出品实现实时在线化。
- 用餐评价，会员管理可以在线化，支持数字化营销。
- 供应链订货、收获、盘点、损耗在流程在线，数据打通。
- 人事、考勤、成本核算等在线化、工具化、高效化。这些方面是新餐饮转型在这方面要进行全方面的数字化改造。

经过一系列调研分析，企业决定向云上进行业务迁移，并采用腾讯云 Serverless 云函数承载业务。


## 腾讯云 Serverless 解决方案

使用 Serverless 云函数可以实现的业务功能非常多，例如：

- 微信小程序的服务应用，云函数提供计算支持。
- 公众号消息推送服务。
- 实时通讯服务。
- 不同的业务系统数据同步，例如，金蝶的 ERP 系统以及 WMS 系统的对接和数据同步，SOS 餐饮系统和金蝶 ERP 数据接口的同步。
- 统一的支付服务、订单的付款、订单的支付，定时异常数据邮件提醒。
- 第三方外卖平台，第三方系统的数据抽取及处理入库。需要临时上线的功能需求或接口对接。

### 使用 Serverless 的优势

- **Serverless 云函数是天然微服务的架构**
一个函数可以看作一个服务。微服务本身能解决很多数据耦合度的问题。
- **适合处理大量零散的定时任务**
例如，可以极大的减少部署独立的定时器服务，解决集群服务的定时任务管理问题，尤其是并发的集群定制任务。
- **更低的开发难度，更高的开发效率**
资源可以直接使用，针对不同的业务场景，可以借助不同语言特性，结合研发团队的能力，更快速的实现对应的需求。利用研发人员熟悉的语言去做业务场景，而非需要团队使用统一的技术架构，团队可以更灵活快速推进需求。
- **更低的运维成本**
云函数的计费方式为按量计费，且未运行时不产生费用，同时支持自动扩缩容。大大降低了资源和人力运维成本。



### 案例一：云打印服务

#### 传统架构

用云函数 SCF 实现云打印服务。云打印是一个小型的打印系统，用来解决用户在门店下单之后，打印机打印小票的业务流程。

在传统架构环境中，每一个门店都需要准备以下硬件：
- 部署一个本地服务器，这个本地服务器提供一个本地服务
- 一个交银机
- 一个一体机
- 一个打印机

这些硬件通过本地服务器进行管控。总部也需要有服务进行数据的整合。下文以美团订单为例进行简单介绍：
<dx-steps>
-美团的订单会先将订单下发到总部的服务器上。
-总部服务器会将订单数据推送到门店。
-门店服务器接到数据之后，通知到打印机进行打印小票。
</dx-steps>


目前，大量的订单皆为线上下单，无论是小程序订单或是其他平台订单，都主要是通过网上下单，传统架构信息传递链路长，非常依赖网络链路的稳定性。传统架构如下图所示：
![](https://main.qcloudimg.com/raw/6f86feb8440514c0fd2a186acb0c5944.jpg)


传统架构存在以下痛点：

- 硬件及维护成本非常高。门店需要部署独立的本地服务器。
- 总部对于门店的服务情况无法快速掌控，由于数据每隔一段时间才会通讯，很难做到数据的实时同步。
- 收银电脑普遍配置极低，订单数据无法实时上传汇总，数据同步存在时间差。



#### 新的 Serverless 云服务架构

新的 Serverless 服务架构，取消了本地服务器，转为在原本配置比较低的收银电脑或 SDK 上部署轻量级客户端，通过 SCF 为客户端提供计算资源。

- 打开浏览器，即可实时传回所有订单数据，企业可以追踪所有的服务状态。
- 打印机部署在门店的局域网内部，所以单独在云端的服务就是 SOS 收银系统。
- 通过云打印服务连接本地的收银机客户端，通过该客户端来定制的打印机可实现实时通讯，随时知道门店的打印机是否能正常功能。
![](https://main.qcloudimg.com/raw/ad2cdcaf4ca99ccb273e263dbe78dbfb.jpg)



### 案例二：会员画像标签运算系统

用云函数结合 CMQ 、API 网关，完成会员画像标签运算系统。

会员系统比较重要的一项数据即会员画像。要基于会员消费行为消费轨迹生成用户会员画像，包括会员爱好、消费频率、消费档次等。企业希望能够快速实时的跟踪这些数据，通过 SCF 可以用极低的成本完成整个过程。

这个过程如何实现？以下为您简单介绍整个会员画像实时计算系统的运行逻辑：


1. 用户产生的购买消费行为数据推送到柜员系统，通过消费订单产生统计数据。
2. 数据统计完之后将写入数据库，同时数据信息会推送到消息队列 CMQ 中，CMQ 调用 API 网关触发用户画像功能的云函数执行。
3. 每一个用户画像功能的云函数会对应一类标签，包括消费频次、消费偏好等，这类云函数对其进行标签的实时运算：
 - 如果消费过程中产生错误，会将这个消息反馈给 CMQ，CMQ 反馈消费失败。
 - 如果消费正常，会将计算完成的标签保存入库，最终生成用户画像。
![](https://main.qcloudimg.com/raw/5b95449d208441299c38df7eb7c30b86.jpg)

>?目前会员画像实时计算系统从2019年上线至今已完成3000多万会员用户画像。





### 案例三：营业额智能预测

通过云函数 SCF + 机器学习完成营业额智能预测。拉取近两年门店的营业额，最长两年，最少是一到两个月，每天滚动生成每一家门店接下来30天的营业额预测。

通过 SCF 完成如下：

- **抽取数据处理**：对营业额的数据做抽取，做相关的异常处理。
- **生成训练特征**：为数据组合特征。
- **定期训练模型**：使用 LightGBM 模型训练多个模型，多个模型预测数据加权融合，使用已有模型集预测数据特征值预测数据。通常两周到一个月做一次训练，到目前运行下来有接近半年的时间，目前营业额单店预测平均准确度高达达87%。
![](https://main.qcloudimg.com/raw/ea330f6c7aafca1f8f39ba8f64020571.jpg)



## 腾讯云 Serverless 云函数的价值

上述三个应用案例中云函数主要价值点体项如下：


#### 云打印服务

- 通过使用腾讯云提供的 Websocket 服务，减少了地层框架的开发难度，研发人员只需关注业务开发即可。
- 一位研发大概2周多时间就可完成，人力和时间成本节省至少50%。

#### 会员画像标签运算系统

- 通过使用 CMQ，API 网关和云函数快速搭建起来一个高质量稳定的计算服务架构。目前从上线运行到现在0故障，运行稳定，且无需考虑服务器资源问题。
- 一位中级研发工程师三年的经验，从研究使用到搭建框架到开发完成不到2周时间。

#### 智能营业额预测

- 通过使用函数的分层管理，减少了代码管理和调试难度。
- 用较低的成本和更高的效率实现了机器学习的智能应用。


整体来看，服务运维及成本、服务稳定性和性能都有较好的保障，而且费用投入远低于自建服务的方式，至少节省了**3台4核8G内存的服务器。**



| 开发环境 | 传统开发环境 | 云函数开发环境 |  
|---------|---------|---------|
| 开发周期 | 100% | 55% | 
| 研发难度 | 100% | 45% | 
| 成本 | 100% | 30% | 
