## 客户介绍

国内某在线视频媒体平台是以视听互动为核心，集网络特色与电视特色与一体，实现 “多屏合一”，独播、跨屏、自制的新媒体视听综合传播服务平台，也是国内 A 股中最早国有控股的视频平台之一。

## 业务需求

#### 需求1：音视频编解码业务

音视频团队承担的主要业务有：

- 自有内容音视频输出：
  - 每天海量时长的源视频内容生产
  - 240P 到 4K 等不同清晰度，超50多种格式的转码及快速适配上线
- 转码效率/算法探索：
  - 码率超高压缩算法
  - 老片修复、视频超分、插帧

在自有内容的音视频播出里，每天有海量视频的生产，需要消耗很大的计算资源。每天处理的量从240P到4K等不同清晰度、超50余种格式，包含 AVC、HEVC、MPEG 等多种编码格式。

而在 UGC 方面，需要快速将创作者的内容呈现给用户，给创造者带来收益。



#### 需求2：主观感兴趣视频编码的研究

主观感兴趣视频编码，基于视觉冗余原理和对编码器引擎深度优化，相对原生 X264、X265 编码软件同等主观画质能够降40%以上低码率。

- **内容感知自适应编码**
  进行前期的预处理，通过分析这个视频动态复杂度、场景、镜头等，自适应匹配到 RDO 编码曲线最佳性价比码率，从而实现在不降低主观画质的体验上，降低30%以上码率。
- **主观感兴趣的区域编码**
  如下图所示，人眼聚焦的点在小汽车上面，可以看到一个人开着车的动作，利用人眼视觉感兴趣区域关注特点，通过基于 AI 的主观感兴趣区域预测模型，指导编码器在不同区域的编码质量权重分配，实现在同等主观体验下，能够降低15%以上码率。
- **视频编码图像增强技术**
  企业自主研发的系列编码图像优化技术，在不增加码率前提下，达到超越源片画质的体验提升。




#### 需求3：音视频转码平台产品迭代

- 第一代，于2015年开始，基于 Hadoop 的 MapReduce 计算实现，处理量相对较少，随着业务的快速发展，后期该架构扩展将比较困难。
- 第二代，基于 mesos 的分布式资源管理框架，此时的业务已有所增加，日处理量得到提升，尤其是2016年起提出独播的战略，音视频内容需要快速生产上线，在此基础上实现了视频分段转码。
- 第三代，在2019年引进 AI 技术和腾讯云图像优化技术，采用 K8S 来实现资源的调度，自研调度及工作流编排。疫情期间，视频量增长非常快速，尤其在 UGC，超过以前十倍以上，引入了腾讯云 Serverless 后，能够快速实现集群扩容、提供所需要的计算资源。


## 为什么要使用腾讯云 Serverless？

从下图可以看到，从左到右云端计算的发展，云计算技术一直在提升。左边是早期是物理机托管，到云主机到容器的出现，再到现在 Serverless 的出现，已经得到非常快速的发展。

![](https://main.qcloudimg.com/raw/64f7c843db5473f500312e79aff1957b.jpg)

早期的物理机和云主机和容器的特点，决定了30%的时间是处于低负载的情况。而早期视频的转码，大概在本地 IDC 机房有上百台服务器。白天资源严重不足，但到凌晨则处于低负载，服务器资源无法合理使用，而如今采用腾讯云 Serverless 以后，能够保证资源得到合理利用。



## Serverless 能够带来哪些价值？

- 快速部署、弹性伸缩灵活的按量使用，降低业务使用瓶颈。
- 按使用场景实现任务的多地域调度能力，根据用户来源去调用每个区域资源，保证合理使用。
- 云上备份容灾机制，实现业务的不间断运行。
- 在确保性能的基础上降低资源成本和人力成本。

## Serverless 落地实践


#### 音视频转码

在云端利用 Serverless 实现音视频转码， 只需执行以下简单的三个步骤即可实现：

1. 创建函数，部署自研编码器资源包、部署转码逻辑。
2. 配置 COS Bucket 触发器，对源视频实时处理加工，旁路生成日志和监控、支持告警。
3. 将转码后的视频回传 COS，并分发到自建 CDN 或腾讯 CDN 节点。

核心优势主要是在于凭借云函数强大的联动能力，能够将视频上传以及视频处理和加工，以及视频提取、存储场景有机结合为一体。



#### 支持灵活处理

能支持自定义转码函数，自身编码器能够快速进行部署，弥补单独服务，云服务的盲点。



#### 平滑迁移转码系统

线上 UPGC 内容采用的云厂家的点播服务，编码器处于不可控的状态。而采用 Serverless 后能够平滑迁移转码系统，将自研的编码器迁移到 Serverless，可自由调节所需参数，达到优化视频质量的目的。



#### 降本增效

使用云函数 Serverless 最大的优势之一，能够大幅降低成本，在上线 Serverless 后，计算资源的**成本降低了45%以上**。

![](https://main.qcloudimg.com/raw/c1a2fc4b38b1685e5477079b4619ebea.png)

原有的音视频转码架构，需要自己监控各项指标，例如 CPU 、内存、网络带宽等。通过触发器去调动云服务器的安装镜像去接入计算平台，还存在一个延时比较高的问题。如下图所示：
![](https://main.qcloudimg.com/raw/63832dba4c37857004998cec2fcea730.png)



在启动后无法动态回收资源，造成大量计算资源的浪费。采用云函数 Serverless 后，可以依赖云函数自动扩容的方式去应对大量用户请求，同时使用腾讯云实时监控功能，实时观察内存、并发，网络带宽的使用情况。如下图所示：
![](https://main.qcloudimg.com/raw/799f2c5630865d7c9397e48cac1d8361.png)



业务迁移腾讯云 Serverless 云函数之后，可以实现：

- 高易用性，只需实现业务代码的逻辑，无需关心非功能开发以外的问题，免运维。
- 稳定性，腾讯云 Serverless 通过多地容灾等方式提供高稳定性保障。
- 快迭代，支持版本、API 流量自由分配，快速实现灰度方案。
- 快启动能力，每次在一秒钟之内实现，20秒以内完成，满足业务需求。
