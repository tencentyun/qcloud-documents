## 操作场景
本文档介绍如何在 Windows 操作系统的轻量应用服务器上通过 IIS 搭建 FTP 站点。

## 示例软件版本
本文搭建 FTP 服务组成版本如下：
 - Windows 操作系统，本文以系统镜像 Windows Server 2012 为例。
 - IIS：Web 服务器，本文以 IIS 8.5 为例。

## 操作步骤
### 步骤1：登录轻量应用服务器
您可以 [使用 VNC 方式登录 Windows 实例](https://cloud.tencent.com/document/product/1207/44656)。也可以根据实际操作习惯，[使用远程桌面连接登录 Windows 实例](https://cloud.tencent.com/document/product/1207/44579)。

### 步骤2：在 IIS 上安装 FTP 服务
1. 在操作系统界面，单击 <img src="https://main.qcloudimg.com/raw/446c1e8cb7da2ce280d710c6a46b693d.png" style="margin:-3px 0px">，打开服务器管理器。
2. 在“服务器管理器”窗口中，单击**添加角色与功能**。如下图所示：
![](https://main.qcloudimg.com/raw/5c7fa77df47fb39bafb9c6f39f4b1007.png)
3. 在弹出的“添加角色和功能向导”窗口中，单击**下一步**，进入“选择安装类型”界面。
4. 在“选择安装类型”界面中，选择**基于角色或基于功能的安装**，单击**下一步**。
5. 在“选择目标服务器”界面中，保持默认设置，单击**下一步**。如下图所示：
![](https://main.qcloudimg.com/raw/beec7ae5fcbdf3e413f133296e53f2df.png)
6. 在“选择服务器角色”界面中，勾选 **Web 服务器(IIS)**，并在弹出的窗口中单击**添加功能**。如下图所示：
![](https://main.qcloudimg.com/raw/f160096425be05330fc7bc39e3d81b22.png)
7. 连续单击三次**下一步**，进入“选择角色服务”界面。
8. 在“选择角色服务”界面，勾选 **FTP 服务**及 **FTP 扩展**，单击**下一步**。如下图所示：
![](https://main.qcloudimg.com/raw/e8efaf069e2f2d2a2e632d0f2eeec4a4.png)
9. 单击**安装**，开始安装 FTP 服务。
10. 安装完成后，单击**关闭**。

### 步骤3：创建 FTP 用户名及密码[](id:user)

<dx-alert infotype="explain" title="">
请按照以下步骤配置 FTP 用户名及密码，若您需使用匿名用户访问 FTP 服务，可跳过此步骤。
</dx-alert>

1. 在“服务器管理器”窗口中，选择右上角导航栏中的**工具** > **计算机管理**，打开计算机管理窗口。
2. 在“计算机管理”界面中，选择左侧导航栏中的**系统工具** > **本地用户和组** > **用户**。
3. 在**用户**右侧界面中，右键单击空白位置，选择**新用户**。如下图所示：
![](https://main.qcloudimg.com/raw/e59109c2d3e2bed1c05bfb6983975622.png)
4. 在“新用户”界面，按照以下提示设置用户名及密码，并单击**创建**。如下图所示：
![](https://main.qcloudimg.com/raw/5727d1a8f33bd35df02e1ec58447f23f.png)
主要参数如下：
  - 用户名：自定义，本文以 `ftpuser` 为例。
  - 密码及确认密码：自定义，密码需同时包含大写、小写字母及数字。
  - 取消勾选“用户下次登录时须更改密码”，勾选“密码永不过期”。
  请根据实际需求进行勾选，本文以密码永不过期为例。
5. 单击**关闭**，关闭“新用户”窗口后即可在列表中查看已创建的 `ftpuser` 用户。
	
### 步骤4：设置共享文件夹权限

<dx-alert infotype="explain" title="">
本文以 `C:\test` 文件夹为例，设置 FTP 站点的共享文件夹，且文件夹包含了需共享的文件 `test.txt`。您可以参照本示例新建一个 `C:\test` 文件夹和 `test.txt`文件。也可以根据实际需求，设置其他文件夹为 FTP 站点的共享文件夹。
</dx-alert>

1. 在操作系统界面，单击 <img src="https://main.qcloudimg.com/raw/863967bab67b6cd83ce5f0924e1b19c8.png" style="margin:-3px 0px">，打开“这台电脑”窗口。
2. 在 C 盘下，选择并右键单击 `test` 文件夹，选择**属性**。
3.  在“test 属性”窗口中，选择**安全**标签。
4.  选择 `Everyone` 用户并单击**编辑**。如下图所示：
如果“组或用户名”中没有 `Everyone`，请参考 [添加 Everyone 用户](#add) 进行添加。
![](https://main.qcloudimg.com/raw/bb4512359271255fbe00e5950483d714.png)
5. [](id:step5)在“test 的权限”界面中，按需设置 `Everyone` 用户的权限并单击**确定**。如下图所示：
本文以授予 `Everyone` 用户所有权限为例。
![](https://main.qcloudimg.com/raw/ab403fb016348a2d5bed75e7f8d8560b.png)
6. 在“test 属性”窗口中，单击**确定**完成设置。


### 步骤5：添加 FTP 站点
1. 在“服务器管理器”窗口中，选择右上角导航栏中的**工具** > **Internet Information Services (IIS)管理器**。
2. 在打开的 “Internet Information Sevices (IIS)管理器” 窗口中，依次展开左侧导航栏的服务器名称，并右键单击**网站**，选择**添加 FTP 站点**。如下图所示：
![](https://main.qcloudimg.com/raw/bfa4fa842a840f0f374a50de828a4615.png)
3. 在“站点信息”界面中，参考以下信息进行设置，并单击**下一步**。如下图所示：
![](https://main.qcloudimg.com/raw/21dee4172724d828f7b326f1376eae8b.png)
    - **FTP 站点名称**：填写 FTP 站点名称，本文以 `ftp` 为例。
    - **物理路径**：请选择已设置权限的共享文件夹路径，本文以 `C:\test` 为例。
4. 在“绑定和 SSL 设置”界面中，参考以下信息进行设置，并单击**下一步**。如下图所示：
![](https://main.qcloudimg.com/raw/aaf8b072c308895c875ffd8897443ab6.png) 
主要配置的参数信息如下：
     - **绑定**：IP 地址默认选择**全部未分配**，端口默认为21（FTP 默认端口号），您也可以自行设置端口。
     - **SSL**：请按需选择，本文以**无 SSL** 为例。
       -  **无 SSL**：无需 SSL 加密。
       - **允许 SSL**：允许 FTP 服务器支持与客户端的非 SSL 和 SSL 连接。
      -  **要求 SSL**：需要 SSL 加密才能在 FTP 服务器和客户端之间进行通信。
   如果您选择了**允许 SSL** 或**需要 SSL** 时，您可以在 “SSL 证书”中选择已有的 SSL 证书，也可参考 [服务器证书制作](#ssl) 步骤制作一个 SSL 证书。
5. 在“身份验证和授权信息”界面中，参考以下信息进行设置，并单击**下一步**。如下图所示：
![](https://main.qcloudimg.com/raw/7cfafd87c991420bf20ab19d6ed5c570.png)
 - **身份验证**：选择一种身份验证方法，本文以**基本**为例。
    - **匿名**：允许任何用户访问仅提供匿名或 FTP 用户名的内容。
	 - **基本**：要求用户提供有效的用户名和密码才能访问内容。因为基本身份验证通过网络传输未加密的密码，所以仅当您知道客户端和 FTP 服务器之间的连接是安全的（例如通过使用安全套接字层 SSL）时，才使用此身份验证方法。
 - **授权**：从允许访问下拉列表中选择一种方式，本文以指定用户 `ftpuser` 为例。
	    - **所有用户**： 所有用户，无论是匿名用户还是已标识身份的用户，都可以访问该内容。
	    - **匿名用户**：匿名用户可以访问内容。
	    - **指定的角色或用户组**：只有某些角色或用户组的成员才能访问内容。选择此项需指定角色或用户组。
	    - **指定的用户**：只有指定的用户可以访问内容。选择此项需指定用户名。
 - **权限**：按需设置权限，本文以设置**读取**和**写入**权限为例。
    - **读取**：允许授权用户从目录中读取内容。
    - **写入**：允许授权用户写入目录。
7. 单击**完成**即可成功创建 FTP 站点。

### 步骤6：设置安全组及防火墙
1. 完成 FTP 站点搭建后，请对应 FTP 访问模式，放通添加 FTP 站点时绑定端口的入站规则：
 - **主动模式**：放通20及21端口。
 - **被动模式**：放通21端口及1024 - 65535端口。
如何放通对应端口，请参见 [添加防火墙规则](https://cloud.tencent.com/document/product/1207/44577#.E6.B7.BB.E5.8A.A0.E9.98.B2.E7.81.AB.E5.A2.99.E8.A7.84.E5.88.99)。
2. （可选）参考 [微软官方文档](https://docs.microsoft.com/en-us/previous-versions/orphan-topics/ws.11/hh831655(v=ws.11)) 配置 FTP 站点的防火墙支持，使 FTP 服务器能够接受来自防火墙的被动连接。

### 步骤7：测试 FTP 站点
您可通过 FTP 客户端软件、浏览器或文件资源管理器等工具验证 FTP 服务，本文以客户端的文件资源管理器为例。
1. 请对应您的实际情况，设置 IE 浏览器：
 - 已配置 FTP 站点防火墙（主动模式）：
 打开**客户端**的 IE 浏览器，选择**工具** > **Internet 选项** > **高级**，取消勾选**使用被动 FTP（用于防火墙和 DSL 调制解调器的兼容）**并单击**确定**。
 - 未配置 FTP 站点防火墙（被动模式）：
    1. 打开 **FTP 服务器**的 IE 浏览器，选择**工具** > **Internet 选项** > **高级**，取消勾选**使用被动 FTP（用于防火墙和 DSL 调制解调器的兼容）**并单击**确定**。
    2. 打开**客户端**的 IE 浏览器，选择**工具** > **Internet 选项** > **高级**，勾选**使用被动 FTP（用于防火墙和 DSL 调制解调器的兼容）**并单击**确定**。
2. 打开客户端的计算机，在路径栏中访问以下地址。如下图所示：
```
ftp://轻量应用服务器公网IP:21
```
![](https://main.qcloudimg.com/raw/01154cd3f3af8c0578e588c29a574216.png)
3. 在弹出的“登录身份”窗口中输入 [创建 FTP 用户名及密码](#user) 中已设置的用户名及密码。
4. 成功登录后，即可上传及下载文件。

## 附录
### 添加 Everyone 用户[](id:add)
1. 在“test 属性”窗口中，选择**安全**标签并单击**编辑**。如下图所示：
![](https://main.qcloudimg.com/raw/1792e5b5ff508f809091e786c229893c.png)
2. 在“test 的权限”界面中，单击**添加**。
3. 在“选择用户或组”界面中，单击**高级**。
4. 在弹出的“选择用户或组”界面中，单击**立即查找**。
5. 在搜索结果中，选择 `Everyone` 并单击**确定**。如下图所示：
![](https://main.qcloudimg.com/raw/3abc835b93387ef1571db5e8eea010b5.png)
6. 在“选择用户或组”界面中，单击**确定**即可添加。如下图所示：
![](https://main.qcloudimg.com/raw/6f94c003d1660597adf67cc640617407.png)
前往 [步骤5](#step5) 设置 `Everyone` 用户权限。

### 服务器证书制作[](id:ssl)
1. 在“服务器管理器”窗口中，选择右上角导航栏中的**工具** > **Internet Information Services (IIS)管理器**。
2. 在弹出的“Internet Information Services (IIS)管理器”窗口中，选择左侧导航栏中的服务器，双击右侧界面中的**服务器证书**。如下图所示：
![](https://main.qcloudimg.com/raw/041a945541b3c94cc8206c8093df84c8.png)
3. 选择右侧操作栏中的**创建自签名证书**。
4. 在弹出的“创建自签名证书”窗口中，设置证书名称及存储类型。如下图所示：
本文以创建个人存储类型的 SSL 证书为例。
![](https://main.qcloudimg.com/raw/c1633f5e0adda9eed1583130c6e5d21e.png)
5. 单击**确定**即可成功创建。
