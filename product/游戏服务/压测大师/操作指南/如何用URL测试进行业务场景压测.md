## 操作场景
该文档指导您在压测时，在压测大师上进行上下文变量设置，配置用例，以及常见问题的解答。用例配置完成后，您可以根据业务场景进行测试。

## 操作步骤
一些测试场景中，前后 URL 请求的数据有关联，如登录或支付操作，需要先拿到一个特定的验证 token 或 key，才能正确的登录完成鉴权。
在 WeTest 中，我们可以通过 URL 测试中的上下文变量和场景设置来模拟类似业务场景。
通过在 URL1 中添加“上下文变量”，并设置对应的取值方式，之后即可在 URL2 中通过{{var}}来获取到 URL1 的动态值，最后在测试模型中将模式选择为“上下文”，将 URL 按业务流程排序，即完成本次配置。

示例：提取 URL1 的 Json 格式 Body 中的内容，赋值给 URL2 中的 Header。
1. 在 URL1 中设置上下文变量 jsonv1，因为需要的值在返回的 Json 文件中，所以选择提取方式为'JSON'，提取规则中输入具体需要的字段。  
 ![](https://main.qcloudimg.com/raw/698c6414386cb3aa706d41fb70b235a5.png)
2. 在 URL2 中设置 Header 中的 testheader 字段的值来源于上文准备好的{{jasonv1}}变量，务必记得变量都需要用{{}}来识别。
 ![](https://main.qcloudimg.com/raw/22a6fed6a7b4620e2903b677c7ed3994.png)
若 URL1 中 JSON 文件内，projectinfo 的值为'p123'，则下文的 Header 中，hh 被赋值'p123'，testheader 被赋值'p123aa'。
3. 在测试模型配置栏为场景命名，选择“上下文”模式。
 ![](https://main.qcloudimg.com/raw/bf98aa4ac57deaae05359a96ff46724d.png)
4. 将 URL1 和 URL2 按顺序排列，该场景就会按照配置的顺序进行，即完成本次配置。
 ![](https://main.qcloudimg.com/raw/1cff645bfc6ceab4171c1c799353ba58.png)

## FAQ

1. 什么时候需要添加 Content-Type 字段？
当请求为 POST 请求的时候，需要在 Header 中添加 Content-Type 字段，对应的值为 application/(Body 数据格式)。

2. 想要让 Cookie 值动态变化应该如何设置？
可以上传 .csv 文件，对 Cookie 进行参数化设置，使 Cookie 值动态变化。

3. 当 Header 中某个参数输入两次，但对应的值不同，那么执行用例的时候该参数是两个都会发送到服务器还是随机选择其中一个？
同一参数在一个客户端请求中只能填写一次，当填写两个及以上的时候服务器会返回错误。

4. Body 中的四种选项各是什么意思？
 - form-data：默认 Web 表单提交方式，模拟输入表单中的字段和值，如 Key 为 number，value 为100。
 - x-www-form-urlencoded：常见的提交表单数据方式，key和value会在URL中进行转码，如 test&sub%5B%5D=1。
 - raw：纯文本，如“This is sample text body”。
 - 二进制文件：允许您插入图像、音频或视频文件（因请求数较大，暂只支持 80KB 以下的文件）。

5. 当 Body 为 x-www-form-urlencoded 数据提交方式时，某个字段对应的值为空，那么不添加这个字段对测试会有影响吗?
会有影响，我们在 Body 中填写参数的时候即使该参数对应的参数值为 NULL，也需要将该参数输入，参数值可以不填写。

6. Body 中可添加的参数数量有上限吗？
有的，一个客户端请求中最多可添加20个 Body。

7. 上下文变量的变量名有什么要求吗？
没有，变量名可以自定义，只需和下文中保持一致即可。

8. 一个上下文变量可以在下文中多次使用吗？
可以。

9. 写提取规则后可以验证提取规则填写是否正确吗？
不能直接的确定，只能在调试结果中查看下文的请求信息，确定是否从上文成功提取出想要的参数。

10. 检查点在哪里可以看到结果？
在测试结果的事务数据中选择设置有检查点的 URL，在数据统计栏最下方可以看到检查点的事务成功率。

