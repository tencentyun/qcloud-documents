
本文档主要介绍 MGOBE 的匹配实现机制，帮助您理解匹配完成结果和匹配超时的现象。
## 概念解释

#### 玩家组
发起同一个匹配请求中传入的玩家称为一个玩家组。例如通过 MatchPlayers 接口传入的单个玩家，或通过 MatchGroup 接口传入的单个或多个玩家。

#### 队伍
一个队伍表示游戏对局中的一个对战方。队伍在匹配规则集中进行定义。

#### 房间
用于承载一个游戏对局的对象。MGOBE 匹配会自动为成功匹配的玩家创建并将其加入房间。

#### 机器人填充
已开启机器人开关的匹配，玩家匹配超时将被按要求填充机器人，并将玩家加入房间。



## 搜索合适的玩家组成游戏对局


### 匹配过程

![](https://main.qcloudimg.com/raw/d2e4066296fe456feebd65b29cb8d568.png)
发起匹配的玩家组，会进入同一个匹配池。匹配池中的玩家组将经历**两个阶段**：
- 等待被匹配成队伍。 
- 等待被匹配进房间。

MGOBE 会根据您配置的规则，在现有的匹配池中尽可能为玩家搜索符合条件的匹配对象组成队伍，再将符合条件的队伍组成房间，搜索过程中的两个阶段对您是不可见。由于不断有玩家进入匹配池，也不断有玩家超时，匹配池中的玩家组和队伍都是动态的。所以为了匹配效率，匹配结果并不总是全局最优解。

 ### 匹配超时

玩家匹配超时可能发生在上述匹配过程中的任意一个阶段。

## 为匹配填充机器人

### 机器人开关

在 [游戏联机对战引擎控制台](https://console.cloud.tencent.com/minigamecloud/room/play) 的【在线匹配】中，可以选择是否开启机器人开关。详见 [ 匹配配置 ](https://cloud.tencent.com/document/product/1038/34949)。
- 关闭机器人开关时，MGOBE 不对超时玩家填充机器人。匹配超时后，玩家无法进入房间开始对战。
- 开启机器人开关，匹配超时的玩家将被独立创建房间，并在空余席位填充机器人；或与其他符合匹配规则的超时玩家一起匹配进入同一房间，并在空余席位填充机器人。

### 机器人逻辑实现

MGOBE 只会在匹配中指定机器人的席位和属性，并不关注机器人的逻辑实现。您需要在实时服务器或客户端自行实现机器人行为逻辑。机器人的属性与同队伍的真人玩家属性平均值相等；当机器人所在队伍没有真人玩家时，机器人的属性与同房间的真人玩家属性平均值相等。
>!MGOBE 不能保证在所有规则情况下，机器人的属性都符合其所在队伍的属性要求。


### 超时填充机器人的机制

超时填充机器人的机制可以在 [游戏联机对战引擎控制台](https://console.cloud.tencent.com/minigamecloud/room/play) 的【在线匹配】中进行配置，目前支持两种机器人超时填充机制：
- #### 优先机器人填充（默认）
 -  将任意阶段匹配超时的玩家组独立加入房间，在房间内的其余空缺席位填充机器人。如5v5的游戏中，单人发起匹配的玩家超时后，将同队伍的其余4个空缺、不同队伍的5个空缺席位都填充机器人。
 -  这种机制一般用于不希望对战双方的真人玩家数量不对等的玩法，避免单人与组队开黑的多人对战。
![](https://main.qcloudimg.com/raw/873dc60d2a5de8db2d634c3542665b6b.png)

- #### 优先玩家填充
 -  将有超时玩家组的队伍、超时的玩家组按规则进行匹配并加入房间，在房间内其余空缺席位填充机器人。
>!MGOBE 不会为超时的玩家组匹配未超时的玩家组。
 -  在超时优先玩家填充的机制下，可能在同一个房间中存在以下几种队形：包含单个真人玩家组的队伍、包含多个真人玩家组的队伍、真人玩家组与机器人混合的队伍、完全是机器人的队伍。MGOBE 不保证房间内的真人玩家在每个队伍中平均分布。
 -  该机制一般用于大乱斗、大逃杀类型的游戏，使人数较多的房间内，尽可能有较多的真人玩家。
![](https://main.qcloudimg.com/raw/ab3dbd2b9cbf3cd18286ebe9562cd20c.png)







## 相关文档

- [规则集配置](https://cloud.tencent.com/document/product/1038/47280)
- [匹配配置](https://cloud.tencent.com/document/product/1038/34949)
- [规则脚本设计](https://cloud.tencent.com/document/product/1038/34952)
- [规则脚本示例](https://cloud.tencent.com/document/product/1038/34953)

