
本文主要介绍认证与通信过程中涉及到的各角色信息以及逻辑流程。

## 角色介绍
本节主要介绍 IoT TID 认证与通信流程中涉及的角色信息。

- 用户 IoT 设备：设备商生产或运营的物联网终端设备。
- 设备端 SDK：对接用户 IoT 设备的 C 语言 SDK，用于协议的打包与解包。
- 用户服务端：设备商自己部署的服务器，负责处理业务逻辑，连接用户 IoT 设备与 TID 认证服务器。
- 服务端 SDK：对接用户服务端的多语言 SDK，封装了 TID 认证 API 及加解密 API。
- TID 认证服务器：腾讯云 IoT TID 认证服务平台，负责处理 TID 认证请求。

## IoT TID 认证流程
本节主要介绍 IoT TID 认证过程中的逻辑流程。
![TID 认证流程](https://main.qcloudimg.com/raw/29b7cad79f4a2b8fae6f073a1ab984a7.png)

1. 设备端通过 SDK 获取认证数据流。
2. 设备端将认证数据流传输至用户服务器。
3. 用户服务器通过服务端 SDK 将认证请求发送至 IoT TID 认证服务器。
4. TID 认证服务器返回认证结果，若认证成功，服务端 SDK 会返回服务端认证数据流和会话 Token。
5. 若服务端 SDK 返回成功，用户服务器需要将服务端认证数据流完整传输至设备端，同时记录会话 Token 用于后续的业务数据加解密。

## IoT TID 通信流程
本节主要介绍 IoT TID 通信过程中的逻辑流程。

### 设备端数据上行
![设备端数据上行](https://main.qcloudimg.com/raw/374810bffc18e04a27d50f99f6499c4a.png)
1. 设备端调用 SDK 的对称算法加密接口，传入原始业务数据流和会话 Token，接口会返回加密后的数据流。
2. 设备端将加密后的业务数据流完整传输至用户服务器。
3. 用户服务器调用服务端 SDK 的对称算法解密接口，传入加密后的数据流和会话 Token，接口会返回解密后的数据流。
4. 用户服务器根据解密后的业务数据流处理业务流程。

### 服务端数据下行
![服务端数据下行](https://main.qcloudimg.com/raw/6c24e70d1c3ef7290b67c822a4610428.png)
1. 用户服务器调用服务端 SDK 的对称算法加密接口，传入原始业务数据流和会话 Token，接口将返回加密后的数据流。
2. 用户服务器将加密后的业务数据流完整传输至设备端。
3. 设备端调用 SDK 的对称算法解密接口，传入加密后的数据流和会话 Token，接口将返回解密后的数据流。
4. 设备端根据解密后的业务数据流处理业务流程。
