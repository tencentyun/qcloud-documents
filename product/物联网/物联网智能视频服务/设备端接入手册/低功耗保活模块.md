

低功耗设备使用低功耗保活模块，使设备在主控断电或深度睡眠后自主维持保活连接。

## 功能介绍

低功耗保活模块提供设备进入低功耗保活的前置工作，通过调用该模块会使设备发起和保活服务器的保活连接，建立保活链路。通过将链路复制到硬件保活模块，使其在后续主控断电或深度睡眠后依然维持和服务器的保活链路。

## 流程

#### 进入保活

调用进入低功耗保活接口 > 设备硬件保活模块进入低功耗保活 > 主控断电。

#### 唤醒（无 SDK 软件参与，硬件保活模块完成）

远端下发唤醒指令 > 服务器发送唤醒码 > 硬件保活模块 > 输出唤醒信号 > 唤醒主控。

## 接口参考

低功耗保活模块提供以下接口：
- iv_go_keep_alive_use_hi1131：进入低功耗保活
- iv_exit_keep_alive_use_hi1131：退出低功耗保活

#### iv_go_keep_alive_use_hi1131

**接口描述**
建立低功耗保活链路，设置硬件保活模块进入低功耗保活，如果返回错误则需要检查错误并处理后重试。调用该接口需要保证网络可用，模块正常。
```
int iv_go_keep_alive_use_hi1131(void);
```

**参数说明**

| 参数名称 | 输入/输出 |
| -------- |--------- |
| void     | 输入      |

**返回值**

| 返回值                       | 描述/处理                          |
| ---------------------------- | ---------------------------------- |
| IV_ERR_NONE                  | 成功                               |
| IV_ERR_KA_NO_SERVER_FOUND    | 失败，检查设备上线，网络顺畅       |
| IV_ERR_KA_CREATE_LINK_FAIL   | 失败，检查服务器服务是否可用       |
| IV_ERR_KA_SET_WIFI_DATA_FAIL | 失败，检查硬件保活模块是否工作正常 |

#### iv_exit_keep_alive_use_hi1131

**接口描述**
退出保活模块。调用该接口将使硬件保活模块退出保活状态，如果此前低功耗保活状态进入失败，则调用该接口会关闭已建立的保活链路。

```
int iv_exit_keep_alive_use_hi1131(void);
```

**参数说明**

| 参数名称 |  输入/输出 |
| --------- | --------- |
| void     |  输入      |

**返回值**

| 返回值                       | 描述/处理                          |
| ---------------------------- | ---------------------------------- |
| IV_ERR_NONE                  | 成功                               |
| IV_ERR_KA_SET_WIFI_DATA_FAIL | 失败，检查硬件保活模块是否工作正常 |

## 示例代码

```c
while(1)
{
    static int cnt = 0;
    if(cnt++ >= 1)
    {
        iv_go_keep_alive_use_hi1131();
    }
    else if(cnt >= 2)
    {
        iv_exit_keep_alive_use_hi1131();
        cnt = 0;
    }
    sleep(10);
}
```

