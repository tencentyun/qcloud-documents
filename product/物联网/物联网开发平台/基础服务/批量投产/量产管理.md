## 操作场景
当设备基于物联网开发平台完成开发并测试通过后，设备会进入量产阶段。待产品发布完成后，用户需要生成设备证书，烧录到设备中进行量产。

量产阶段一般至少会经过以下三个环节：
1. 设备所有者在 IoT Explorer 批量生成设备的关键信息（DeviceName、DeviceSecret）。
2. 设备所有者将生成的设备关键信息分发到授权设备厂家进行烧录。
3. 设备厂家按设备所有者的测试要求进行产测，产测通过的设备进行包装和交付，产测不通过的设备则不会包装、交付，需进一步分析产测不通过的原因。

## 前提条件
- 产品已完成前序开发步骤，产品已发布，进入批量投产环节。
- 设备的实际生成环境，已具备量产的资质条件。

## 量产步骤
1. 登录 [物联网开发平台](https://console.cloud.tencent.com/iotexplorer) ，选择【公共实例】或您购买的【标准企业实例】进入项目列表页面。
2. 选择具体的项目进入，单击【设备量产】>【量产管理】，即可查看当前量产的产品记录。
>?首次进入量产管理，若无数据，则会在列表区域显示“暂无量产记录，请单击创建量产”。
3. 单击【创建量产】，则需要用户填写具体的产品信息和量产烧录方式。
 - **量产产品**：从下拉框选择已经发布的产品，会自动获取产品 ID。
 - **烧录方式**：可以选择一机一密和一型一密两种烧录方式，详情请参见 [选择烧录方式](#slfs)。
 - **生产方式**：
    - 对于一机一密烧录方式可以选择系统自动随机生成唯一的 DeviceName 和 DeviceSecret， 或者自主上传文件作为 DeviceName 并生成对应的 DeviceSecret。
    - 对于一型一密可以选择自主上传文件作为 DeviceName 并生成对应的 DeviceSecret。
 - **量产数量**：最多一次性量产10000个设备。
 - **一机一密二维码**：根据需求自行选择。
![](https://main.qcloudimg.com/raw/2844eeda8b8c1b3be477c9847aff4a66.jpg)
3. 选择好烧录方式后，单击【确定】，后台会对批量任务进行处理。
4. 当后台审核处理完量产任务，则会显示量产信息，提供下载批量设备信息用于厂家烧录。


<span id="slfs"></span>
## 选择烧录方式
烧录方式分为一机一密（直接烧录）和一型一密（动态注册），一机一密又称为直接烧录，直接烧录的量产流程一般是自己生产、制造、烧录设备的企业使用，DeviceName 与 DeviceSecret 关键信息不会透露给外部合作伙伴，降低了关键信息在分发阶段转手风险。

| 功能项 | 直接烧录 | 动态注册 |
|---------|---------|---------|
| 设备烧录信息 | 设备证书，即：ProductID、DeviceName、DeviceSecret |设备证书，即： ProductID、ProductSecret、DeviceName（设备名称，一般为设备本身的 MAC 地址、SN 等） |
| 生成方式| 自动生成和上传文件 | 上传文件 |
| 量产数量 | 单产品下10000个设备| 单产品下10000个设备|
|安全性 | 较高| 较低 |
| 默认开启 | 是 | 控制台人工开启 |

### 一机一密（直接烧录）
 直接烧录的流程也分两种
- 第一种：系统自动生成一批 DeviceName 与 DeviceSecret。
- 第二种：设备所有者上传产品序列号作为 DeviceName，然后系统根据上传的序列号生成与之一一对应的 DeviceSecret。

#### 系统自动生成 DeviceName 与 DeviceSecret
1. 设备所有者选择【一机一密】直接烧录。
2. 设备所有者选择批量生成的设备数量。
3. 后台根据设备数量自动生成唯一的 DeviceName 与 DeviceSecret。
4. 后台通过下载 CSV 文件的方式输出生成的设备信息。
5. 设备所有者下载文件后可进行具体生成过程中的烧录过程。

#### 系统根据用户导入的 DeviceName，生成配对的 DeviceSecret
1. 设备所有者选择【一机一密】直接烧录。
2. 设备所有者选择文件上传方式，并导入预先准备好的文件。
3. 后台根据上传文件中第一列的数据作为 DeviceName，并自动生成对应的 DeviceSecret。
4. 后台通过下载 CSV 文件的方式输出生成的设备信息。
5. 设备所有者下载文件后可进行具体生成过程中的烧录过程。
![](https://main.qcloudimg.com/raw/6d85cda4748278c0c555fee99a4b2c2c.png)

### 一型一密（设备动态注册）
设备动态注册的目的是在分发阶段不会提供 DeviceSecret，只会提供 ProductID、ProductSecret、DeviceName。设备在产测环节，会根据 ProductID、ProductSecret、DeviceName 去云端动态获取对应的 DeviceSecret，设备端收到后将存储该 DeviceSecret，然后发起设备正常的登录流程。可应用于需要将设备密钥信息分发多次的场景。

#### 控制台操作流程
1. 设备所有者选择【一型一密】动态注册的烧录方式。
2. 设备所有者选择文件上传方式，并导入预先准备好的文件。
3. 后台根据上传文件中第一列的数据作为 DeviceName。
4. 系统为选择“动态注册”的产品输出产品 Secret 参数。
5. 设备所有者将 ProductID、ProductSecret 和 DeviceName 列表文件分发至设备生产厂家。
![](https://main.qcloudimg.com/raw/226295e6ab6429ba01df3eb94ac8f9ed.png)

#### 补充说明
厂家烧录产测环节设备上线动态获取密钥的流程如下：
1. 设备生产厂家将获取到设备所有者分发的数据进行烧录。
2. 烧录完成后进行产测。
3. 设备上电后，固件程序检查本地无 DeviceSecret，则通过设备 SDK 封装好的接口送入产品 ID、产品密钥、 DeviceName，SDK 将向云端获取 DeviceSecret。
 1. 首先对请求合法性进行签名校验。
 2. 其次检查 DeviceName 是否已在云端存在。
    - 若不存在，则注册失败，产测也失败。
    - 若设备存在，则云端将为该 DeviceName 返回一个加密后的 DeviceSecret。
4. 设备端收到 DeviceSecret 后，进行解密并存储在本地。
5. 设备端通过动态获取的 DeviceSecret，向云端发起 MQTT 登录请求。
6. 登录成功，则表示产测的第一步通过。


 




