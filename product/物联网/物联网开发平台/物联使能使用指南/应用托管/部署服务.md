
本文为您介绍如何在物联网应用托管平台部署服务。
## 前提条件
已完成 [服务创建](https://cloud.tencent.com/document/product/1081/50044)。

<span id="test"></span>
## 步骤一：版本配置
1. 登录 [物联网开发平台](https://console.cloud.tencent.com/iotexplorer) ，单击项目进入项目详情页面。
2. 单击【物联使能】>【应用服务】，选择应用，再单击【应用托管】进入应用托管页，在已新建的服务中选择您需要部署的服务，单击服务名称进入服务详情页面。
>?一个服务可同时存在最多10个版本。
>
<img src="https://main.qcloudimg.com/raw/66ee697e5f732f918f234505707480f5.png" style="width: 650px;"></img>
3. 单击【新建版本】，在弹出的新建版本配置框中，基础配置选项如下说明：
<img src="https://main.qcloudimg.com/raw/cf38b865313f6d45e39c6441c3166a36.jpg" style="width: 650px;"></img>
 - **镜像**：由您自行采用任意方式进行镜像构建后，手动将镜像上传至服务所绑定的镜像仓库中，然后系统基于您选定的镜像进行部署。若无所需镜像版本，可单击【查看上传指引】上传镜像。
 - **服务端口**：应用监听端口，默认为80。
 - **流量策略**：选择是否开启100%流量。若不开启，此版本发布后将没有流量访问。
  >? 部署完成后，如何开启流量。目前有如下两种选择：
  >
  > - 部署完成后保持流量为0稍后再手动调整流量：希望部署完成后先手动验证再开流量，或只希望引入部分流量进行灰度升级。部署完成后，会先按副本个数的最小值创建出对应数量的实例并保持，等您手动配置流量后实例个数将根据扩缩容条件变化。若您将副本个数最小值设为0，此时将不会创建实例。
  > - 部署完成后自动开启100%流量：首次部署完成后立刻开流量。部署完成后立刻开始创建实例并开始自动扩缩容。
 - **版本描述**：不超过50个字符，您可以根据需要选填。



## 步骤二：托管配置 

1. 完成 [步骤一](#test) 配置后，单击【下一步】可进入托管配置。
<img src="https://main.qcloudimg.com/raw/481f1751b34c3ef7cf5427a1e1046de8.png" style="width: 650px;"></img>
 - **资源规格**：指集群中每个容器实例的配置。自动扩容时，新创建的实例将使用这个规格。默认值为0.5核1G。
 - **副本个数**：当前服务版本在自动扩缩容时可达到的最大实例数及最小实例数。最小值下限为0，最大值上限为50。默认最小值为1，最大值为50。
    >?
    >- 若将副本个数最小值设定为0，版本上线后连续一个小时无流量才将实际缩容到0。再次冷启动时，可能有30秒服务延迟。请谨慎选择。
    >- 若副本个数最小值不为0，即便业务无任何流量，仍然会有实例在运行并产生费用，但好处是可保持服务常驻无冷启动影响。
    >- 自动扩容到最大实例数后若仍不足以承载业务流量，即便再次达到扩缩容条件，也不会继续创建新的实例，可能导致您的业务受影响，请您评估好业务指标后合理设定最大实例数。
   - **扩缩容条件**：当达到某个条件时，应用托管会自动会创建/删除一个实例，冷却 15 秒后，检测是否再次达到条件，如果满足条件则继续扩缩容，如此反复直至实例数量达到副本个数的最小值/最大值，或不再满足扩缩容条件时停止自动扩缩容。目前仅支持 CPU 使用率作为扩缩容条件，即当前实例 CPU 使用率超过设定值后，若实例数小于最大副本个数，则创建出一个新的实例。默认值为 60%。
 - **日志采集路径**：可设置目录或文件，支持设置多个路径。默认路径为 stdout。
 - **InitialDelaySeconds**：实例创建完成后，等待一定的时间后开始进行健康检查。若健康检查失败，将重试 3 次，依然失败则判定服务版本异常。请将此值设定为大于应用启动的时间，否则版本可能持续处于异常状态。默认值为 2 秒。
 - **环境变量**：用户所需的环境变量，以 key value 的形式可配置多个环境变量，支持导入。
2. 单击【开始部署】，若部署成功则状态变为“正常”。若有报错，会变为具体的错误状态。
<img src="https://main.qcloudimg.com/raw/94782c0b9ee47b80b928c5e31f39abfc.png" style="width: 718px;"></img>
服务部署状态说明如下：
 - 正常：版本部署成功后的状态。
 - 部署失败：版本部署失败后的状态，单击“部署失败”可查看详细的错误日志。
 - 创建中：版本部署中的状态。
 - 版本调整中：账户欠费停机状态下，充值后版本调整恢复中的状态。


## 使用限制

- 版本名由系统自动生成，格式为“服务名”+“序号”，序号按照创建顺序依次递增，不支持修改（例如：testservice-001，testservice-002 等）。
- 不再使用的版本可以手动删除，已删除的版本不计入版本总数，但不会影响新建版本的序号。(例如：删除掉版本 "testservice-002"，再次新建的版本仍然会是 "testservice-003"。）
