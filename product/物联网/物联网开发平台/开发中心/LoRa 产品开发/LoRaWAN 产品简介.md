## 网络架构
![腾讯云 LoRaWAN 网络架构](https://main.qcloudimg.com/raw/e0d2a0b1a64317b95c9aacd1b2173a4c.png)

## 频谱策略	
请参考工信部于2019/11/28发布的微功率技术要求[《微功率短距离无线电发射设备目录和技术要求》公告](https://www.miit.gov.cn/n1146285/n1146352/n3054355/n3057735/n6161863/c6513390/part/6513417.pdf) 第四节民用计量仪表的使用要求，具体要求如下：
>（四）民用计量仪表 
>用于电力、热力、水务、燃气等公用计量业务。在建筑楼宇、住宅小区及村庄等小范围内组网应用，任意时刻限单个信道工作。
>民用计量仪表设备应当具备“发射前搜寻”等干扰规避功能，且不能被用户调整或关闭。 
>若使用频率与当地声音、电视广播电台频率相同时，不得在当地使用；若对当地声音、电视广播接收产生干扰时，应立即停止使用，待消除干扰或调整到无干扰频率后方可重新使用。
>1. 使用频率：470-510MHz。
>2. 发射功率限值：50mW(e.r.p)。
>3. 发射功率谱密度限值：占用带宽小于等于200kHz的,为50mW/200kHz(e.r.p) ; 占用带宽200-500kHz的，为10mW/100kHz(e.r.p)。
>4. 单次发射持续时间：不超过1秒。 
>5. 占用带宽：不大于500kHz。 
>6. 频率容限：100 × 10<sup>-6</sup>。 
### 注意事项
基于上述要求，使用 LoRaWAN 时应注意以下几点：
1. 单终端及网关设备，不能同时使用两个及以上信道发送数据，但接收数据可以。
2. 发送功率加上天线的增益不能超过 17dBm，即 50mw。
3. 单次发送数据的空中时长 ToA 应不超过1s，根据 semtech 官方提供的 [计算公式](https://semtech.my.salesforce.com/sfc/p/#E0000000JelG/a/2R000000Q2OJ/Ez25zbF836YSS7KLnl80hd2HKMhA6l1QVPUIR.baDW8) 计算 ToA。

## 应用特征
LoRaWAN 并不适用每一种通信应用场景，使用者应根据 LoRaWAN 的特点来适配应用场景。
### 适用场景
- 长距离：根据不同的遮挡环境，可以覆盖几公里到几百公里，一般视距可达 10Km。
- 低功耗：典型场景下使用电池供电可以工作数年的时间。
- 低成本：通信模组成本可控制在 40RMB 以下，随着时间增长，成本会逐步降低。
- 低带宽：通信速率 250bits 到 5Kbits 不同的调制方式下均适用（SF7 到 SF12）。
- 按需部署：不需要依赖运营商的基站，可根据应用需求灵活部署网关。
- 安全：端到端 128位 AES 加密。

### 不适用场景
- 实时数据：按秒为单位实时的上传应用数据的场景。
- 语音通信。
- 实时及高并发的下行控制场景。
- 大带宽：大数据包传输场景，LoRaWAN 物理层单个数据帧仅支持 242 字节传输。

## 关键功能及参数
### 工作模式
<dx-tabs>
::: Class\sA
双向传输终端（**Class A**）：Class A 的终端在每次上行后都会紧跟两个短暂的下行接收窗口，以此实现双向传输。终端基于自身通信需求来安排传输时隙，在随机时间的基础上具有较小的变化（即 ALOHA 协议）。Class A 操作为应用提供了最低功耗的终端系统，只要求应用在终端上行传输后的很短时间内进行服务器的下行传输，服务器在其他任何时间进行的下行传输都需要等终端的下一次上行。
:::
::: Class\sB
划定接收时隙的双向传输终端（**Class B**）：Class B 的终端有更多的接收时隙。除了 Class A 的随机接收窗口，Class B 设备还会在指定时间打开其他的接收窗口。为了让终端可以在指定时间打开接收窗口，终端需要从网关接收时间同步的信标（Beacon），使服务器知晓终端何时处于监听状态。
:::
::: Class\sC
最大化接收时隙的双向传输终端（**Class C**）：Class C 的终端基本处于一直打开接收窗口的状态，只在发送时短暂关闭。Class C 的终端会比 Class A 和 Class B 更加耗电，但同时从服务器下发给终端的时延也是最短的。
:::
</dx-tabs>

>!目前腾讯 LoRaServer 支持 Class A、Class C 两种模式，Class B 暂未支持。

### 标识符

| 标识符     | 说明                                                   |
| ---------- | ------------------------------------------------------ |
| DevEUI     | 64位设备终端标识符，设备唯一。                         |
| DevAddr    | 32位设备地址，设备非唯一。                             |
| AppEUI     | 应用标识符，目前腾讯 LoRaServer 未对 AppEUI 标识限制。 |
| GatewayEUI | 网关标识符，设备唯一。                                 |
| NetID      | 腾讯使用 LoRaWAN 联盟分配地址前缀0x35（十进制53）。       |

### 网络接入模式
<dx-tabs>
::: 空中激活\sOTAA
空中激活 OTAA 是目前推荐的连接方式，安全性更高，通过网络执行入网的过程，动态地生产会话密钥及 DevAddr。
:::
::: 本地激活\sABP
本地激活 ABP 接入网络的方式更为简单直接，无需入网流程，通过本地预存的会话密钥进行加解密，但存在一些安全性的问题如重放攻击，因此不推荐使用。
:::
</dx-tabs>

>!目前腾讯 LoRaServer 支持 OTAA、ABP 两种网络接入模式，用户需要妥善维护设备的密钥信息。

### 物理调制方式及速率
#### 物理调制方式
基于 Chirp 扩频技术，LoRaWAN 使用 LoRa 的调制方式，即使在低功率下，也有很好的抗干扰特性，且多径衰弱及多普勒效应对 LoRaWAN 的影响也非常小。LoRaWAN 的速率取决于使用的带宽及扩频因子，目前在中国区可以使用125Khz带宽，SF7到SF12等6种速率，设备端决定使用扩频因子，不同的扩频因子极大的影响传输数据所需的时间和功耗。
>!在信号强度满足传输的条件下，请尽可能使用较高速率的扩频因子，以减少设备使用功耗，增加电池使用寿命及增加网关接入设备数量。

#### 自适应速率 ADR
自适应速率 ADR 是一种用于优化网络速率、传输时间和功耗的机制，设备终端具有足够的稳定的信号强度下，需要启用 ADR。
- 静态终端：当设备长期处于静态状态，例如水表，此时 RF 环境相对稳定，应启用 ADR 功能，确保设备在合适的速率下运行。
- 移动终端：当设备处于移动的状态，例如包裹跟踪定位器，则在移动的状态下应禁用 ADR，使用固定的速率发送数据，确保数据能够被稳定的接收，当设备检测到设备处于静止的状态，应在此期间开启 ADR。

>!终端决定是否使用 ADR 功能，并非由网络或者应用来确定。ADR 开启期间，网络会根据最近多个数据包信号及丢包状态给出合适的速率建议。
