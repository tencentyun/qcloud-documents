## 操作场景

为了满足开发者能够通过数据开发处的规则配置，实时推送平台侧定义的告警消息到开发者服务器，从而实现消息推送到自主品牌小程序或自主品牌公众号内，平台为开发者提供了自定义推送功能。


## 新建数据流

1. 登录 [物联网开发平台](https://console.cloud.tencent.com/iotexplorer) ，选择【公共实例】或者您购买的【标准企业实例】进入项目列表页。
2. 选择某一项目进入项目详情页面，单击左侧菜单【数据开发】。
3. 进入数据开发列表页面，单击【新建数据流】。
   ![](https://main.qcloudimg.com/raw/70a877bf9956f7a84a8f104bae31aff5.png)
 - **数据流名称**：输入数据流处理的名称标识。
  - **描述**：输入该数据流处理的备注信息。  
4. 单击【保存】，保存成功后则显示数据流列表页。

## 数据流编排

### 设备数据编排

1. 单击数据流列表页中的“数据流名称”，进入数据流编排页面。
2. 鼠标长按左键拖动左侧输入区域中的【设备数据】节点，放置到画布区域。
3. 单击已拖放的【设备数据】节点，界面右侧显示该节点的配置内容。
![](https://main.qcloudimg.com/raw/286ab74e0ff254edca34c8b19ee98c31.png)
 - 节点名称：该【设备数据】的节点名称，默认为“设备数据”可修改。
 - 选择产品：下拉选择该项目下的某个产品后，平台则对该产品下所有设备上报的数据进行实时处理。
 - 属性：用户可根据需要选择该产品下哪些属性作为数据的输入
4. 单击【保存】即可完成数据配置。


### 数据过滤编排

1. 鼠标长按左键拖动左侧处理区域中的【数据过滤】节点，放置到画布区域。
2. 单击已拖放的【数据过滤】节点，界面右侧显示该节点的配置内容。
3. 在配置“数据过滤”前，必须要指定数据源，即需要将“设备数据”与“数据过滤”两个节点连接起来。
   ![image](https://main.qcloudimg.com/raw/00ff20688400e9739b5c957ba81a2a73.png)
4. 数据过滤目前支持与、或逻辑组合，可根据上一个节点的输出任意组合过滤条件。
5. 选择添加条件，如设置某个值大于80，表示数据流将不符合该规则的数据都丢弃，只有将符合规则的数据留到下一个节点处理。


### 数据推送

数据推送分为公众号推送、App 推送和自定义推送等多种数据输出方式，以下为您说明公众号和自定义两种推送方式。

#### 公众号推送
1. 鼠标长按左键拖动左侧输出区域中的【公众号推送】节点，放置到画布区域。
2. 单击已拖放的【公众号推送】节点，界面右侧显示该节点的配置内容。
3. 在配置“自定义推送”前，必须要指定数据源，即需要将“自定义推送”与“数据过滤”两个节点连接起来。
![](https://main.qcloudimg.com/raw/3e607f858d43fbb651d5608cb2f9308c.jpg)
4. 输入推送标题以及推送内容并单击【确定】。

#### 自定义推送

1. 鼠标长按左键拖动左侧输出区域中的【自定义推送】节点，放置到画布区域。
2. 单击已拖放的【自定义推送】节点，界面右侧显示该节点的配置内容。
3. 在配置“自定义推送”前，必须要指定数据源，即需要将“自定义推送”与“数据过滤”两个节点连接起来。
   ![image](https://main.qcloudimg.com/raw/656aea281b527fd177ec654714c5a74b.png)
4. 输入推送标题以及推送内容。
5. 输入接受告警推送消息的服务器地址和鉴权 Token 并单击【确定】

>?为了您后台稳定使用，请填写鉴权 Token。您可以任意填写 Token，用作生成签名（该 Token 会和接口 URL 中包含的 Token 进行比对，从而验证安全性）。
>

### 推送到相关平台

1. 平台侧推送到服务端的告警内容消息模板如下。
```
{
	 	"RequestId": "推送请求Id",
	 	"ProductId": "产品ID",
	 	"DeviceName": "设备名称",
		 "MsgTitle": "推送标题",
		 "MsgContent": "推送内容"
}
```
2. 若需要推送到自主品牌公众号，请参见微信公众号官方文档-[通过模板消息推送](https://developers.weixin.qq.com/doc/offiaccount/Message_Management/Template_Message_Interface.html#2)。
3. 若需要推送到自主品牌小程序或 App 的告警消息，开发者可自行根据业务逻辑实现。


### 保存与启用数据流

1. 用户设置完输入、处理与输出节点的规则后，需要单击【保存】或【启用】。
2. 当启用数据流后，只要该设备上报的数据符合定义的规则，则会触发公众号推送。
3. 在官方小程序“腾讯连连”的【消息推送设置】中，启动公众号消息推送，即可收到消息推送。
   ![image](https://main.qcloudimg.com/raw/e00f033ff03e574fd40140f5fe018621.png)

### 禁用数据流

1. 当用户需要停止某个数据流服务时，进入数据开发页面查看对应的数据流列表。
2. 单击生效状态列下的【关闭】，系统弹出确认提示，单击【禁用】表示停止该数据流服务，系统将不会再实时处理。
   ![image](https://main.qcloudimg.com/raw/51e8366f0a90e4abf8dfd449d3245d2d.png)

