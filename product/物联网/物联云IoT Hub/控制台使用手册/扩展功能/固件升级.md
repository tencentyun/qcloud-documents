## 操作场景

本文档主要介绍固件升级在物联网通信的使用方法，帮助您快速使用固件升级服务。

## 操作步骤

### 添加固件
1. 登录 [物联网通信控制台](https://console.cloud.tencent.com/iothub)，单击左侧导航【固件升级】进入固件列表页，可查看当前项目中的全部固件。
2. 单击【添加固件】添加新固件。
<img src="https://main.qcloudimg.com/raw/cde344f4d54f4a007bd3b4af7ebffddb.png" style="width:80%"></img>
 - 固件名称：支持中文、英文大小写、数字、部分常用符号（下划线，减号，括弧），必须以中文、英文或数字开头，长度不超过32个字符。
 - 所属产品：选择上传固件所属的产品。
 - 固件版本号：仅支持英文字母、数字、点、中划线和下划线，长度限制1 - 32字符。
 - 选择固件：上传的固件文件必须为 bin 文件或 tar/gz/zip 包，上传的固件文件大小不能超过1024MB。
 - 固件描述：对本次上传的固件进行描述和记录，长度限制0 - 100字符。
 - 一个账号下最多可上传100个固件 ，若继续上传，则需要删除旧版本固件。
3. 上传完成后，固件将显示在列表中，可对固件进行升级、增删查改、查看详情等操作。


### 固件升级

选择想要升级到的目标固件版本，单击固件列表右侧的【固件升级】发起升级任务。固件升级方式支持按固件版本号升级和按设备名称升级两种批量升级方式。
![](https://main.qcloudimg.com/raw/8dbc951ce179f8236a72b8599d85e764.png)

#### 按固件版本号升级
1. 进入固件升级页，页面展示目标升级固件的信息（例如固件名称、所属产品、固件版本号等）。
2. 选择【批量升级方式】为“按固件版本”升级。
<img src="https://main.qcloudimg.com/raw/43e06ec0fc0d967836ebd7213c7d87c9.png" style="width:80%"></img>
 - 待升级版本号：选择下拉框中的固件版本号作为等待被升级的固件，可多选。
 - 升级范围：支持两种升级范围，可将待升级版本号下的全部设备或者指定设备作为固件升级目标设备。指定设备升级功能常用于灰度验证固件内容。选择升级范围为指定设备时，单击下拉框右侧的【选择设备】，可以从该产品下全部设备中批量勾选目标升级设备。
<img src="https://main.qcloudimg.com/raw/ae204f27c52dd884ef79e59324d92713.png" style="width:80%"></img>
3. 单击【保存】后，系统将会执行升级任务，下发所选的目标版本固件到升级范围内的目标设备中。

>?按固件版本升级需要待升级设备上报当前运行的固件版本，如未上传您可选择下文介绍的按设备名称升级。



#### 按设备名称升级 

1. 进入固件升级页，页面展示目标升级固件的信息（例如固件名称、所属产品、固件版本号等）。
2. 选择【批量升级方式】为“按设备名称”升级。
<img src="https://main.qcloudimg.com/raw/3afad15358878879fc4bfe4c65235cac.png" style="width:80%"></img>
3. 上传需要升级固件的指定设备清单。单击【下载模板】得到模板文件，并在模板文件中录入准确的 DeviceName 后单击【上传文件】进行上传。一次最多可升级10000个设备，文件仅支持 csv 格式。
4. 单击【保存】后，系统将会执行升级任务，下发固件到目标设备中。



### 查看固件详情

1. 在固件列表单击固件列表右侧的【查看详情】查看固件详情。
   ![](https://main.qcloudimg.com/raw/3e1a5ef492c2912d017d52d4667a494d.png)
2. 进入固件详情页，可查看该固件的详细信息、固件升级设备统计和升级任务管理列表。
![](https://main.qcloudimg.com/raw/2f59f51506e1018488b6d691e5fb125c.png)
 - 固件信息：包括固件名称、所属产品、固件版本号、固件签名、签名算法、添加时间与固件描述等。点击右上角的编辑按钮，可修改固件名称与描述。
 - 固件升级设备统计：包括对该固件全部批量升级任务中的设备总数，以及不同升级状态的固件升级任务对应的设备数量。
 - 任务管理列表：
    - 单击【任务明细】，可查看该固件的全部升级任务。升级任务的任务状态包含4种：未开始、创建中、创建成功、创建失败。
![](https://main.qcloudimg.com/raw/c722c07dad995570f3a763f08f23fe68.png)
    - 单击【设备明细】，可查看该固件关联的所有升级任务中设备升级的记录明细。设备升级状态包含5种：待推送、已推送、升级中、升级成功和升级失败。
![](https://main.qcloudimg.com/raw/ffba69e4830cd2d1ef9d948373bec1eb.png)
3. 在任务管理的【任务明细】或【设备明细】，单击某次任务右侧的【查看详情】，进入任务详情页，可以查看此次任务升级的设备清单、升级状态以及不同升级状态的设备数量统计。 
   ![](https://main.qcloudimg.com/raw/49987e61d8e87f2229ae7b806ddb11b7.png)

在设备详情列表，可查看该任务批量升级的所有设备当前的升级状态和状态详情。当升级状态为“待推送”和“已推送”时，不显示状态详情；当升级状态为“升级中”，状态详情则包含：下载中、烧录中，同时显示百分比进度；当升级状态为“升级失败”，状态详情将反馈错误信息。

另外，在设备详情列表右侧，可以根据升级进度进行设备升级的取消、重试操作。取消升级的设备升级状态将标记为升级失败；升级失败的设备可单击【重试】进行重新升级。

