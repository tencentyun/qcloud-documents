## 摄像头注册不成功

摄像头注册不成功请按照如下步骤排查：

1. 检查摄像头所处的网络，是否能够连通 SIP 服务器的 IP 跟端口。
2. 检查摄像头所处的网络是否有防火墙，是否允许 TCP/UDP 包的收发。
3. 检查摄像头是否启用了国标28181的支持。
4. 检查摄像头里面的配置（注意不是控制台里有关摄像头的配置），查看 SIP 服务器的国标 ID 跟 SIP 服务器的 IP 跟端口是否正确。
5. 检查是否配置了 SIP 域，如果配置了请确保 SIP 域为 SIP 服务器 ID 的前10位数字。
6. 检查摄像头的用户名密码是否与控制台输入的匹配。

## 摄像头国标注册配置信息不正确

摄像头在国标注册前要在自己的管理页面上进行国标接入配置，需检查以下信息是否正确：

- 在 GB/T28181 的配置页面，“启用”框须勾选上。
- 检查“SIP 服务器ID”是否为腾讯云视频监控产品提供的国标 ID。
- 检查“SIP 服务器地址”和 “SIP 服务器端口”是否为腾讯云视频监控产品提供的 SIP 服务器地址和端口。
- 检查协议版本是否为“GB/T28181-2016”。
- 配置为基于 TCP 协议采用 PS 封装的视音频媒体传输。

## 摄像头推流不成功

摄像头在注册成功之后推流不成功，请按如下步骤排查：

1. 检查控制台里面摄像头是否处于在线状态，如果没有，请检查摄像头及所在的网络环境是否正常。
2. 检查摄像头所在网络是否能够访问腾讯云视频监控接入结点的 IP 和端口，腾讯云视频监控的国标收流端口（以上 IP 和端口信息在国标注册交互过程中可获取）。
3. 检查摄像头的工作模式是否为 Active，即摄像头需要主动 TCP 连接到腾讯云服务器的端口并推流。
4. 摄像头推流不支持 UDP 的方式。

## 摄像头视频中断

摄像头视频经常中断原因排查：

1. 是否没有配置录制模板，导致视频无人观看而被挂断（目前视频180s无人观看会被挂断）。
2. 摄像头带宽是否足够，如带宽不够导致数据发送异常，也会被挂断（腾讯云后台连续15s没有收到摄像头音视频数据）。
3. 摄像头的 IP 是否发生变化，导致 TCP 连接断开。

## 摄像头视频流卡顿

摄像头在推流成功之后，视频流比较卡顿，请按如下步骤排查：

1. 检查摄像头里面的配置，查看当前摄像头推送的码流，因为摄像头是公网接入，请根据摄像头的实际网络情况选择合适码率的视频流。
2. 请检查播放所在的网络带宽是否满足摄像头的码率。

参考表格：

| 视频格式 | 视频分辨率  | 对应像素 | 推荐单路传输带宽 | 一天使用硬盘大小 |
| -------- | ----------- | -------- | ---------------- | ---------------- |
| CIF      | 352 × 288   | 10万     | 512Kbps          | 5.3GB            |
| D1       | 704 × 576   | 40万     | 1.5Mbps          | 16GB             |
| 720P     | 1280 × 760  | 100万    | 2Mbps            | 21GB             |
| 960P     | 1280 × 960  | 130万    | 3Mbps            | 32GB             |
| 1080P    | 1920 × 1080 | 200万    | 4Mbps            | 42GB             |
| 1536P    | 2048 × 1536 | 300万    | 5Mbps            | 52GB             |
| 4K       | 3840 × 2160 | 800万    | 8Mbps以上        | 84GB             |

一天某一路相机在某一码率下所带入上表的 CIF 的推荐码率为：
3600秒（每小时）× 24（每天）× 码率（kbps） ÷ 8（位转换为字节）÷ 1024（换算成 MB） ÷ 1024（换算成 GB） = 86400 × 512 ÷ 8 ÷ 1024² ≈ 5.3GB

一天一路摄像头某一码率下所需硬盘大小为：
86400s × 码率 ÷ 8 ÷ 1024² =>  **10.546875 × 码率（kbps）** 

## 摄像头 PTZ 控制无反应

1. 若控制时无报错，请确认该摄像头的型号，是否支持 PTZ 功能（或仅支持部分 PTZ 功能）。
2. 若控制时有报错，请检查调用参数或联系客服人员协助排查。

## 国标流接入失败排查步骤

- 检查与腾讯云服务器的网络连接。可以采用 telnet 腾讯云视频监控产品提供的 SIP 服务器地址和端口，或者直接在 NVR 或 IPC 侧抓包的方式检查。
- 检查国标注册是否成功。在 NVR 或 IPC 的国标配置页面上可能有注册成功与否的提示，具体信息请参考厂商手册。
- 检查国标信令交互。抓包查看是否会收到腾讯云侧 SIP 服务器的 INVITE 请求，以及其中是否包含的腾讯云侧媒体服务器地址和端口；NVR 或 IPC 是否回复给腾讯云侧 SIP 服务器 INVITE 请求。
- 检查视频接入是否成功。抓包查看 NVR 或 IPC 是否有数据发送给腾讯云侧媒体服务器地址和端口，以及视频是否采用 PS 封装。

## 常见播放延时情况说明

- 目前已知 VLC 或者 ffplay 等播放器在播放 rtmp 或者 flv 的视频时，默认行为是分析5秒（rtmp）到90秒（以 .flv 作为后缀的 url）数据查找媒体中是否包含音频。在无音频的流中，这一播放器行为会造成起播和播放的视频时间延迟。对于 ffplay，可以加入参数“-analyzeduration 1”来实现秒开。

```
# 秒开播放
ffplay -analyzeduration 1 'http://80.1.1.1:30000/proxy/2a69b*****9ad45.flv'
# 无缓冲模式播放
ffplay -i 'http://80.1.1.1:30000/proxy/2a69b*****9ad45.flv' -fflags nobuffer
```

- 除播放器造成的延时外，视频本身的 GOP 设置也会造成额外的延时。例如，GOP 设为2秒，可能造成小于2秒的延时；如果播放时间点与上一关键桢相差1秒，则会造成1秒的延时。IPC 配置建议参考 [带宽测试与摄像机 GOP 配置](https://cloud.tencent.com/document/product/1361/55476) IPC 设置中的 GOP 设置，设置 GOP 为1s~2s。
