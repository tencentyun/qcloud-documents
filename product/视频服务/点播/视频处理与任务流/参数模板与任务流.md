视频处理操作存在如下几个特点：

- **输入参数众多**：单项视频处理操作可能存在很多输入参数，如果每一次视频处理操作都需要携带所有参数，则接口调用必然十分复杂；例如转码操作，存在数十个控制参数。
- **处理种类多样**：同一个视频可能存在多种不同的处理方式，如果每一种操作都需要独立的接口来调用，则开发者的接入过程必然十分复杂；例如对同一个视频可能需要进行标清、高清、超清三路转码，并进行雪碧图截图。
- **处理流程复杂**：针对同一个视频的不同处理操作之间可能存在依赖关系，如果仅提供原子化的视频处理接口，则开发者需要依赖视频处理回调来进行逻辑判断；例如：依照原始视频的码率决定转码出几路，再如依照鉴黄结果决定是否需要进行转码。

[参数模板](#.E5.8F.82.E6.95.B0.E6.A8.A1.E6.9D.BF)与[任务流](#.E4.BB.BB.E5.8A.A1.E6.B5.81)，正是点播系统针对视频处理以上几个问题给出的解决方案。其中，参数模板解决了第一个问题，任务流则解决了后两个问题。

参数、模板、任务流三者的关系如下图所示：
![参数-模板-任务流](//mc.qcloudimg.com/static/img/06cc3e175e8fce4ae44b68c6fb3173c4/image.png)

## 参数模板

所谓参数模板，是将一种视频处理的众多参数封装到一个模板中（参数容器），同时为该模板赋予一个 ID。在视频处理过程中，可以通过一个模板 ID 代表一组视频处理参数。

点播系统既提供了预置参数模板，同时还允许开发者自定义参数模板，参见：

- [转码模板](/document/product/266/11701#.E8.BD.AC.E7.A0.81.E6.A8.A1.E6.9D.BF)
- [转封装模板](/document/product/266/11701#.E8.A7.86.E9.A2.91.E8.BD.AC.E5.B0.81.E8.A3.85)
- [水印模板](/document/product/266/11701#.E6.B0.B4.E5.8D.B0.E6.A8.A1.E6.9D.BF)
- [转动图模板](/document/product/266/11701#.E8.BD.AC.E5.8A.A8.E5.9B.BE.E6.A8.A1.E6.9D.BF)
- [指定时间点截图模板](/document/product/266/11702#.E6.8C.87.E5.AE.9A.E6.97.B6.E9.97.B4.E7.82.B9.E6.88.AA.E5.9B.BE.E6.A8.A1.E6.9D.BF)
- [采样截图模板](/document/product/266/11702#.E9.87.87.E6.A0.B7.E6.88.AA.E5.9B.BE.E6.A8.A1.E6.9D.BF)
- [雪碧图截图模板](/document/product/266/11702#.E9.9B.AA.E7.A2.A7.E5.9B.BE.E6.88.AA.E5.9B.BE.E6.A8.A1.E6.9D.BF)
- [视频加密模板](/document/product/266/9645)
- [内容审核模板](/document/product/266/17914#.E5.8F.82.E6.95.B0.E6.A8.A1.E6.9D.BF)

## 任务流

参数模板实现了对**单项**视频处理操作的参数封装，而任务流则是在参数模板的基础上，实现了对**一组**视频处理操作的整合。

- 任务流将单个视频的处理过程划分为一系列串行的**阶段**（如下图所示）；
- 每个阶段包含一组**子任务**，每一个子任务只负责一项原子化的视频处理操作，同一阶段内子任务的可以并发执行的。

![任务流各个阶段](//mc.qcloudimg.com/static/img/6319b1a7d78997d4585e86436d6cdcb8/image.png)

### 任务流模板

为了简化任务流使用方式，点播支持将任务流中的子任务封装到模板中，成为任务流模板。开发者可以通过任务流模板名，发起任务流。

点播提供两种类型的任务流模板：**可配置的任务流模板**和**可带参数的任务流模板**，特点如下：

| 模板类型 | 是否支持带参数 | 是否支持自行定义模板 |
| --- | --- | --- |
| 可配置的任务流模板 | 不支持 | 支持，可以便捷地在控制台上新增、修改和删除模板 |
| 可带参数的任务流模板 | 支持 | 不支持，仅提供预置模板供使用 |

#### 可配置的任务流模板
可以在控制台上新增、修改和删除模板，自由指定模板中要做的子任务。
操作方式：登录[控制台任务流模板](https://console.cloud.tencent.com/video/taskflow)，点击【添加】按钮，即可添加自定义的任务流模板。

#### 可带参数的任务流模板
模板支持传递参数（如转码规格、水印规格等），但不支持新增自定义的模板。开发者可以使用点播提供的[预置模板](#预置任务流模板)。

## 使用任务流处理视频

开发者可以对已有视频，或者待上传的视频发起视频处理：

- 处理已有视频
- 在上传视频时，指定视频处理方式，包括：
    - 客户端上传时指定任务流
    - 服务端上传时指定任务流

### 处理已有视频
#### 通过控制台处理已有视频
在控制台的[视频管理](https://console.cloud.tencent.com/video/videolist)菜单中，勾选要处理的视频，并点击【转码】按钮。

【操作类型】一栏选择【任务流】，即可对已有视频发起任务流处理。

#### 通过服务端API处理已有视频

可使用以下两个接口，对已有视频发起任务流：
- 服务端API：[使用任务流处理视频（RunProcedure）](/document/product/266/11030)
- 服务端API：[对视频文件进行处理（ProcessFile）](/document/product/266/9642)

注意：`RunProcedure` 使用任务流模板发起任务流，`ProcessFile`以填写任务流参数的方式发起任务流。

### 处理新生成的视频
#### 客户端上传时指定任务流
* [客户端上传时指定任务流](/document/product/266/9219#.E4.B8.8A.E4.BC.A0.E6.97.B6.E6.8C.87.E5.AE.9A.E8.A7.86.E9.A2.91.E5.A4.84.E7.90.86.E6.96.B9.E5.BC.8F)

#### 服务端上传时指定任务流
* [服务端上传时指定任务流](/document/product/266/9759#.E4.B8.8A.E4.BC.A0.E6.97.B6.E6.8C.87.E5.AE.9A.E6.8C.87.E5.AE.9A.E8.A7.86.E9.A2.91.E5.A4.84.E7.90.86.E6.96.B9.E5.BC.8F)

## 获取任务流执行结果

所谓任务流执行结果，是指各项视频处理操作的输出物，例如转码、截图输出文件的路径，视频鉴黄的结果等。
开发者可以通过如下几种方式获取任务流的执行结果：
1. 通过任务流事件通知感知任务流执行结果（或状态变更）：参见[事件通知](/document/product/266/9636)；
1. 通过状态查询接口获取任务流执行结果：参见[状态查询](/document/product/266/7829#.E4.BB.BB.E5.8A.A1.E7.AE.A1.E7.90.86)；
1. 通过媒资管理接口获取任务流的输出结果：任务流中部分子任务的操作结果会写入媒资系统中，可以通过[服务端API：获取视频信息(GetVideoInfo)](/document/product/266/8586)获取视频的转码、截图等操作的结果。

## 预置任务流模板

### QCVB_SimpleProcessFile
#### 概述
任务流模板名称为 QCVB_SimpleProcessFile，属于**支持可带参数的任务流模板**，模板参数可做几种简单的视频处理操作：
- 视频转码
- 在转码时打水印
- 截取首帧作为视频封面
- 采样截图

#### 参数
该任务流支持四个输入参数，各参数含义分别如下：
<table>
    <tr>
        <th>
            参数
        </th>
        <th>
            说明
        </th>
    </tr>
    <tr>
        <td>
            transcodeDefinition
        </td>
        <td>
            <p>转码控制参数，支持以下几种输入方式：</p>
            <li>使用控制台上配置的默认格式转码：将该参数填写为整数1；</li>
            <li>使用指定转码模板 ID 进行转码：将该参数填写为一个整数数组，数组中的每个元素为目标转码模板 ID；</li>
            <li>不转码：将该值填写为 nil 或者0。</li>
        </td>
    </tr>
    <tr>
        <td>
            watermarkDefinition
        </td>
        <td>
            <p>水印控制参数，支持以下几种输入方式：</p>
            <li>使用控制台配置的默认水印：将该参数填写为整数1；</li>
            <li>使用指定水印模板 ID：将该参数填写为水印 ID（整数）；</li>
            <li>不打水印：将该值填写为 nil 或者0。</li>
        </td>
    </tr>
    <tr>
        <td>
            coverBySnapshotDefinition
        </td>
        <td>
            <p>截取首帧作为封面控制参数，支持以下几种输入方式：</p>
            <li>使用指定时间点截图模板截取首帧，并将其设置为封面：将该参数填写为截图模板 ID（整数）；</li>
            <li>不截取首帧作为封面：将该值填写为nil或者0。</li>
        </td>
    </tr>
    <tr>
        <td>
            sampleSnapshotDefinition
        </td>
        <td>
            <p>采样截图控制参数，支持以下几种输入方式：</p>
            <li>使用采样截图模板进行截图：将该参数填写为采样截图模板 ID（整数）</li>
            <li>不进行采样截图：将该值填写为 nil 或者0。</li>
        </td>
    </tr>
</table>


#### 使用示例
##### 示例 1
使用控制台设置的默认转码、水印格式进行转码：
<pre>
QCVB_SimpleProcessFile(1, 1)
</pre>

##### 示例 2
截取首帧作为封面，使用截图模板10，不进行其他处理：
<pre>
QCVB_SimpleProcessFile(0, 0, 10)
</pre>

##### 示例 3
使用转码模板10，20进行转码；
转码过程使用水印模板150设置水印；
使用截图模板10截取首帧设置封面；
使用采样截图模板10进行采样截图：
<pre>
QCVB_SimpleProcessFile({10, 20}, 150, 10, 10)
</pre>