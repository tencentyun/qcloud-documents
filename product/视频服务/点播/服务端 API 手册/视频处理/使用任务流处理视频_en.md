## API Name
RunProcedure

## Feature Description
The API is used to process a video file based on specified process parameters. The main processes include transcoding, creating image sprites, screenshots and so on. For more information on specific process parameters, contact Tencent Cloud VOD.
The video to be processed can be directly specified or be generated according to a certain process, such as, videos generated by clipping and stitching multiple files or by pulling another video file.
This asynchronous API is called only to initiate a series of video processing tasks. Task status changes (including end of tasks) in the task flow can be perceived via the [Event Notification](#.E4.BA.8B.E4.BB.B6.E9.80.9A.E7.9F.A5) mechanism.

After a task is completed, the execution result (e.g. URL of the transcoded output file) of each asynchronous task can be obtained through API [GetVideoInfo](https://cloud.tencent.com/document/product/266/8586).
*This API is only supported for VOD 4.0.*

## Event Notification

Task status changes (or end of tasks) in the task flow will trigger [Event Notification-Notification for Task Flow Status Changes](https://cloud.tencent.com/document/product/266/9636). The backend of app can monitor the execution status of task flow according to this.

For more information, please see [Server Event Notification Introduction](https://cloud.tencent.com/document/product/266/7829).

## Request Method

### Request Domain
vod.api.qcloud.com

### Max Calling Frequency
100/min

### Parameter Description
| Parameter | Required | Type | Description |
|---------|---------|---------|---------|
| inputType | Yes | String | The way to input a video file. SingleFile: to directly specify the file ID; MultiFile: to specify a file list and clipping parameters, and then generate the file ID; Stream: to specify a stream ID and clipping parameters, and then generate the file ID; PullFile: to specify the URL of the video file to be pulled |
| file | No | Object | Information of the processed video file. This parameter is valid when inputType is SingleFile. |
| file.id | No | String | ID of the processed video file |
| file.startTimeOffset | No | Integer | Starting offset of the clipped file |
| file.endTimeOffset | No | Integer | Ending offset of the clipped file |
| fileList | No | Array | List of the processed video file. This parameter is valid when inputType is MultiFile. |
| fileList.n.id | No | String | ID of the processed video file |
| fileList.n.startTimeOffset | No | Integer | Starting offset of the clipped file |
| fileList.n.endTimeOffset | No | Integer | Ending offset of the clipped file |
| stream | No | Object | ID of the processed stream . This parameter is valid when inputType is Stream. |
| stream.streamId | Yes | String | ID of the recorded stream |
| stream.startTimeStamp | Yes | Integer | Start time of recording during clipping |
| stream.endTimeStamp | Yes | Integer | End time of recording during clipping |
| pull | No | Object | Information of the pulled video. This parameter is valid when inputType is PullFile. |
| pull.url | Yes | String | The URL of the video file to be pulled. This parameter is required when inputType is PullFile. |
| pull.fileName | Yes | String | Video file name. This parameter is required when inputType is PullFile. |
| pull.fileMd5 | No | String | MD5 of the video file. This parameter is valid when inputType is PullFile. |
| pull.classId | No | Integer | Video category ID. This parameter is valid when inputType is PullFile. |
| procedure | Yes | String | Process parameters |
| COMMON_PARAMS | Yes |  | For more information, please see [Common Request Parameters](https://cloud.tencent.com/document/api/213/6976) |

### Request Example

#### Specify a single fileId
The following example indicates:
Initiate the task flow after clipping the file with a specified fileId

```
https://vod.api.qcloud.com/v2/index.php?Action=RunProcedure
&inputType=SingleFile
&file.id=12345
&file.startTimeOffset=10
&file.endTimeOffset=25
&procedure=SomeProcedure
&COMMON_PARAMS
```

#### Specify an ID list of files to be clipped
The following example indicates:
1. Clip the contents from the 30th second to the 100th second from the video with fileId of 12345. And clip the contents from the 300th second to the 400th second from the video with fileId of 67899.
2. Stitch the clipped files​ as the target file in the format of mp4.
3. Initiate a task flow for the target file.

```
https://vod.api.qcloud.com/v2/index.php?Action=RunProcedure
&inputType=MultiFile
&fileList.0.id=12345
&fileList.0.startTimeOffset=30
&fileList.0.endTimeOffset=100
&fileList.1.id=67899
&fileList.1.startTimeOffset=300
&fileList.1.endTimeOffset=400
&procedure=SomeProcedure
&COMMON_PARAMS
```

#### Record stream information
The following example indicates:
1. Clip all the fileId within the recording period from 15020876538 to 15020876638 from the stream file with streamId of 12345.
2. Stitch the clipped files​ as the target file in the format of mp4.
3. Initiate a task flow for the target file.

```
https://vod.api.qcloud.com/v2/index.php?Action=RunProcedure
&inputType=Stream
&stream.streamId=12345
&stream.startTimeStamp=15020876538
&stream.endTimeStamp=1502087638
&procedure=SomeProcedure
&COMMON_PARAMS
```

## API Response

### Parameter Description
| Parameter | Type | Description |
|---------|---------|---------|
| code | Integer | Error code, 0: Successful; other values: Failed. |
| message | String | Error message |
| vodTaskId | String | Task ID |

### Error Codes
| Error Code | Description |
|---------|---------|
| 4000-7000 | For more information, please see [Common Error Codes](https://cloud.tencent.com/document/product/266/7783)  |
| 1 | Internal error  |
| 1000 | Invalid parameter  |
| 1001 | Internal error  |
| 1003 | Internal error  |
| 2000 | Internal error  |
| 10008 | File does not exist  |
| 10022 | Internal error |
| 50005 | A task with the same procedure already exists |
| 50006 | Failed to create the procedure task |
| 50007 | Invalid procedure parameter |

### Response Example
```javascript
{
    "code": 0,
    "message": "",
    "vodTaskId": "procedure-7a2229a8f1957bfce08ba733fbfd4a3c",
}
```
If the callback notification is enabled, each task is individually called back when finished. For more information, please see [Overview of Server Event Notifications](https://cloud.tencent.com/document/product/266/7829).

