## 插件声明
在小程序的 app.json 中声明需要使用的插件，示例如下：
```
"plugins": {
    "myPlugin": {
      "provider": "wx76f1d77827f78beb",
      "version": "0.0.1"
    }
  },
```

- myPlugin：您自己定义的插件名称，可以改为其他名称。
- provider：使用的插件方，其值为微剪插件的 appid，即`wx76f1d77827f78beb`。
- version：微剪插件的版本号，一般选择最新版本。

## 插件使用
### 拍摄组件
在需要展示视频编辑能力的页面 json 内引入插件，插件名称可自定义，如下方暂定为`my-clip`：
```
{
  "usingComponents": {
    "my-clip": "plugin://myPlugin/clip"
  }
}
```
在页面的 wxml 内写入插件标签：
```
<view>
	<my-clip
	></my-clip>
</view>
```
在 js 里获取插件实例：
```
const plugin = requirePlugin("myPlugin")
console.log(plugin)
```
>!clip 为插件的出口，因此插件内部除导出功能外，所用到的参数均从 clip 传入。

### 导出组件
export 是一个集成了视频导出功能的可定义外观组件。

#### 组件引入
```
{
    "usingComponents": {
      "export": "plugin://myPlugin/export"
    },
 }
 ```

#### 编写 wxml
```
<export //内部元素的 tap 事件触发导出操作
  watermark="https://cdn.cdn-go.cn/mp-video-edit-static/latest/images/watermark.png" //水印地址
  bindprogressupdate="handleProgressUpdate" //导出进度回调
  bindexportsuccess="handleExportSuccess" //返回导出的文件临时路径，供调用者使用
  bindexportfail="handleExportFail">	//失败回调
	<button class="customContent">导出</button> //自定义 UI，由 slot 实现
</export>
```
>!导出需要 tap 事件触发，内部需要包含可点击的组件，并且不能 catch 事件。

#### 处理返回的数据
```
handleExportSuccess(e) {
  console.log(e.detail)
}
```
`e.detail`包含导出视频的信息，如下所示：
```
{
	code: 0, //成功
	tempFilePath: 'wxfile://xxx.mp4',
	width: '544', //视频分辨率
	height: '960', 
	fps: 30, //帧率
	duration: 3000 //单位 ms
}
```

## 插件支持传入的参数

|参数名称	|类型	|是否必填	|说明
-|-|-|-
appid|	string	|是|	请在控制台的【账号信息】>[【基本信息】](https://console.cloud.tencent.com/developer)中查看
settings	|object	|否	|用于自定义配置，包括 UI 样式
bindInitedEvent|	function	|否|	插件初始化事件回调
 
### settings 参数说明

`settings`参数用来修改插件内置的一些基本参数，通过修改`settings`可以定制 UI 界面或部分编辑能力。下面是关于`settings`的具体说明：
- `settings`整体为一个 Object，如果不设置属性，则取插件内置默认值。
- `settings`对象主要有两部分的配置：common 和页面配置:
	- 插件包含若干个组件，会暴露组件的样式配置项。每个组件包含了自己的 state，默认 state 为 default，部分组件包含特殊 state，例如 camera 有 recording 这个状态。
	- 页面配置分为 camera、previewer 和 editor 等几个主界面，分别代表拍摄页、预览页和编辑主页面，不填写则默认取 common 中的配置。
	- 每个组件暴露的最内层属性 value 为可修改部分，例如设置：`settings.previewer.nextButton.default.fontColor = '#fff'`，表示把该按钮字体设置为白色。

### settings 参数使用
在初始化的时候，传入`settings`参数：
```
<view>

<my-clip
settings="{{myCustomSettings}}"
></my-clip>

</view>
```

**settings 对象默认值示例如下**：

```
export default {
  // 通用配置
  common: {
    videoMaxDuration: 30, // 小程序限制最多拍摄30秒
    chooseMaxDuration: 1000, // 选择视频的默认时长限制
    clipMaxDuration: 60, // 裁切时长的默认限制
    exportPagePath: "/pages/main/export/index", // 默认跳进插件自己提供的页面
    style: {
      // 主题色
      primaryColor: "#ff584c",
      // 文字色
      textColor: "#fff",
      // 禁用色
      disableColor: "#ddd",
      // 整体背景色
      backgroundColor: "#000",
      // 通用按钮配置
      button: {
        state: {
          default: {
            backgroundColor: "#ff584c",
            fontColor: "#fff"
          },
          disable: {
            backgroundColor: "#ddd",
            fontColor: "#fff"
          }
        }
      },
      // 通用二级按钮配置
      secondaryButton: {
        state: {
          default: {
            backgroundColor: "#ffffff",
            fontColor: "#ff584c"
          },
          disable: {
            backgroundColor: "#ddd",
            fontColor: "#fff"
          }
        }
      }
    }
  },
	// 以下配置均可选，单独配置覆盖上面的通用色配置
  // 拍摄界面
  camera: {
    // 录制按钮
    recordButton: {
      state: {
        default: {
          backgroundColor: "#ff584c",
          borderColor: "rgba(255,88,76,0.5)"
        },
        recording: {
          backgroundColor: "#fff"
        }
      }
    },
    // 下一步按钮
    nextButton: {
    	state: {
        default: {
          backgroundColor: "#ff584c",
          borderColor: "rgba(255,88,76,0.5)"
        },
        recording: {
          backgroundColor: "#fff"
        }
      }
    },
    // 重新选择按钮
    rechooseButton: {
      // 同上
    }
  },

  previewer: {
    //下一步按钮，可以不配，配了覆盖 style.style.button
    nextButton: {
      state: {
        default: {
          backgroundColor: "#ff584c",
          fontColor: "#fff"
        }
      }
    },
    // 覆盖 common.style.primaryColor
    clipper: {
      borderColor: "#ff584c"
    }
  },
  // 编辑页面
  editor: {
    //下一步按钮
    nextButton: {
      state: {
        default: {
          backgroundColor: "#ff584c",
          fontColor: "#fff"
        }
      }
    },

    //操作面板
    operatePanel: {
      // 面板背景色,覆盖 common.style.backgroundColor
      backgroundColor: "rgba(0,0,0,0.8)",
      // 特效面板
      effect: {
        // 自定义 icon，不传使用默认 icon
        icon: "https://xx.xx.xx",
        // 游标颜色，此处的 movableColor 和下面的 highlightColor 不填则取 common.style.primaryColor
        movableColor: "#ff584c"
      },
      // 滤镜面板
      filter: {
        icon: "https://xx.xx.xx",
        highlightColor: "#ff584c"
      },
      // 音乐面板
      music: {
        icon: "https://xx.xx.xx",
        highlightColor: "#ff584c"
      },
      // 文字面板
      text: {
        icon: "https://xx.xx.xx",

      }
    }
  }
};
```

