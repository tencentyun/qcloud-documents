智能降冷依托于点播的媒资管理能力，为了降低开发者使用云点播服务时的存储成本，我们推出了媒体生命周期管理能力。开发者可以根据自身的业务特点，从而达到有效降低用户存储成本，将点播文件的存储类型按照一定的策略从标准存储沉降为低频存储、归档存储和深度归档存储，更灵活的管理自己的媒体文件。

## 使用场景
- **直播电商**：按照文化部 [《网络交易监督管理办法》](http://gkml.samr.gov.cn/nsjg/fgs/202103/t20210315_326936.html) 的要求，网络直播服务提供者对网络交易活动的直播视频保存时间自直播结束之日起不少于三年。直播录像存储在云点播中，存储类型为标准存储。部分录像不会（或极少）被回看，仅用于有关部门的审查，媒资智能降冷功能可以有效帮助客户降低存储成本。
- **低频率访问媒体降冷**：对于视频门户、流媒体、UGC 内容管理平台，对于用户不频繁访问和观看的媒体，不能直接下线又带来较高的存储成本，云点播的媒资智能降冷能力可以通过访问次数来将媒体文件进行降冷，有效降低存储成本的同时，满足低频观看的要求。
- **媒体归档**：对于新闻传媒、广播电视行业，部分媒体文件具有很强的时效性，这类媒体一般会作为历史资料被长期保存，在日后需要的时候再检索出来观看，对观看的实时性要求不高。这种场景下可以将媒体转为归档存储或深度归档存储，降低用户存储成本。

## 前提条件
1. [注册](https://cloud.tencent.com/register?&s_url=https%3A%2F%2Fcloud.tencent.com%2F) 并 [登录](https://cloud.tencent.com/login?s_url=https%3A%2F%2Fcloud.tencent.com%2F) 腾讯云账号，并且完成账号实名认证。
2. 已开通腾讯云点播服务。若未开通，请前往开通 [云点播服务](https://console.cloud.tencent.com/vod/overview)。
3. 进行策略创建，详情请参见 [媒资降冷](https://cloud.tencent.com/document/product/266/55267)。

## 使用说明
为了便于用户理解和使用媒资降冷能力，用户需要了解 [存储类型](#type)、[数据取回及取回模式](#retake)、[策略管理](#strategy) 的概念。
### 存储类型[](id:type)
用户媒体文件存储至云点播时的存储类型，云点播提供了以下几种存储类型，分别为：标准存储、低频存储、归档存储和深度归档存储。其特性如下表所示：

| 存储类型   | 标准存储 | 低频存储 | 归档存储  | 深度归档存储   |
| ------ | ---- | ---- | ----- | -------- |
| 云点播默认  | 是    | 否    | 否     | 否        |
| 存储成本   | 高    | 中    | 低     | 极低       |
| 访问性能   | 高    | 低    | 不支持访问 | 不支持访问    |
| 数据取回费用 | 无    | 无    | 有 | 有    |
| 支持园区   | 全部   | 全部   | 全部    | 北京、上海、重庆 |

标准存储是云点播的默认存储类型。不论是直播录制、各种上传方式还是视频处理任务所生成的文件都是标准存储。

| 属性 | 由高到低对比 | 
|---------|---------|
| 存储成本 | 标准存储 > 低频存储 > 归档存储 > 深度归档存储 |
| 访问性能 | 标准存储 > 低频存储 |
>?
>- 归档存储和深度归档存储不支持直接访问，需要先进行取回操作，云点播仅支持用户取回至 **标准存储**。
>- 访问性能将影响观看视频时的**首屏时间、卡顿率**等指标，故**对于频繁访问的线上业务不建议用户变更存储类型**。

云点播支持不同存储类型进行变更，所允许的存储类型变更方式如下：

| 源存储类型  | 目标存储类型           |
| ------ | ---------------- |
| 标准存储   | 低频存储、归档存储、深度归档存储 |
| 低频存储   | 标准存储、归档存储、深度归档存储 |
| 归档存储   | 标准存储             |
| 深度归档存储 | 标准存储             |
>?
>- 若要将归档存储和深度归档存储变更为除标准存储之外的其它存储类型，需要先变更为标准存储，然后再由标准存储变更为最终的目标存储类型。
>- 存储类型的变更以 FileId 为粒度，即原始文件和视频处理文件的存储类型是一致的，不支持对 FileId 下的一部分文件单独指定存储类型。

### 数据取回及取回模式[](id:retake)
#### 数据取回
媒体变更为归档存储或深度归档存储之后不允许被直接访问，包括播放、发起视频处理等。如果需要访问，那么可以使用上文介绍的变更存储类型操作。但有时候开发者仅需要在短时间内进行访问，访问结束后希望该媒体仍然能保留归档存储或深度归档存储状态，那么上述的方式就不适用。因此点播提供了数据取回能力。

云点播支持对归档存储和深度归档存储的媒体进行两种取回操作：永久取回、指定时长取回。

| 对归档存储/深度归档存储的操作 | 变更存储类型   | 取回       |
| ------------------- | -------- | -------- |
| 实时性                 | 异步       | 异步       |
| 模式                  | 极速/标准/批量 | 极速/标准/批量 |
| 有效期                 | 永久       | 指定时长     |
| 产生副本                | 否        | 是        |

1. 取回之后，云点播会为该媒体生成一份存储类型为标准存储的副本。
2. 取回副本具备有效期，以天为单位。在有效期之内，允许对该媒体进行访问；在有效期结束后，副本被自动清理，之后不允许对媒体进行访问。
3. 副本有效期内，会额外产生相应的标准存储费用。
4. 副本有效期内，不允许再次发起取回操作。

#### 取回模式
对归档存储和深度归档存储变更存储类型和取回操作有多种模式。不同模式的最终效果一致，区别在于速度和费用（即取回费用）：

| 取回模式 | 归档存储取回耗时 | 深度归档存储取回耗时 |
| ---- | -------- | ---------- |
| 极速模式 | 5分钟      | 不支持        |
| 标准模式 | 5小时      | 24小时       |
| 批量模式 | 12小时     | 48小时       |
>?
>- 一个媒体（由一个 FileId 表示）在存储上可以包含许多个文件，如原始文件、转码文件和截图文件等等，各个文件的实际解冻完成时间可能有先后。云点播不维护各个文件的具体解冻完成情况，而是将媒体作为一个整体，统一以解冻的最大可能耗时来计算媒体的解冻完成时间。在该时间到达之前，即使媒体下的所有文件实际已经解冻完成，媒体仍然被标识为未解冻状态，不允许访问。
>- 由于媒体被标识为已解冻的时间点会晚于实际解冻的时间点，因此媒体的解冻副本的可用时长会短于预期想要的时长。为了确保解冻后副本有足够的可用时长，建议在解冻深度归档存储时加多1天的有效期。

### 策略管理[](id:strategy)
为了方便开发者对大量媒体的生命周期进行统一管理，云点播结合媒资信息和媒体文件播放统计数据，开发了基于策略的智能管理系统。

云点播后台每天执行管理任务，对满足指定策略的媒体进行存储类型变更。
#### 策略能力
##### 组合筛选
策略允许开发者指定一系列条件，对**同时**符合所有条件的媒体进行存储类型变更。具体筛选条件如下：
- 以媒体的类型作为筛选条件，包括视频媒体、音频媒体和图片媒体。
- 以媒体的创建日期作为筛选条件，有以下几种形式：
 - 指定日期之前创建的文件。
 - 指定日期之后创建的文件。
 - 指定的两个日期之间创建的文件。
 - 指定天数之前创建的文件（根据当前日期动态变化）。
 - 创建时间不限（即所有媒体均满足该条件）。
- 以媒体的分类 ID 作为筛选条件，可以同时指定多个分类 ID，也可以不做限制（即所有媒体均满足该条件）。
- 以媒体的来源类型作为筛选条件，包括直播录制、上传、视频编辑、其它等几类。可以同时指定多种来源类型，也可以不做限制（即所有媒体均满足该条件）。
- 以媒体的近期播放次数作为筛选条件，筛选出最近若干天内播放次数少于若干次的媒体。也可以不做限制（即所有媒体均满足该条件）。

##### 停用策略
策略创建完成后自动启用，开发者可以根据需要停用策略。已停用的策略在次日之后的管理任务中被忽略，直到该策略被再次启用。
>?停用策略后，该策略在当天的管理任务中有可能生效，也有可能不生效。

#### 限制
最多配置10条策略。
不允许指定策略优先级。如果一个媒体同时命中多条策略，自动按照目标存储类型来确定优先级。优先级从高到低为：深度归档存储 > 归档存储 > 低频存储。

## 云点播配置智能降冷策略
### 步骤1：创建降冷策略
在 [云点播控制台](https://console.cloud.tencent.com/vod/media) （非管理员）左侧导航栏，选择【媒资管理】>【媒资降冷】，单击【智能降冷策略】。
![](https://main.qcloudimg.com/raw/65df119b8f2ade0c97f4d931faf7e456.png)
### 步骤2：配置降冷策略
![](https://main.qcloudimg.com/raw/1eac483e844c4d5255202d4182634eaa.png)
按照用户的需求进行降冷策略的配置。
示例：如图所示则为若媒体在30日内，视频播放次数低于300次，则触发低频降冷策略；云点播会选取满足所有规则的媒体进行降冷。
### 步骤3：确认配置生效
![](https://main.qcloudimg.com/raw/0d2d2cc1d2bd30256de30471c644928b.png)
