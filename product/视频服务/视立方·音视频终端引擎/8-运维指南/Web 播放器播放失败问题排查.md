本文主要介绍 Web 端视频播放的几类常见问题及相应解决方案。

## 视频播放失败
视频播放失败有多种原因，定位问题的基本思路是：

1. 配置网络抓包，查看网络请求情况。
2. 查看浏览器控制台报错情况。
3. 检查视频格式，使用的浏览器是否支持播放。

以下是视频播放失败的几种原因，以及对应的解决方案：

### 网络
#### 跨协议拦截
**问题表现：**在 HTTPS 协议的页面播放 HTTP 协议的视频时，浏览器会处于安全考虑进行拦截。
**解决方案：**HTTP 协议的页面播放 HTTP 的视频，HTTPS 协议的页面播放 HTTPS 的视频。

#### CDN 无视频
**问题表现：**访问视频地址返回404。
**解决方案：**请 [联系我们](https://cloud.tencent.com/document/product/266/19905) 定位并修复 CDN 资源。

#### CDN 鉴权失败
**问题表现：**访问视频地址返回403，无法加载视频。
**解决方案：**需确认是否开启 referer 防盗链或者 key 防盗链，视频播放时是否具备校验参数。

#### 微信浏览器拦截
**问题表现：**在微信无法播放视频，非微信情况下可以播放。
**解决方案：**需要通过微信申诉解除拦截。

### 跨域问题
**问题表现：**在 PC 端无法播放视频，浏览器控制台报跨域相关的错误。
**问题背景：**在 PC 端使用 Flash 播放视频需要检查视频服务器的`crossdomain.xml`文件。

**crossdomain.xml 的作用**
- 位于`www.a.com`域中的 SWF 文件要访问`www.b.com`的文件时，SWF 首先会检查`www.b.com`服务器根目录下是否有`crossdomain.xml`文件，如果没有，则访问不成功；如果`crossdomain.xml`文件存在，且文件内设置了允许`www.a.com`域访问，则通信正常。
- `crossdomain.xml`中配置的是 SWF 文件的域名。

在 PC 端的现代浏览器使用 HTML5 播放 HLS 和 FLV 时，视频服务器需要配置跨域资源共享 [CORS](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS)。
正常情况下，腾讯云服务会自动配置这两项跨域策略，如遇到异常情况请 [联系我们](https://cloud.tencent.com/document/product/266/19905)。

**解决方案：**视频存储服务器需要部署 `crossdomain.xml`文件并配置正确的访问策略，以及开启 CORS 支持。

### 视频未转码
**问题表现：**在腾讯云控制台上传视频后，播放器提示视频未转码。
**解决方案：**对视频进行转码操作，具体操作请参见 [处理视频](https://cloud.tencent.com/document/product/266/36448)，确保视频编码格式为 H.264，视频封装格式为 MP4 或者 HLS。

### 异常视频
**问题表现：**转码后的视频出现花屏、黑屏、卡顿和无法播放等现象，可能是原始视频有问题或者视频转码失败。
**解决方案：**需要定位原始视频是否有问题，如果是转码问题请 [联系我们](https://cloud.tencent.com/document/product/266/19905)。

### 浏览器环境不支持播放
通常情况下在 Web 端播放视频依赖浏览器自带的解码器，或者 Flash 解码器，不支持播放会出现 error code 为3或4的错误。浏览器不支持播放的常见问题如下：

#### 浏览器不支持 Flash
**问题表现：**无法播放 RTMP 和 FLV 格式的视频，或者无法在 IE 浏览器中播放视频。
**解决方案：**播放 RTMP、FLV 格式的视频以及在 IE 中播放视频都依赖 Flash 插件，请安装并启用 Flash 插件。

#### 浏览器不支持 MSE
**问题表现：**在 PC 浏览器不支持 Flash 的情况下，使用 H5 方式无法播放 HLS、FLV 格式的视频。
**解决方案：**不支持 Flash 的情况下，播放器将使用 MSE 播放 HLS、FLV 格式的视频，如浏览器不支持，只能更换或升级浏览器，目前支持通过 MSE 播放 HLS、FLV  格式视频的浏览器有 Edge、Chrome、Firefox 和 Safari11+。

#### 浏览器不支持解码 H264 或者不支持播放 MP4、HLS 格式的视频
**问题表现：**排除其他情况后仍无法播放 MP4、HLS 格式的视频，通常出现在部分 PC 软件或者 App 集成精简版本的浏览器内核中，没有对应的视频解码器，会出现无法播放 MP4、HLS 格式视频的情况。
**解决方案：**在 PC 软件或 App 中升级浏览器内核，或者集成 Flash 插件，并允许调用 Flash 插件。

### HLS 加密视频播放失败
HLS 加密视频的播放流程有别于常规视频，通常需要确保获取 key 这个步骤是正常的，常见问题如下：

#### 获取 key 失败
**问题表现：**获取密钥接口无返回，或者返回非密钥数据。
**解决方案：**检查 m3u8 文件格式是否符合规范，获取密钥的地址是否正确，密钥接口服务端鉴权是否正常，密钥接口是否正常返回。

#### 解密失败
**问题表现：**获取密钥接口正常返回，仍无法播放。
**解决方案：**检查密钥长度，确保密钥长度为16字节，并且是能正确解密的密钥。
