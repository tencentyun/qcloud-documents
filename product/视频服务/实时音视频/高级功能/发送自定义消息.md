## 内容介绍

TRTC SDK 提供了发送自定义消息的功能，通过该功能，任何一个用户都可以向同一个视频房间里的其他用户广播自己的定制消息。


## 支持的平台

| iOS | Android | Mac OS | Windows | 微信小程序 | Chrome浏览器|
|:-------:|:-------:|:-------:|:-------:|:-------:|:-------:|
|     ✔  |    ✔    |    ✔   |    ✔    |    ✖    |   ✖    |

## 发送接收原理
某一个用户的自定义消息会被夹在音视频数据流中，随着音视频数据一起传输给房间里的其他用户。由于音视频线路本身并不是100%可靠的，为了提高可靠性，TRTC SDK 内部本身实现了一些可靠性保护机制。

![](https://main.qcloudimg.com/raw/329f37be110851604a177ff66df1f842.png)


## 消息发送

通过调用 TRTCCloud 的 `sendCustomCmdMsg` 接口发送的，发送时需要指定四个参数：

- **cmdID**
消息ID，取值范围为 1 ~ 10，不同业务类型的消息应当使用不同的 cmdID。

- **data**
待发送的消息，最大支持 1KB（1000字节）的数据大小。

- **reliable**
是否可靠发送，可靠发送的代价是会引入一定的延时，因为接收端要暂存一段时间的数据来等待重传。

- **ordered**
是否要求有序，即是否要求接收端接收的数据顺序和发送端发送的顺序一致，这会带来一定的接收延时，因为在接收端需要暂存并排序这些消息。

> 注意：请将 reliable 和 ordered 同时设置为 YES 或 NO, 暂不支持交叉设置。

- **Objective-C**

``` Objective-C
//发送自定义消息的示例代码

```

- **Java**

``` java
//发送自定义消息的示例代码

```

- **C++**

``` C++
//发送自定义消息的示例代码

```

## 消息接收

当房间中的一个用户通过 `sendCustomCmdMsg` 发出自定义消息后，房间中其他的用户可以通过 SDK 回调中的 `onRecvCustomCmdMsg` 接口来接收这些消息。

- **Objective-C**

``` Objective-C
//发送自定义消息的示例代码

```

- **Java**

``` java
//发送自定义消息的示例代码

```

- **C++**

``` C++
//发送自定义消息的示例代码

```

## 使用限制

由于自定义消息享受比音视频数据更高的传输优先级，如果自定义数据发送过多，音视频数据可能会被干扰到，从而导致画面卡顿或者模糊。所以，我们针对自定义消息的发送进行了如下的频率限制：

- 自定义消息会被云广播给房间内所有用户，所以每秒最多能发送 30 条消息。
- 每个消息包（即 data 的大小）最大为 1 KB，超过则很有可能会被中间路由器或者服务器丢弃。
- 每个客户端每秒最多能发送总计 8 KB 数据，也就是如果每个数据包都是 1KB，那么每秒钟您最多只能发送 8 个数据包。








