云剪辑 SDK 主要用于协助用户完成云剪辑 WEB 端开发，合成自己的轨道编辑数据等。

## 准备工作
已做好相关准备，应用服务已就绪。具体操作请参见 [接入文档]()。

## 快速开始
1. 使用 CDN 引入 SDK：`<script src="https://imgcache.qq.com/qcloud/cme/sdk_v1.js"></script>`。
2. 在页面初始化完成以后填入如下代码：

```js
/* @init  初始化方法,没调用该方法之前,调用 send 方法通信无效。
 *    @param el {{HTMLELement}}  html元素,做为父容器承载 CME 组件。
 *    @param options {{ object|hash }} 参数。
 *         @param signature {{ string }} ，该项目签名.具体参考 签名算法。
 *         @param onerror {{ function}}  iframe 加载失败的回调。
 *    @return 返回一个 cme 组件实例。
 **/
let cme = CME.init(document.getElementById("Container"), {
  signature: "your_signature",
});

/**
 * 页面初始化异常时，会抛出Error事件。
 **/
cme.on("Error", (data) => {
  console.log("Error", data);
});

/**
 * 页面组件完全准备好以后，会抛出：Editor:Ready 事件，
 * 该事件触发以后，所有命令字会正常响应，触发之前，部分命令字无法响应。
 **/
cme.on("Editor:Ready", () => {
  console.log("desc", "iframe Ready");
  /**
   *
   * @send 发送命令字方法,
   *    @param cmd {{string}} 字符串,参考 cme 命令字列表。
   *    @param param {{object}} 命令入参。
   *    @param callback {{function}} 完成命令的回调函数。
   *
   **/
  cme.send("syncFusionData", {}, (data) => {
    console.log("sync done", data);
  });
});

let clickHandler = () => {
  console.log("Click");
};
/**
 *
 * @on 监听方法,监听来自 CME 的用户事件。
 *    @param eventName {{string}} 字符串,参考 cme 自定义用户事件。
 *    @param callback {{function}} 回调函数。
 *
 */
cme.on("Editor:MoreResourceBtn:click", clickHandler);

/**
 * @off 取消监听方法,监听来自 CME 的事件,如果什么都不传则会清理所有监听事件。
 *    @param eventName {{string}} 字符串,参考 cme 自定义用户事件。
 *    @param callback {{function}} 对应回调函数。
 *
 */
cme.off("Editor:MoreResourceBtn:click", clickHandler);


```

3.  如果执行成功则可以看到开启一个 [编辑页](#页面定制)。

## 页面定制
加入已经成功初始化，则可以看到下图这样的页面，页面可以做**基础定制**，目前只能我们来协助操作，后续会开放自助。

**基础定制主要提供以下能力：**
- 设置页面元素隐藏和显示。
- 定制页面元素呈现形态（仅支持替换 Logo 图标，修改部分文案的小幅修改）。

<img src='https://main.qcloudimg.com/raw/4dd1c59303257a11bdb64eefce6ada8f.png'>

可配置元素如下，`图标位置`对应上图**标红数字**：

| 图标位置 | 组件名                 | 描述           |
| -------- | ---------------------- | -------------- |
| 1        | Header:Logo            | 顶部 Logo。    |
| 2        | Header:BackBtn         | 顶部返回按钮。 |
| 3        | Editor:UploadBtn       | 上传按钮。     |
| 4        | Editor:MoreResourceBtn | 更多资源按钮。 |
| 5        | Editor:ExportBtn       | 导出按钮。     |

## SDK 概述
SDK 主要包含 3 种行为相关接口：
1. [协商配置和初始化组件](#init)。
2. [控制云剪辑行为](#send)。
3. [用户事件监听抛出](#on)。

### init
配置主要内容是身份校验和云剪组件应该出现位置以及相关操作。
>? 配置初始化方法.与之对应则可以 [销毁组件](#destroy)。

```js
/* @init  初始化方法,没调用该方法之前,调用 send 方法通信无效。
 *    @param el {{HTMLELement}}  html元素,做为父容器承载 CME 组件。
 *    @param options {{ object|hash }} 参数。
 *         @param signature {{ string }} ，该项目签名.具体参考 签名算法。
 *         @param onerror {{ function}}  iframe 加载失败的回调。
 *    @return 返回一个 cme 组件实例。
 **/
let cme = CME.init(document.getElementById("Container"), {
  signature: "your_signature",
});
```

### destroy

```js
/**
 * @destroy 清理所有监听事件、临时变量并将对象销毁。
 *  注意，此时cme对象引用会变为空。
 */
cme.destroy();

```

### send
云剪组件用 iframe 的方式嵌入到应用，采用 postMessage 方式与父容器通信，所以`send`必须在 `iframe`内 云剪辑页面加载成功以后可用（监听到`Editor:Ready`事件以后），否则无效或报错。

通过`send` 方法发送 [命令字](## 命令字列表)控制云剪辑的页面行为，实例如下：

```js
  /**
   *
   * @send 发送命令字方法,
   *    @param cmd {{string}} 字符串,参考 cme 命令字列表。
   *    @param param {{object}} 命令入参。
   *    @param callback {{function}} 完成命令的回调函数。
   *
   **/
  cme.send("syncFusionData", {}, (data) => {
    console.log("sync done", data);
  });
```

#### 命令字列表
<table><tr><th >可用范围</th><th >命令字</th><th width="40%">参数</th><th width="5%">功能</th></tr><tr>
<td><a href="#页面定制">编辑页</a></td>
<td>refreshResources</td>
<td>mids：素材 ID，列表数组(可选)</td>
<td>更新素材，如果不什么都不传，会将素材刷新到为第一页（20 条数据），如果传入素材 ID，会去尝试将刷新传入素材 ID 到顶部。</td>
</tr><tr>
<td><a href="#页面定制">编辑页</a></td>
<td>syncFusionData</td>
<td>无</td>
<td>提交编辑数据，如果在外部触发导出项目事件，需要调用一次该接口。</td>
</tr><tr>
<td><a href="#页面定制">编辑页</a></td>
<td>showUpload</td>
<td>sign：上传签名</td>
<td>开启上传面板，<b>在云剪内部上传会使用云剪的即传即用功能，即浏览器支持度较好的媒体格式，如 .h264 的 mp4 视频和 webm，可边上传边编辑，不用等待完全上传和解码的全过程</b>。</td>
</tr><tr>
<td>所有页面</td>
<td>routeGoto</td>
<td>name：路由名</td>
<td>目前支持<code>Editor</code>,<code>MyAsset</code>,<code>AssetMarket</code>,projectId：项目 ID，必须指定跳转具体项目 ID。</td>
</tr></table>


### on
监听来自云剪辑的 [用户事件](#用户交互事件)，与之相对应的有 [移除事件](#off)。

```js
/**
 * 页面组件完全准备好以后，会抛出：Editor:Ready 事件，
 * 该事件触发以后，所有命令字会正常响应，触发之前，部分命令字无法响应。
 **/
cme.on("Editor:Ready", () => {
  console.log("desc", "iframe Ready");
  /**
   *
   * @send 发送命令字方法,
   *    @param cmd {{string}} 字符串,参考 cme 命令字列表。
   *    @param param {{object}} 命令入参。
   *    @param callback {{function}} 完成命令的回调函数。
   *
   **/
```

#### 用户交互事件

用户事件命名规则,可以使用控制台查看元素，元素上标有`data-ui`就会响应`click`,该事件抛出名字为:`${data-ui}:Click`，`data-ui` 以组件/页面，组件的方式命名，参考`Editor:ExportBtn:Click`可知道是编辑页导出按钮点击事件，具体抛出事件如下:

**用户事件：**

| 事件名                       | 说明                   |
| ---------------------------- | ---------------------- |
| Header:BackBtn:Click         | 用户点击顶部返回按钮。 |
| Editor:ExportBtn:Click       | 用户点击导出按钮 。    |
| Header:Logo:Click            | 用户点击 Logo。        |
| Header:Goto:Click            | 用户点击顶部跳转按钮。 |
| Editor:MoreResourceBtn:Click | 用户点击更多资源按钮。   |
| Editor:UploadBtn:Click       | 用户点击上传按钮。       |

**生命周期事件：**

| 事件名       | 说明           |
| ------------ | -------------- |
| Editor:Ready | 页面加载完成。 |

**异常事件：**

| 事件名 | 数据结构                                                     |
| ------ | ------------------------------------------------------------ |
| Error  | {error:1000,msg:'NotSupportBrowser'}，更多错误码详情请参见 [错误码](#错误码)。 |


#### 错误码

|错误码| 意义|
| ------------ | -------------- |
|1000| 不支持的浏览器，目前只支持 Chrome 60 版本以上的浏览器 。|

### off
移除监听的云剪辑用户事件，与之对应的有[监听事件](#on)

```js
/**
 * @off 取消监听方法,监听来自 CME 的事件,如果什么都不传则会清理所有监听事件。
 *    @param eventName {{string}} 字符串,参考 cme 自定义用户事件。
 *    @param callback {{function}} 对应回调函数。
 *
 */
cme.off("Editor:MoreResourceBtn:click", clickHandler);

```
