# iframe集成

## 快速开始

> 使用我们的 CDN 引入 sdk，`<script src="https://vs-cdn.tencent-cloud.com/sdk/cme_v2.1.js"></script>`，在页面初始化完成以后填入如下代码。


```js
/* @create  创建实例方法,没调用该方法之前,调用 send 方法通信无效。
 *    @param el {{HTMLELement}}  html元素,做为父容器承载 CME 组件。
 *    @param options {{ object|hash }} 参数。
 *         @param sign {{ string }} ，该项目签名.具体参考 签名算法。
 *    @return 返回一个 cme 组件实例。
 **/
let myCmeInstance = CME.Iframe.create(document.getElementById("Container"), {
  sign: "your_signature",
});

/**
 * 页面初始化异常时，会抛出Error事件。
 **/
myCmeInstance.on("Error", (data) => {
  console.log("Error", data);
});

/**
 * 页面组件完全准备好以后，会抛出：Editor:Ready 事件，
 * 该事件触发以后，所有命令字会正常响应，触发之前，部分命令字无法响应。
 **/
myCmeInstance.on("Editor:Ready", () => {
  console.log("desc", "iframe Ready");
  /**
   *
   * @send 发送命令字方法,
   *    @param cmd {{string}} 字符串,参考 cme 命令字列表。
   *    @param param {{object}} 命令入参。
   *    @param callback {{function}} 完成命令的回调函数。
   *
   **/
  myCmeInstance.send("syncFusionData", {}, (data) => {
    console.log("sync done", data);
  });
});

let clickHandler = () => {
  console.log("Click");
};
/**
 *
 * @on 监听方法,监听来自 CME 的用户事件。
 *    @param eventName {{string}} 字符串,参考 cme 自定义用户事件。
 *    @param callback {{function}} 回调函数。
 *
 */
myCmeInstance.on("Editor:MoreResourceBtn:click", clickHandler);

/**
 * @off 取消监听方法,监听来自 CME 的事件,如果什么都不传则会清理所有监听事件。
 *    @param eventName {{string}} 字符串,参考 cme 自定义用户事件。
 *    @param callback {{function}} 对应回调函数。
 *
 */
myCmeInstance.off("Editor:MoreResourceBtn:click", clickHandler);


```
如果执行成功则可以看到开启一个[编辑页](#页面定制)。

## 页面定制

假如已经成功初始化，则可以看到下图这样的页面,页面可以做*基础定制*，具体请参考控制台。

<img src='https://vs-cdn.tencent-cloud.com/assets/imgs/demo.png' />


# Iframe模块介绍

`sdk`引入后，我们会在全局挂载一个`CME`对象，此章节关注以下模块：

- Iframe：Iframe模块，会包含相关方法。
  + [create](#create) 创建并返回一个`CMEIframe`实例。

`CMEIframe`实例拥有以下方法：
- [send](#send) 给实例发送命令。
- [destroy](#destroy) 销毁实例。
- [on](#on) 监听实例的用户触发事件。
- [off](#off) 取消监听事件。


### create

> 用于创建`CMEIframe`实例的工厂方法.与之对应则可以调用组件自身的[销毁方法](#destroy)

组件 `create` 后会返回一个`CMEIframe`组件实例:

```js
/* @create  创建实例方法,没调用该方法之前,调用 send 方法通信无效。
 *    @param el {{HTMLELement}}  html元素,做为父容器承载 CME 组件。
 *    @param options {{ object|hash }} 参数。
 *         @param sign {{ string }} ，该项目签名.具体参考 签名算法。
 *    @return 返回一个 cme 组件实例。
 **/
let myCmeInstance = CME.Iframe.create(document.getElementById("Container"), {
  sign: "your_signature",
});
```

## 实例方法

以下为CMEIframe实例所有方法

### send

_云剪组件用 Iframe 的方式嵌入到应用，采用 postMessage 方式与父容器通信，所以`send`必须在 `Iframe`内 云剪辑页面加载成功以后可用（监听到`Editor:Ready`事件以后），否则无效或报错_。
> 通过`send` 方法发送*命令字*_命令字相关内容请参考附录_控制云剪辑的页面行为,实例如下: 
```js
  /**
   *
   * @send 发送命令字方法,
   *    @param cmd {{string}} 字符串,参考 cme 命令字列表。
   *    @param param {{object}} 命令入参。
   *    @param callback {{function}} 完成命令的回调函数。
   *
   **/
  myCmeInstance.send("syncFusionData", {}, (data) => {
    console.log("sync done", data);
  });
```






### destroy
```js
/**
 * @destroy 清理所有监听事件、临时变量并将对象销毁。
 *  注意，此时cme对象引用会变为空。
 */
myCmeInstance.destroy();

```



### on

> 监听来自云剪辑的用户事件用户事件，与之相对应的有移除事件，了解更多用户事件请参考附录。

```js
/**
 * 页面组件完全准备好以后，会抛出：Editor:Ready 事件，
 * 该事件触发以后，所有命令字会正常响应，触发之前，部分命令字无法响应。
 **/
myCmeInstance.on("Editor:Ready", () => {
  console.log("desc", "Iframe Ready");
  /**
   *
   * @send 发送命令字方法,
   *    @param cmd {{string}} 字符串,参考 cme 命令字列表。
   *    @param param {{object}} 命令入参。
   *    @param callback {{function}} 完成命令的回调函数。
   *
   **/
```


### off

> 移除监听的云剪辑用户事件，与之对应的有[监听事件](#on)

```js
/**
 * @off 取消监听方法,监听来自 CME 的事件,如果什么都不传则会清理所有监听事件。
 *    @param eventName {{string}} 字符串,参考 cme 自定义用户事件。
 *    @param callback {{function}} 对应回调函数。
 *
 */
myCmeInstance.off("Editor:MoreResourceBtn:click", clickHandler);

```


## 更多

指令和事件说明参考:
- [云剪辑指令](./云剪/指令.md)
- [云剪辑事件](./云剪/事件.md)

