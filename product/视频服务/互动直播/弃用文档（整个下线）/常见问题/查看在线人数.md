## 方案一：业务服务器管理

### 流程图

![](http://mc.qcloudimg.com/static/img/8da0f13a73d87e2970e5e4603d3ca61d/image.png)

### 步骤描述

1. 观众 2 调用业务服务器进房接口生成进房记录。
2. 观众 2 调用 imsdk 接口发送进群自定义消息，可与步骤 1 同步进行。
3. 观众 2 生成进房记录同时，业务服务器返回当前房间人数。
4. 观众 1 收到观众 2 进群自定义消息，在线人数＋1。
5. 观众 2 调用业务服务器退房接口生成退房记录。
6. 观众 2 调用 imsdk 接口发送退群自定义消息，可与步骤 5 同步进行。
7. 观众 1 收到观众 2 退群自定义消息，在线人数－1。

## 方案二：使用 IMSDK 接口

> **注意：**
> ILiveSDK 暂未提供该方案，推荐使用方案一。

通过 IMSDK 接口获取直播间在线人数主要有两种方式：
* AVChatRoom 通过群组资料获取人数
    * 不是实时的，有 1 分钟左右的时延
    * 只返回人数
* AVChatRoom 注册 TIMGroupEventListener 接口收到进群、退群事件时获取人数
    * imsdk2.4 支持
    * 统计结果存在时延
    * 只返回人数
    * 人数较少场景（比如只有几十人），统计结果偏差明显

### 流程图

![](http://mc.qcloudimg.com/static/img/b16adf18652b99993810d07054ec7c9b/image.png)

### 步骤描述

1. 观众 2 进入直播。
2. 观众 1 和观众 2 收到观众 2 的进群事件通知，使用附带的人数字段 memberNum 更新在线人数。
3. 观众 2 退出直播。
4. 观众 1 收到观众 2 的退群事件通知，使用附带的人数字段 memberNum 更新在线人数。
