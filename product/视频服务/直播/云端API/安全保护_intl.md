﻿ 
## Feature Description
Security hotlink protection is a URL with a hotlink protection signature. The URL with signature can work with the security mechanism of Tencent Cloud server to limit the URL operation permission to your App. In this way, malicious third parties cannot use or propagate the URL even if they get it.

(1) **Push** - It is highly necessary to add a hotlink protection signature to a push URL, especially when the LVB Code is bound with the user ID. The LVB Code IDs of famous VJs are easily stolen by attackers who will pretend to be the VJs to push streams in a preemptive manner. Therefore, the hotlink protection signature needs to be added to the push URL, ensuring only VJs themselves can get the hotlink protection signatures after login.

(2) **Playback** - It is necessary to add a hotlink protection signature to a playback URL only when your video source is very popular (for example, exclusive event LVB). The hotlink protection signature can prevent your competitors from obtaining the playback URL and broadcasting the program on their Apps. The loading speed of a video may become unstable if hotlink protection is added, because the system needs to apply for hotlink protection signature before playing the video.

## Principles
The following figure shows typical security hotlink protection URLs. Such URLs share a common feature: the **txSecret** and **txTime** parameters are concatenated to the end of the original push or playback URLs.

![](//mccdn.qcloud.com/static/img/b75148662176ff29eef17210b5d3d4f1/image.png)

**txTime** specifies the validity period of an URL, for example, 5 minutes. If the URL is used again after 5 minutes, Tencent Cloud considers it as an expired URL and rejects the request.

But txTime is not enough. Any attackers can add one txTime with the validity period of 100 days to the end of a stolen URL. Therefore, Tencent Cloud needs a security measure to ensure that attackers cannot forge txTime, and that is **txSecret**.

**txSecret** is a security signature computed by your server by using the following formula: **txSecret = MD5 (KEY + stream_id + txTime)**

>- **KEY**
>  A **security key** that you submit to and exchange with Tencent Cloud on the console, which should not be disclosed to any third party and should be changed periodically.
>	
>- **stream_id**
>	The LVB Code. When many VJs are online simultaneously, txTime of the VJs may be the same and stream_id is used to prevent duplication.
>	
>- **MD5**
>	MD5 is the most famous unidirectional irreversible hash algorithm. For its irreversible feature, attackers cannot compute the key reversely based on txSecret, nor compute a txSecret that can be verified by Tencent Cloud based on the forged txTime.


## Combination Steps
The security hotlink protection mechanism needs the collaboration of the customer server and Tencent Cloud backend, as shown below:
![](//mccdn.qcloud.com/static/img/4ea1512fd335f68f30cca0a01e902966/image.png)

- **Step 1 - Exchange the key**
You need to negotiate an **encryption key** on the console at the official website. This encryption key is used to generate a hotlink protection signature on your server. Since Tencent Cloud has the same key as yours, it can decrypt and verify the hotlink protection signature generated by your server.

 Encryption keys are classified into **push hotlink protection keys** and **playback hotlink protection keys**. The former are used to generate the push hotlink protection URLs and the latter are used to generate the playback hotlink protection URLs. You can configure push hotlink protection keys in the [LVB Console](https://console.cloud.tencent.com/live), as shown below:
 ![](//mc.qcloudimg.com/static/img/6dcddb480ffab18886d8b245a2707af9/image.png)

 > The play hotlink protection keys cannot be frequently changed in the debugging phase because of long synchronization periods. Contact us if you need to change the key.

- **Step 2 - Generate txTime**
In the signature, the plaintext is txTime, which indicates the URL validity period. For example, if the current time is 2016-07-29 11:13:45 and the generated URL is expected to expire after 5 minutes, txTime can be set to 2016-07-29 11:18:45.

 The long time string occupies large space in the URL. In actual applications, 2016-07-29 11:18:45 is converted into the UNIX timestamp, that is, 1469762325 (the various backend programming languages are directly handled by available time functions in the conversion). Then, the timestamp is converted into a value in hexadecimal notation, that is, txTime = 579ACB15.

- **Step 3 - Generate txSecret**
txSecret is generated as follows: txSecret = **MD5(KEY+ stream_id + txTime)**. The key here is the encryption key exchanged with Tencent Cloud in Step 1. In this example, stream_id is 8888_test001, and txTime is 579ACB15 as calculated above. MD5 is the standard unidirectional irreversible hash algorithm.

- **Step 4 - Construct the hotlink protection URL**
  Combine the push (or playback) URL, the txTime indicating the expiration time of the URL and the txSecret that can be decrypted and verified only by Tencent Cloud to generate a secure hotlink protection URL.

