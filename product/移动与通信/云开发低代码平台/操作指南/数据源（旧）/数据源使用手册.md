## 新建数据源

### 数据源分类

根据数据源目的及存储方式的不同，数据源可分为以下两类：
<table>
<tr>
<th>数据源模型</th>
<th>说明</th>
</tr>
<tr>
<td><a href = "#model1">自建数据源</a></td>
<td>使用腾讯云微搭低代码提供的数据库存储数据</td>
</tr>
<tr>
<td><a href = "#model2">外部数据源</a></td>
<td>使用第三方已有的数据源集成到腾讯云微搭低代码平台</td>
</tr>
</table>

两种类型数据源的创建过程略有区别, 下边会分别介绍说明。

### 新建自建数据源[](id:model1)

#### 填写基础信息
![](https://qcloudimg.tencent-cloud.cn/raw/d42c2730fffff92bb753057f3e797679.png)

>!数据源标识为数据源的唯一标识，在微搭应用编辑器及应用的低代码编辑器中均需要借助这个标识来使用数据源，故这个标识应当遵循一般代码变量命名规则，命名时应当具有一定的可读性,平台会自动为用户输入的内容增加一个随机唯一的后缀，以保证数据源标识的唯一性。

#### 创建方式

创建方式分为两种：

- **默认方式** ：使用默认行为创建数据源, 为数据源添加默认的字段及内置方法。
- **Excel 上传**：在 默认方式 之上, 通过上传 Excel 文件, 平台对文件进行解析完成数据源结构和数据值的初始化。 
>!表格的表头会自动添加至数据源字段中, 故表头名应符合数据源字段命名要求：以英文开头且只能包含英文、数字及下划线。
>
![](https://qcloudimg.tencent-cloud.cn/raw/f9200356623437f8f5d461ddf23ad472.png)

#### 填写字段配置
![](https://qcloudimg.tencent-cloud.cn/raw/542437389153cf503615948f20c120c2.png)

数据源模型数据源会预置六个字段：
- 数据标识：\_id
- 创建时间：createdAt
- 更新时间：updatedAt
- 所有人：owner
- 创建人：createBy
- 修改人：updateBy

>?
- 预置字段不可编辑不可删除，可单击**添加字段**来添加自定义字段。
- 若自建数据源的内置方法不满足需求, 可添加自定义方法, 具体可参见 [添加数据源自定义方法](#custom)。

### 新建外部数据源[](id:model2)

#### 填写基础信息
![](https://qcloudimg.tencent-cloud.cn/raw/f7e7eb0bbfd7bed848043c76d2176510.png)

>!如新建自建数据源一样，数据源标识为数据源的唯一标识，在微搭应用编辑器及应用的低代码编辑器中均需要借助这个标识来使用数据源。故这个标识应当遵循一般代码变量命名规则，命名时应当具有一定的可读性。平台会自动为用户输入的内容增加一个随机唯一的后缀，以保证数据源标识的唯一性。

#### 数据来源

数据来源分为**模版创建**和**配置导入**两种：

- 模版创建：使用预置模版来创建外部数据源。目前有以下几个模版：
	- 空白模版：不预置任何内容, 需要用户手动添加方法。
	- 腾讯会议：预置腾讯会议的创建、查询、取消等方法，需 Oauth 授权微搭访问腾讯会议。
	<dx-alert infotype="notice" title="">
据腾讯会议要求，腾讯会议的企业用户在授权微搭时需要企业的腾讯会议管理会管理员配置后方可正常授权使用。
</dx-alert>
	- 腾讯文档：预置操作腾讯文档表格相关方法，需 Oauth 授权微搭访问腾讯文档。
- 配置导入：使用第三方 HTTP API 描述文件来创建数据源。目前支持以下两种格式：
	- Postman：支持 Postman 2.1规范的 Json 描述文件。可将 Postman 中的添加的接口导出为 2.1 格式的文件后，再在微搭中导入。
	- OpenAPI：支持 Openapi 3.0(即 Swagger 2.0)规范的 Json 描述文件。

#### 公共变量

数据源里的方法可能会有一些公共固定的参数。前端应用使用时并不需要传递, 但又需要调用第三方接口，例如：
- 调用第三方数据源需要的认证信息，如 Access-Token、Secret-Key
- 来源标识信息，如 AppID、AffiliateID
- 其他业务相关的公共参数：
![](https://qcloudimg.tencent-cloud.cn/raw/b6a8854c286fb442c481c4694106c9ca.png)

这些公共的固定参数，可以在公共变量中添加。在数据源的方法中，根据方法类型不同，使用公共变量的方式也有不同：
 - 在 HTTP 请求中，可在 HTTP 配置的值中使用 `{{vars.<公共变量的key>}}` 来使用对应公共变量的值，具体可参考 HTTP 请求。
 - 在云函数中，可在函数代码中通过 `context.vars.<公共变量的key>` 来使用对应公共变量的值，具体可参考云函数 context。

## 添加数据源自定义方法[](id:custom)
![](https://qcloudimg.tencent-cloud.cn/raw/9a914aabadde859d34bb9b88e32bc885.png)

根据数据源方法意图及实际使用场景，微搭已预置了5种默认方法：

| 数据源方法意图 | 对应方法标识 | 说明 |
| --- | --- | --- |
| 查看多条 | wedaGetList | 返回多条数据记录，适用于前端需要展示列表、表格等场景 |
| 查看多条 | wedaGetRecords | 按查询条件返回多条数据记录，适用于前端需要展示列表、表格等场景 |
| 查看单条 | wedaGetItem | 返回单条数据记录，适用于前端需要展示详情、信息卡片等场景；前端编辑数据的场景也会需要使用该类型方法获取需要编辑的数据 |
| 修改数据 | wedaUpdate | 更新已存在的数据记录，例如更新个人信息，修改已发布的文章等 |
| 删除数据 | wedaDelete | 删除（也包括多选删除）已有数据记录，例如多选删除 |
| 新增数据 | wedaCreate | 添加新的数据记录，例如注册用户，发布文章等 |

### 方法入参

在微搭应用编辑器中使用数据源时，会使用到数据源方法入参中描述的结构信息，例如：
1. 数据源变量的定义中，会根据入参提示的结构生成变量的配置表单（提示出字段的中文名，根据不同类型显示不同的表单控件）。
2. 表单容器关联数据源方法后，会根据入参结构信息生成完整的表单。例如：入参中字段名称会变成表单输入框的字段标题，入参中字段的数据类型可能会用于生成不同类型的输入框（手机号输入框/邮件输入框/开关选择器等），入参中枚举信息会用于生成多选输入框或者下拉选框等等。


>?
>- 入参即用于描述上述函数 params 的结构。若函数无参数，则不填写。
>- 若函数有参数，则参数必须为对象，入参中描述字段结构应当与函数实际使用的 params 结构一致，否则在微搭应用编辑器中使用时可能出错。
>- 上述数据源方法入参在微搭应用编辑器中的使用场景有很多，故在填写入参时信息提供的越完整，在微搭应用编辑器中使用时则越方便。

### 方法类型

数据源方法根据实现方式，分为两种：

- **HTTP 请求：**仅外部数据源中提供该类型方法，可简单对接第三方 HTTP 接口，可以通过简单的配置 HTTP 请求地址 、方法 、参数等等。即可往完成方法的配置。
- **云函数：** 通过编写 JS 代码来实现更灵活的功能，包括发起 HTTP 请求。

关于不同类型方法的参数说明可参见 [数据源 API 文档](https://docs.cloudbase.net/lowcode/datasource/add-methods#http%E8%AF%B7%E6%B1%82)。

## 应用中使用数据源

目前有可视化界面和低代码两种使用数据源的方式。

### 可视化界面

通过可视化界面主要有两种形式：**通过变量管理、通过组件**。

#### 通过变量管理

在低码编辑器中，还可以通过变量管理中通过添加数据源变量的方式来更方便的使用数据源。
![](https://qcloudimg.tencent-cloud.cn/raw/3b52817f6bd862a80e1aa80e55e292f6.png)

数据源变量定义好后, 可通过下列两种方式使用：
- 可以在组件编辑时，绑定数据源变量的值。
- 还可以在低代码编辑器中使用 `app.dataset.state.<全局数据源变量标志>` 和`$page.dataset.state.<页面数据源变量标志>`，使用全局和页面的数据源变量。

#### 通过组件使用数据源

- 在表单容器等组件中，可以绑定数据源，并借助数据源的描述信息，自动对组件进行配置：
![](https://qcloudimg.tencent-cloud.cn/raw/9ab5a32ddffd10ad612c65c112262a86.png)
- 在组件事件配置中，亦可以绑定数据源方法：
![](https://qcloudimg.tencent-cloud.cn/raw/e05fe83fe92e046843dba77d797b836f.png)


### 低代码

低码框架会在低码运行环境中注入全局对象以方便的访问使用数据源相关方法，可以在应用的低代码编辑器及微搭组件的组件代码中使用。有如下两种形式，可根据自己需要来选择使用：
![](https://qcloudimg.tencent-cloud.cn/raw/8f3fd3a43452c76aa40330d36b8aab11.png)
<dx-codeblock>
:::  js
app.cloud.callDataSource({ dataSourceName:<数据源标志>, methodName: <数据源方法名称>, params: params }): Promise<Object>
app.cloud.dataSources.<数据源标志>.<数据源方法名称>(params): Promise<Object>
//注意:若调用的数据源或数据源方法不存在，会报语法错误
:::
</dx-codeblock>

## 管理数据源

### 查看数据源

在数据源管理界面，可以查看微搭中所有的数据源，单击列表中的某一个条即可进入对应条目的数据源详情页面。
>!
>- 在查看数据源详情中的方法时，类型为云函数的方法会自动将代码折叠起来，需要单击 **查看详情**来展开。
>- 可以通过数据源详情页面底部的关联应用，查看那些应用使用了当前数据源，单击应用名称可直接进入对应应用的详情页面。

### 编辑数据源

进入**数据源详情**页面，单击右上角**编辑**，即可对当前数据源进行编辑。


### 发布数据源

数据源运行环境分为体验环境与正式环境两种。

![](https://qcloudimg.tencent-cloud.cn/raw/1b765a3640c815f543ce4632212888a8.png)

在数据源列表页面和数据源详情页面，状态为未发布的数据源均有**立即发布**按钮，可用于发布数据源，即更新正式环境。
![](https://qcloudimg.tencent-cloud.cn/raw/35aed547a7d342c63806f2870b678f6e.png)

### 删除数据源

在数据源列表页面可对数据源进行删除操作，但删除前需确保数据源未被应用使用，否则删除按钮将处于禁用状态。
![](https://qcloudimg.tencent-cloud.cn/raw/713b6c4abf1c5de693faf0aac8931e7b.png)

### 移除应用对数据源的关联

应用使用数据源后，即与数据源产生了关联关系。关联后数据源无法删除，应用正式发布时其使用的数据源必须发布。若想移除关联，在应用中移除对数据源的使用即可，例如：

- 在变量管理中删除使用该数据源创建的变量
- 在低代码编辑器中删除调用该数据源方法的代码
- 在表单容器、数据容器、列表数据源等数据源相关的容器中解除对当前数据源的绑定
- 在组件的事件绑定中移除调用当前数据源的数据源事件绑定

### 管理数据源产生的数据

自建数据源产生的数据源均存储在微搭平台中，微搭提供了专门的数据管理后台来查看管理这些数据。外部数据源产生的数据则需要进入对应第三方平台进行查看管理。可通过以下两种方式进入微搭的数据管理后台：
- 在数据源列表页面：
![](https://qcloudimg.tencent-cloud.cn/raw/756d16bb98945167b019b58da4a41302.png)
 - 单击顶部的**数据管理后台**，进入微搭专门的数据管理工具首页。
 - 单击列表操作列中的**管理数据**(外部数据源无此按钮)进入当前数据源对应的管理页面。
- 在应用详情页面：单击左侧的数据管理后台菜单下的**正式数据**或**体验数据**。
![](https://qcloudimg.tencent-cloud.cn/raw/d4dcc96f5bb4c305912844b548ad748e.png)
