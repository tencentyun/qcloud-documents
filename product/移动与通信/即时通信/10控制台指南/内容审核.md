
IM 内容审核包提供了基于 IM 场景下的内容审核（反垃圾信息）服务，包含 [本地审核](#bdsh) 和 [云端审核](#ydsh) 两个功能，可针对不安全、不适宜的消息内容进行识别和处理，为您的产品体验和业务安全保驾护航。

[](id:bdsh)
## 本地审核
本地审核功能，全称“客户端本地文本审核”，通过在客户端本地完成敏感词的拦截或者替换，实现过滤敏感词的效果。可用于拦截/替换在发送文本消息、修改昵称/备注/群公告等操作中产生的、不希望被发送的文本敏感词。

> ! 该功能仅支持终端 SDK 增强版 6.8 、Web SDK 2.24.0 及以上版本。

本地审核仅对文本内容进行检测，支持如下场景：

- 单聊文本消息：在双人聊天场景下通过 IMSDK 发送的文本消息
- 单聊自定义消息：在双人聊天场景下通过 IMSDK 发送的自定义消息
- 群聊文本消息：在群组（包括好友工作群 Work、陌生人社交群 Public、临时会议群 Meeting、直播群 AVChatRoom、社群 Community）聊天场景下通过 IMSDK 发送的文本消息
- 群聊自定义消息：在群组（包括好友工作群 Work、陌生人社交群 Public、临时会议群 Meeting、直播群 AVChatRoom、社群 Community）聊天场景下通过 IMSDK 发送的自定义消息
- 资料文本内容：对用户资料（包含昵称、个性签名、自定义状态字段）、关系链资料（包含加好友附言字段）、群成员资料（包含群成员名片字段）、群组资料（群名称、群简介、群公告、加群附言、话题名称、话题公告、话题简介字段）进行修改所产生的文本内容

本地审核词库是由开发者在控制台配置的，分为拦截词库和替换词库，支持关键词和正则表达式两种检测方式，IMSDK 在登录后会自动获取词库。
IMSDK 在发送文本内容时，如果文本内容命中了拦截词库的敏感词，则该文本不会发送至服务端；如果命中了替换词库的敏感词，则会把文本中的敏感词替换成控制台配置的指定字符再发送至服务端。

## 接入流程

### 步骤1：开通本地审核功能

请前往即时通信 IM [购买页](https://buy.cloud.tencent.com/avc?activeId=safe%C2%AEionId=1)，购买后即刻生效。体验版、专业版、旗舰版应用均可购买本地审核服务。
![](https://qcloudimg.tencent-cloud.cn/raw/aed5d0d24cbc977040de062e0d60e8e9.png)

### 步骤2：配置词库

开通本地审核功能后，进入 **即时通信 IM 控制台** > **内容审核** > [**本地审核**](https://console.cloud.tencent.com/im/local-audit-setting)，进行配置。

> !词库分为拦截词词库和替换词词库，两个词库总上限10000词，其中正则表达式不超过200个。

1. **添加拦截词词条**：单击 **添加拦截词** 后，选择需要添加的**词条格式**。
![](https://qcloudimg.tencent-cloud.cn/raw/bce6e8d53fde12678ac00b57591d7295.png)
**关键词**格式的词条，可以通过**手动输入**或者**文件上传**的方式添加。手动输入，单次最多添加50个词；文件上传仅支持 .txt 格式的文本，不限制单次添加个数，但添加词条总数应小于词库上限，否则添加失败。
**正则表达式**格式的词条，仅支持**手动输入**。
> !因正则表达式对性能影响较高，请您务必在添加正则表达式前进行耗时测试，避免影响您业务可用性。
> 
![](https://qcloudimg.tencent-cloud.cn/raw/30c4bc3d9a69c000795b89996e5711ff.png)
2. **添加替换词词条**：单击 **添加替换词** 后，选择需要添加的**词条格式**。
![](https://qcloudimg.tencent-cloud.cn/raw/ecf7de7a6e5d9cbb056a6c31f3be2ea4.png)
**关键词**格式的词条，可以通过**手动输入**或者**文件上传**的方式添加。手动输入，单次最多添加50个词；文件上传仅支持 .txt 格式的文本，不限制单次添加个数，但添加词条总数应小于词库上限，否则添加失败。**正则表达式**格式的词条，仅支持**手动输入**。同时，输入需要**全部替换为**的内容，默认是“\*”，支持自定义内容。
> !因正则表达式对性能影响较高，请您务必在添加正则表达式前进行耗时测试，避免影响您业务可用性。
>
![](https://qcloudimg.tencent-cloud.cn/raw/40b08f8a7746fcf50c2f122d87362665.png)
3. 可根据业务实际需要，**搜索**、**逐个删除**、**批量删除**拦截词词库或者替换词词库中的词条。

### 步骤3：选择审核场景

默认为您全部勾选审核场景，您可通过单击**编辑**，在审核场景配置弹窗中操作**勾选/取消勾选**并**确定**。
![](https://qcloudimg.tencent-cloud.cn/raw/8a7a95bd990a667645abc2f9b82ec9da.png)
![](https://qcloudimg.tencent-cloud.cn/raw/7e81ca86a76e37bef514229050dfaedc.png)


### 步骤4：IMSDK 更新词库

词库添加完成之后，IMSDK 需要重新登录才能更新词库。
以发送文本消息为例，当内容中包含拦截词库中的敏感词时，消息发送失败，终端 SDK 回调的错误码为7015，Web SDK 回调的错误码为3123；当内容中包含替换词库中的敏感词时，敏感词会被替换成控制台配置的指定字符，再将替换后的内容发送至服务端。


[](id:ydsh)
## 云端审核
云端审核功能，是一款在云端（服务端）进行内容智能识别和拦截的服务。
- 支持对文本、图片内容同步审核，对音频、视频内容异步审核；
- 支持分别针对单聊、群聊、资料三大场景中产生的不同类型内容进行策略配置；
- 支持配置特定终端用户产生/接收的消息不送审，支持对返回审核结果进行配置；
- 支持查看审核用量抵扣明细、审核结果明细、审核识别统计等数据；
- 能够精准识别可能令人反感、不安全或不适宜的内容，有效降低内容违规风险与有害信息识别成本。

## 接入流程
### 步骤1：购买云端审核资源包
请前往即时通信 [IM 购买页](https://buy.cloud.tencent.com/avc?activeId=safe&amp;regionId=1)，购买云端审核资源包。体验版、专业版、旗舰版应用均可购买，购买完成后即刻生效。
>!开通服务后，默认为您开启图文审核场景，并配置默认审核策略（默认识别并拦截包含**高风险敏感事件/人物、高风险色情/辱骂/暴恐/违禁**等内容，如果您需要更严格/更宽松的审核策略，或者您需要**增加中、低风险内容审核策略**，请参见 [审核策略配置](#step2_3_2) 进行操作），您可通过单击对应模块的**编辑**，分别更改 [**审核场景**](#step2_3_1) 和 [**审核策略**](#step2_3_2)。

### 步骤2：打开云端审核功能开关
进入 即时通信 **IM 控制台** > **内容审核** > [**云端审核**](https://console.cloud.tencent.com/im/cloud-audit-setting)，单击页面内模块右上角的**开关**，开启云端审核服务。
![](https://qcloudimg.tencent-cloud.cn/raw/9e5336aa1d12a9c7468ebabaa740d99e.png)
>!
>- 开通服务后，默认为您开启图文审核场景，并配置默认审核策略（默认识别并拦截包含**高风险敏感事件/人物、高风险色情/辱骂/暴恐/违禁**等内容，如果您需要更严格/更宽松的审核策略，或者您需要**增加中、低风险内容审核策略**，请参见 [审核策略配置](#step2_3_2) 进行操作），您可通过点击对应模块的编辑按钮，分别更改审核场景和审核策略。
>- 如果您未提前购买云端审核资源包，在控制台直接开通云端审核服务后，产生的审核量将按照后付费计费规则扣除费用，请及时 [购买云端审核资源包](https://buy.cloud.tencent.com/avc?activeId=safe&regionId=1)，计费规则详见 [计费说明](https://cloud.tencent.com/document/product/269/81908#check)。

### 步骤3：自定义审核配置
[](id:step2_3_1)
#### 1. 审核场景配置
打开云端审核服务开关后，默认为您开启了单聊的文本和图片审核、群聊的文本和图片审核、用户资料/群资料/群成员资料/关系链资料的文本审核。如果需要开启音频/视频审核，或者关闭图文审核开关，请点击对应场景模块右上角的**管理配置**。
![](https://qcloudimg.tencent-cloud.cn/raw/6091d912e346e43c4ef28e4bd2357f8d.png)
在弹窗中**勾选/取消勾选**对应审核项，单击**确定**即可。
![](https://qcloudimg.tencent-cloud.cn/raw/bb31e4ce3024e89cbe9720583df31481.png)
>!单聊、群聊场景下，将音视/视频异步审核开启后，所有音频/视频都将正常送审并计费，但仅对存储在腾讯云即时通信 IM 的内容生效审核结果。如有自定义存储的音频/视频内容，请谨慎开启！如需审核自定义存储的音频/视频内容，请通过监听音频/视频审核结果的方式，进行拦载或撒回操作，详情请参见 [返回审核结果](#step2_4_1)。
>
[](id:step2_3_2)
#### 2. 审核策略配置
每个审核场景及内容类型均已配置默认审核策略，默认识别并拦截包含**高风险敏感事件/人物、高风险色情/辱骂/暴恐/违禁**等内容，如果您需要更严格/更宽松的审核策略，或者您需要**增加中、低风险内容审核策略**，请按照下方指引操作。
如果需要编辑审核策略，请点击对应场景及内容类型右侧的**编辑策略**。
![](https://qcloudimg.tencent-cloud.cn/raw/b885cd94e88925417411c46f431a624d.png)

- **文本/图片策略配置：**可以修改通用识别策略配置与自定义库信息。
 - 通用识别策略配置：勾选需要识别的风险类型
 - 自定义库信息：勾选需要关联的自定义词库（最多可支持设置5个自定义词库）
![](https://qcloudimg.tencent-cloud.cn/raw/ffc633e58b1a17fede57be75cdb37335.png)
- **音频策略配置：**可以修改通用识别策略配置、截帧策略配置与自定义库信息。
 - 通用识别策略配置：勾选需要识别的风险类型
 - 截帧策略配置：音频切片时长配置，支持滑动设定或填写整数，范围[1,60]
 - 自定义库信息：勾选需要关联的自定义词库（最多可支持设置5个自定义词库）
![](https://qcloudimg.tencent-cloud.cn/raw/2cf8a114f6a124b9f1c52d7609743d5a.png)
- **视频策略配置：**可以修改通用识别策略配置、截帧策略配置与自定义库信息。
 - 通用识别策略配置：勾选需要识别的风险类型，包括对图片和音频的识别
 - 截帧策略配置：审核内容配置，支持仅审核视频画面、仅审核音频和全部审核；图片截帧间隔，支持滑动设定或填写整数，范围[1,60]；音频切片时长配置，支持滑动设定或填写整数，范围[1,60]
 - 自定义库信息：勾选需要关联的自定义词库（最多可支持设置5个自定义词库）
![](https://qcloudimg.tencent-cloud.cn/raw/175aa4024fe2d25482b623861e5d183e.png)
- **复制策略：**图文音视的编辑策略时，单击**复制策略**，可以将本策略复制到下拉选择的其他场景。
![](https://qcloudimg.tencent-cloud.cn/raw/1fbb050e0d687a88bf3949866a3b1403.png)

#### 3. 终端用户审核白名单配置
如果您不需要审核特定终端用户发送/接收的消息内容，您可以通过终端用户审核白名单模块进行配置。具体操作如下：
单击终端用户审核白名单配置模块的**添加**。
![](https://qcloudimg.tencent-cloud.cn/raw/8496fe80ff314c3cb72b1542143f4ae7.png)
在弹窗中**选择审核方式**，并**填入终端用户 ID**，单击**确定**。
![](https://qcloudimg.tencent-cloud.cn/raw/ca7336b7f8c4fb697ff40f12ced7b34b.png)
支持对已添加的终端用户 ID **编辑不送审方式**、**删除/批量删除**添加白名单记录。

### 步骤4：审核结果配置
[](id:step2_4_1)
#### 1. 返回审核结果
审核结果可以通过配置基础回调的方式，将结果转发给 App 后台。具体操作如下：
返回审核结果开关**默认关闭**，如果需要打开，点击审核结果配置模块右上角的**编辑**，**打开**返回审核结果开关，单击**确定**。
![](https://qcloudimg.tencent-cloud.cn/raw/1c0877f28a033af215b24f4814ad5531.png)
审核结果将使用 **后回调** 发送至您在基础配置中配置的 URL 地址，如果您在开启返回审核结果开关前未配置基础回调 URL，请在打开开关时弹出的弹窗中填写基础回调 URL，详情请参见 [基础回调配置](https://cloud.tencent.com/document/product/269/32431#.E5.9F.BA.E7.A1.80.E5.9B.9E.E8.B0.83.E9.85.8D.E7.BD.AE)。
![](https://qcloudimg.tencent-cloud.cn/raw/e37d1f54018210e5938aa8362782d4b3.png)
开关开启后，内容回调的结果将通过基础回调抄送到 App 后台，支持拦截、所有结果的配置选项。
>!App 后台在收到回调请求之后，务必校验请求 URL 中的参数 SDKAppID 是否是自己的 SDKAppID。

#### 接口说明

#### 请求 URL 示例

以下示例中 App 配置的回调 URL 为 `https://www.example.com` 。
**示例：**
```
https://www.example.com?SdkAppid=$SDKAppID&CallbackCommand=$CallbackCommand&contenttype=json
```

#### 请求参数说明

| 参数 | 说明 |
| --- | --- |
| https | 请求协议为 HTTPS，请求方式为 POST |
| [www.example.com](http://www.example.com) | 回调 URL |
| SdkAppid | 创建应用时在即时通信 IM 控制台分配的 SDKAppID |
| CallbackCommand | 固定为：ContentCallback.ResultNotify |
| contenttype | 请求包体固定为 JSON |

#### 请求包示例

```
{
    "Scene":"C2C",
    "SdkAppId":1400187352,
    "From_Account":"jared",
    "ContactItem":{
        "ContactType":1,
        "To_Account":"Jonh"
    },
    "ContentType":"Text",
    "TextContent":[
        "aaabbbccc",
        "1234567"
    ],
    "MsgID":"1434460578_4137340972_1661154487",
    "CtxcbResult":1,
    "CtxcbRequestId":"241ed925-4c56-4357-95dd-1e6e7798f214"
}
```

#### 请求包字段说明

| 字段 | 类型 | 说明 |
| --- | --- | --- |
| Scene | String | 送审场景：<br>单聊=C2C；<br>单聊自定义消息=C2CCustom；<br>群聊=Group；<br>群聊自定义消息=GroupCustom；<br>群资料=GroupInfo；<br>群成员资料=GroupMemberInfo；<br>关系链=RelationChain；<br>用户资料=UserInfo； |
| From_Account | String | 送审内容的发起者 UserID |
| ContactItem | Object | 消息送审时，表示消息接收对象 |
| ContactType | Integer | 消息送审时，区分接受对象为群组或单聊。<br>ContactType=1表示单聊；<br>ContactType=2表示群聊； |
| To_Account | String | ContactType=1时，表示消息接收方 UserID |
| ToGroupId | String | ContactType=2时，表示消息接收方 GroupID |
| ContentType | String | 表示送审的内容类型：<br>文本=Text；<br>图片=Image；<br>音频=Audio；<br>视频=Video |
| TextContent | String | 当 ContentType 为 Text 时，表示送审的文本内容 |
| FileURL | String | 当 ContentType 为 Image/Audio/Video 时，表示送审的文件 URL |
| MsgID | String | 单聊送审，MsgID 为单聊消息 MsgKey；群聊送审，MsgID 为群聊消息 MsgSeq。|
| CtxcbResult | Integer | 第三方内容服务审核结果，1表示拦截；0表示放过。|
| CtxcbRequestId | String | 第三方内容服务审核标示 |

#### 应答包示例

```
{
    "ActionStatus": "OK",
    "ErrorInfo": "",
    "ErrorCode": 0 // 0为回调成功，1为回调出错
}
```

#### 应答包字段说明

| 字段 | 类型 | 属性 | 说明 |
| --- | --- | --- | --- |
| ActionStatus | String | 必填 | 请求处理的结果，OK 表示处理成功，FAIL 表示失败 |
| ErrorCode | Integer | 必填 | 错误码 |

#### 2. 下发拦截错误码
针对图文同步审核，**默认下发拦截错误码**，即消息发送方会收到消息被拦截的错误码提示。
如果需要发送方对被消息拦截无感知，即发送方不需要收到消息下发失败的提示，可通过关闭“下发拦截错误码”开关实现。具体操作如下：
单击审核结果配置模块右上角的**编辑**，关闭“下发拦截错误码”开关，单击**确定**。
![](https://qcloudimg.tencent-cloud.cn/raw/14cbcbb23d4663beb5c631b0fe24ae0f.png)
>!为方便您回溯消息未成功发送的原因，您需要在关闭“下发拦截错误码”开关前，开启“返回审核结果”开关，接收审核结果。开启“返回审核结果”开关步骤详情请参见 [返回审核结果](#step2_4_1)。

### 步骤5：查看审核明细和抵扣明细

#### 1. 查看审核明细
在审核用量中可查看今日审核用量数据。
![](https://qcloudimg.tencent-cloud.cn/raw/304f85e5d0ebd1a8eed5cc628e2c8611.png)
>!用量明细数据仅供参考，审核用量的计费数据以抵扣明细数据为准。
>
单击模块右上角的**查看审核明细**，可查看历史审核的明细数据。
![](https://qcloudimg.tencent-cloud.cn/raw/44c8424410e42f324ba62cc4db8ee099.png)
单击模块右上角的**查看识别统计**，可查看历史审核的统计数据。
![](https://qcloudimg.tencent-cloud.cn/raw/0614803b47e3e252ec85446b848d0391.png)

#### 2. 查看抵扣明细

单击按钮**查看抵扣明细**。
![](https://qcloudimg.tencent-cloud.cn/raw/495b3cc90133e41818e22ac486a0d0c0.png)
支持筛选、查看特定日期内审核产生用量的具体抵扣数据（每小时更新）。
![](https://qcloudimg.tencent-cloud.cn/raw/78dc5386e1733bf39933fb10ba9cc2af.png)
如果您已购买预付费资源包，可在资源包管理页面查看资源包可用量、有效期等信息。
![](https://qcloudimg.tencent-cloud.cn/raw/c5fc24fc5939558b56c44e168498a842.png)


## 常见问题
### 怎么控制通过调用 REST API 接口发送的单聊/群聊消息不送审？
根据您的业务需要，在单聊 REST API 接口或者群聊 REST API 接口的 SendMsgControl 字段中指定 “NoMsgCheck” 控制字段，即可。

### 怎么能快速为同一个 sdkappid 的不同内容配置相同的审核策略？
图文音视的编辑策略时，单击策略配置下方的**复制策略**，可以将本策略复制到下拉选择的其他场景。
![](https://qcloudimg.tencent-cloud.cn/raw/57fd2a5c544850fe2e1c74063bf5a9ca.png)
