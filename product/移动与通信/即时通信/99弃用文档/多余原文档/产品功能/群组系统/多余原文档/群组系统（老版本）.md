## 群组系统简介
所谓群组系统，本质上就是一个支持多人聊天的即时通讯系统。群组系统所具备的基本能力包括：

1. 内置私有群、公开群、聊天室三种群组形态；
1. 完备的群组管理能力；
1. 最大支持10000人群；
1. 具备消息漫游能力。

除此之外，具备高度可定制性，是腾讯云即时通信群组系统的一大特色，具体包括：

1. [自定义消息格式](/doc/product/269/消息格式描述#.E8.87.AA.E5.AE.9A.E4.B9.89.E6.B6.88.E6.81.AF.E5.85.83.E7.B4.A0)；
1. [自定义群组ID](#.E8.87.AA.E5.AE.9A.E4.B9.89.E7.BE.A4.E7.BB.84id)；
1. [自定义群组形态](#.E8.87.AA.E5.AE.9A.E4.B9.89.E7.BE.A4.E7.BB.84.E5.BD.A2.E6.80.81)；
1. [自定义字段](#.E8.87.AA.E5.AE.9A.E4.B9.89.E5.AD.97.E6.AE.B5)；
1. [自定义回调](#.E8.87.AA.E5.AE.9A.E4.B9.89.E5.9B.9E.E8.B0.83)。

## 群组形态介绍

群组系统当前提供三种默认群组形态：

1. 私有群（Private）：适用于较为私密的聊天场景，群组资料均不公开，类似于微信群。
2. 公开群（Public）：适用于公开群组，具有较为严格的管理机制、准入机制，类似于QQ群。
3. 聊天室（ChatRoom）：群成员可以随意进出，组织较为松散。

三种群组形态之间的主要差异如下：

<table style="display:table;width:100%" >
		<tbody>
			<tr>
				<td style="width:10%;">
					<br>
				</td>
				<td style="width:22%;">
					控制项
				</td>
				<td>
					备注
				</td>
				<td>
					私有群
				</td>
				<td>
					公开群
				</td>
				<td>
					聊天室
				</td>
			</tr>
			<tr>
				<td rowspan="11">
					群组管理
				</td>
				<td>
					是否允许普通成员修改资料<br>
				</td>
				<td>
					<p>
						0：普通成员（非群主、管理员）不能修改群基础资料；
					</p>
					<p>
						1：普通成员可以修改群名称、简介、公告、头像，但不能修改其他字段。 
					</p>
				</td>
				<td>
					1
				</td>
				<td>
					0
				</td>
				<td>
					0
				</td>
			</tr>
			<tr>
				<td>
					是否公开<br>
				</td>
				<td>
					<p>
						<span style="line-height:1.5;">0：非群成员无法获取该群的公开资料；</span> 
					</p>
					<p>
						1：非群成员可以通过群ID获取该群的公开资料，例如群名称等。<span style="line-height:1.5;"></span> 
					</p>
				</td>
				<td>
					0
				</td>
				<td>
					1
				</td>
				<td>
					1
				</td>
			</tr>
			<tr>
				<td>
					是否允许需申请加群<br>
				</td>
				<td>
					<p>
						0：任何申请加群的请求都不被允许；
					</p>
					<p>
						1：依照申请加群选项来决定后续操作。
					</p>
				</td>
				<td>
					0
				</td>
				<td>
					1
				</td>
				<td>
					1
				</td>
			</tr>
			<tr>
				<td>
					是否允许拉人入群<br>
				</td>
				<td>
					<p>
						0：任何邀请他人入群的操作都是不允许的；
					</p>
					<p>
						1：群成员可以不经受邀请用户同意便将其拉入群中；
					</p>
					<p>
						2：群成员邀请他人入群时需要受邀用户同意才能入群。
					</p>
				</td>
				<td>
					1
				</td>
				<td>
					0
				</td>
				<td>
					0
				</td>
			</tr>
			<tr>
				<td>
					是否允许群主退群<br>
				</td>
				<td>
					<p>
						<span style="line-height:1.5;">0：群主不得退群，如果要退群，只能通过解散群的方式；</span> 
					</p>
					<p>
						1：群主可以退群，退群之后，群组将没有群主。
					</p>
				</td>
				<td>
					1
				</td>
				<td>
					0
				</td>
				<td>
					0
				</td>
			</tr>
			<tr>
				<td>
					是否允许群主解散群<br>
				</td>
				<td>
					<p>
						<span style="line-height:1.5;">0：群主不能解散群（但是APP管理员可以强制将其解散）；</span> 
					</p>
					<p>
						1：群主可以解散群。<span style="line-height:1.5;"></span> 
					</p>
				</td>
				<td>
					0
				</td>
				<td>
					1
				</td>
				<td>
					1
				</td>
			</tr>
			<tr>
				<td>
					是否允许设置管理员<br>
				</td>
				<td>
					<p>
						0：<span style="line-height:1.5;">群主不能设置管理员；</span> 
					</p>
					<p>
						1：群主可以设置管理员。<span style="line-height:1.5;"></span> 
					</p>
				</td>
				<td>
					0
				</td>
				<td>
					1
				</td>
				<td>
					1
				</td>
			</tr>
			<tr>
				<td>
					群组的默认申请加群选项<br>
				</td>
				<td>
					<p>
						0：禁止任何人申请加入群组；
					</p>
					<p>
						1：申请加入群组需要通过管理员审批；
					</p>
					<p>
						2：无需经过管理员审批即可直接加入群组。 
					</p>
				</td>
				<td>
					0
				</td>
				<td>
					1
				</td>
				<td>
					2
				</td>
			</tr>
			<tr>
				<td>
					是否允许普通成员踢人<br>
				</td>
				<td>
					<p>
						0：普通群成员不具有踢人权限，仅群主、管理员才可以；
					</p>
					<p>
						1：群内任意成员可以将任意其他成员踢出该群。
					</p>
					<p>
						2：所有人都不具有踢人权限。
					</p>
				</td>
				<td>
					0
				</td>
				<td>
					0
				</td>
				<td>
					0
				</td>
			</tr>
			<tr>
				<td>
					是否定期踢掉不在线的群成员<br>
				</td>
				<td>
					<p>
						0：群组不会定时清理不在线群成员；
					</p>
					<p>
						1：群组每5分钟清理一次群组，不在线的群成员将被踢出。 
					</p>
				</td>
				<td>
					0
				</td>
				<td>
					0
				</td>
				<td>
					0
				</td>
			</tr>
				<tr>
				<td>
					是否定期计算在数成员数量<br>
				</td>
				<td>
					<p>
						0：群组不会计算在线群成员数量；
					</p>
					<p>
						1：群组每5分钟计算一次在线的群成员数量。
					</p>
				</td>
				<td>
					0
				</td>
				<td>
					0
				</td>
				<td>
					0
				</td>
			</tr>
			<tr>
				<td rowspan="6">
					消息
				</td>
				<td>
					无限制历史消息<br>
				</td>
				<td>
					<p>
						0：群成员只能看到自己入群之后的消息；
					</p>
					<p>
						1：群成员可以看到自己入群之前的历史消息。
					</p>
				</td>
				<td>
					0
				</td>
				<td>
					0
				</td>
				<td>
					1
				</td>
			</tr>
			<tr>
				<td>
					成员变更通知<br>
				</td>
				<td>
					<p>
						0：群成员变更不会在群内发送消息；
					</p>
					<p>
						1：在群成员变更之后向所有群成员推送一条消息，客户端可以选择将这条消息展示给用户；
					</p>
					<p>
					  2：在群成员变更之后向所有群成员推送一条提示，客户端收到该提示之后对群成员列表进行更新，但不向用户展示这条提示。
					</p>
				</td>
				<td>
					1
				</td>
				<td>
					1
				</td>
				<td>
					0
				</td>
			</tr>
			<tr>
				<td>
					是否在首条消息之后激活群<br>
				</td>
				<td>
					<p>
						0：新创建的群组立即针对所有群成员可见；
					</p>
					<p>
						1：在创建群之后，不论当前群内有多少成员，只要创建者没有说话，其他群成员就不会感知到自己被拉入该群，只有创建者自己能感知到该群的存在。
					</p>
				</td>
				<td>
					1
				</td>
				<td>
					0
				</td>
				<td>
					0
				</td>
			</tr>

			<tr>
				<td>
					是否支持禁言<br>
				</td>
				<td>
					<p>
						0：管理员不能对群成员设置禁言；
					</p>
					<p>
						1：管理员可以对群成员设置禁言，群成员在禁言时间内无法发送群聊消息。
					</p>
				</td>
				<td>
					0
				</td>
				<td>
					1
				</td>
				<td>
					1
				</td>
			</tr>
			<tr>
				<td>
					默认消息接收选项<br>
				</td>
				<td>
					<p>
						0：接收并提示，表示客户端将接收消息并提示用户；
					</p>
					<p>
						1：屏蔽，表示不向客户端推送消息。
					</p>
					<p>
						2：接收不提示，表示客户端接收消息但不提示用户。
					</p>
				</td>
				<td>
					0
				</td>
				<td>
					0
				</td>
				<td>
					2
				</td>
			</tr>
			<tr>
				<td>
					是否支持未读计数<br>
				</td>
				<td>
					<p>
						0：不支持未读计数，客户端不展示未读消息；
					</p>
					<p>
						1：支持未读计数，客户端将展示未读消息。
					</p>
				</td>
				<td>
					1
				</td>
				<td>
					1
				</td>
				<td>
					0
				</td>
			</tr>
			<tr>
				<td>
					自动回收(暂不支持)
				</td>
				<td>
					群组自动回收时间（秒）<br>
				</td>
				<td>
					<p>
						0：群组永远不会被后台回收，除非群主解散，或者所有成员都退出群组；
					</p>
					<p>
						x：如果群在给定时间（x秒）内，既没有人说话，也没有成员变更，则静默回收该群。目的是节省APP在所占用的资源。
					</p>
				</td>
				<td>
					2592000 (30天)
				</td>
				<td>
					0
				</td>
				<td>
					0
				</td>
			</tr>
		</tbody>
	</table>
	
	
	
	
	
## 群组管理简介

在介绍群组管理方式之前，首先需要明确群组中各成员的角色：
1. 群主：即群组的创建者，拥有最高的管理权限。
1. 管理员：由群主任命的、协助群主来管理群组的群成员，拥有一定的管理权限。
1. 普通成员：不具备管理权限的群成员。

群内管理员具备的权限包括：
1. 修改群组基本资料；
1. 将普通群成员踢出群；
1. 将普通群成员禁言（即禁止其在一段时间内发言）；
1. 审批其他用户的入群申请。

群主具备管理员所拥有的各项权限之外，还拥有如下权限：
1. 任命/取消管理员；
1. 将管理员踢出群组；
1. 将管理员禁言。

不同群组形态所针对的应用场景不同，故而它们支持的管理方式稍有差别：
1. 私有群的管理方式较弱，其特点是：所有群成员可以修改群组的基本信息（如群名称）；不提供管理员这一角色；不提供禁言能力；群主不能解散私有群（群主退出后群组仍然存在）。
1. 公开群、聊天室均提供完整的的管理方式：支持设置/取消管理员；支持禁言；群主对于该群拥有绝对控制权限。
1. 各种群组形态在管理上的细微差异可以参见[群组形态介绍](#.E7.BE.A4.E7.BB.84.E5.BD.A2.E6.80.81.E4.BB.8B.E7.BB.8D)。

## 群组数据结构

### 群基础资料

<table style="display:table;width:100%" >
		<tbody>
			<tr>
				<td style="width:20%;">
					字段名称<br>
				</td>
				<td style="width:10%;">
					类型<br>
				</td>
				<td style="width:55%;">
					描述<br>
				</td>
				<td>
					备注<br>
				</td>
			</tr>
			<tr>
				<td>
					GroupId<br>
				</td>
				<td>
					String<br>
				</td>
				<td>
					群组的唯一标识<br>
				</td>
				<td>
					只读（注1）<br>
				</td>
			</tr>
			<tr>
				<td>
					Type<br>
				</td>
				<td>
					String<br>
				</td>
				<td>
					群组形态<br>
				</td>
				<td>
					只读（注2）<br>
				</td>
			</tr>
			<tr>
				<td>
					Name<br>
				</td>
				<td>
					String<br>
				</td>
				<td>
					群组名称（最长30字节）<br>
				</td>
				<td>
					（注3）<br>
				</td>
			</tr>
			<tr>
				<td>
					Introduction<br>
				</td>
				<td>
					String<br>
				</td>
				<td>
					群组简介（最长120字节）<br>
				</td>
				<td>
					（注3）<br>
				</td>
			</tr>
			<tr>
				<td>
					Notification<br>
				</td>
				<td>
					String<br>
				</td>
				<td>
					群组公告（最长150字节）<br>
				</td>
				<td>
					（注3）<br>
				</td>
			</tr>
			<tr>
				<td>
					FaceUrl<br>
				</td>
				<td>
					String<br>
				</td>
				<td>
					群组头像URL（最长100字节）<br>
				</td>
				<td>
					（注3）<br>
				</td>
			</tr>
			<tr>
				<td>
					Owner_Account<br>
				</td>
				<td>
					String<br>
				</td>
				<td>
					群主ID<br>
				</td>
				<td>
					只读<br>
				</td>
			</tr>
			<tr>
				<td>
					CreateTime<br>
				</td>
				<td>
					Integer<br>
				</td>
				<td>
					群组的创建时间<br>
				</td>
				<td>
					只读<br>
				</td>
			</tr>
			<tr>
				<td>
					InfoSeq<br>
				</td>
				<td>
					Integer<br>
				</td>
				<td>
					群资料的每次变都会增加该值<br>
				</td>
				<td>
					只读<br>
				</td>
			</tr>
			<tr>
				<td>
					LastInfoTime<br>
				</td>
				<td>
					Integer<br>
				</td>
				<td>
					群组最后一次信息变更时间<br>
				</td>
				<td>
					只读<br>
				</td>
			</tr>
			<tr>
				<td>
					LastMsgTime<br>
				</td>
				<td>
					Integer<br>
				</td>
				<td>
					群组内最后发消息的时间<br>
				</td>
				<td>
					只读<br>
				</td>
			</tr>
			<tr>
				<td>
					NextMsgSeq<br>
				</td>
				<td>
					Integer<br>
				</td>
				<td>
					群内下一条消息的Seq<br>
				</td>
				<td>
					只读（注4）<br>
				</td>
			</tr>
			<tr>
				<td>
					MemberNum<br>
				</td>
				<td>
					Integer<br>
				</td>
				<td>
					当前成员数量<br>
				</td>
				<td>
					只读<br>
				</td>
			</tr>
			<tr>
				<td>
					MaxMemberNum<br>
				</td>
				<td>
					Integer<br>
				</td>
				<td>
					最大成员数量<br>
				</td>
				<td>
					<br>
				</td>
			</tr>
			<tr>
				<td>
					ApplyJoinOption<br>
				</td>
				<td>
					String<br>
				</td>
				<td>
					申请加群选项<br>
				</td>
				<td>
					（注5）<br>
				</td>
			</tr>
		</tbody>
	</table>

>注：
1. 群组ID，APP内保证唯一，其格式前缀为@TGS#。另外，APP亦可[自定义群组ID](#.E8.87.AA.E5.AE.9A.E4.B9.89.E7.BE.A4.E7.BB.84id)。
1. 默认支持三种产品形态：Private表示私有群，Public表示公开群，ChatRoom表示聊天室。
1. 对于公开群和聊天室，这些数据只允许群主和APP管理员修改；但是对于私有群，这些数据允许任意群成员修改，具体可以参见[群组形态介绍](#.E7.BE.A4.E7.BB.84.E5.BD.A2.E6.80.81.E4.BB.8B.E7.BB.8D)中的相关描述。
1. 群组内每一条消息都有一条唯一的消息Seq，且该Seq是按照发消息顺序而连续的。从1开始，群内没增加一条消息，NextMsgSeq就会自增1。
1. 申请加群选项包括如下几种：DisableApply表示禁止任何人申请加入；NeedPermission表示需要群主或管理员审批；FreeAccess表示允许无需审批自由加入群组。

### 群成员资料
<table style="display:table;width:100%" >
		<tbody>
			<tr>
				<td style="width:20%;">
					字段名称
				</td>
				<td style="width:10%;">
					类型
				</td>
				<td style="width:55%;">
					描述
				</td>
				<td>
					备注
				</td>
			</tr>
			<tr>
				<td>
					Member_Account<br>
				</td>
				<td>
					String<br>
				</td>
				<td>
					群成员ID<br>
				</td>
				<td>
					只读<br>
				</td>
			</tr>
			<tr>
				<td>
					Role<br>
				</td>
				<td>
					String<br>
				</td>
				<td>
					群内身份<br>
				</td>
				<td>
					（注1）<br>
				</td>
			</tr>
			<tr>
				<td>
					JoinTime<br>
				</td>
				<td>
					Integer<br>
				</td>
				<td>
					入群时间<br>
				</td>
				<td>
					只读<br>
				</td>
			</tr>
			<tr>
				<td>
					MsgSeq<br>
				</td>
				<td>
					Integer<br>
				</td>
				<td>
					该成员当前已读消息Seq<br>
				</td>
				<td>
					只读<br>
				</td>
			</tr>
			<tr>
				<td>
					MsgFlag<br>
				</td>
				<td>
					String<br>
				</td>
				<td>
					消息接收选项<br>
				</td>
				<td>
					（注2）<br>
				</td>
			</tr>
			<tr>
				<td>
					LastSendMsgTime<br>
				</td>
				<td>
					Integer<br>
				</td>
				<td>
					最后发送消息的时间<br>
				</td>
				<td>
					只读<br>
				</td>
			</tr>
			<tr>
				<td>
					NameCard<br>
				</td>
				<td>
					String<br>
				</td>
				<td>
					群名片<br>
				</td>
				<td>
					读写<br>
				</td>
			</tr>
		</tbody>
	</table>

>注：
1. 群内身份包括如下几种：Owner表示群主，Admin表示群管理员，Member表示群成员。
1. 消息接收选项包括如下几种：AcceptAndNotify表示接收并提示；AcceptNotNotify表示接收不提示（不会触发APNs 远程推送）；Discard表示屏蔽群消息（不会向客户端推送消息）。


## 自定义群组ID

默认情况下，在APP创建群时，腾讯云会为新创建的群组分配一个默认的ID。该ID将以@TGS#开头，且保证在APP中唯一。

为了使得群组ID更加简单，便于记忆传播，腾讯云支持APP在通过REST API创建群组时自定义群组ID。自定义群组ID必须为可打印ASCII字符（0x20-0x7e），最长48个字节，且前缀不能为@TGS#（避免与默认分配的群组ID混淆）。

## 自定义字段

群组系统目前支持APP根据业务需求，在群组维度或群成员维度上设置自定义字段。群组维度最多支持20个字段，群成员维度最多支持5个字段。利用自定义字段，APP可以将一些额外数据附加到群组之上，并可以通过现有接口进行读写操作。该服务目前完全免费。

**1.介绍**

每个自定义字段有以下特性：

1. 为Key-Value形式；
1. Key为String类型，长度不超过16字节，其命名仅支持英文大小写字母、数字、下划线；
1. Value为用户自定义Buffer，可以为二进制数据，群维度的Value长度不超过512字节，群成员维度的Value长度不超过64字节；
1. 支持配置每个Key的最小读权限、最小写权限。

每个自定义字段的读写权限从高到低分别是：

1. APP管理员可读/可写；
1. 群主可读/可写；
1. 群管理员可读/可写；
1. 群成员可读/可写；
1. 任何人（包括非成员）可读/可写。

例如，假设APP需要需要在群组中扩展一个字段：GroupLevel，其Value为一个数字，用于记录该群的等级信息。假设等级信息需要APP后台计算得出，那么该字段的最小写权限应当为“APP管理员可写”。该字段应当为群的公开资料，故而其最小读权限应当为“任何人（包括非成员）可读”。

对于C/C++开发者，如果需要存储的Value是数字，建议将其存储为数字的字符串形式，而非其二进制形式（例如，当存储的数字是1时，建议存储字符串“1”，而非二进制数据0x01）。对于自定义字段，腾讯云后续会扩展出更多操作方式，例如对Value进行特定数学操作等，这些运算未来都会以基于字符串形式表示的数字来进行操作。

**2.配置方法**

这两个自定义字段,都可以通过云通信控制台进行配置。

设置群组维度自定义字段，需要为每一个要添加的字段提交如下资料：

1. 自定义字段名称（key）；
1. 字段的最小读权限；
1. 字段的最小写权限。

设置群成员维度自定义字段，需要为每一个要添加的字段提交如下资料：

1. 自定义字段名称（key）；
1. 字段的最小读权限；
1. 字段的最小写权限；
1. 字段是否允许自己读；
1. 字段是否允许自己写。

“字段是否允许自己读”和“字段是否允许自己写”标识成员是否具有对自己本人的自定义字段的读写权限。例如，某一个群成员维度的自定义字段是“MemberLevel”（成员在群组中的等级），成员一般无权修改自己的等级，因此该字段的“字段是否允许自己写”就应该设为“否”。


## 自定义群组形态

腾讯云默认提供私有群、公开群、聊天室三种群组形态，每种群组形态的具体特性参见[群组形态介绍](#.E7.BE.A4.E7.BB.84.E5.BD.A2.E6.80.81.E4.BB.8B.E7.BB.8D)。三种默认形态可以满足大多数群组类型的通信需求。但是，如果APP存在较为特殊的群组通信需求，亦可对现有群组形态的某些特性进行修改，或者组装新的群组形态。

例如，对于在办公场景下使用的群组，它有可能需要群内任意成员都具有最高级别的管理权限，此时APP便可自定义一种新的群组类型：OAGroup，并打开“是否允许普通成员踢人”选项；再如，公开群默认情况下不允许用户查看自己入群之前的历史消息，但只要APP需要，便可打开这一选项。

不论是增加新的群组形态，还是修改默认群组形态，都需要向腾讯云客服提交需求工单。

## 自定义回调

第三方回调是APP实现特殊需求的重要方式之一，为用户提供了自定义行为的能力。腾讯云群组系统支持多种回调，具体参见[第三方回调简介](/doc/product/269/第三方回调简介)以及[群组系统回调接口列表](/doc/product/269/回调命令列表)。