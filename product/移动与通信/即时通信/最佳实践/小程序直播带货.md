
传统销售方式成本高，效果难以评估。直播带货无疑为各大商家突破了营销活动中的层层阻碍，将搜索渠道、触达渠道、下订渠道、评估渠道、运营渠道整合到了一起，整合后能有效避免因渠道跳转带来的用户流失。因此，直播带货成为了互联网时代整合营销的必备之选。
有数据显示，2019年全国在线直播用户5.04亿，2020年预计5.26亿，销售规模9160亿，占我国网络零售规模的8.7%。市场如此之大，直播带货的效果如此好，除了进驻各大直播平台进行直播以外，如何搭建自己的直播带货平台呢？
## 需求背景
根据场景分析，可将交互效果设计如下图所示：
<img src="https://main.qcloudimg.com/raw/5f9c19773bcfc22334f3d6cbf4f9e13f.png" width="450px"></img>
交互场景中需要实现以下能力：
- 聊天室功能
- 公告功能
- 用户加入群聊、退出群里提示
- 后台上架新商品提示
- 送礼提示
- 后台上架新礼物提示
- 点赞&点赞提示
- 直播功能
- 直播间状态控制功能

由此可以看出，直播带货的核心功能分为即时通信 IM 能力和直播能力，您可以选用 [即时通信 IM](https://cloud.tencent.com/document/product/269) 与 [云直播](https://cloud.tencent.com/document/product/267) 作为需求实现的基础。

## Demo 体验
![](https://main.qcloudimg.com/raw/3158cc06a9e6fafa48554bbe1918fa8e.jpg)

## 场景化 SDK

在直播带货场景中，您可以通过自定义消息实现点赞、送礼、关注的提醒，通过群自定义字段实现商品上架通知、群状态改变通知。基于此，我们封装了一个 [场景化 SDK](https://www.npmjs.com/package/im-live-sells)，轻松实现直播带货的场景的相关功能，详细使用指南请参阅 [小程序直播 SDK API](https://cloud.tencent.com/document/product/269/44527)。

您也可以根据以下步骤搭建自己的直播带货平台：

## 操作步骤
### 步骤1：使用即时通信 IM 的 AVChatroom 实现直播聊天室

聊天室是直播中很重要的一部分，用户可以在这里发送自己想说的话并且可以收到同一个聊天室中其他成员的消息。

1. 登录 [即时通信 IM 控制台](https://console.cloud.tencent.com/im)，单击【+添加新应用】。
2. 在【创建应用】对话框中输入您的应用名称，单击【确定】。
  创建完成后，可在控制台总览页查看新建应用的状态、业务版本、SDKAppID、创建时间以及到期时间。
  >?新建应用的业务版本默认为体验版，后续可根据需求 [升级](https://cloud.tencent.com/document/product/269/32577#.E5.8D.87.E7.BA.A7.E5.BA.94.E7.94.A8) 至专业版或旗舰版。
  >同一个腾讯云账号，最多可创建100个即时通信 IM 应用。若已有100个应用，您可以先 [停用并删除](https://cloud.tencent.com/document/product/269/32578#.E5.81.9C.E7.94.A8.2F.E5.88.A0.E9.99.A4.E5.BA.94.E7.94.A8) 无需使用的应用后再创建新的应用。**应用删除后，该 SDKAppID 对应的所有数据和服务不可恢复，请谨慎操作。**
  >
  ![](https://main.qcloudimg.com/raw/2753962b67754a9ebb2a2a5b8042f2ef.png)
3. 单击目标应用卡片，在左侧导航栏选择【群组管理】。
4. 在【群组管理】页面，单击【添加群组】。
5. 在弹出的添加群组对话框中，配置以下参数：
 - 群名称：请输入群组的名称，必填参数，长度不超过30字节。
 - 群主 ID：请输入群主的 ID，选填参数，必须输入已注册的用户名。
 - 群类型：请设置群组类型，根据 [群组类型介绍](https://cloud.tencent.com/document/product/269/1502#GroupType)，**建议设置为	
直播群 (AVChatRoom)**。
3. 单击【确定】保存配置。
 群组创建完成后，在群组列表中可以查看群 ID、群名称、群主、类型和创建时间。


### 步骤2：使用自定义消息实现点赞、送礼、购买等行为的消息通知

在直播的场景中，为达到活跃群热度的效果需要将大量消息实时反馈给群成员，例如有人送礼给主播，需要全员通知，可能还需要一个特别炫酷的动效来展现。全员通知的送礼消息可以用 IM 的自定义消息来实现，并且自定义消息可以携带额外信息，用户在发送礼消息时，可以携带上礼物信息以及用户信息。同理，用户的点赞行为、购买商品行为、关注主播的行为等都可以用自定义消息来实现。自定义消息与文本消息、富文本消息有所不同，可以理解为用户发送的一种特殊消息，它仅仅是传递了一种特殊信号。

SDK 中发送自定义消息的示例代码如下：

```
public async sendCustomMsgAndEmitEvent(type: string, extension?: string) {
        const message = this.tim.createCustomMessage({
            to: this.roomID,
            conversationType: this.TIM.TYPES.CONV_GROUP,
            priority: this.TIM.TYPES.MSG_PRIORITY_HIGH,
            payload: {
                data: type,
                description: '',
                extension: extension
            }
        })
        await this.tim.sendMessage(message)
        const res = {
            nick: this.userInfo.nick,
            avatar: this.userInfo.avatar,
            value: extension,
            userID:this.userInfo.userID
        }
        this.eventBus.emit(type, res)
        return res
}
```

### 步骤3：使用群自定义字段实现直播间上新商品、直播状态改变的消息通知

在直播带货场景中，主播推荐某款产品时，屏幕下方的商品位需要立即更新为当前产品，并需要通知所有在直播中的用户有新的商品上线，商品上新消息一般由小助手触发。
从技术角度来看，小助手触发商品上新消息有两种方案：
- 小助手发送自定义消息
 - 该方案要求小助手已加入到当前直播群中。
 - 当群消息量太大时，IM 后台会根据消息优先级返回消息，自定义消息的优先级低，可能会出现用户端商品刷新不及时的情况。
- 小助手修改群资料
 - 采用该方案，小助手可以是当前直播群的群成员（例如管理员角色），也可以不是群成员。
 - 虽然默认的群资料字段已有既定含义，但 IM 还提供了群维度的自定义字段，您可以自定义指定字段含义和读/写权限等。

因此，推荐采用**管理员修改群自定义字段的方式**实现商品上新消息通知，具体操作步骤如下：

#### 添加群自定义字段

1. 登录 [即时通信 IM 控制台](https://console.cloud.tencent.com/im) ，单击目标应用卡片，在左侧导航栏选择【功能配置】>【群自定义字段】。
2. 在【群自定义字段】页面，单击【添加群维度自定义字段】。
3. 在弹出的群维度自定义字段对话框中，输入字段名称，设置群组形态及其对应的读写权限。
  >?
  >- 字段名称只能由字母、数字以及下划线（\_）组成，不能以数字开头，且长度不能超过16个字符。
  >- 群自定义字段名称不允许与群成员自定义字段名称一致。
  >
 ![](https://main.qcloudimg.com/raw/8fe4aa2bb4efdce9027affa2a0a4831f.png)
4. 勾选【我已经知道自定义字段和群组形态添加后，除了形态的读写权限可修改，无法删除。】，单击【确定】保存设置。
 群维度自定义字段配置后大约10分钟左右生效。

#### 使用群自定义字段

小助手以群管理员的角色身份，适时调用 [修改群组基础资料 REST API](https://cloud.tencent.com/document/product/269/1620) 更新对应的群自定义字段，从而实现直播间的商品上新通知和直播状态改变消息通知。


### 步骤4：使用群发消息后回调实现用户等级统计

在直播场景中，用户除了头像、昵称等一般还有等级信息，例如观众发消息、送礼之后用户的成长等级需要增加。您可以通过回调实现相关功能，业务方可通过回调获取用户在群组、关系链、单聊消息、在线状态等方面状态改变时的消息，根据在群聊中用户发普通文本消息以及送礼消息来改变用户的等级。
回调相关操作请参见 [回调配置](https://cloud.tencent.com/document/product/269/32431) 和 [第三方回调简介](https://cloud.tencent.com/document/product/269/1522)。

### 步骤5：通过安全打击来实现敏感词的拦截

安全打击能力一直是直播、社交、咨询等领域中必不可少的能力。在直播场景中，如果涉嫌传播敏感内容，后果非常严重。即时通信 IM 提供敏感词过滤功能，默认支持对部分国家领导人名进行敏感词过滤，您也可以增值购买 [安全打击服务](https://cloud.tencent.com/document/product/269/11673#zz)。


### 步骤6：使用云直播生成推流地址并开始直播
腾讯云标准直播助力电商平台发展，使商家更加全面地传递了商品信息，促进用户的有效决策，降低营销成本，增加成交量。
在开始直播前，您需要通过 [地址生成器](https://cloud.tencent.com/document/product/267/35257) 生成推流地址，然后再进行 [直播推流](https://cloud.tencent.com/document/product/267/32732)。


## 相关文档
[折扣活动](https://cloud.tencent.com/document/product/269/46181)
