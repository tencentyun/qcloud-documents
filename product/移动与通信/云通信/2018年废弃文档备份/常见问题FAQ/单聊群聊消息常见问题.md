## 消息收发延迟

请确认是否在初始化时调用 `SetEnv`，如果有调用，请去除。IMSDK 测试环境仅限于云通信内部测试使用。

## IMSDK 是否缓存语音

IMSDK 仅提供下载接口，并不缓存语音文件，该逻辑由 App 业务层实现。

## 相同的图片传给不同的人，第二次传输需要流量吗

IMSDK 的上传图片做了秒传逻辑，即如果服务器检测到已有这张图片，服务器会立即返回该图片上传成功，并不会再次耗费传图片的流量。

## REST API 可以收发图片吗？

请看 PHP SDK 的 [图片发送接口](/doc/product/269/单发单聊消息#php.E9.9B.86.E6.88.90)

## 单聊消息最长多少字节

单聊消息需要在 9K byte 以内，超过大小限制发送时 API 会返回错误码。

## iPhone 推送最长多少字节

受 APNs 限制，iPhone 的推送内容不超过1K byte。

## CustromElement 中的 Data 字段可以使用二进制吗

如果仅是 SDK 使用该字段，可以使用二进制，如果调用 REST API，则 CustomElem 中的 Data 建议使用可见字符，如使用 XML、JSON 或者经过 Base64 转换过的二进制串。

## 非好友可以发消息吗

云通信默认不验证好友关系，非好友可以互相发消息。如果业务需要云通信后台做好友关系验证，需先将好友关系链通过 SDK API 或 REST API 托管到云通信服务器上，再到云通信控制台将对应 SDKAPPID 的【应用配置】-【功能配置】-【单聊消息检验关系链】选项设置为开启状态，将在 50 分钟内生效。

## 如何增加语音消息的已听未听状态

详情请参考：[消息收发](/doc/product/269/消息收发（Android%20SDK）#.E6.8E.A5.E6.94.B6.E8.AF.AD.E9.9F.B3.E6.B6.88.E6.81.AF)。

> 语音是否已经播放，可使用 消息自定义字段 实现，如 `customInt` 的值 0 表示未播放，1 表示播放，当用户单击播放后可设置 customInt 的值为 1。

` public void setCustomInt(int value) `

## 单条消息最长可以到多少 byte

云通信允许单条消息不超过 9k byte，如果超过，SDK API 会报错，返回 80002（参见 [错误码](/doc/product/269/错误码)）。

## 消息 Elem 在 add 的时候和取出的时候，能保证顺序吗

消息中不含文件和语音的 Elem 时，可保证取出顺序和写入顺序一致。

> 但不建议依赖于 Elem 的顺序，否则出现异常时容易引起客户端 Crash。

## 如何删除聊天记录（本地、服务器）

- 本地聊天记录删除，请参见 [本地消息删除](/doc/product/269/消息缓存和存储#.E6.9C.AC.E5.9C.B0.E6.B6.88.E6.81.AF.E5.88.A0.E9.99.A4)。
- 服务器保存消息时长，请参见 [漫游消息保存时长](/doc/product/269/%E6%B6%88%E6%81%AF%E7%BC%93%E5%AD%98%E5%92%8C%E5%AD%98%E5%82%A8#.E6.BC.AB.E6.B8.B8.E6.B6.88.E6.81.AF.E4.BF.9D.E5.AD.98.E6.97.B6.E9.95.BF)。
- 群消息删除，请参见 [Server 消息删除](/doc/product/269/消息缓存和存储#server.E6.B6.88.E6.81.AF.E5.88.A0.E9.99.A4)。

## 如何让消息不存储本地

请参见 [消息不存储本地](/doc/product/269/消息缓存和存储#.E7.A6.81.E7.94.A8.E6.9C.AC.E5.9C.B0.E5.AD.98.E5.82.A8)。

## 消息收发延迟

请确认是否在初始化时调用 SetEnv，如果有调用，请去除。IMSDK 测试环境仅限于云通信内部测试使用。

## 互动直播时，IM 消息如何携带昵称头像

为了简化互动直播的 IM 开发，云通信在消息中可以获取到发送者的昵称和头像。该操作分两步，设置昵称头像，在消息中获取昵称头像。

**设置昵称头像有几种方法：**

1.帐号 REST API，在导入帐号时进行设置（存量用户资料导入），参见 [独立模式帐号同步接口](/doc/product/269/独立模式帐号同步接口)。
2.资料关系链 REST API，可单独设置，参见 [设置资料](/doc/product/269/设置资料)。
3.通过客户端 API 设置，Android 参见 [Android 用户资料与关系链](/doc/product/269/用户资料与关系链（Android%20SDK）#.E8.AE.BE.E7.BD.AE.E8.87.AA.E5.B7.B1.E7.9A.84.E8.B5.84.E6.96.99)，iOS 参见 [iOS 用户资料与关系链](/doc/product/269/用户资料与关系链（iOS%20SDK）#.E8.AE.BE.E7.BD.AE.E8.87.AA.E5.B7.B1.E7.9A.84.E8.B5.84.E6.96.99)。

**在聊天消息中获取昵称头像：**

1.Android SDK，通过 TIMMessage 中 `getSenderProfile()` 方法获取发送者昵称头像（仅有昵称头像），参见 [Android 消息发送者及其相关资料](/doc/product/269/消息收发（Android%20SDK）#.E6.B6.88.E6.81.AF.E5.8F.91.E9.80.81.E8.80.85.E5.8F.8A.E5.85.B6.E7.9B.B8.E5.85.B3.E8.B5.84.E6.96.99)
2.iOS SDK，参见 [iOS 消息发送者以及相关资料](/doc/product/269/消息收发（iOS%20SDK）#.E6.B6.88.E6.81.AF.E5.8F.91.E9.80.81.E8.80.85.E4.BB.A5.E5.8F.8A.E7.9B.B8.E5.85.B3.E8.B5.84.E6.96.99)

> **注意：**
> 该属性仅在 `OnNewMessage` 回调中生效，`GetMessage` 方法暂无法获取到发送方的昵称与头像。

## 互动直播时，IM 聊天室出现串消息或者部分人看不到消息

请从以下几个方向进行问题跟踪：

1.当来电话时，音视频被打断，电话结束后，是否重新建立了聊天室（ID 不同），导致一个直播间建立了两个聊天室。
2.当观众从直播间退出时，App 需要调用退出聊天室 API，否则云通信服务器认为该观众还在聊天室内。
3.收到的聊天室消息需判断是否为当前进入的聊天室。

## 如果消息中包含有脏字，是否还能发送成功

云通信服务器默认过滤脏字，如果消息中含有脏字，该消息无法发送成功。

## 云通信是否支持多客服功能

不支持，需要业务方根据 SDK 接口自己实现。

## 调用 getMessage 时，SDK 是先从服务器拉取，还是从本地拉取

SDK 相关策略为：如本地消息足够并且不存在遗漏，则直接从本地数据库读取消息返回；如果判断出本地消息存在缺失，首先从服务器获取漫游消息，补全到本地数据库后返回给调用者。

## 收不到消息的可能原因

1. 接收方没有注册消息监听器，检查一下是不是存在某些逻辑把消息监听器删除了
2. 发送方发送消息的时候，没有把elem添加到消息中了（发消息的时候需要检查addElement的返回值），如果发送的是空消息，接收方在收到的时候会把这种消息丢掉
3. 接收方是Android，注册了多个消息监听器，并且在消息监听器中返回了true
4. 群组消息，该群曾经解散过又重建了（这种情况可能会触发去重，建议在收到解散群组的通知的时候，通过 deleteLocalMsgs 把对应群组会话的本地消息删除了）
5. 消息没有发送成功
6. 接收方没有登录成功，或者已经被踢下线了
7. 发送方与接收方不在同一个群
