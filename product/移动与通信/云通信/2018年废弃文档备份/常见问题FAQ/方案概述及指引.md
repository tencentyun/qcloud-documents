### 1.云通信平滑迁移方案
__1 简介__ 

云通信拥有丰富的高并发、高可靠的运营经验。如果App开发者希望接入云通信，但正在使用自主研发或第三方即时通信服务，就需要考虑迁移问题。云通信根据不同的场景分别提出了迁移方案。

 __2 术语约定__ 

后续文档中，我们约定：
1 . 老系统：App原本使用的即时通信服务；
2 . 新系统：腾讯云的云通信服务；
3 . App 1.0：基于老系统来实现即时通信功能的App；
4 . App 2.0：基于新系统来实现即时通信功能的App；
5 . 停服：是指停止即时通信服务，其他不依赖即时通信的服务不受影响；
6 . 消息路由（消息回调）服务：第三方通信服务商在收到消息后，向App后台转发一份消息，类似于云通信的 [发单聊消息之后回调](https://cloud.tencent.com/document/product/269/2716) 。
迁移过程，本质上就是把即时通信服务后台从老系统切换到新系统，并把App 1.0升级到App2.0的过程。

 __3 内容提要__ 

云通信为您提供如下两种备选迁移解决方案：

1 . 强制升级策略：
需要短暂停服来实施迁移；
迁移完成之后，App 1.0将无法使用；

2 . 新老兼容策略：
需要短暂停服来实施迁移；
迁移完成之后，新老App可以共存，消息互通；
在App 1.0彻底停用之前，App后台需要在新老系统之间保持实时双向同步。
不同方案的迁移效果不同，实施难度也相差很大，需要综合考虑App现有的即时通信实现场景来确定合理的迁移方案。
下面罗列出几种可能的迁移场景，供App参考。

 __3.1 场景1__ 

老系统为其他即时通信服务提供商。
帐号体系、用户资料、关系链完全托管在老系统，App后台不保存用户资料、关系链。
老系统不提供消息路由（消息回调）服务。
这一场景下，基本上无法实施新老系统双向同步，唯一的迁移策略是强制升级策略。

 __3.2 场景2__ 

老系统为其他即时通信服务提供商。
帐号体系、用户资料、关系链完全托管在老系统，App后台不保存用户资料、关系链。
老系统能够提供消息路由（消息回调）服务，但无法提供更多的回调服务。
由于帐号体系完全托管在老系统，所以在老系统中注册的用户无法实时同步到新系统，故而只能使用强制升级策略。

 __3.3 场景3__ 

老系统为其他即时通信服务提供商。
帐号体系、用户资料、关系链均由App自己管理，只是会实时同步到老系统中。
老系统能够提供消息路由（消息回调）服务，但无法提供更多的回调服务。
此时账户体系、用户资料、关系链均可以实现新老系统实时同步。单聊服务可以使用新老兼容策略，但群组系统依然只能使用强制升级策略进行迁移。

 __3.4 场景4__ 

老系统为App自研即时通信服务，一切服务均可以自主控制。
此时App有条件实施双向数据同步。App可以使用任意一种迁移策略。
![图片描述](//bot1024-1253841380.file.myqcloud.com/16322b38065a11e8b7bf5254000ab150.png)
如果上述四种场景无法涵盖App现有的即时通信服务，您可以联系商务经理一起协商合理的迁移方案。

### 2.云通信产品概述
__简介__ 

腾讯是国内最大也是最早的即时通信开发商，QQ 和微信已经成为每个互联网用户必不可少的应用。现在，腾讯将高并发、高可靠的即时通信能力进行开放，开发者可以很容易的根据腾讯提供的 SDK 将即时通信功能集成入 App 中。
针对开发者的不同阶段需求及不同场景，云通信提供了一系列解决方案，包括：Android/iOS/Windows/Web 的 SDK 组件、 [服务端集成接口](https://cloud.tencent.com/doc/product/269/REST%20API%E7%AE%80%E4%BB%8B) 、 [第三方回调接口](https://cloud.tencent.com/doc/product/269/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%9B%9E%E8%B0%83%E7%AE%80%E4%BB%8B) 等。利用这些组件，可以在应用中构建自己的即时通信产品，解决开发者面临的高并发、高可用性的一系列问题。

 __架构介绍__ 

云通信提供单聊、群聊、资料托管、关系链托管、帐号托管全方位解决方案，并提供完善的 App 接入、后台管理接口。

![图片描述](//bot1024-1253841380.file.myqcloud.com/57c4fc5c2be311e897d95254000ab150.png)

 __业务介绍__ 

 __单聊__ 

1V1 聊天，提供包括文字、图片、语音、地理位置、文件、自定义消息等多种能力，除此之外还提供 iPhonePush 消息提醒服务。

 __群聊__ 

多人聊天服务，内置公开群、私有群、聊天室、互动直播聊天室和在线成员广播大群五种群组形态，能够适应各种群组需求的场景。

1 . 公开群：具备创建者及管理员身份，拥有严格的准入制和管理权限；
2 . 私有群：只允许群成员邀请好友加入，非群成员无法搜索到该群，是一种较为私密的聊天环境；
3 . 聊天室：群成员可以随意进出，组织较为松散。成员可以拉到进入聊天室之前的聊天消息。
4 . 互动直播聊天室：与聊天室类似，但群成员人数无上限，并且支持以游客身份接收聊天消息。
5 . 在线成员广播大群：成员人数无上限，支持以游客身份接收群消息，适用于向 App 全体在线成员推送消息的场景。

群组具备高度可定制性，包括自定义群组形态、自定义字段、自定义群组 ID、自定义事件回调等。App 可以根据自己的需求进行深度定制。详细请参见： [群组系统](https://cloud.tencent.com/doc/product/269/%E7%BE%A4%E7%BB%84%E7%B3%BB%E7%BB%9F)  文档。


### 3.云通信服务端集成指引
所谓服务端集成，即App后台通过云通讯提供的一系列REST API来管理自身App的数据。云通信提供的REST API参见 [REST API接口列表](https://cloud.tencent.com/doc/product/269/REST%20API%E6%8E%A5%E5%8F%A3%E5%88%97%E8%A1%A8) 。
本文档将介绍如何通过REST API来进行数据管理，您将了解到：

1 . 调用REST API需要哪些前提条件；

2 . 如何调试REST API，包括：
- 2.1 通过云通讯REST API调试工具来调用REST API；
- 2.2 通过Postman来调试REST API；
- 2.3 通过PHP Server SDK中的工具来调试REST API；

3 . 如何在服务端调用REST API，包括：
- 3.1 在PHP中集成PHP Server SDK。

详情请参考： [服务端集成指引](https://cloud.tencent.com/document/product/269/4029)

### 4.云通信第三方回调
为方便第三方App精细化控制App的功能形态，腾讯云为第三方提供了完全免费且强大的回调能力。所谓回调，即腾讯云会在某一事件发生之前或者之后，向App的后台服务器发送请求，App后台可以据此进行必要的数据同步，或者干预事件的后续处理流程。

例如，App可以开启群发消息回调，腾讯云后台会在下发该消息之前回调第三方服务器，并根据回调结果决定该消息是否应当下发。App不仅可以基于该回调来实现消息同步，而且可以进行发消息安全打击。其业务流程如下图所示：

![图片描述](//bot1024-1253841380.file.myqcloud.com/0dc2bb4e2c1a11e883185254000ab150.png)
详情请参考： [第三方回调简介](https://cloud.tencent.com/document/product/269/1522)

### 5.云通信在线成员广播大群解决方案
__1 . 简介__ 

在IM通信系统中，经常遇到需要向全体在线用户下发消息的场景。例如在直播系统中用户赠送高价值道具时，需要将此消息广播给当前所有在App中观看直播的用户，俗称“大喇叭消息”。
针对这种需求，云通信提供了一套解决方案：BChatRoom（也称为在线成员广播大群）。

 __2 . 在线成员广播大群的能力__ 

BChatRoom主要能力包括：
- 基本的消息分发能力；
- 成员人数无上限；
- 支持 Native App 和 H5；
- 支持匿名（即无需注册账号并登录）接收消息；
- 支持下发自定义消息；

除了同时为了保证服务质量,相应的也做了一些限制，如：
- 每个App创建的BChatRoom，不能超过5个；
- 不支持消息漫游；
- 不存储群成员列表；
- 只支持向在线用户下发消息，离线用户无法接收消息；
- 不允许任何人（包括App管理员）邀请他人入群，并且创建群时不能拉人入群；

__3 . 在线成员广播大群使用方法__ 

BChatRoom的原理是，把App中所有满足条件的在线成员都加入到某个固定群组中，然后通过该群组下发广播消息。这样就能保证所有满足条件的在线用户就都可以接收到该消息了。
其使用方法一般包括以下步骤：
- App管理员预先创建好广播大群，且保证该群长期有效，请勿随意解散；
- 把满足条件的所有成员加入到该群组中（例如在直播场景中，用户进入直播间加入直播聊天室的同时，也加入该在线成员广播大群）；
- App管理员把需要广播的消息，发送到该群组中；
- App接收并展示该消息。

BChatRoom的详细接入方法跟其他类型群组是相同的,请参考  [直播场景下的IM集成方案](https://cloud.tencent.com/doc/product/269/%E7%9B%B4%E6%92%AD%E5%9C%BA%E6%99%AF%E4%B8%8B%E7%9A%84IM%E9%9B%86%E6%88%90%E6%96%B9%E6%A1%88) 中AVChatRoom的接入指引。

 __4 . 与消息推送服务的区别__ 

 [消息推送服务](https://cloud.tencent.com/document/product/269/4119) 支持向全体成员推送消息（包括在线和离线用户），同时还支持向全部用户中满足特定条件的用户推送消息，即按用户的标签、属性进行推送。但是该服务为增值服务，需要申请开通才可使用。
而在线成员广播大群是专门针对在线用户的解决方案，离线用户无法接收广播消息。所以对于向在线用户推送广播消息的场景，该方案效率更高，且目前无需申请开通即可使用。

### 6.云通信客户端集成
您好，有关云通信客户端集成的相关内容请单击 [这里](https://cloud.tencent.com/document/product/269/1594) 查看。

### 7.云通信DEMO运行指引
__官网sdk和demo__ 

官网demo体验地址：
http://avc.qcloud.com/demo/webim/index.html

官网直播聊天室demo地址：
http://avc.qcloud.com/demo/webim/biggroup/mobile/index.html

直播聊天室demo运行指引地址：
https://cloud.tencent.com/doc/product/269/4105

SDK包下载地址：
https://cloud.tencent.com/product/im.html

 __准备环境__ 
操作系统：windows 7 64位
web服务器软件：Apache 2.4 64位
运行demo也可以是其他web服务器软件，比如nginx。
详细安装步骤请参考：https://cloud.tencent.com/document/product/269/4196
