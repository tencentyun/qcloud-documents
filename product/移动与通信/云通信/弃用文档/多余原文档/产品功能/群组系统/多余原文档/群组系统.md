## 群组系统简介
所谓群组系统，本质上就是一个支持多人聊天的即时通讯系统。群组系统所具备的基本能力包括：

1. 内置私有群（Private）、公开群（Public）、聊天室（ChatRoom）、互动直播聊天室（AVChatRoom）和在线成员广播大群（BChatRoom）五种群组形态；
2. 完备的群组管理能力：创建/解散群组、成员管理、群组资料管理、成员资料管理等；
3. 群成员人数上限：私有群 200 人，公开群 2000 人，聊天室 10000 人，互动直播聊天室和在线成员广播大群支持人数无上限；
4. 在 web 端，互动直播聊天室和在线成员广播大群支持用户以游客身份（即不需要登录）接收消息；
5. 私有群和公开群具备消息漫游能力；
6. [在线成员广播大群](/document/product/269/7949) 支持 App 后台向全体在线用户推送消息。

>!
1. 群成员人数上限还受到 [预付费功能包](/document/product/269/11673) 的限制。如预付费购买成员人数上限为20人，则私有群、公开群和聊天室成员人数上限均只有20人;如预付费购买成员人数上限为10000人，则各群组类型成员上限为私有群 200 人，公开群 2000 人，聊天室 10000 人。购买预付费功能包后，如果各种类型群组成员上限无法满足业务需求，可以使用 [自定义群组形态](https://cloud.tencent.com/document/product/269/1502#.E8.87.AA.E5.AE.9A.E4.B9.89.E7.BE.A4.E7.BB.84.E5.BD.A2.E6.80.81)或者咨询客服工作人员。
2. 互动直播聊天室和在线成员广播大群需要购买 [预付费功能包](/document/product/269/11673) 开通使用。其成员人数没有上限，但如果预估群成员人数会超过1万人，请提前联系腾讯云客服或商务工作人员申请服务资源。
3. 在 IM 通信系统中，经常遇到需要向全体在线用户下发消息的场景，例如在直播系统中的“大喇叭消息”。云通信专门为此场景提供了一套解决方案，详情请参考 [在线成员广播大群解决方案](/document/product/269/7949)。

除此之外，腾讯云即时通信群组系统具备高度可定制性，具体包括 [自定义消息格式](/doc/product/269/消息格式描述#.E8.87.AA.E5.AE.9A.E4.B9.89.E6.B6.88.E6.81.AF.E5.85.83.E7.B4.A0)、 [自定义群组ID](https://cloud.tencent.com/document/product/269/1502#.E8.87.AA.E5.AE.9A.E4.B9.89.E7.BE.A4.E7.BB.84-id)、 [自定义字段](https://cloud.tencent.com/document/product/269/1502#.E8.87.AA.E5.AE.9A.E4.B9.89.E5.AD.97.E6.AE.B5)、[自定义群组形态](https://cloud.tencent.com/document/product/269/1502#.E8.87.AA.E5.AE.9A.E4.B9.89.E7.BE.A4.E7.BB.84.E5.BD.A2.E6.80.81) 和 [自定义回调](https://cloud.tencent.com/document/product/269/1502#.E8.87.AA.E5.AE.9A.E4.B9.89.E5.9B.9E.E8.B0.83)。


## 群组形态介绍
群组系统当前提供五种默认群组形态：

| 群组形态   |适用场景    |
|--------|---------|
| 私有群（Private）| 适用于较为私密的聊天场景，群组资料不公开，只能通过邀请的方式加入，类似于微信群。   |
| 公开群（Public）|适用于公开群组，具有较为严格的管理机制、准入机制，类似于 QQ 群。|
| 聊天室（ChatRoom）|群成员可以随意进出，组织较为松散。|
| 互动直播聊天室（AVChatRoom）|适用于互动直播场景，管理上与聊天室相似，但群成员人数无上限；支持以游客身份（不登录）接收消息|
| [在线成员广播大群（BChatRoom）](/document/product/269/7949)|适用于需要向全体在线用户推送消息的场景。|

五种群组形态之间的主要差异如下：

#### 群组操作差异

|控制项|详情|
|--- |--- |
|允许群组被搜索（是否对非群成员公开）|**私有群**：不支持精确搜索和模糊搜索；<br>**公开群/聊天室/互动直播聊天室**：默认支持精确搜索，不支持模糊搜索；<br>**在线成员广播大群**：不支持精确搜索和默认搜索。|
|允许普通成员修改群基础资料|**私有群**：普通成员可以修改群名称、简介、公告、群头像URL，但不能修改其他字段；<br>**公开群/聊天室/互动直播聊天室/在线成员广播大群**：普通成员不能修改群基础资料|
|获取全员群成员列表|**私有群/公开群/聊天室**：客户端可以实时获取群组中的所有群成员的成员信息；<br>**互动直播聊天室**：客户端只能获取一部分群成员（例如先入群的群成员）的成员信息，超出部分的群成员的信息无法获取；常用于大群中只需要部分群成员信息的场景；<br>**在线成员广播大群**：客户端无法获取群成员信息|
|允许群主解散群|**私有群**：不允许群主解散群（App 管理员可以强制解散群）；<br>**公开群/聊天室/互动直播聊天室**：群主可以解散群；<br>**在线成员广播大群**：不设置群主和管理员，所以只有 App管理员可以解散群。|

>?精确搜索：通过群组 ID 搜索指定的群组；

#### 群成员操作差异

|控制项|详情|
|--- |--- |
| 允许申请加群|**私有群**：不允许申请加群，不需要再进一步参考申请加群选项（申请加群选项对私有群无效）；<br>**公开群/聊天室/互动直播聊天室/在线成员广播大群**：依照申请加群选项决定后续的加群操作|
|默认申请加群选项|**私有群**：申请加群选项对私有群无效，禁止任何人申请加入群组；<br>**公开群**：申请加入群组需要通过管理员审批；<br>**聊天室/互动直播聊天室/在线成员广播大群**：无需经过管理员审批即可直接加入群组|
|允许邀请他人入群|**私有群**：群成员无需受邀用户同意，直接将其拉入群中，并且创建群时可以直接拉人入群；<br>**公开群/聊天室**：不允许群成员邀请他人入群，但创建群时可以直接拉人入群；<br>**互动直播聊天室/在线成员广播大群**：不允许任何人（包括 App 管理员）邀请他人入群，并且创建群时不能拉人入群|
|允许群主退群|**私有群**：群主可以退群，退出群组后该群将没有群主<br>**公开群/聊天室/互动直播聊天室/在线成员广播大群**：不允许群主退群，除非通过解散群组的方式|
|允许群主设置管理员|**私有群**：不允许群主设置管理员<br>**公开群/聊天室**：群主可以设置管理员；<br>**互动直播聊天室/在线成员广播大群**：暂时不允许群主设置管理员|
|允许群成员踢人|**私有群/公开群/聊天室**：不允许普通成员踢人；<br>**互动直播聊天室/在线成员广播大群**：不允许任何人（包括 APP 管理员）踢人|
|定期踢掉不在线的群成员|**私有群/公开群/聊天室/互动直播聊天室/在线成员广播大群**：群组不会定时清理不在线群成员|

>?如果需要开启定时（每 5 分钟）清理不在线成员的功能，可以根据 [工单模板](/doc/product/269/云通信配置变更需求工单#.E5.AE.9A.E6.9C.9F.E8.B8.A2.E6.8E.89.E7.BE.A4.E5.86.85.E4.B8.8D.E5.9C.A8.E7.BA.BF.E6.88.90.E5.91.98) 提交工单进行申请，但是只会清理普通成员，不会清理群主和管理员。


#### 群组限制差异

|控制项|详情|
|--- |--- |
|成员人数上限|**私有群/公开群/聊天室**：群成员人数上限，私有群 200 人，公开群 2000 人，聊天室 10000 人，成员人数超过上限后不允许新成员加入；<br>**互动直播聊天室/在线成员广播大群**：群组没有成员人数上限，允许任意数量的人加入群组|
|创建群组数量上限|**私有群/公开群/聊天室/互动直播聊天室**：默认每天净增群组数量(创建数减去解散数)不能超过 500 个，超过则需要付费使用；<br>**在线成员广播大群**：每个 App 可以创建的在线成员广播大群不能超过 5 个|

>?
>- 如果对每日创建群组的上限有调高的需求，可以根据 [工单模板](/doc/product/269/云通信配置变更需求工单#.E4.BF.AE.E6.94.B9.E6.AF.8F.E6.97.A5.E5.88.9B.E5.BB.BA.E7.BE.A4.E7.BB.84.E9.85.8D.E9.A2.9D) 提交工单进行申请。
- 离线推送目前只有 Android（Android 离线推送）和 iOS（APNS 推送）支持，详情请见 [消息推送服务简介](/doc/product/269/消息推送服务#.E6.B6.88.E6.81.AF.E6.8E.A8.E9.80.81.E6.9C.8D.E5.8A.A1.E7.AE.80.E4.BB.8B)。



#### 消息管理差异

|控制项|详情|
|--- |--- |
|入群前历史消息可见|**私有群/公开群/互动直播聊天室/在线成员广播大群**：群成员只能看到入群之后的消息；<br>**聊天室**：群成员可以看到入群之前的历史消息|
|成员变更通知|**私有群/公开群**：群成员变更后向所有群成员推送一条消息，客户端可以选择将这条消息展示给用户；<br>**聊天室/在线成员广播大群**：群成员变更后不会发送消息提示其他群成员；<br>**互动直播聊天室**：群成员变更后向所有群成员推送一条消息，客户端接收后仅更新群成员列表，但不向用户展示这条提示|
|需要一条消息激活群组（未激活群组不可见）|**私有群**：新创建的群组为未激活状态，在群主发言之前，除群主外的群成员无法感知到这个群组的存在；<br>**公开群/聊天室/互动直播聊天室/在线成员广播大群**：新创建的群组不需要发消息激活，即对所有群成员可见|
|支持管理员设置禁言|**私有群**：管理员不能对群成员设置禁言；<br>**公开群/聊天室/互动直播聊天室**：管理员可以对群成员设置禁言，群成员在禁言时间内无法发送群聊消息；<br>**在线成员广播大群**：只有 App 管理员可以发送消息|
|默认消息接收选项|**私有群/公开群**：表示客户端将接收在线推送消息和离线推送；<br>**聊天室/互动直播聊天室/在线成员广播大群**：表示客户端接收在线推送消息，但不接收离线推送|
|支持未读消息计数|**私有群/公开群**：客户端将展示未读的消息数量；<br>**聊天室/互动直播聊天室/在线成员广播大群**：不支持未读消息计数，客户端不展示未读消息|
|支持以游客身份（即不需要登录）接收群消息|**私有群/公开群/聊天室**：用户不能以游客身份接收群消息，接收消息前必须先登录；<br>**互动直播聊天室/在线成员广播大群**：用户不必登录，可以以游客身份在群组中接收消息|
|支持消息漫游|**私有群/公开群/聊天室**：为用户保存最长 7 天的漫游消息;<br>**互动直播聊天室/在线成员广播大群**：不支持漫游消息|

>?离线推送目前只有 Android（Android 离线推送）和 iOS（APNS 推送）支持，详情请见 [消息推送服务简介](https://cloud.tencent.com/document/product/269/4119#.E6.B6.88.E6.81.AF.E6.8E.A8.E9.80.81.E6.9C.8D.E5.8A.A1.E7.AE.80.E4.BB.8B)。


#### 批量导入与自动回收差异

|控制项|详情|
|--- |--- |
|允许导入群、群成员和群消息|**私有群/公开群/聊天室**：允许导入群、群成员和群消息，适用于从第三方平台迁移历史群组到云通信时使用;<br>**互动直播聊天室/在线成员广播大群**：不允许批量导入群、群成员和群消息，只能使用现有的群、群成员和群消息|
|群组自动回收时间（秒）|**私有群/公开群/聊天室/互动直播聊天室/在线成员广播大群**：后台不会回收群组，除非群主解散，或者所有成员都退出群组|

>?如果需要开启群组回收功能，可以根据 [工单模板](https://cloud.tencent.com/document/product/269/3916#.E8.87.AA.E5.8A.A8.E5.9B.9E.E6.94.B6.E7.BE.A4.E7.BB.84) 提交工单进行申请。配置后，将会根据群组类型清理不活跃群组(群组不活跃是指群组中既没人发言，也没有成员变更)。


## 群组管理简介
在介绍群组管理方式之前，首先需要明确群组中各成员的角色：

| 群组成员角色 |描述| 权限 |
|---------|---------|------|
| 普通成员 | 不具备管理权限的群成员 |无|
| 管理员 | 由群主任命的、协助群主来管理群组的群成员，拥有一定的管理权限 | <br>1. 修改群组基本资料；<br>2. 将普通群成员踢出群；<br>3. 将普通群成员禁言（即禁止其在一段时间内发言）；<br>4. 审批其他用户的入群申请。|
| 群主 | 即群组的创建者，在群组中拥有最高的管理权限 | 群主具备管理员所拥有的各项权限之外，还拥有如下权限：<br>1. 任命/取消管理员；<br>2. 将管理员踢出群组；<br>3. 将管理员禁言；<br>4. 解散群组。|
| App 管理员 | 具备管理 App 中所有群组权限的一种特殊身份，能力超过群主 | App 管理员可以不是群组中的成员，但是拥有群主具备的所有权限。|


不同群组形态所针对的应用场景不同，故而它们支持的管理方式稍有差别：
1. 私有群的管理方式较弱，其特点是：所有群成员可以修改群组的基本信息（如群名称）；不提供管理员这一角色；不提供禁言能力；群主不能解散私有群（群主退出后群组仍然存在）。
2. 公开群和聊天室均提供完整的的管理方式：支持设置/取消管理员；支持禁言；群主对于该群拥有绝对控制权限。
3. 互动直播聊天室的管理方式与聊天室相似，但是不支持群成员踢人和邀请他人入群。
4. 各种群组形态在管理上的细微差异可以参见 [群组形态介绍](#.E7.BE.A4.E7.BB.84.E5.BD.A2.E6.80.81.E4.BB.8B.E7.BB.8D)。

## 群组数据结构

### 群基础资料

|字段名称|类型|描述|备注|
|--- |--- |--- |--- |
|GroupId|String|群组的唯一标识|只读。<br>群组 ID，App 内保证唯一，其格式前缀为 @TGS#。另外，App 亦可 [自定义群组 ID](#.E8.87.AA.E5.AE.9A.E4.B9.89.E7.BE.A4.E7.BB.84id)|
|Type|String|群组形态|只读。<br>默认支持五种产品形态：Private 表示私有群，Public 表示公开群，ChatRoom 表示聊天室，AVChatRoom 表示互动直播聊天室，BChatRoom 表示在线成员广播大群|
|Name|String|群组名称（最长 30 字节）|对于公开群、聊天室和互动直播聊天室，这些数据只允许群主和 App 管理员修改；但是对于私有群，这些数据允许任意群成员修改，具体可以参见 [群组形态介绍](#.E7.BE.A4.E7.BB.84.E5.BD.A2.E6.80.81.E4.BB.8B.E7.BB.8D) 中的相关描述|
|Introduction|String|群组简介（最长 120 字节）|对于公开群、聊天室和互动直播聊天室，这些数据只允许群主和 App 管理员修改；但是对于私有群，这些数据允许任意群成员修改，具体可以参见 [群组形态介绍](#.E7.BE.A4.E7.BB.84.E5.BD.A2.E6.80.81.E4.BB.8B.E7.BB.8D)中的相关描述|
|Notification|String|群组公告（最长 150 字节）|对于公开群、聊天室和互动直播聊天室，这些数据只允许群主和 App 管理员修改；但是对于私有群，这些数据允许任意群成员修改，具体可以参见 [群组形态介绍](#.E7.BE.A4.E7.BB.84.E5.BD.A2.E6.80.81.E4.BB.8B.E7.BB.8D)中的相关描述|
|FaceUrl|String|群组头像 URL（最长 100 字节）|对于公开群、聊天室和互动直播聊天室，这些数据只允许群主和 App 管理员修改；但是对于私有群，这些数据允许任意群成员修改，具体可以参见 [群组形态介绍](#.E7.BE.A4.E7.BB.84.E5.BD.A2.E6.80.81.E4.BB.8B.E7.BB.8D)中的相关描述|
|Owner_Account|String|群主 ID|只读|
|CreateTime|Integer|群组的创建时间|只读|
|InfoSeq|Integer|群资料的每次变都会增加该值|只读|
|LastInfoTime|Integer|群组最后一次信息变更时间|只读|
|LastMsgTime|Integer|群组内最后发消息的时间|只读|
|NextMsgSeq|Integer|群内下一条消息的 Seq|只读。<br>群组内每一条消息都有一条唯一的消息 Seq，且该 Seq 是按照发消息顺序而连续的。从 1 开始，群内每增加一条消息，NextMsgSeq 就会增加 1|
|MemberNum|Integer|当前成员数量|只读|
|MaxMemberNum|Integer|最大成员数量||
|ApplyJoinOption|String|申请加群选项|申请加群选项包括如下几种：DisableApply 表示禁止任何人申请加入；NeedPermission 表示需要群主或管理员审批；FreeAccess 表示允许无需审批自由加入群组|



### 群成员资料

|字段名称|类型|描述|备注|
|--- |--- |--- |--- |
|Member_Account|String|群成员 ID|只读|
|Role|String|群内身份|群内身份包括如下几种：Owner 表示群主，Admin 表示群管理员，Member 表示群成员。|
|JoinTime|Integer|入群时间|只读|
|MsgSeq|Integer|该成员当前已读消息 Seq|只读|
|MsgFlag|String|消息接收选项|消息接收选项包括如下几种：AcceptAndNotify 表示接收并提示；AcceptNotNotify 表示接收不提示（不会触发 APNs 远程推送）；Discard 表示屏蔽群消息（不会向客户端推送消息）。|
|LastSendMsgTime|Integer|最后发送消息的时间|只读|
|NameCard|String|群名片|可读可写|


## 自定义群组 ID
默认情况下，在 App 创建群时，腾讯云会为新创建的群组分配一个默认的 ID。该 ID 将以 @TGS# 开头，且保证在 App 中唯一。

为了使得群组 ID 更加简单，便于记忆传播，腾讯云支持 App 在通过 REST API 创建群组时自定义群组 ID。自定义群组 ID 必须为可打印 ASCII 字符（0x20-0x7e），最长 48 个字节，且前缀不能为 @TGS#（避免与默认分配的群组 ID 混淆）。

## 自定义字段

群组系统目前支持 App 根据业务需求，在群组维度或群成员维度上设置自定义字段。群组维度最多支持 20 个字段，群成员维度最多支持 5 个字段。利用自定义字段，App 可以将一些额外数据附加到群组之上，并可以通过现有接口进行读写操作。该服务目前完全免费。

**1.介绍**

每个自定义字段有以下特性：

1. 为 Key-Value 形式；
2. Key 为 String 类型，长度不超过 16 字节，其命名仅支持英文大小写字母、数字、下划线；
3. Value 为用户自定义 Buffer，可以为二进制数据，群维度的 Value 长度不超过 512 字节，群成员维度的 Value 长度不超过 64 字节；
4. 支持配置每个 Key 的最小读权限、最小写权限。

每个自定义字段的读写权限从高到低分别是：

1. App 管理员可读/可写；
2. 群主可读/可写；
3. 群管理员可读/可写；
4. 群成员可读/可写；
5. 任何人（包括非成员）可读/可写。

例如，假设 App 需要需要在群组中扩展一个字段：GroupLevel，其Value为一个数字，用于记录该群的等级信息。假设等级信息需要 App 后台计算得出，那么该字段的最小写权限应当为“App 管理员可写”。该字段应当为群的公开资料，故而其最小读权限应当为“任何人（包括非成员）可读”。

对于 C/C++ 开发者，如果需要存储的 Value 是数字，建议将其存储为数字的字符串形式，而非其二进制形式（例如，当存储的数字是 1 时，建议存储字符串“1”，而非二进制数据 0x01）。对于自定义字段，腾讯云后续会扩展出更多操作方式，例如对 Value 进行特定数学操作等，这些运算未来都会以基于字符串形式表示的数字来进行操作。

**2.配置方法**

这两个自定义字段,都可以通过云通信控制台进行配置。

配置群组维度的自定义字段，需要指定要为哪种群组形态新增自定义字段。另外，还需要为每一个要添加的字段提交如下资料：

1. 自定义字段名称（key）；
2. 字段的最小读权限；
3. 字段的最小写权限。

配置群成员维度的自定义字段，需要说明要为哪种群组形态新增自定义字段（因为 AVChatRoom 不存储所有群成员的资料，所以不支持群成员维度的自定义字段）。另外，还需要为每一个要添加的字段提交如下资料：

1. 自定义字段名称（key）；
2. 字段的最小读权限；
3. 字段的最小写权限；
4. 字段是否允许自己读；
5. 字段是否允许自己写。

“字段是否允许自己读”和“字段是否允许自己写”标识成员是否具有对自己本人的自定义字段的读写权限。例如，某一个群成员维度的自定义字段是“MemberLevel”（成员在群组中的等级），成员一般无权修改自己的等级，因此该字段的“字段是否允许自己写”就应该设为“否”。

## 自定义群组形态
腾讯云默认提供私有群、公开群、聊天室、互动直播聊天室和在线成员广播大群五种群组形态，每种群组形态的具体特性参见 [群组形态介绍](#.E7.BE.A4.E7.BB.84.E5.BD.A2.E6.80.81.E4.BB.8B.E7.BB.8D)。五种默认形态可以满足大多数群组类型的通信需求。但是，如果 App 存在较为特殊的群组通信需求，亦可对现有群组形态的某些特性进行修改，或者组装新的群组形态。

>例如，
>对于在办公场景下使用的群组，它有可能需要群内任意成员都具有最高级别的管理权限，此时 App 便可自定义一种新的群组类型：OAGroup，并打开“是否允许普通成员踢人”选项；再如，公开群默认情况下不允许用户查看自己入群之前的历史消息，但只要 App 需要，便可打开这一选项。

不论是 [增加新的群组形态](/doc/product/269/云通信配置变更需求工单#.E6.96.B0.E5.A2.9E.E7.BE.A4.E7.BB.84.E5.BD.A2.E6.80.81)，还是 [修改默认群组形态](/doc/product/269/云通信配置变更需求工单#.E4.BF.AE.E6.94.B9.E7.BE.A4.E7.BB.84.E5.BD.A2.E6.80.81)， 都需要向腾讯云客服提交需求工单。

## 自定义回调

第三方回调是 App 实现特殊需求的重要方式之一，为用户提供了自定义行为的能力。
腾讯云群组系统支持多种回调，具体参见 [第三方回调简介](/doc/product/269/第三方回调简介)以及 [群组系统回调接口列表](/doc/product/269/回调命令列表)。
