## 离线消息存储

云通信支持离线消息缓存，即当用户不在线时，下次登录时会收到该条离线消息。离线消息默认保存 7 天，如果用户 7 天内没有登录过，再次登录的时候，不能获取到 7 天前的离线消息，因离线消息由空间限制，离线消息会按照发送时间倒序排列，部分用户的消息可能会被服务器删除。

默认情况下，一个终端可通过SDK把离线消息拉回到本地，云通信便会删除消息。如果需要支持多终端的情况、或者更换终端还想要拿到未读的消息，需要自己管理未读消息，当禁用了自动已读上报，只有用户显式调用已读上报接口，云通信才会删除消息，否则保存到消息过期。这样如果没有进行已读上报，更换终端，仍然可拿到未读的消息。

## 漫游消息存储

云通信支持消息漫游，即用户更换终端的情况下，也可以获取到跟其他用户或者某个群的聊天记录。

默认情况下，单聊消息和群聊消息有 7 天漫游，超过漫游时长的消息会被删除。群聊消息漫游时长不支持修改，而延长单聊消息的漫游时长是增值服务，需要提交工单修改，可参考：[调整单聊消息漫游时长](/doc/product/269/云通信配置变更需求工单#.E8.B0.83.E6.95.B4.E5.8D.95.E8.81.8A.E6.B6.88.E6.81.AF.E6.BC.AB.E6.B8.B8.E6.97.B6.E9.95.BF)。

## 最近联系人消息

最近联系人消息类似 QQ 的最近联系人列表中，可展示最近跟用户联系过的用户以及最后一条消息。

客户端默认情况下会在登录时通过SDK拉取最近联系人消息，如果本地之前没有存储过，会通过 onNewMessage 回调取得。

使用最近联系人，登录时会消耗一些流量，获取服务器中相关联系人的最后一条消息。如果不需要此功能，可通过SDK实现禁用，最近联系人默认存储最近 100 个联系人，但是保存时长跟最近联系人中的最后一条消息保存时间一致，比如默认如果超过7天跟联系人没有消息，最后一条消息过期后便无法在最近联系人中获取到此用户。

## App 本地存储

默认情况下，SDK 内部会对收到的消息进行存储，无需用户进行存储。用户可调用接口获取本地消息（无网络操作），另外，通过 getMessage 接口，也会获取本地消息，如果本地消息存在断层，会通过 [漫游消息](#2.-.E6.BC.AB.E6.B8.B8.E6.B6.88.E6.81.AF.E5.AD.98.E5.82.A8) 补全。

SDK 默认不会删除用户消息，但我们提供本地消息删除的能力满足您特殊的需要。

请您注意，使用本地存储会消耗磁盘以及 CPU 性能，在不需要存储的场景（如直播场景，更注重消息处理性能，也不关心历史消息），可选择禁用本地存储。





