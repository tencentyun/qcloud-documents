## 概述
自定义解析是腾讯云移动解析 HTTPDNS 基于腾讯云函数 SCF（Serverless）实现的功能，能够自定义参数和返回值、自定义解析规则与线路，实现定向调度、智能调度。本文将指导您如何创建自定义解析，并将域名解析至指定 IP。


## 前提条件
已在 [移动解析 HTTPDNS 控制台](https://console.cloud.tencent.com/httpdns/domain) 添加域名，具体操作请查看 [添加域名](https://cloud.tencent.com/document/product/379/54588)。
>?若子账号需使用自定义解析，则需要给子账号添加对应权限。具体操作请查看 [子账号或协作者授权自定义解析权限](https://cloud.tencent.com/document/product/379/70979)。

## 操作步骤
### 步骤1：配置腾讯云云函数 SCF（Serverless）服务
自定义解析前，您需要开通腾讯云云函数 SCF（Serverless）服务，开发配置您自定义解析的云函数并完成发布。具体操作请查看 [配置函数计算服务](https://cloud.tencent.com/document/product/379/70146)。

### 步骤2：服务授权关联角色
1. 登录 [移动解析 HTTPDNS 控制台](https://console.cloud.tencent.com/httpdns)，在左侧菜单栏中单击**自定义解析**，进入 “自定义解析” 管理页面。
2. 单击**添加自定义解析**。如下图所示：
 ![](https://qcloudimg.tencent-cloud.cn/raw/b461b99f06cb570ef26f94a46a7922ae.png)
3. 若为首次使用自定义解析服务，移动解析 HTTPDNS 控制台将会提示您需要授权 `API 网关` 与 `移动解析 HTTPDNS` 关联服务角色，设置后即可使用腾讯云云函数服务。如下图所示：
![](https://qcloudimg.tencent-cloud.cn/raw/0999a50d7e879f3dbeba7f45c96ff487.png)
4. 单击**同意授权**，即可完成设置。

### 步骤3：添加自定义解析
1. 登录 [移动解析 HTTPDNS 控制台](https://console.cloud.tencent.com/httpdns)，在左侧菜单栏中单击**自定义解析**，进入 “自定义解析” 管理页面。
2. 单击**添加自定义解析**。在弹出的 “添加自定义域名解析” 窗口中，填写相关配置信息。如下图所示：
![](https://qcloudimg.tencent-cloud.cn/raw/feb02f0c72d518dd847a7b212157bc24.png)
   - **基础信息**
     - **授权 ID**：默认为系统分配的授权 ID。
     - **域名**：请填写您自定义解析域名的前缀，并选择已添加的移动解析 HTTPDNS 域名。
     - **地域**：请选择需要支持的地域。
>?目前仅支持**广州、上海、新加坡**3个地域。
>
     - **命名空间**：请选择 `httpdns` 命名空间，若无请确认云函数服务是否已创建该命名空间。
   - **自定义解析函数**
     - **刷新缓存前**：请选择刷新缓存前调用的云函数名称以及版本/别名。
     - **构造响应包前**：请选择构造响应包前调用的云函数名称以及版本/别名。

>!
>- 为确保移动解析 HTTPDNS 自定义解析功能安全运行，建议选择 DEFAULT 版本或指定正式发布的版本。
>- 若需使用 LATEST 版本，请您前往 [云函数控制台](https://console.cloud.tencent.com/scf/list?rid=1&ns=httpdns) 创建 LATEST 版本触发器并予以绑定后才可正常使用。**创建的触发器中请勿开启集成响应，否则将导致无法正常使用。**
>
>

3. 完成填写后，单击**开始测试**，测试您的函数是否符合调用规范，以确保函数可以正确服务于域名解析过程。
4. 单击**保存**，即可完成设置。
