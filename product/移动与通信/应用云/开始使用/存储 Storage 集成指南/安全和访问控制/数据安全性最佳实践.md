安全性通常是应用开发过程中最复杂的部分之一。在大多数应用中，建立授权机制本身就十分困难，要确保正确则更加困难，而这直接关系到您的产品能否取得成功。

Storage 构建于腾讯云的安全体系中，为您的数据访问提供健壮的安全保障。我们提供基于存储桶的权限设置和基于资源的临时密钥机制，您可以按照需求，从不同粒度保障数据的安全访问。

## 前提

如果您还不了解我们整个鉴权体系的流程，以及如何搭建一个后台授权服务器，请查看 [用户访问控制](https://cloud.tencent.com/document/product/666/17922)。

## 公开访问

公开访问是指您的存储资源可以直接访问，不需要授权。通常是您应用的一些静态资源。

访问分为读操作和写操作，您可以通过控制台设置存储桶的权限为:

- 公有读私有写：数据读取是公开的，但是写入需要授权。
- 公有读写：数据是完全公开读写的。请注意，这表示您的数据完全没有访问控制，容易导致数据泄露。

![](https://mc.qcloudimg.com/static/img/534ddc525229f91b75ab6d0a7290dacb/image.png)


## 私有访问

私有访问是指您的存储资源只有持有合法的密钥才能访问。我们的应用数据可以允许 APP 内的用户访问，而不会暴露给其他的访问来源。

访问分为读操作和写操作，您可以通过控制台设置存储桶的权限为：

- 公有读私有写：数据读取是公开的，但是写入需要授权。
- 私有读写：数据的读写都需要授权。

![](https://mc.qcloudimg.com/static/img/534ddc525229f91b75ab6d0a7290dacb/image.png)

当数据是私有访问时，每次请求都需要携带从 STS（临时密钥服务）获取的临时密钥，才能正常访问。注意在此之前，您最好在业务侧对访问身份先进行鉴定。

请求临时密钥时，您需要指定一个访问策略（Policy）。下面展示的是一个通用策略，它表示对所有资源都有读写权限：

```
{
	"version": "2.0",
	"statement": [{
		"action": [
			"name/cos:*"
		],
		"effect": "allow ",
		"principal": {
			"qcs": ["*"]
		},
		"resource": "*"
	}]
}
```

如果您想了解策略的语法，请参考 [策略语法说明](https://cloud.tencent.com/document/product/598/10603)。


## 基于用户的数据安全

基于用户的数据安全策略是指，数据允许自己的创建用户访问，而其他用户无法访问。这个适用于很多 APP 的场景，例如一个相册应用允许用户管理自己上传的图片，而其他用户没有访问权限。

您可以通过以下设置，达到用户级别的数据安全。

#### 将数据设置为私有写

存储桶的权限应该是私有写的，根据应用场景，您可以选择是 `私有读写` 还是 `公有读私有写`。

####  数据按照用户存储

Storage 的每个数据都有唯一的路径，在上传时，将用户唯一标识作为文件路径前缀的一部分。

举例：假如用户A唯一标识是 `2222`，那么他上传的文件 `file1` 存放在 `/2222/file1` 中。

####  按照用户设置policy路径

使用用户唯一标识来设置 Policy 的资源路径前缀。

举例：假如您的存储桶地域是上海 `ap-shanghai`，您的腾讯云 APPID 是 `12345678`，用户A唯一标识是 `2222`，当他访问时，Policy 设置为：

```
{
	"version": "2.0",
	"statement": [{
		"action": [
			"name/cos:*"
		],
		"effect": "allow",
		"principal": {
			"qcs": ["*"]
		},
		"resource": "qcs::cos:ap-shanghai:uid/12345678:prefix//12345678/2222/*"
	}]
}
```

用这个 Policy 请求得到的临时密钥，只有对 `/2222/*` 目录下的数据有读写权限，而对其他路径的数据都没有访问权限。

您可以在 [可用地域](https://cloud.tencent.com/document/product/436/6224) 查到不同地域的代码。
您可以在 [API 密钥管理](https://console.cloud.tencent.com/cam/capi) 查到您的腾讯云 APPID。






