## 功能介绍

自定义事件功能，是为开发者提供的自助分析工具。通过代码埋点，对用户行为进行追踪，完成对用户行为细节的记录。我们提供了两种形式的自定义事件：普通事件、计算事件。

**普通事件与计算事件的区别是什么？**

普通事件可满足定性事件的统计需求，如登录、注册、进入首页等行为。

计算事件可满足变量事件的统计需求，如充值金额、购买数量等。

### 普通事件
在普通事件下，通过代码埋点，用户行为得到了量化：

* 统计次数：统计指定行为被触发的次数 如，点击“开始注册”等按钮的次数和点击“广告页”等页面的次数

* 统计时长：统计两个指定行为之间的消耗时间，单位为秒 如，用户从开始注册到注册成功的消耗时间

下面以音乐播放应用的播放事件为例说明普通事件如何完成统计。

事件 ID 及其参数形如：onPlay(Name=‘那些年’, singer=‘胡夏’)

#### 1. 统计每天的播放情况：

播放事件统计结果

|日期	|事件ID	|事件名	|触发账户数	|触发次数	|平均时长|
|:----|:-----|:----|:-----|:----|:---|
|20171130	|onPlay	|播放	|27095	|102586	|185|
|20171129	|onPlay	|播放	|26873	|98792	|179|
|20171128	|onPlay	|播放	|26124	|96875	|160|

#### 2. 统计每天“那些年”和“老男孩”的播放量和播放时长：

播放事件 — Name参数统计结果

|日期	|参数名	|参数值	|触发账户数	|触发次数	|平均时长|
|:----|:-----|:----|:-----|:----|:---|
|20171130	|Name	|那些年	|3095	|3985	|158|
|20171130	|Name	|老男孩	|3985	|3125	|130|
|20171129	|Name	|那些年	|2995	|3027	|124|
|20171129	|Name	|老男孩	|2885	|3596	|168|

### 计算事件
考虑以下情景：

一款手游，想统计游戏道具购买情况，包括：

1. 每个道具的平均购买数量
2. 不同等级下，不同角色的花费分布情况

来看看如何通过计算事件完成游戏道具购买情况统计。

在用户购买道具完成后，上报计算事件数据：

【例】onShop(playerId=98754515, playerLevel=3, playerRole=‘法师’, itemId=1027, itemNum=5, payment=175)

##### 1. 统计每个道具的平均购买数量

① 选择 itemId 参数作为统计维度

② 选择 itemNum 作为计算参数

③ 对 itemNum 选择求平均值计算方式

|日期	|事件 ID	|事件名	|itemID	|itemNum 平均|
|:----|:-----|:----|:-----|:----|
|20171130	|onShop	|道具购买	|1027	|5.5|
|20171129	|onShop	|道具购买	|1026	|4.4|
|20171128	|onShop	|道具购买	|1025	|6.3|

##### 2. 统计不同等级下，不同角色的花费分布情况

① 选择 playerLevel、playerRole 参数作为统计维度

② 选择 payment 作为计算参数

③ 对 payment 选择累加计算方式

|游戏等级	|游戏角色	|payment累加|
|:----|:-----|:----|
|2	|法师	|49600|
|2	|武士	|43800|
|3	|法师	|53000|
|3	|武士	|62300|
|4	|法师	|88655|
|4	|武士	|99550|

计算事件除了支持对事件参数做 SUM（累加）、AVG（求平均值）计算外，还支持 COUNT(DISTINCT)（去重）、MAX（求最大值）、MIN（求最小值），并且可以同时选择多个维度进行分析，满足深层次的分析需求。

### 事件列表

![](http://tacimg-1253960454.file.myqcloud.com/guides/%E6%8E%A7%E5%88%B6%E5%8F%B0-%E4%BA%8B%E4%BB%B6%E5%88%86%E6%9E%90-%E4%BA%8B%E4%BB%B6%E5%88%97%E8%A1%A8.png)

#### 主要指标说明

#### 事件 ID

控制台配置的事件 ID，应用端上报也需要使用同样的 ID，才能正确统计。

#### 事件名称

自定义的时间名称。

#### 事件类型

分为普通事件和计算事件。

#### 周同比

按周计算的同比变化。计算公式是：周同比 =（昨日触发事件数 - (昨日-7)那天触发的事件数）/ (昨日-7)那天触发的事件数

### 新增事件

自定义事件功能获取业务特性统计结果只需要：

在控制台新增自定义事件，填写事件 id、事件名称，并按需选择事件类型；

在事件的参数配置页面新增参数，填写参数 id，参数名称；

嵌入 Android 或 iOS SDK，把数据上报到服务器；

普通事件可在管理台直接查看事件及参数统计数据；计算事件需在参数配置页面下设置参数组合，设置完成后，即可查看参数组合数据报表。

其中每类事件都有 Key-Value 参数类型和不定长字符串参数类型，由于 Key-Value 参数类型的接口能表达更丰富的内容，我们推荐优先使用 Key-Value 类参数接口。另外，如果代码同时使用了这两种参数类型，event_id最好不一样。

注意：事件 ID 需要先在控制台上配置，才能参与正常的数据统计。事件 ID 不能包含空格或转义字符。

#### 新增事件的方法

![](http://tacimg-1253960454.file.myqcloud.com/guides/%E6%8E%A7%E5%88%B6%E5%8F%B0-%E4%BA%8B%E4%BB%B6%E5%88%86%E6%9E%90-%E6%96%B0%E5%A2%9E%E4%BA%8B%E4%BB%B6.png)

#### 新增事件参数的方法

![](http://tacimg-1253960454.file.myqcloud.com/guides/%E6%8E%A7%E5%88%B6%E5%8F%B0-%E4%BA%8B%E4%BB%B6%E5%88%86%E6%9E%90-%E6%96%B0%E5%A2%9E%E4%BA%8B%E4%BB%B6%E5%8F%82%E6%95%B0.png)

### 事件详情

在事件列表中，点击 `查看详情`，会弹出事件详情页，您可以查看事件的完整数据分布。

![](http://tacimg-1253960454.file.myqcloud.com/guides/%E6%8E%A7%E5%88%B6%E5%8F%B0-%E4%BA%8B%E4%BB%B6%E5%88%86%E6%9E%90-%E4%BA%8B%E4%BB%B6%E8%AF%A6%E6%83%85.png)

#### 指标说明
 
- 事件触发次数

事件总共触发的次数。
 
- 启动平均事件数

启动平均事件数指的是当日事件发生总次数/启动次数。
 
- 触发用户数

触发用户数指的是触发了该事件且该事件参数为当前值的用户数。
 
- 人均事件数

人均事件数指的是事件发生总次数/触发该事件的用户数。
 
- 用户参与度

用户参与度指的是事件触发用户数/活跃用户数。

### 导出事件明细

#### 功能介绍
对用户自定义事件，我们不但提供基础统计分析，还提供数据明细导出服务，用户可获取明细数据，结合自身业务特性更深度数据分析，挖掘数据价值，助力业务发展。

#### 后台推送
针对所有事件，用户可选择具体事件，平台将该事件数据明细，以 FTP 方式，推送到用户配置的服务器上。

特别说明：用户需配置服务器信息，并保证链路通畅。具体操作如下：

##### 第一步：配置服务器信息

具体如下，用户配置服务器信息后，可点击调试链路，是否与平台服务器打通。

当用户配置的服务器与平台服务器链路打通时，服务器状态会显示“已调通”

![](http://tacimg-1253960454.file.myqcloud.com/guides/%E6%8E%A7%E5%88%B6%E5%8F%B0-%E4%BA%8B%E4%BB%B6%E5%88%86%E6%9E%90-%E5%90%8E%E5%8F%B0%E6%8E%A8%E9%80%81%E7%9B%91%E6%8E%A7.png)


##### 第二步：配置事件导出开关

对自定义事件，可以设置后台推送的开关。服务器会把推送状态为“开”的事件，按每小时 1 次，把这些事件的数据明细，推送到指定服务器，可在【后台推送监控】页面，查看推送情况。



### 数据格式
后台推送的明细以 json 串方式导出，具体字段说明如下：

|名称|	字段说明|
|:--|:--|
|ui	|user id, android为IMEI，iOS 为 IF A 或 openUDID|
|mc	|设备的 mac 地址|
|ts	|timestamp，时间戳|
|idx	|自定义事件用户触发后，生成1条数据记录的数据 ID|
|cui|	Custom user id，用户自定义的 id，比如账号|
|av	|app version，应用的版本|
|ch	|channel，应用安装（推广）渠道|
|id|	应用 APPID|
|ei|	event id，用户配置自定义事件的事件 id|
|du	|duration，事件从触发开始到结束的时长，单位秒|
|kv	|Key-Value，自定义事件 Key-Value 参数|
