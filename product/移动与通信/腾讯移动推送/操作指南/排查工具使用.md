
## 简介

移动推送 TPNS 提供排查工具，帮助开发者在推送出现异常情况（如推送消息收不到）时进行自助排查及通过用户账号或TPNS设备唯一标识（Token）查询设备信息。

## 设备查询

### 通过用户账号查询

1. 登录 [移动推送 TPNS 控制台](https://console.cloud.tencent.com/tpns)。
2. 在左侧导航栏选择【工具箱】>【排查工具】。
3. 单击下拉框选择您需要查询产品及应用，选择【通过账号查询】。
![](https://main.qcloudimg.com/raw/9c5fc96d4004b24f93833f9536367ff3.png)
4. 输入用户账号（与 Token 绑定的用户唯一 ID，一般为 OpenID、UID等），单击【查询】。
5. 选择账号下关联的设备 `Token` 查看设备注册详情。
> ?Token 按与账号绑定时间的倒序展示，本页面最多展示10个 Token，推送目标设置为账号推送时，系统默认推送给最近一次绑定该账号的设备 ，如需要更改为推送给所有绑定该账号的设备，请在 [控制台](https://console.cloud.tencent.com/tpns) 或 [API](https://cloud.tencent.com/document/product/548/39064#.E5.8F.AF.E9.80.89.E5.8F.82.E6.95.B0) 推送时更改设置。
> 
![](https://main.qcloudimg.com/raw/61111a0a300176d5384da6adaa1af58e.png)

### 通过 Token 直接查询

1. 在排查工具页面中选择【通过 Token 直接查询】。
2. 输入设备 Token，单击【查询】，页面右侧会显示当前设备注册详情。
> ? 
	- Token：TPNS 分配给每一个设备的唯一ID，长度36位。
	- 若您不知道如何获取设备 Token，可参考 SDK 集成文档中的 [获取 Token 交互建议（Android）](https://cloud.tencent.com/document/product/548/36652#.E8.8E.B7.E5.8F.96-tpns-token-.E4.BA.A4.E4.BA.92.E5.BB.BA.E8.AE.AE) 或 [获取 Token 交互建议（iOS）](https://cloud.tencent.com/document/product/548/36663#.E8.8E.B7.E5.8F.96-tpns-token-.E4.BA.A4.E4.BA.92.E5.BB.BA.E8.AE.AE)。
	>
 ![](https://main.qcloudimg.com/raw/da0813f65491293e683a699ca7e9db95.png)

## 常见问题

1. 设备 Token 的有效期是多少，什么情况下会失效？
答：Token 有效期为90天，若设备连续90天未连接移动推送服务器，则会被标记为无效设备；若设备卸载了 App，当前 Token 会被标记为无效。
2. 通知栏权限已经开启，为什么设备查询显示关闭状态？
答：若手机通知栏设置从关闭到开启权限，需要在客户端重新触发一次注册请求，才可以把开启状态同步到移动推送服务器。
3. 通过账号或者标签推送无法收到，但通过Token推送可以收到，是什么原因？
答：在设备注册详情页中查看该Token是否关联了推送的目标账号或者标签，若未关联则无法通过账号或标签推送。
4. 推送状态显示已完成，设备状态正常，为什么手机没有看到推送？
答：
	- iOS平台推送环境是否与 Token 注册环境一致，不一致则无法收到推送，推送环境选择说明详情可参考文档 [推送环境选择](https://cloud.tencent.com/document/product/548/39395)。
	- 检查 APP 包名是否和配置管理中填写的包名一致，如果包名不一致检查是否开启了 [多包名推送功能](https://cloud.tencent.com/document/product/548/42875)。
	- 安卓 P 及以上系统需要添加使用 Apache HTTP client 库，检查在 AndroidManifest 的 application 节点内是否有添加以下配置：
	```
	<uses-library android:name="org.apache.http.legacy" android:required="false"/>
	```
	- 小米手机确认是否被收纳到【不重要通知】。
	- 魅族手机确认是否被收纳到【消息盒子】。
	- OPPO手机通知栏默认关闭，确认是否手动开启。
	- vivo 部分机型通知栏、通知渠道默认关闭，确认是否手动开启。
	- 应尽量避免使用“test”、“测试”等字眼，部分厂商通道会拦截这类型的通知。
	- vivo、OPPO 需要厂商审核通过后才可以测试推送，请注意确认。
