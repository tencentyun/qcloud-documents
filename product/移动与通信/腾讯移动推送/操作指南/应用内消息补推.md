下发推送消息时，如果您的用户关闭了手机终端的通知权限，推送消息将无法抵达。通过启动应用内消息补发能力，当用户在前台运行 App 时，会通过应用内横幅消息的方式展示推送消息的内容，不让您的用户错过重要通知，提升推送消息的抵达率。

## 应用场景
某信用卡 App 的运营人员想要给用户 W 发一条重要的、通知用户还款即将到期的 App 推送，但是用户 W 的 App 通知权限已被关闭，无法接收 App 推送。此时，运营人员可以通过启用“应用内推送补发”的能力，当用户 W 打开 App 时，通过应用内消息的形式，将该重要消息展示给用户。
![](https://main.qcloudimg.com/raw/8456ba2a603a4251f9293eefba0e99e0.png)
 
## 使用条件

### Android 端设置允许应用内消息展示

1. 在 app 目录中的 `build.gradle` 文件下,增加以下依赖
```
implementation 'com.tencent.tpns:tpns-inmsg:[version]-release' //[VERSION] 为最新发布的 SDK 版本号，版本号可在 Android SDK 发布动态查看
```
2. 调用 SDK 接口开启应用内消息展示，示例代码如下：
```
XGPushConfig.enableShowInMsg(context, true);
```

>! 安卓端的应用内消息展示依赖 WebView 框架，请留意配置 WebView 数据目录，否则可能引起程序崩溃，详情请参见 [应用内消息展示](https://cloud.tencent.com/document/product/548/36659#.E5.BA.94.E7.94.A8.E5.86.85.E6.B6.88.E6.81.AF.E5.B1.95.E7.A4.BA)。
>


### iOS 端设置允许应用内消息展示

iOS 端 SDK 默认允许应用内消息展示，更多应用内消息的设置请参考 [iOS 接口文档](https://cloud.tencent.com/document/product/548/48835#.E5.BA.94.E7.94.A8.E5.86.85.E6.B6.88.E6.81.AF.E5.B1.95.E7.A4.BA)。


## 操作说明

### 控制台使用

1. 登录 [腾讯移动推送控制台](https://console.cloud.tencent.com/tpns)。
2. 在左侧导航栏中，选择**App推送管理** ＞ **推送任务**，进入推送任务管理页面。
3. 单击**新建推送**，打开**应用内消息补推**。如下图所示：
![](https://main.qcloudimg.com/raw/e40fa16cde8ecf685925fc8b9f087804.png)
>? 
> - 此功能启用后，针对应用通知权限被关闭的用户，当在前台运行 App 时，会通过应用内横幅消息的方式展示推送的内容，提升推送消息的抵达率。
> - 设置仅针对该推送任务（push_id）生效。
> 

### Rest API 使用

在 Rest API 可选参数中增加设置`supply_inapp_msg`参数为`true`，可实现应用内消息补推，具体参考 [PushAPI 参数说明](https://cloud.tencent.com/document/product/548/39064#.E5.8F.AF.E9.80.89.E5.8F.82.E6.95.B0)。
推送示例如下：
```
{
   "audience_type": "all",
    "message_type": "notify",
		 "supply_inapp_msg": true 
    "message": {
        "title": "重要提示",
        "content": "7月1日是您的还款日期，请及时还款",
        "android": {
        	 "custom_content":"{\"key\":\"value\"}"
        }
    }
}
```


### 查看补推数据

当启用应用内消息补推后，可以在**推送任务** ＞ **单击-查看详情** ＞ **消息补推**中查看补推的数据效果。如图所示：
![](https://main.qcloudimg.com/raw/b68c1f5aaf7ed5f10bc65796407dfec3.png)

#### 指标口径

**计划发送**：该推送任务通过应用内消息下发的次数加和，不去重
**实际发送：**该推送任务通过应用内消息下发到终端设备的次数加和，不去重
**抵达数：** 该推送任务通过应用内消息下发并抵达成功的数量加和，不去重
**抵达率：** 抵达数 / 实际发送 * 100%
**曝光数：**该推送任务通过应用内消息下发并成功曝光的次数加和，不去重
**点击数：**该推送任务通过应用内消息曝光并被用户点击的次数加和，不去重
**点击率：**点击数 / 曝光数 * 100%
**抵达量提升：**应用内消息补推的抵达数 / 推送抵达数 * 100%
>? 抵达量提升说明：假如某推送任务没有启用应用内消息补推，仅 App 推送的抵达量为2000。若该推送任务启用应用内消息补推， App 推送的抵达量为2000，应用内消息的抵达量为1000，那么整个推送任务的抵达量为3000，较仅使用 App 推送而言抵达量提升50%。
>



