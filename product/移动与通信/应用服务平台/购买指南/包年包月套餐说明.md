## 计费资源周期

- **账期日**：用户购买包年包月云开发资源后，购买日记为资源账期日。云开发资源中的按月累计资源将在每个账期日进行资源重置。
例如：小明在2019年11月1日购买2个月的企业版1资源套餐，到期时间为2020年1月1日。小明的资源账期日为每月1日，即在12月1日按月资源会重置。
- **计费周期**：用户购买包年包月云开发资源后，从一个账期日起到下个账期日的逻辑月记为一个计费周期。

## 包年包月资源超限
在一个计费周期内，若某项资源使用量超出当前配额限制，系统将限制对该资源的使用，具体限制策略如下：

- 存储容量、数据库容量、数据库集合超限时，将无法存储或处理更多数据。除非清理数据到上限值以下或升级到更高配额套餐。
- CDN 流量、CDN 回源流量、存储下载次数限制、存储上传次数限制、云函数资源使用量和云函数外网出流量超限时，在下个计费周期前，将无法使用资源，除非升级到更高配额套餐。
- 数据库读操作次数和数据库写操作次数超限时，在当前自然日内将无法使用资源，除非升级到更高配额套餐。
- 同时连接数、函数并发达到上限后，后续的连接都将被拒，直到某些现有连接关闭为止。已连接的用户可以继续使用应用，除非升级到更高配额套餐。


## 包年包月资源到期
云开发到期停服规则，详情请参见 [预付费计费说明](https://cloud.tencent.com/document/product/555/9618)。

另外到期停服后：
- 存储、数据库和 CDN 资源均无法使用。
- 对于云函数：
  - 不再运行函数，同时不再处理任何新请求，定时触发器新周期内不再触发函数。
  - 暂停处理异步调用队列中的请求。超过7 × 24小时后，从请求入队列开始逐渐丢弃仍未被处理的请求。
  - 若异步调用队列中的请求自欠费后未超过7 × 24小时，恢复服务后异步调用队列恢复正常。

>!免费版本由系统自动续费。

## 包年包月套餐变更

满足套餐变更条件下，套餐变更需要付费记为升配操作，套餐变更需要退费记为降配操作。

### 包年包月资源升配
- 升配费用 = 按月升配差价 × 升配天数 / (365 / 12) × 适用折扣
  - 按月升配差价：新老配置原价按月的单价。
  - 升配的费用按天计算：升配天数 = 资源到期时间 - 当前时间。
  - 适用折扣：根据升配天数向下匹配适用折扣。
  - 折扣为现网生效的折扣。
- 升配不影响资源到期时间。
- 升配可以使用代金券和平台赠送余额（赠送金）抵扣费用。

> ? 升配时的新套餐额度生效时间为旧套餐剩余时长。升配时，用户无法选择升配时长，仅可在续费套餐时选择购买时长。
> 例如用户购买套餐一，套餐一有效时间为2021年3月1日至2021年9月1日，用户在2021年4月1日变配至套餐二，则变配后套餐二有效时间为2021年4月1日至2021年9月1日，有效时长不可选择。

#### 计费示例
>?以下价格仅作示例用，非官网实际价格，实例单价请参见 [云开发产品定价](https://cloud.tencent.com/document/product/876/39095)。

2019年11月1日，购买3个月低配版套餐，到期时间为2020年2月1日，包年包月单价为100元/月。
2019年12月15日，将该套餐升级为1000元/月的高配版套餐。
- 按月升配差价 = 1000 - 100 = 900元/月
- 升配天数 = 31 × 1 + 15 + 1 = 47天（1指1月份为31天，15指12月份剩余15天， 1指2月份1天）
- 适用折扣：暂无折扣
- 升配费用 = (1000 - 100) × 47 / (365 / 12) = 1390.68元

### 包年包月资源降配

- 降配费用 = 资源清退退款 - 资源新购费用
- 资源清退退款：按照非全额退款规则计算退款金额，
  
具体计算方法为：退款金额 = 当前有效订单金额 + 未开始订单金额 - 资源已消费金额
  其中：
   1. 当前有效订单金额/未开始订单金额：付费现金
   2. 资源已消费金额 =（已使用时长 / 总时长）× 订单金额
  - 资源新购费用：按新购的价格及对应折扣进行计算购买金额。
  - 若退费金额 > 0，实施配置降级，退还费用将以原路退还的方式退还到您到腾讯云账户。
  - 若退款金额 <= 0，实施配置降级但不退费。
  - 若购买时使用折扣或代金券，折扣和代金券不予退还。

#### 计费示例

>?以下价格仅作示例用，非官网实际价格，实例单价请参见 [云开发产品定价](https://cloud.tencent.com/document/product/876/39095)。

2019年11月1日，购买3个月某高配版套餐，到期时间为2020年2月1日，包年包月单价为1000元/月。
2019年12月15日，将该套餐降配为100元/月的低配版套餐。
资源清退退款 = 1000 × 3 - [(30 × 1 + 15) / (30 + 31 × 2 + 1)] × 1000 = 2516.13元（30指11月份30天，2指12、1两个月， 1指2月份1天）
- 资源新购费用 = [(31 × 1 + 15 + 1) / (365 / 12)] × 100 = 154.5元
- 降配费用 = 2516.13 - 154.5 = 2361.63 元

### 自动降配
包年包月产品提供了一定的免费版资源，而用户在使用付费的包年包月产品时有资源到期的情况，如果未及时续费，环境将进入隔离期，业务停服。为了最大化免费资源的使用，我们提供资源到期自动降配为免费版资源的能力。

#### 操作步骤

您可以通过以下两种方式设置自动降配：

<dx-tabs>
::: 方式1：购买时设置
在腾讯云云开发控制台购买包年包月付费产品时，勾选设置自动降配能力。
![](https://main.qcloudimg.com/raw/b811782ab362a9052128f2ec1d27544e.png)
:::
::: 方式2：购买后设置
在腾讯云云开发控制台对已有的付费环境，单击**自动降配**设置。
![](https://main.qcloudimg.com/raw/ac10ceaac5b26f90d0cfc3a3a94340e8.png)

设置自动降配能力后，如果当前环境中的文件存储容量、数据库容量、数据库集合数均不超过免费版上限，资源到期时系统将该环境降配到免费版。降配的同时，环境资源的能力也会相应发生变化，例如免费版数据库不支持指定回档时间，数据库回档天数限制在7天内，云函数数量限制变为50个等。

> !
> 1. 不满足上述条件，到期后环境会正常隔离。
> 2. 设置自动降配的环境，将占用免费资源名额。
> 3. 自动降配需在环境到期隔离前设置，隔离期不能设置。
> 4. 超过免费名额的限制将不能设置自动降配，除非删除已有的免费版环境或者修改自动降配环境。
:::
</dx-tabs>



## 套餐变更限制[](id:change)
出现以下情形时，系统将限制用户变更套餐：
1. 存储容量、数据库容量以及数据库集合数量超过目标套餐上限将无法变更套餐。用户可以清理资源后再进行变更操作。
2. 存储下载次数、上传次数、CDN 回源流量、CDN 流量、云函数调用次数、云函数资源使用量、云函数外网出流量任一资源超过目标套餐上限将无法变更套餐。可在下一计费周期再进行变更操作。
3. 数据库读操作次数和数据库写操作次数超过目标套餐上限后，可选择下一自然日再进行配额调整或强制调整。强制调整将导致已超限资源本自然日内无法继续使用。

>?小程序云开发的配置调整请参见 [配额调整规则](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/billing/adjustment-rule.html)。

#### 示例
背景：小明在2019年11月1日购买2个月的某高配版资源套餐，到期时间为2020年1月1日。
<dx-tabs>
::: 案例一
在2019年11月15日时 CDN 用量已达145G，此时小明想调整资源到低配版，但因低配版的 CDN 流量上限为50G，用户当前用量已经超过低配版上限，出于保证用户服务考虑，当前计费周期内不能调整为低配版。用户可以在下个计费周期，各个资源都满足不超过目标套餐上限的条件下调整配置。
:::
::: 案例二
在2019年11月15日时存储容量已达95G，此时小明想调整资源到低配版，因低配版的存储容量上限为50G，用户当前用量已经超过目标套餐的上限值，所以不能降配。此时，小明可通过清理部分存储文件降低当前用量到目标套餐上限值以下，再尝试变配操作。
:::
::: 案例三
在2019年11月15日当天的数据库读操作数已达200万次，此时小明想调整资源到低配版，因低配版的数据库读操作上限为150万，用户当前用量已经超过目标套餐的上限值，所以不建议用户降配。但小明可选择强制降配或第二天降配，如果选择强制降配，则服务有关数据库读服务都将停止。
:::
</dx-tabs>
