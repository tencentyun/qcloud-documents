## 操作场景

本文档主要介绍在弹性微服务控制台中创建应用与部署的具体步骤。

## 前提条件

1. 已 [创建环境](https://cloud.tencent.com/document/product/1371/53293)。
2. 已 [添加环境资源](https://cloud.tencent.com/document/product/1371/55684)（按需选用日志服务、存储服务、注册中心）。

## 操作步骤

1. 登录 [弹性微服务控制台](https://console.cloud.tencent.com/tem)。
2. 在左侧导航栏，单击**应用管理**进入应用列表页面，选择您的应用部署地域。

| 地域 | 支持部署的可用区       |
| ---- | ---------------------- |
| 广州 | 三区、四区、六区       |
| 上海 | 二区、三区、四区、五区 |

3. 单击**新建**，进入新建应用页面，填写应用信息。
   ![](https://main.qcloudimg.com/raw/62c0076388cf1ec0806fdfdc8194db22.png)

   - 名称：填写应用名称，最长为45个字符，只能包含小写字母、数字及分隔符(“-”)，且不能以分隔符开头或结尾
   - 开发语言：选择您的开发语言。
   - 程序包上传方式：选择程序包上传方式。Java 语言支持上传镜像、JAR 包和 WAR 包，其他语言只支持镜像上传。如果选择 JAR 包或者 WAR 包的方式，TEM 将自动为您构建容器镜像，并推送至 TEM 为您创建的个人版容器镜像仓库中。

4. 单击**提交**，在弹窗中选择**确认**，进入部署应用页面。如果选择**取消**，您后续可以在应用列表中，点击**部署至新环境**完成应用部署。
   ![](https://main.qcloudimg.com/raw/5ebe44d78394d4d0f86af65002e37c2a.png)

5. 在应用部署页面，根据您的应用具体情况配置相关参数。
   ![](https://main.qcloudimg.com/raw/658d265230fc3c9fcda6038637986ab6.png)

   参数说明如下：


| 参数            | 说明                                                         |
| --------------- | ------------------------------------------------------------ |
| 发布环境        | 选择应用所在的环境。如果没有合适的环境可前往 [环境页面](https://console.cloud.tencent.com/tem/env) 进行新建（参考 [创建环境](https://cloud.tencent.com/document/product/1371/53293)）。 |
| JDK 版本        | 选择 JDK 版本，支持 OpenJDK 8和 KonaJDK 8。                  |
| 上传程序包/镜像 | 上传您的程序包或者镜像，或者下载控制台上的体验 Demo 进行部署体验 TEM 完整功能。 |
| 版本号          | 设置应用版本号，您可以选择输入版本号或者单击**使用时间戳为版本号**将时间戳作为应用版本号。 |
| 版本描述        | 填写版本描述。                                               |
| 启动参数        | 设置启动参数。                                               |

>?如果您的应用是 Java 语言，并且关联了注册中心，TEM 将为您提供自动注入注册中心信息的能力，详情请参考 [服务注册与发现](https://cloud.tencent.com/document/product/1371/56367)。

6. （可选）您可以根据需要设置以下高级选项。


| 参数                    | 是否必选 | 说明                                                         |
| ----------------------- | -------- | ------------------------------------------------------------ |
| 资源配置                | 是       | 可以手动设置或者设置弹性规则自动弹性伸缩。                   |
| 访问配置                | 否       | <li>访问方式：环境内访问，公网访问可前往 [环境](https://console.cloud.tencent.com/tem/env) 全局配置，参考 [配置应用访问与路由](https://cloud.tencent.com/document/product/1371/55685)。 </li><li>协议：支持 TCP 和 UDP 协议，使用公网/内网负载均衡时，TCP 和 UDP 协议不能混合使用。 </li> |
| 应用生命周期管理        | 否       | 对应用进程在启动前和结束后设置处理任务，例如：环境准务、应用退出等。 |
| 配置设置                | 否       | 配置的使用与管理。                                           |
| 环境变量                | 否       | 配置环境变量。                                               |
| 健康检查                | 否       | <li> 存活检查 (Liveness)：检查应用实例是否运行正常，不正常则重启实例。</li><li> 就绪检查 (Readiness)：检查应用实例是否就绪，不就绪则停止转发流量到当前实例</li>具体操作参考 [健康检查](https://cloud.tencent.com/document/product/1371/60004)。 |
| <nobr>持久化存储</nobr> | 否       | 持久化存储：为容器提供存储，目前支持腾讯云文件存储 CFS，需挂载到容器的指定路径中。<li>   数据卷：添加在 [添加环境资源](https://cloud.tencent.com/document/product/1371/55684) 中关联的 CFS 存储资源。</li><li> 挂载点：选择为该步骤中所添加的数据卷，挂载至目标路径。填写版本描述。</li> |
| 安全组                  | 否       | 您可以通过配置安全组规则，允许或禁止安全组内的实例的出流量和入流量。如您有业务需要放通其他端口，您可以 [新建安全组](https://console.cloud.tencent.com/vpc/securitygroup)。 |
| 日志配置                | 否       | 您可以开启“持久化存储至CLS”，支持标准输出“stdout”以及`*`配置路径，例如：`/logs/*`，使用半角逗号分隔，默认采集标准输出。 |

7. 单击**提交**，完成应用部署。
8. 如果您为微服务应用，消费端应用的部署与服务端应用类似参考步骤3 - 7，不再赘述。

## 访问应用

弹性微服务提供微服务环境内访问和外网访问两种方式：

- 环境内访问：同一环境中的微服务，可通过注册服务名互相调用。支持基于 consul、eureka 等注册中心的服务注册与发现，也支持基于 kubernetes 的服务发现。
- 外网访问：单击环境卡片下方的**查看详情**，在**访问管理**页面可创建公网 LB 和 HTTP/HTTPS 协议的转发规则，对应用进行访问。

以外网访问为例，操作步骤如下：

1. 参考 [配置应用访问与路由](https://cloud.tencent.com/document/product/1371/55685) 建立一条公网访问路由。

2. 您可以在环境详情页中的**访问管理**下，查看应用的公网访问 IP。
   ![](https://main.qcloudimg.com/raw/ce7a258c400a846dae3bcb792af62ca9.png)

3. 在浏览器地址栏中输入以下 URL。
  ```xml
 <外网访问地址/域名>+<路径>
  ```
   例如：输入 `http://xx.xx.xx.xx/ping-provider`，如果返回以下结果，则说明应用部署成功。
   ```
	Hello World!
   ```
