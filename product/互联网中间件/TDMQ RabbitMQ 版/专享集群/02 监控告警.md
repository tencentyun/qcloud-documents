## 操作场景

TDMQ RabbitMQ 版专享集群支持监控您账户下创建的资源，包括集群、节点等，您可以根据这些监控数据，分析集群的使用情况，针对可能存在的风险及时处理。同时您也可以对监控项设置报警规则，以便数据异常时收到报警消息，及时处理风险，保障系统的稳定运行。

## 监控指标

TDMQ RabbitMQ 版专享集群支持查看**集群**和**节点**两个维度的监控数据，支持的监控指标如下：


| 监控指标           | 单位    | 监控指标含义                                                 |
| ------------------ | ------- | ------------------------------------------------------------ |
| 连接数量           | Count   | 当前打开的连接数量                                           |
| 通道数量           | Count   | 当前打开的通道数量                                         |
| 队列数量           | Count   | 当前可用队列总数                                             |
| 消费者数量         | Count   | 当前在线消费者总数                                           |
| 堆积消息数量       | Count   | ready 状态(堆积未投递)的消息总数                              |
| 消费未确认消息数量 | Count   | 已投递至消费者但未确认的消息总数                             |
| 消息丢弃速率       | Count/s | mandatory=false 的情况下发送至 exchange，并且没有符合的路由条件导致消息丢弃(drop)速率 |
| 生产确认速率       | Count/s | client 消息生产成功后，broker 确认回包速率                     |
| 每秒生产消息数量   | Count/s | client 端生产消息速率                                         |
| 消费确认速率       | Count/s | 消费者确认的消息速率                                         |
| 每秒消费消息数量   | Count/s | 总体每秒消费消息速率，包括 autuAck=false 和 autoAck=true 两种情况 |
| 重投递速率         | Count/s | channel 中重投递到消费者的消息速率                            |



## 查看监控数据

1. 登录 [TDMQ RabbitMQ 版控制台](https://console.cloud.tencent.com/tdmq/rabbit-cluster)。
2. 在左侧导航栏选择**集群管理**，选择好地域，并切换到**专享集群**页面，单击需要查看的集群的“ID”，进入集群详情页。
3. 在集群详情页顶部，选择**监控**页签，进入监控页面。
4. 选择要查看的资源页签，设置好时间范围后，查看对应的监控数据。

| 图标                                                         | 说明                                                         |
| :----------------------------------------------------------- | :----------------------------------------------------------- |
| ![img](https://main.qcloudimg.com/raw/9ba57bbd3b8ef3efc4f687d63d27a46d.png) | 单击可查看监控指标同环比，支持同比、环比和自定义日期对比。   |
| ![img](https://main.qcloudimg.com/raw/34bdbdbdabb7b5720bf17d78c636a4ad.png) | 单击可刷新获取最新的监控数据，支持设置30s、5min、30min和1h时间间隔自动刷新监控数据。 |
| ![img](https://main.qcloudimg.com/raw/8f2bf7f4df9ddd959f0ecb69fdda8e4c.png) | 单击可将图表复制到 Dashboard，关于 Dashboard 请参见 [什么是 Dashboard](https://cloud.tencent.com/document/product/248/47161)。 |
| ![img](https://main.qcloudimg.com/raw/af20129df7be46f33ab7d3598f6e9213.png) | 勾选后可在图表上显示图例信息。                               |

![](https://qcloudimg.tencent-cloud.cn/raw/a44a98d3a9597093569aef198ad106b9.png)

## 配置告警规则

### 新建告警规则

您可以为监控指标配置告警规则，当监控指标达到设定的报警阈值时，云监控可以通过邮件、短信、微信、电话等方式通知您，帮助您及时应对异常情况。

1. 在集群的 [监控](https://console.cloud.tencent.com/tdmq/rabbit-cluster-detail) 页面，单击下图告警按钮跳转至 [云监控控制台](https://console.cloud.tencent.com/monitor/policylist) 配置告警策略。
   ![](https://qcloudimg.tencent-cloud.cn/raw/4db136f8dc334d12aeacd62de71bd06d.png)

2. 在告警策略页面，选择好策略类型和要设置告警的实例，设置好告警规则和告警通知模板。
   - **策略类型**：选择**消息队列 TDMQ/RabbitMQ**。
   - **告警对象**：选择需要配置告警策略的 RabbitMQ 资源。
   - 触发条件：支持**选择模板**和**手动配置**，默认选择手动配置，手动配置参见以下说明，新建模板参见 [新建触发条件模板](#model)。
     <dx-alert infotype="explain" title="">

 - 指标：例如“连接数量”，选择统计粒度为1分钟，则在1分钟内，生产时延平均耗时连续N个数据点超过阈值，就会出发告警。
 - 告警频次：例如“每30分钟警告一次”，指每30分钟内，连续多个统计周期指标都超过了阈值，如果有一次告警，30分钟内就不会再次进行告警，直到下一个30分钟，如果指标依然超过阈值，才会再次告警。
   </dx-alert>
   - **通知模板**：选择通知模板，也可以新建通知模板，设置告警接收对象和接收渠道。

3. 单击**完成**，完成配置。
   <dx-alert infotype="explain" title="">
   有关告警的更多信息，请参见 [云监控告警服务](https://cloud.tencent.com/document/product/248/50398) 。
   </dx-alert>


[](id:model)

### 新建触发条件模板

1. 登录 [云监控控制台](https://console.cloud.tencent.com/monitor/)。
2. 在左侧导航栏中，单击**触发条件模板**，进入触发条件列表页面。
3. 在触发条件模板页单击**新建**。
4. 在新建模板页，配置策略类型。
   - **策略类型**：选择**消息队列 TDMQ/RabbitMQ**。
   - **使用预置触发条件**：勾选此选项，会出现系统建议的告警策略。
5. 确认无误后，单击**保存**。
   ![](https://qcloudimg.tencent-cloud.cn/raw/07dcc7044fde9e78d9dd035f93d8304f.png)
6. 返回新建告警策略页，单击**刷新**，就会出现刚配置的告警策略模板。
   ![](https://qcloudimg.tencent-cloud.cn/raw/a095c0b7ed7fbd9f89e048fc8517e329.png)
