## 操作场景

日志配置项用于指定采集日志的规则，包括日志的采集路径和日志解析格式（功能待发布）。用户可以在 TSF 控制台上创建日志配置项，然后将配置项发布到部署组上。同一个部署组可以关联多个日志配置项。


## 操作步骤

### 创建日志配置项

1. 登录 [TSF 控制台](https://console.cloud.tencent.com/tsf/index)。
2. 在左侧导航栏 ，单击**日志服务** > **日志配置**。
3. 在日志配置页，单击**新建配置**，在“创建日志配置”页面中设置您的日志配置项信息。
   ![](https://main.qcloudimg.com/raw/c770ed43301c19d4bdc44b586647cf56.png)
   - **名称**：填写日志配置名称，不超过 60 个字符。
   - **日志类型**：根据应用程序的日志类型选择一种日志类型，目前支持 Spring boot、 Nginx Access 、自定义logback、自定义log4j、 自定义log4j2 、单行/多行文本、无解析规则七种类型。
   - **采集路径**：设置您的日志采集路径，可配置一个或者多个日志采集路径。目前支持**绝对路径具体到日志文件**，如/data/log/2017.log，文件名称允许使用数字、字母、横杠`-`、下划线`_`、通配符`\*`和小数点`.`。日志文件必须具有文件后缀，文件名和目录支持通配符，如`/data/log/*.log`或`/var/log/*/*.log`。
   - **日志格式**：当日志类型为“自定义 logback”、“自定义 log4j”、“自定义log4j2” 及 “单行/多行文本”时，需设置日志格式（参见 [日志格式说明](https://cloud.tencent.com/document/product/649/55278)）。
     > ?
     >- 若要实现调用链与业务日志联动，部署组关联的日志配置项必须遵守日志格式规范。
     >- Spring Boot 格式默认可以支持日志调用链联动。
     >- 自定义 Logback、自定义 Log4j、自定义 Log4j2 和单行/多行文本格式日志需要日志 pattern 中添加 %trace 才可以支持日志和调用链联动。
     >- Nginx Access 和无解析规则格式日志无法支持日志和调用链联动。
 
 设置日志格式后，您可以通过“格式解析”功能，检验当前的设置是否正确：
     1. 单击**格式解析**，打开日志格式解析弹框。
        ![](https://main.qcloudimg.com/raw/4ef44d2f6374366c68e5e449410c76ed.png)
     2. 复制部分日志内容粘贴在“日志内容”区域，单击**解析**，查看“解析结果”区域的输出是否符合预期。
        ![](https://main.qcloudimg.com/raw/a3c390c1bf9001a824cff82b85ce2465.png)
        **备注**：选填，日志配置项的描述信息。
4. 单击**提交**完成创建。




### 默认日志配置项

TSF 提供默认日志配置项，格式是 Spring Boot。日志路径包括三部分，相对于应用启动路径：

-  `./*.log` 
-  `./log/*.log` 
-  `./logs/*.log` 

用户可以在微服务应用的配置文件中配置 `logging.file` 为上述任意一个路径，然后在创建部署组时，选择默认日志配置项 `default-log-config`。

> !默认日志配置项仅适用于虚拟机部署的应用。



### 部署组关联日志配置项

部署组关联日志配置项有两个入口：

- 用户可以在创建应用时将日志配置项关联到应用。
- 在日志配置项列表，右侧操作栏中单击**发布规则**。

**创建部署组时选择日志配置项**

1. 登录 [TSF 控制台](https://console.cloud.tencent.com/tsf/index)。
2. 在左侧导航栏，单击**部署组**。
3. 单击**新建部署组**，在弹出框中选择关联的日志配置项。
   ![](https://main.qcloudimg.com/raw/9de400c3eac8a92320c0b0e0b7fd903e.png)
4. 单击**提交**。

**在日志配置项列表发布配置**

1. 登录 [TSF 控制台](https://console.cloud.tencent.com/tsf/index)。
2. 在左侧导航栏 ，单击**日志服务** > **日志配置**。
3. 在日志配置页，单击操作列的**发布规则**。
4. 选择要绑定的部署组。
   ![](https://main.qcloudimg.com/raw/06fe0c94f9e21118afcc1f813de0f467.png)
5. 单击**提交**完成发布。

 

### 删除日志配置项

当日志配置项没有被其他部署组关联时，才可以删除日志配置项。

1. 登录 [TSF 控制台](https://console.cloud.tencent.com/tsf/index)。
2. 在左侧导航栏，单击**日志服务** > **日志配置**。
3. 在日志配置页，单击操作列的**更多** > **删除**。
   ![](https://main.qcloudimg.com/raw/9b9530d3a8efdad3acb1906373df55a2.png)
4. 在删除确认框中单击**确认**，即可删除日志配置项。


