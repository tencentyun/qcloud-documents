以下视频将为您介绍 TSF 部署组的使用方法：

<div class="doc-video-mod"><iframe src="https://cloud.tencent.com/edu/learning/quick-play/2039-24421?source=gw.doc.media&withPoster=1&notip=1"></iframe></div>

部署组基本操作如下：

| 功能     | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| 应用扩容 | 将 CVM 云服务器添加到部署组中，如果部署组此时已经关联了程序包，将执行部署命令。 |
| 部署应用 | 将应用部署到 CVM 云服务器上，并执行启动命令。                |
| 下线实例 | 停止 CVM 云服务器上的应用，然后将实例从部署组中移除。        |
| 停止应用 | 将部署组中所有的节点上运行的应用停止，停止后可以再启动。     |
| 启动应用 | 当应用处于停止状态时可以启动应用。                           |

### 创建部署组

1. 登录 [TSF 控制台](https://console.cloud.tencent.com/tsf/index)。
2. 在左侧导航栏中，单击**部署组**。
3. 在页面顶部选择集群。
4. 单击部署组列表上方的**新建部署组**。
5. 设置部署组相关信息。
   - **部署组名称**：部署组的名称，不超过60个字符。
   - **命名空间**：选择命名空间。
   - **关联应用**：关联应用字段决定了后续程序包来源和应用配置来源。
   - **日志配置项**：指定部署组内实例的业务日志采集规则。如果配置为"无"，将不采集业务日志。更多关于日志配置项的说明请参考 [日志配置项](https://cloud.tencent.com/document/product/649/13697)。
   - **日志投递**：指定日志的转储方式，将规则指定路径中的日志内容投递到指定的接收端。如果配置为"无"，将不投递业务日志。更多关于日志投递的功能说明请参考 [日志投递](https://cloud.tencent.com/document/product/649/43510)。
6. 单击**保存&下一步**，选择当前集群下可用的云主机实例。
7. 单击**部署应用**，按照 [部署应用](#deploy) 进行操作。

<span id='deploy'></span>

### 部署应用

1. 单击部署组列表页右侧的**部署应用**。
2. 选择目标程序包版本。

| 程序包类型 | 说明                                                         |
| ---------- | ------------------------------------------------------------ |
| jar        | 启动命令固定为 java -jar；支持JDK版本 KNOA JDK8，KNOA JDK11 和 OPEN JDK8；支持用户设置启动参数 |
| war        | 启动命令固定为 java -jar，支持用户设置启动参数               |
| zip/tar.gz | 程序包类型为zip/tar.gz时，支持JDK版本 KNOA JDK8，KNOA JDK11 和 OPEN JDK8；支持**启停脚本配置**。<li>使用本地start.sh和stop.sh：默认方式</li><li>控制台配置：需要填写启动脚本和停止脚本（推荐）</li>当部署组内的实例 agent 版本不支持**控制台配置**启停脚本时，不能选中该选项，请升级 agent 到最新版本。参考 [应用管理相关](https://cloud.tencent.com/document/product/649/20271)。 |

> ? 当用户切换运行环境，在部署组动态更新 JDK 运行版本，且重启部署组后生效。

3. （可选）设置启动参数。
>?如果部署组关联的应用是 Mesh 应用，则无须设置启动参数。
4. 选择更新方式。

| 更新方式 | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| 立即更新 | 会先停止所有运行实例，然后使用新的程序包版本部署，会造成发布期间短暂停服。 |
| 滚动更新 | 当部署组内有多个实例时，可以选择滚动更新方式进行分批发布。滚动更新支持设置发布策略：<li>**beta 批次**：是否首次用一个实例来部署新版本，如果部署成功，才会部署后面的批次实例。</li><li>**批次 N 实例占比**：除了 beta 批次，可以将部署组内剩余实例按百分比划分为多个批次部署，只有当批次 N 部署成功后才会继续部署批次 N+1。</li><li>**分批执行方式**：批次之间可以选择自动或手动方式来开启下一批次的部署。</li><li>**分批等待时间**：如果**分批执行方式**选择自动时，等待分批等待时间后会自动部署下一批次。</li> |

5. （可选）选择健康检查方式。关于健康检查的作用和配置详情参考 [健康检查](https://cloud.tencent.com/document/product/649/52359)。
>!
>- 当部署组内的实例 agent 版本不支持存活检查和就绪检查时，不能开启检查功能，请升级 agent 到最新版本。参考 [应用管理相关](https://cloud.tencent.com/document/product/649/20271)。
>- 当部署组内的多个实例 agent 版本不一致时，不能开启检查功能。只有当所有实例的 agent 的版本支持存活检查和就绪检查才开启该特性。


| 健康检查方式 | 说明                                     |
| ------------ | ---------------------------------------- |
| 存活检查     | 检查应用是否正常，不正常则重启实例       |
| 就绪健康     | 检查应用是否就绪，不就绪会影响滚动更新。 |

存活检查的检查方式：

| 检查方式      | 说明                                                         |
| ------------- | ------------------------------------------------------------ |
| HTTP 请求检查 | 任何大于200小于400的返回码都会认定是成功的返回码。其他返回码都会被认为是失败的返回码。HTTP 检查需要设置端口和请求路径。 |
| TCP 端口检查  | 如果可以建立连接被认为是成功的。该检查方式需要设置检查端口。 |
| 执行命令检查  | 如果命令执行成功并且返回值为 0，认为是成功；其他返回值认为是失败。该检查方式需要填写执行命令。 |

   高级参数：

| 参数       | 说明                                   | 参数范围                                                     |
| ---------- | -------------------------------------- | ------------------------------------------------------------ |
| 启动延时   | 延时启动健康检查的时间                 | 最小值为0，默认值为10                                        |
| 超时时间   | 每次健康检查响应的最大超时时间         | 最小值为1，默认值为2                                         |
| 检查周期   | 进行健康检查的时间间隔                 | 最小值为1， 默认值为10                                       |
| 健康阈值   | 表示从失败到成功的连续健康检查成功次数 | 存活检查不支持编辑，只能为1就绪检查支持编辑：最小值为1，默认值为1 |
| 不健康阈值 | 表示从成功到失败的连续健康检查成功次数 | 最小值为1，默认值为3                                         |


7. （可选）填写描述信息。
8. （可选）开启强制启动，开启强制启动则实例忽视consul服务注册报错信息正常启动。
9. 单击【完成】。应用部署成功后，部署组中的 **已启动/总机器数** 数值发生变化。 ![](https://main.qcloudimg.com/raw/0dbf4dddad91bd8770f15f3c4ddb6498.png)

### 应用扩容

1. 单击部署组列表右侧的**更多** > **添加实例**。
2. 选择要添加进部署组的云服务器 CVM，单击**提交**。
>?部署组如果已选择在控制台配置启停脚本，扩容时如果实例 agent 版本不支持该特性，请升级 agent 到最新版本。参考 [应用管理相关](https://cloud.tencent.com/document/product/649/20271)。
3. 在部署组的实例列表页面中显示出刚才添加的 CVM。

### 下线实例

1. 单击部署组列表右侧的**更多** > **下线实例**。
2. 选择要下线的实例。
3. 在弹出的确认页面中，单击**提交**。

### 停止应用

1. 单击部署组列表页右侧的**更多** > **停止应用**。
2. 在弹出的确认页面中，单击**确认**。

### 启动应用

1. 单击部署组列表页右侧的**更多** > **启动应用**。
2. 在弹出的确认页面中，单击**提交**。

### 删除部署组

>?下线部署组内所有实例后，才能执行部署组的删除操作。

1. 勾选您要删除的部署组，单击左上角的**删除**。
2. 在弹出的确认页面中，单击**提交**。

   
