文件配置功能支持用户通过控制台将配置下发到服务器的指定目录。应用程序通过读取该目录下的配置文件实现特殊的业务逻辑。

文件配置支持如下功能：

- 创建文件配置项：一个文件配置项管理多个版本的配置。
- 生成新版本：基于历史版本生成新版本。
- 发布配置：支持发布配置到部署组。
- 发布情况：查看配置项的发布到哪些部署组。
- 回滚：回滚到上一个版本的配置。

## 使用场景

### 定时检查配置是否更新

- 应用程序中包含了读取指定目录配置文件的逻辑，例如定时去检查配置文件是否更新（通过文件 md5 是否变化等方式检查），如果更新了会执行特定逻辑。
- 在控制台上创建文件配置，下发到部署组。

### 动态替换 PHP 文件

通过控制台发布一个 PHP 文件到指定目录，来达到动态替换服务器上 PHP 文件的目的。

## 前提条件

能否使用文件配置功能，依赖于应用部署的环境是否满足以下条件：

- **对于使用虚拟机部署的应用**：只有2018年11月20号之后导入到集群的云主机上会具有满足应用配置功能的环境。
- **对于容器部署的应用**：该功能需要用户修改 Dockerfile。以下示例在 [制作镜像](https://cloud.tencent.com/document/product/649/17007) 文档的基础上做修改：
	- 需要将`tsf-consul-template-docker.tar.gz`（[下载地址](https://tsf-doc-attachment-1300555551.cos.ap-guangzhou.myqcloud.com/%E5%85%AC%E6%9C%89%E4%BA%91/%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE/tsf-consul-template-docker.tar.gz)） 添加到`/root/`目录下：
	```Dockerfile
	ADD tsf-consul-template-docker.tar.gz /root/
	```
	- 启动脚本中，需要执行`/root/tsf-consul-template-docker/script` 目录下的 `start.sh` 脚本：
	```shell
	CMD ["sh", "-ec", "sh /root/tsf-consul-template-docker/script/start.sh; exec java ${JAVA_OPTS} -jar ${jar} 2>&1"]    
	```

## 控制台基本操作

### 创建文件配置

1. 登录 [TSF 控制台](https://console.cloud.tencent.com/tsf)。
2. 在左侧导航栏中，单击**配置管理** > **[文件配置](https://console.cloud.tencent.com/tsf/config-file)**。
3. 在文件配置页面，单击**新建配置**。
4. 填写文件配置信息：
	- 配置名称
	- 关联应用
	- 文件保存编码
	- 配置内容：支持上传文件或者控制台编辑
	- 配置文件名称：下发到服务器的配置文件的文件名称
	- 版本号
	- 版本描述
		![](https://main.qcloudimg.com/raw/7b87e152a4f9dd656f0ee12738a8943b.png)
	- 配置下发路径：配置下发到服务器的路径
	- 后置脚本（选填）：配置下发到服务器后执行的命令（**不需要** 包含 #! /bin/bash）
		![](https://main.qcloudimg.com/raw/abad2fd25b6931305bbde8082e1c20b1.png)
	- 数据集：将新建的集群添加到已有数据集中。非必填字段。数据集使用，请参阅 [数据集管理](https://cloud.tencent.com/document/product/649/38326)。
	- 标签：用于分类管理资源，可不选。详情参考 [标签](https://cloud.tencent.com/document/product/649/53869)。

  

### 生成新版本

1. 在配置列表页，单击配置名称进入详情页。
2. 单击某个配置版本旁的**生成新版本**。
3. 填写变更的新版本的配置内容和版本号。
4. 单击**完成**，生成新版本。

### 发布配置

1. 在配置列表页，单击配置名称进入详情页。
2. 单击某个配置版本旁的**发布**。
3. 选择配置发布的目标部署组，填写发布描述。
4. 单击**提交**，完成发布。

### 查看文件所在部署组的配置发布历史

1. 在配置列表中，单击操作列的**查看发布信息**。
2. 展开所需查看的部署组，即可查看该部署组的配置发布历史。
3. 单击其中一条发布历史，可查看配置发布前后区别。

### 配置回滚

回滚配置会将部署组的配置回滚到**上一次**发布的版本。

1. 进入**发布情况** 界面， 查看文件所在部署组的配置发布历史  。
2. 在相应部署组的操作中，单击**回滚**。
3. 可查看回滚前后配置变化，单击**提交**。
