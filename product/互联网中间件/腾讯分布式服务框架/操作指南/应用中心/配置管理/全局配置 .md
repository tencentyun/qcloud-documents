## 操作场景
全局配置功能用于动态更新应用代码中的配置。全局配置可以保证配置内容在某个集群或者命名空间中全局生效。
全局配置包括管理配置和发布配置两部分。管理配置包括创建配置、生成新版本配置和删除配置。配置可以发布到命名空间下的所有应用。

## 前提条件
在使用全局配置功能之前，请确保已经按照 [分布式配置开发文档](https://cloud.tencent.com/document/product/649/16620) 添加了代码注释。

## 操作步骤
### 创建配置
1. 登录 [TSF 控制台](https://console.cloud.tencent.com/tsf/index)。
2. 在左侧导航栏，单击【配置管理】>【[全局配置](https://console.cloud.tencent.com/tsf/config)】。
3. 在全局配置页面左上角，单击【配置列表】。
4. 在配置列表页，单击【新建】，进入配置界面。
5. 填写配置内容。配置可以按照 YAML 方式进行编辑。YAML 格式规范参考 [YAML 格式介绍](https://cloud.tencent.com/document/product/649/17925)。
>!单个全局配置版本的大小不能超过65535个字节，如果实际使用的配置超过了该上限值，可以分成多个全局配置项发布到同一个命名空间，多个配置会合并成一份配置。
6. 单击【完成】，完成创建。



### 生成新版本配置
1. 单击配置项名称，进入配置详情页。
2. 单击配置列表右侧的【生成新版本】。
![](https://main.qcloudimg.com/raw/e5e26d0d98dc069e5be8d67618639490.png)
3. 填写变更的配置内容和版本号。
>!新版本配置的版本号不能与原版本相同。
4. 单击【完成】，即可生成新版本。


### 删除配置
1. 单击配置项名称，进入配置详情页。
2. 删除每个配置版本，删除最后一个配置版本后，配置项将被删除。
![](https://main.qcloudimg.com/raw/34f27604941c0de831abd2a2dcc0a191.png)
>!对于已经发布的配置，需要在【发布情况】页面中先删除配置，然后再删除配置版本，避免配置被误删除。
3. 在弹框中，单击【确认】。

### 发布配置
1. 在配置列表中，单击操作列的【发布】。
 ![](https://main.qcloudimg.com/raw/72cb12247938fbacb4576f85521800cc.png)
2. 选择配置发布的目标集群和命名空间，填写发布描述。
3. 单击【提交】。

#### 配置合并逻辑说明
按照配置**下发时间**排序执行合并（merge）。不同名的配置项中如果存在相同 key 会进行合并。合并规则：按照配置下发时间排序，离当前时间近的优先级较高。举例如下：
```
1. 创建配置项 config-abc，配置内容是 custom-key: value-1，发布时间 15:00:00
2. 创建配置项 config-bcd，配置内容是 custom-key: value-2， 发布时间15:00:01
```
最终在实例上生效的配置：`custom-key: value-2`


### 查看配置发布历史
1. 在全局配置页面中，单击【配置发布历史】。
2. 查看全局配置的发布历史。


### 配置回滚
1. 在全局配置页面中，单击【配置发布历史】。
2. 单击配置发布历史列表右侧的【回滚】。
3. 填写回滚说明，单击【提交】。


