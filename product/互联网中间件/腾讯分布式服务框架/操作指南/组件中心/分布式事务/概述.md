
分布式事务（Distributed Transaction Framework，简称 DTF）是腾讯云自主研发的高性能、高可用的分布式事务中间件，用于提供分布式的场景中，特别是微服务架构下的事务一致性服务。DTF 提供基于 TCC（Try、Confirm 和 Cancel 的简称）的 MT 模式，支持跨数据库、跨服务的使用场景，为金融、制造业、互联网等行业客户保驾护航。

## 使用场景
随着业务的发展，一个完成的业务涉及的服务和数据库也会不断增多。在基于 SOA（Service-Oriented Architecture，面向服务架构）的分布式应用环境下，越来越多的应用要求对多个数据库资源，多个服务的访问都能纳入到同一个事务当中，分布式应用环境下的数据一致性问题，由分布式事务来保证。

- **微服务 × 分布式事务**
DTF 分布式事务搭配腾讯微服务平台 TSF 一起使用，借助微服务平台提供服务注册发现、应用生命周期管理、配置管理、服务治理、数据化运营等功能。只需一行注解，即可接入启用 TSF（目前仅支持 G 版本 TSF SDK）。

- **支付&交易**
事务最典型的应用即是在支付领域，需要保证付款、收款、订单等多个数据的一致性。如今在支付领域（线下线上）、金融交易领域，使用分布式事务来保障跨数据库的数据一致性，高并发下的性能，以及发生宕机时的高可用。

## 功能说明

- **分布式事务 × 多数据库**
- **分布式事务 × 多服务**
- **异常事务重试**

## 优势说明
- **高可用**
在出现客户端、协调器节点、数据库发生故障的情况下仍可保证数据一致性。  

- **高性能**
DTF 在开源分布式事务实现的基础上针对事务协调器、数据库操作进行了深度优化，拥有高达传统分布式事务十倍以上性能。

- **易使用**
DTF 接入仅需添加依赖与注解，上手简单。

## MT 模式
MT 模式（Manual Transaction Mode），用户可以根据自己的业务场景实现 Try，Confirm 和 Cancel 操作（TCC），目前 TCC 是现今被广泛应用的一种分布式事务模式。
MT 模式中，资源管理器（RM）可对跨数据库、跨服务的资源进行管理，使得对多个数据库的访问和对不同业务的操作，转变为一个原子操作，从而解决了复杂场景下事务的一致性问题。且 MT 模式中无全局行锁，每次操作对于数据库而言都属于本地操作，结束操作则事务结束，数据库资源释放，相比传统的 2PC  方案性能显著提升。
事务处理流程如下：
![](https://main.qcloudimg.com/raw/179b0a661ca9e6fcd16064e3ab18f6c4.png)
1. 事务发起者（TM）向 事务协调器（TC）申请开启一个全局事务，全局事务创建成功并申请注册一个全局事务 XID。
2. TM 将 XID 传给所调用的微服务（事务参与者）中。
3. 微服务中的资源管理器（RM）利用得到的全局事务 XID 向 TC 注册分支事务 ID，将其纳入 XID 对应全局事务的管辖。
4. RM 完成自身业务逻辑（即完成 TCC 中的 Try 阶段）
5. TM 向 TC 发起针对 XID 的全局提交（Commit）或回滚（Rollback），即 TCC 的二阶段。
6. TC 调度 XID 下管辖的全部分支事务完成提交（Commit）或回滚（Rollback）请求。


