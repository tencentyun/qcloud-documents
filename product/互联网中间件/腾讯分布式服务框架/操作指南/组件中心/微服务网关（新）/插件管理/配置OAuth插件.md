## 操作场景

该文档指导您通过 TSF 控制台，创建微服务网关标签（OAuth）插件。

微服务网关 OAuth 插件提供了简单的第三方鉴权的能力。外部请求请求到网关，网关向第三方服务器发送请求对参数进行校验，校验结果返回给第三方。

OAuth 插件的时序图如下：

![](https://main.qcloudimg.com/raw/45e344dd4d0fb9266c58c24ca863d3d6.svg)
外部请求请求到业务 API，通过微服务网关时网关访问认证服务器，认证服务器将结果返回给网关并返回相应给外部请求。


## 操作步骤

### 新建插件

1. 登录 [TSF 控制台](https://console.cloud.tencent.com/tsf)，在左侧导航栏单击组件中心下的**微服务网关** > **插件管理**。
2. 在插件管理页面，单击**新建插件**，填写基本信息。

 - 插件类型：选择 OAuth。
 - 插件名称：必填。
 - 插件描述：选填。

3. 设置请求参数。
   - 请求参数名称：请求参数名称，即上图中的 A 字段。
   - 请求参数携带位置：填写 A 参数的位置，网关将在这个位置将 A 参数传递给认证服务器。
   - 验证请求参数地址：填写认证服务器地址。以 http:// 或者 https:// 开头。
   - 请求方法：访问认证服务器的方法，GET 或 POST。
   - 超时时间：网关访问认证服务器的超时时间，0秒＜超时时间≤30秒。
4. 设置返回值。
   返回值指的是认证服务器认证成功后，认证服务器可以将某些业务字段返回给网关，网关可以将这些字段通过 Payload 的形式返回给业务 API，方便后续业务依据这些字段进行业务逻辑处理。
   - Payload 参数名称：选填。
   - Payload 参数携带位置：填写 Header 或者 Query。
5. 单击**完成**，跳转至插件管理列表。

### 使用说明

- 认证服务器返回认证结果将在 response body 中返回 result 字段，返回值为 true / false。返回示例如下：

 ```
{
	"result": true,
	"payload": "this is payload"
 }
 ```

- 认证失败后，网关将返回错误码401，错误信息为 “AuthCheckFailed”。
- 创建好插件后，需要将插件绑定在分组或者 API 上，才能生效。
- OAuth 插件与 JWT 插件的使用区别如下，用户可以酌情选择。

| 对比项     | 标鉴权认证实现方式 | 计算签名       | 性能                                                         |
| ---------- | ------------------ | -------------- | ------------------------------------------------------------ |
| <nobr>OAuth 插件</nobr> | 在认证服务器上实现 | 需要请求方计算 | 请求量较大时，由于 OAuth 插件需要等待远程认证服务器的响应，可能会对性能有一定影响。 |
| JWT 插件   | 由网关完成         | 不需要         | -                                                            |



















