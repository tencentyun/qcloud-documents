## 操作场景

该文档指导您通过 TSF 控制台，创建和绑定微服务网关 Tag 插件。

标签是 TSF 中传递客户业务参数的形式，用户可以通过标签来实现灵活的基于业务参数的服务治理能力并依据标签过滤调用链。
典型的标签的使用场景是：通过业务参数（如 usertype 等字段）实现针对参数值的特殊路由、限流等。
TSF 中支持两种标签的配置方式：

- 通过微服务网关 Tag 插件将外部请求的请求参数转化为标签。
- 通过在代码或请求头中配置来实现标签。
  - Spring Cloud 应用配置标签的方法请参考 [参数传递](https://cloud.tencent.com/document/product/649/18511)。
  - Service Mesh 应用配置标签的方法请参考 [Mesh 开发使用指引](https://cloud.tencent.com/document/product/649/19049)。



## 操作步骤

### 创建 Tag 插件

1. 登录 [TSF 控制台](https://console.cloud.tencent.com/tsf)，在左侧导航栏单击组件中心下的**微服务网关** > **插件管理**。
2. 在插件管理页面，单击**新建插件**，填写基本信息。
	- 插件类型：选择 Tag。
	- 插件名称：必填。
	- 插件描述：选填。

3. 配置自定义标签。
   - 参数位置：可选 Path、Query、Header 和 Cookie。
   - 参数名：填写外部请求进来携带的参数名称。参数名请填写小写。
     如果参数在 Path中，可以按照这样的规则填写：/a/{parameter}/b，其中{}中的是参数名称。此时的路径不需要包含微服务名称、命名空间等信息。
   - 转换后标签名（选填）：如果不填写，会默认使用参数名作为转换后的标签名称。
> ?
> - 通过微服务网关标签和代码中配置的标签总数是16个。
> - 使用1.21.0版本的微服务网关 SDK，可以保证配置后的标签在全链路中进行传递。
> - 标签名最长32字节。
   - 设置为 TraceID：是一个非必须功能。当请求中某个参数值具有唯一性时，且希望在部署在 TSF 的后台业务与其他前台、后台系统联动时，可以通过设置 TraceID 进行追踪。
> ?
> - 同一类请求只允许一个参数设置为 TraceID。
> - 当将某个参数设置为 TraceID 时，TSF 依然将同时生成 TraceID，参数名为 "X-B2-TraceID"，并将两者关联，且同时返回给调用方。
> - 用户可以通过调用链查询中的标签检索能力搜索过滤所需要的调用链。

4. 单击**完成**，本步骤创建的插件将显示在插件管理列表中。



### 绑定插件

创建好 Tag 类型的插件需要绑定到分组或 API 上才会生效。

1. 登录 [TSF 控制台](https://console.cloud.tencent.com/tsf)，在左侧导航栏单击组件中心下的**微服务网关** > **插件管理**。
2. 选择刚刚创建好的插件，单击操作列的**绑定对象**。
3. 在绑定对象中，将插件绑定到某个分组或者某个分组下的 API 上。
4. 单击**提交**。当用户访问对应的微服务网关分组时，插件就会生效。

有关使用微服务网关标签插件实现全链路服务治理能力并过滤调用链，请参考最佳实践 - [基于业务参数的服务治理](https://cloud.tencent.com/document/product/649/40965)。
