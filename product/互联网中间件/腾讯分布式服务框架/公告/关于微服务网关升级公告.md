## 背景信息

腾讯微服务平台 TSF 基于近期的用户使用反馈与场景化需求对微服务网关模块的使用进行了版本更新。

在新的版本中我们：
- 优化了微服务网关的使用管理体验与操作流程。
- 支持了单元化部署能力。

## 升级时间

**时间区间：2021年4月7日～2021年4月21日**


## 调整详情

### 概念关系调整

- 调整前，分组是一个顶层概念，网关部署组与分组关联，分组托管后端微服务的API。
![](https://main.qcloudimg.com/raw/20caf0f37cc0da52dce56c8f425e4c2b.png)

- 调整后，分组属于某个微服务网关下，与微服务网关下的部署组相关联，分组分别托管相应的API。
![](https://main.qcloudimg.com/raw/690e1dd6903af3e7e0a07887698b0671.png)



### 使用流程调整

| 使用流程              | 调整前路径                              | 调整后路径                                       |
| --------------------- | --------------------------------------- | ------------------------------------------------ |
| 1. 创建微服务网关应用 | 【应用管理】>【新建应用】           | 【应用管理】>【新建应用】                             |
| 2. 部署应用           | 【部署组】>【新建部署组】                | 【部署组】>【新建部署组】                              |
| 3. 新建分组           | 【微服务网关】>【分组管理】>【新建分组】>【绑定部署组】 | 【微服务网关】>【网关管理】>【分组管理】>【新建分组】>【绑定部署组】 |
| 4. 分组托管 API      | 【选择分组】>【API列表】>【导入API】                | 【API列表】>【选择分组】>【导入API】                        |

- 调整前，用户在【微服务网关】>【分组管理】页面直接创建分组后，与网关的部署组关联；

- 调整后，用户需要在具体网关下创建分组，分组与微服务网关下的部署组相关联，在【API列表】页，选择分组后，导入后端微服务的 API。

### 单元化部署

单元化架构是一种将完整的系统按照数据维度划分为不同的单元的部署方式，常应用在互联网（高用户量的 C 端业务）、大型银行、保险等行业中。任意一个单元支持完整系统的功能，而业务数据垂直划分到不同单元中，每个单元承接自己的业务数据的处理。常见的划分方式有按照用户省份、用户 ID 对用户进行单元化划分。
在本升级版本中，微服务网关支持了单元化流量的分发能力，如您希望使用单元化架构部署业务，请 [提交工单](https://console.cloud.tencent.com/workorder/category) 联系我们的解决方案架构师获取进一步信息。

## 对客户的影响
- 升级过程中，网关功能的控制台和云 API 不可调用。网关的请求转发、插件运行等业务处理能力不受影响。
- 如您的分组未绑定任何部署组或绑定的部署组异常（未注册为微服务），分组数据会丢失。建议您在升级前将分组绑定在一个正常运行的部署组上避免这部分的数据丢失。
- 如您调用我们的云 API 进行分组的创建等操作，需在 DescribeGroupsWithPlugin、DescribeApiGroups、CreateApiGroup 三个接口中添加必填参数网关 ID 。
- 升级后，网关监控中无法查看到历史分组的监控数据。
- 网关不支持通过分布式配置的方式修改服务名（spring.application.name）。

## 联系我们
若您有其他疑问，请 [提交工单](https://console.cloud.tencent.com/workorder/category) 联系我们，将有工程师为您服务。
