TSF 分布式事务服务（TSF Distributed Transaction Service, TDTS）是一款高性能、高可靠的分布式事务中间件，旨在解决分布式环境下的事务一致性问题。一个完整的业务往往涉及到多个子业务，随着业务数增加，系统逐渐演变为分布式系统，进而带来了数据一致性的问题。

## 产品优势
TDTS 基于 TCC 模式，相比于其他分布式事务解决方案，具有如下优势：

| 优势 | TDTS | 基于 XA | 消息模式 | 开源 TCC|
|---------|---------|---------|---------|---------|
| 业界使用情况 | 基于 TCC，使用广泛 | 较少 | 常用，但没有TCC广泛 | 使用广泛|
| 对数据库要求 | 无 | 要求数据库支持XA协议 | 无 | 无|
| 并发性能 | 高 | 较差 | 高 | 高|
| 实现难度 | 简单 | 较难 | 开源 MQ 未提供，需二次开发 | 简单|
| 与微服务框架结合 | 支持 Spring Cloud, Dubbo 服务框架 | 不支持 | 不支持 | 需要改造|
| 事务回溯 | 支持查看历史事务，方便查错 | 不支持 | 不支持 | 需要改造|


## TCC 模式介绍
TCC 模式是应用层的两阶段提交：先 try, 再执行 confirm；若 try 失败，则执行cancel。

TCC 模式解决的问题包括但不限于：

- 数据库的两阶段并发性能差
- 数据库对XA协议的支持可能不完善
- 在分布式架构下，主业务系统并非直接操作数据库，而是调用从业务系统的服务接口

TCC 模式的事务执行流程：

1. 依次调用从业务系统的 Try 接口
2. 若 Try 阶段成功，则依次调用从业务系统的 Confirm 接口
3. 若在 Try 阶段出现失败，则调用从业务系统的 Cancel 接口，对 Try 接口的操作进行恢复
4. 若在 Confirm 阶段出现失败，则重试，设置重试次数。若重试仍然失败，则需要事后处理
5. 若调用 Cancel 接口失败，也进行重试操作


## 名词解释

**事务**：作为单个逻辑工作单元执行的一系列操作，要么全部执行，要么全部不执行。

**分布式事务**：事务的参与者、支持事务的服务器、资源服务器以及事务管理器分别位于不同的分布式系统的不同节点之上。

**主事务**：主调方提供服务的入口事务（使用 @TSFTransaction 注解）。

**子事务**：主调方操作数据库或者调用其他服务的事务（使用 @TSFTransaction 注解）。

**事务 ID**：TDTS 会为每一个分布式事务生产一个全局唯一的事务 ID。


 




