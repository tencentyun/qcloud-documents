## 操作场景

集群是指云资源管理的集合，包含了运行应用的云主机等资源。TSF 中的集群分为虚拟机集群和容器集群。使用虚拟机或者容器计算资源时，用户需要提前先将云主机导入集群中，才能进行应用的部署。本文介绍在 TSF 控制台创建容器集群并对集群进行管理的操作方法。

**操作流程**

您可以将容器服务 TKE 中的容器集群导入到 TSF 控制台进行应用部署，也可以在 TSF 控制台上直接创建容器集群。

整体操作流程如下：

- 在 TSF 控制台导入容器集群服务
  1. 在容器服务 TKE 控制台创建或注册集群
  2. 在 TSF 控制台导入容器集群服务
  3. 在 TSF 控制台部署应用到容器集群
- TSF 控制台直接创建容器集群
  1. TSF 控制台直接创建容器集群
  2. 在容器集群中导入云主机
  3. 在 TSF 控制台部署应用到容器集群

> ? 默认情况下每个账号在一个地域最多能创建5个容器集群，如需扩大额度，请 [提交工单](https://console.cloud.tencent.com/workorder/category) 给 **容器服务 TKE** 产品。

### 在 TSF 控制台导入容器集群服务

当用户已经在容器服务 TKE 上已经创建好了容器集群，可以直接导入到 TSF 集群列表。这种方式适用于更灵活的容器集群配置场景（如制定 Kubernetes 版本、独立部署模式集群）。在容器服务 TKE 页面创建集群请参见 [容器服务 TKE 集群文档](https://cloud.tencent.com/document/product/457/32189)。

1. 登录 [TSF 控制台](https://console.cloud.tencent.com/tsf/index)。
2. 在左侧导航栏中单击**集群管理**，选择好地域后，单击**新建**。
3. 设置集群的基本信息。
   - 集群类型：选择**容器集群**。
   - 新建类型：选择**导入容器服务集群**。
   - 所在可用区：选择要导入的容器服务集群所在的可用区。
   - 选择集群：选择要导入的容器服务集群。
   - 标签：用于分类管理资源，可不选。详情参见 [标签](https://cloud.tencent.com/document/product/649/53869)。
   - 备注：集群的描述，不超过200个字符。
   - 数据集：将新建的集群添加到已有数据集中。非必填字段。数据集使用，请参见 [数据集管理](https://cloud.tencent.com/document/product/649/38326)。
4. 单击**提交**，在弹窗中选择**确认**，进入导入云主机页面。如果选择**取消**，您后续可以在集群列表中，单击操作列的**导入云主机**重新导入云主机。
5. 从集群所在 VPC 的云主机列表中，选择需要添加到集群的云主机。
6. 单击**下一步**，进行云主机配置。
   - 导入方式：容器集群只支持**重装系统**部署方式，该方式会使 root 用户安装 agent。
   - 操作系统：支持 CentOS，TencentOS 和 Ubuntu 三种类型。
   - 登录方式：提供三种对应登录方式。
     - 设置密码：请根据提示设置对应密码。
     - 立即关联密钥：密钥对是通过一种算法生成的一对参数，是一种比常规密码更安全的登录云主机的方式。详请参阅 [SSH 密钥](https://cloud.tencent.com/document/product/213/6092)。
     - 自动生成密码：自动生成的密码将通过站内信发送给您，也可登录CVM控制台重置密码。
   - 数据卷挂载：勾选后，自动格式化数据盘成ext4，仅对拥有一块数据盘的节点生效。
   - 容器目录：设置容器和镜像存储目录，建议存储到数据盘。
   - 安全组：安全组具有防火墙的功能，用于设置云主机 CVM 的网络访问控制。详情参见 [安全组设置](id:安全组设置)。
7. 单击**提交**，等待云主机导入完成，云主机的可用状态将变为“可用”。
![](https://qcloudimg.tencent-cloud.cn/raw/209e2e4492a65f210270336816c47eb1.png)
<dx-alert infotype="explain" title="">
当集群下存在超级节点，可支持资源灵活弹性调度，单击**查看超级节点详情**可跳转到超级节点页面。关于超级节点的详情请参见 [超级节点概述](https://cloud.tencent.com/document/product/457/74014)。
</dx-alert>


导入容器集群后，您可以使用 TSF 的 K8S 原生部署能力将您的应用快速接入 TSF，详情请参见 [K8S 原生部署](https://cloud.tencent.com/document/product/649/72803)；也可以在 TSF 控制台直接创建并部署应用，详情请参见 [容器托管应用](https://cloud.tencent.com/document/product/649/73931)。





### 在 TSF 控制台直接创建容器集群

您可以通过 TSF 控制台直接创建容器集群，调用容器服务 TKE 新建集群 API 创建容器集群。

1. 登录 [TSF 控制台](https://console.cloud.tencent.com/tsf/index)。
2. 在左侧导航栏中单击**集群管理**，选择好地域后，单击**新建**。
3. 设置集群的基本信息。
   - 集群类型：选择**容器集群**。
   - 新建类型：选择**直接创建**。
   - Kubernetes 版本：选择容器集群的 Kubernetes 版本。
   - 所在可用区：选择容器集群所在的可用区
   - 集群网络：为集群内主机分配在主机网络地址范围内的 IP 地址。参见 [集群及容器网络设置](#915051)。
   - 容器网络：为集群内容器分配在容器网络地址范围内的 IP 地址。参见 [集群及容器网络设置](#915051)。
   - 标签：用于分类管理资源，可不选。详情参见 [标签](https://cloud.tencent.com/document/product/649/53869)。
   - 备注：集群的描述，不超过200个字符。
   - 数据集：将新建的集群添加到已有数据集中。非必填字段。数据集使用，请参见 [数据集管理](https://cloud.tencent.com/document/product/649/38326)。
4. 单击**提交**，在弹窗中选择**确认**，进入导入云主机页面。如果选择**取消**，您后续可以在集群列表中，单击操作列的**导入云主机**重新导入云主机。
5. 从集群所在 VPC 的云主机列表中，选择需要添加到集群的云主机。
6. 单击**下一步**，进行云主机配置。
   - 导入方式：容器集群只支持**重装系统**部署方式，该方式会使 root 用户安装 agent。
   - 操作系统：支持 CentOS，TencentOS 和 Ubuntu 三种类型。
   - 登录方式：提供三种对应登录方式。
     - 设置密码：请根据提示设置对应密码。
     - 立即关联密钥：密钥对是通过一种算法生成的一对参数，是一种比常规密码更安全的登录云主机的方式。详请参阅 [SSH 密钥](https://cloud.tencent.com/document/product/213/6092)。
     - 自动生成密码：自动生成的密码将通过站内信发送给您，也可登录CVM控制台重置密码。
   - 数据卷挂载：勾选后，自动格式化数据盘成ext4，仅对拥有一块数据盘的节点生效。
   - 容器目录：设置容器和镜像存储目录，建议存储到数据盘。
   - 安全组：安全组具有防火墙的功能，用于设置云主机 CVM 的网络访问控制。详情参见 [安全组设置](#915052)。
7. 单击**提交**，等待云主机导入完成，云主机的可用状态将变为“可用”。



导入云主机后，您可以在容器集群服务中创建并部署应用，参见 [创建并部署应用](https://cloud.tencent.com/document/product/649/15525)。









### 移出云主机

>!只有当节点上没有运行应用时，才可以将节点从集群中移出。停止应用需要到部署组的实例列表页面中操作。

1. 在集群列表页中，单击目标集群的**ID/名称**，进入集群的云主机列表页面。
2. 在云主机节点列表页面，选择需要移出的云主机，单击操作列的**删除**。
3. 在弹出的提示框中，单击**确定**将云主机移出节点。



### 删除集群

>!
>- 集群内存在云主机时，无法删除集群，您需要先移除云主机。
>- 集群在删除期间，无法对外提供服务，请提前做好准备，以免造成影响。

1. 在集群列表页中，单击目标集群操作列的**删除**。
2. 在弹出的提示框中，单击**确定**删除集群。




[](id:915051)
### 集群及容器网络设置

集群网络与容器网络是集群的基本属性。通过设置集群网络和容器网络可以规划集群的网络划分。

- **集群网络**：将为集群内主机分配在节点网络地址范围内的 IP 地址，您可以选择私有网络中的子网用于集群的节点网络，更多私有网络介绍请参见 [私有网络和子网](https://cloud.tencent.com/document/product/215/20046) 。
- **容器网络**：将为集群内容器分配在容器网络地址范围内的 IP 地址，您可以自定义三大私有网段作为容器网络， 根据您选择的集群内服务数量的上限，自动分配适当大小的 CIDR 段用于 kubernetes service，同时容器网络自动为集群内每台云主机分配一个24位的网段用于该主机分配 Pod 的 IP 地址。

#### 集群网络与容器网络的关系

- 集群网络和容器网络网段不能冲突；
- 同一 VPC 内，不同集群的容器网络网段不能冲突；
- 容器网络和 VPC 路由冲突时，优先在容器网络内转发。

#### 集群网络与腾讯云其他资源通信

- 集群内容器与容器之间互通；
- 集群内容器与节点直接互通；
- 集群内容器与 [腾讯云数据库 TencentDB](https://cloud.tencent.com/product/cdb-overview)、[云数据库 Redis](https://cloud.tencent.com/document/product/239/3205)、[云数据库 Memcached](https://cloud.tencent.com/document/product/241/7489) 等资源同一 VPC 下内网互通。



### 安全组设置[](id:915052)

用户将容器集群导入云主机时需要设置安全组，设置方法请参见 [容器服务安全组设置](https://cloud.tencent.com/document/product/457/9084)。

此外，如果从 API 网关访问容器集群中的微服务，则需要在安全组中**增加服务的监听端口**。例如，provider - demo 的监听端口是18081，需要新增入站规则如下：

| 协议 | 端口号 | 网段      | 是否允许 |
| :--- | :----- | :-------- | :------- |
| TCP  | 18081  | 0.0.0.0/0 | 允许     |





### 查看容器集群创建事件

登录 [TSF 控制台](https://console.cloud.tencent.com/tsf/index)，在集群页面新建容器集群后，在集群列表的集群状态栏可以查看容器集群状态。

![](https://main.qcloudimg.com/raw/ab0707c6b64009454aa5fb012070ca2a.png)

- 闲置中：容器集群内没有云主机，处于完全不可用状态，可以通过导入云主机方式唤醒集群或者删除集群
- 创建中：集群正在创建，正在申请云资源，单击集群状态栏的**查看进度**可查看创建进度
  ![](https://main.qcloudimg.com/raw/5b01fc8e9e1eca5a3caf29d7a3cec39c.png)
- 运行中：集群正常运行
- 异常：集群中存在异常，如节点网络不可达等，可单击查看异常原因

## 常见问题

- [云服务器加入容器集群后，项目属性为何变为"默认项目"？](https://cloud.tencent.com/document/product/649/20270#.E4.BA.91.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.8A.A0.E5.85.A5.E5.AE.B9.E5.99.A8.E9.9B.86.E7.BE.A4.E5.90.8E.EF.BC.8C.E9.A1.B9.E7.9B.AE.E5.B1.9E.E6.80.A7.E4.B8.BA.E4.BD.95.E5.8F.98.E4.B8.BA.26quot.3B.E9.BB.98.E8.AE.A4.E9.A1.B9.E7.9B.AE.26quot.3B.EF.BC.9F)
- [如何手动恢复 tsf-agent 进程？](https://cloud.tencent.com/document/product/649/20270#.E4.BA.91.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.8A.A0.E5.85.A5.E5.AE.B9.E5.99.A8.E9.9B.86.E7.BE.A4.E5.90.8E.EF.BC.8C.E9.A1.B9.E7.9B.AE.E5.B1.9E.E6.80.A7.E4.B8.BA.E4.BD.95.E5.8F.98.E4.B8.BA.26quot.3B.E9.BB.98.E8.AE.A4.E9.A1.B9.E7.9B.AE.26quot.3B.EF.BC.9F)
- [TSF 容器集群数达到上限如何处理？](https://cloud.tencent.com/document/product/649/20270#tsf-.E5.AE.B9.E5.99.A8.E9.9B.86.E7.BE.A4.E6.95.B0.E8.BE.BE.E5.88.B0.E4.B8.8A.E9.99.90.E5.A6.82.E4.BD.95.E5.A4.84.E7.90.86.EF.BC.9F)
- [TSF 不同集群内的服务是否支持相互调用？](https://cloud.tencent.com/document/product/649/20270#tsf-.E4.B8.8D.E5.90.8C.E9.9B.86.E7.BE.A4.E5.86.85.E7.9A.84.E6.9C.8D.E5.8A.A1.E6.98.AF.E5.90.A6.E6.94.AF.E6.8C.81.E7.9B.B8.E4.BA.92.E8.B0.83.E7.94.A8.EF.BC.9F)
- [TSF 如何设置开发环境和测试环境？](https://cloud.tencent.com/document/product/649/20270#tsf-.E5.A6.82.E4.BD.95.E8.AE.BE.E7.BD.AE.E5.BC.80.E5.8F.91.E7.8E.AF.E5.A2.83.E5.92.8C.E6.B5.8B.E8.AF.95.E7.8E.AF.E5.A2.83.EF.BC.9F)
- [CVM 集群应用的日志清理机制是什么？](https://cloud.tencent.com/document/product/649/20270#cvm-.E9.9B.86.E7.BE.A4.E5.BA.94.E7.94.A8.E7.9A.84.E6.97.A5.E5.BF.97.E6.B8.85.E7.90.86.E6.9C.BA.E5.88.B6.E6.98.AF.E4.BB.80.E4.B9.88.EF.BC.9F)
