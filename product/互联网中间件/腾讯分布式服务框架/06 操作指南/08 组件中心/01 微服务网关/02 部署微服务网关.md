## 操作场景

部署微服务网关相当于部署一个微服务，本文以 TSF 提供的 [官方 Demo](https://github.com/tencentyun/tsf-simple-demo) 为例介绍在 TSF 平台上部署微服务网关的操作方法。

- 微服务网关兼具灵活性和便捷性。当用户仅需要使用请求转发、密钥对鉴权、服务治理等 TSF 已经提供的产品能力时，您仅需要使用 [官方 Demo](https://github.com/tencentyun/tsf-simple-demo) 中的 msgw - demo 程序包即可，可以选择其中的 msgw - zuul 以及 msgw - scg 来分别部署基于 Zuul 和基于 Spring Cloud Gateway 的微服务网关。
- 当您希望定制化微服务网关的转发逻辑，您可以选择自行开发微服务网关，并依赖 TSF 的网关 SDK 来进行开发。详情参见 [微服务网关开发指南](https://cloud.tencent.com/document/product/649/40428)。
- 直接使用开源的微服务网关（Demo 中的 opensource 版本）会导致 TSF 产品页面中的网关功能不可用。不建议您使用开源版本的微服务网关。



## 前提条件

1. 已创建好集群并导入云主机。
   - 虚拟机场景请参见 [虚拟机集群管理](https://cloud.tencent.com/document/product/649/73964)。
   - 容器场景请参见 [容器集群管理](https://cloud.tencent.com/document/product/649/16929)。
2. 下载 [官方 Demo](https://github.com/tencentyun/tsf-simple-demo) 并解压后，在pom.xml文件所在目录下执行`mvn clean package`将应用程序打包，在`msgs-demo/target/`目录下可以看到打包好的 jar 程序包。



## 操作步骤

1. 登录 [TSF 控制台](https://console.cloud.tencent.com/tsf)。
2. 在左侧导航栏单击**应用管理**，选择好地域后单击**新建应用**，填写应用基本信息。
   ![](https://qcloudimg.tencent-cloud.cn/raw/0d2b7649b988095e0672fd688e86fadc.png)
   - 应用名：填写应用名称
   - 部署方式：选择虚拟机部署或者容器部署方式，本文以容器部署为例。
   - 业务类型：选择**微服务网关应用**。
   - 标签：用于分类管理资源，可不选。详情参见 [标签](https://cloud.tencent.com/document/product/649/53869)。
   - 备注：选填，可留空。
   - 数据集：用户可以通过数据集管理配置不同的子账号和协作者使用不同资源的权限，详情参阅 [数据集管理](https://cloud.tencent.com/document/product/649/38326)。
3. 单击**提交**，在弹窗中选择**导入程序包**，跳转至上传程序包页面。如果选择**关闭**，您后续可以在应用详情页面选择**程序包管理**页签，重新上传程序包。
4. 在程序包管理页面，单击**上传程序包**，选择提前准备好的 jar 程序包。
   ![](https://qcloudimg.tencent-cloud.cn/raw/462fb687767b2c22ecd1791c57b9937c.png)
5. 单击**提交**，等待程序包上传完成后，在跳出的弹窗中选择**前往部署**，进入部署组列表页面。
6. 在部署组列表页面，单击**新建部署组**，填写部署组信息。
![](https://qcloudimg.tencent-cloud.cn/raw/21d76e67be2d1cf7da895270cebff97c.png)
   - 部署组名称：填写部署组名称，不超过60个字符，只能包含字母、数字及分隔符(“-”)，且必须以字母开头，数字或字母结尾。
   - 集群：选择应用要部署所在的集群。
   - 命名空间：选择应用要部署所在的命名空间。
> !
>
> - 当微服务网关部署在全局命名空间中时，该微服务网关可以将请求路由转发到全部命名空间的微服务上；当微服务网关部署在非全局命名空间时，该微服务网关只能转发当前命名空间下的请求。即：**非全局命名空间中的微服务网关，无法穿透命名空间的逻辑隔离**。
>
> - **单元化配置功能仅支持部署在全局命名空间下的网关**，关于单元化配置的详细介绍请参见 [单元化部署](https://cloud.tencent.com/document/product/649/55879)。
> 
   - 关联应用：选择部署组关联的应用。关联应用字段决定了后续程序包来源和应用配置来源。
   - 日志配置项：选择日志配置项，用于采集应用的业务日志数据。
   - 日志投递：指定日志的转储方式，将规则指定路径中的日志内容投递到指定的接收端。如果配置为"无"，将不投递业务日志。更多关于日志投递的功能说明请参见 [日志投递](https://cloud.tencent.com/document/product/649/43510)。
   - 标签：用于分类管理资源，可不选。详情参见 [标签](https://cloud.tencent.com/document/product/649/53869)。
   - 备注：选填，可留空。
7. 单击**保存&下一步**，从关联集群的可用云主机列表勾选用于部署的云主机。
8. 单击**部署应用**，设置部署信息。
   - 软件仓库：选择**默认仓库**。
   - 程序包类型：选择 **jar**。
   - JDK 版本：选择**KONA JDK8**。
   - 程序包类型：选择提前上传好的程序包。
   - 启动参数：选填。
   - 更新方式：支持立即更新和滚动更新。此处选择**立即更新**为例。
   - 健康检查：可选。详情参见 [健康检查](https://cloud.tencent.com/document/product/649/15525)。
   - 描述：可选。
   - 强制启动：可选，开启强制启动，开启强制启动则实例忽视consul服务注册报错信息正常启动。
9. 单击**完成**，部署成功后，可以在服务列表中找到微服务网关服务。
10. 在左侧导航栏选择**微服务网关** > **网关管理**，可以看到刚部署好的网关。
![](https://qcloudimg.tencent-cloud.cn/raw/13074c176a7c8c296f037058e1477960.png)
