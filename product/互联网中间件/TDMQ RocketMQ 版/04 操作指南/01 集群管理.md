## 操作场景

集群是 TDMQ RocketMQ 版中的一个资源维度，不同集群的命名空间、Topic、Group 等完全隔离。每个集群会有集群的资源限制例如 Topic 总数、消息保留时长等。常见的使用方式如：开发测试环境使用一个专门集群，生产环境使用一个专门的集群。

集群分为虚拟集群和专享集群：

- **专享集群**： 独占物理资源，数据安全，使用几乎无限制。
- **虚拟集群**： 使用虚拟化的计算和存储资源，根据用量自动分配，使用有一定限制。

**TDMQ 资源层次关系**
![](https://main.qcloudimg.com/raw/a98447d277622f79a33a9e5376d4ea95.png)

## 操作步骤

### 创建集群

1. 登录 [TDMQ 控制台](https://console.cloud.tencent.com/tdmq)，进入**集群管理**页面。
2. 在**集群管理**页面，选择地域后，单击**新建集群**进入新建集群对话框。
  - 集群类型：支持**专享集群**和**虚拟集群**两种类型。
    - **专享集群**： 独占物理资源，数据安全，使用几乎无限制。
    - **虚拟集群**： 使用虚拟化的计算和存储资源，根据用量自动分配，使用有一定限制。
  - 计费模式：专享集群使用**包年包月**计费模式，虚拟集群使用**按量计费**模式。
  - 地域：选择与您的业务最靠近的地域，处于不同地域的云产品内网不通，购买后不能更换，请您谨慎选择。例如，广州地域的云服务器无法通过内网访问上海地域的集群。若需要跨地域内网通信，请参见 [对等连接](https://cloud.tencent.com/document/product/553/18836)。
  - 集群规格：根据您的业务需求选择合适的集群规格。
  - 网络配置：默认不开通公网访问，如需开通请 [提交申请](https://cloud.tencent.com/login?s_url=https%3A%2F%2Fconsole.cloud.tencent.com%2Fworkorder%2Fcategory%3Flevel1_id%3D876%26level2_id%3D1772%26source%3D0%26data_title%3D%25E6%25B6%2588%25E6%2581%25AF%25E9%2598%259F%25E5%2588%2597%2520TDMQ%26step%3D1)。
  - 集群名称：填写集群名称， 3-64个字符，只能包含数字、字母、“-”和“\_”。
  - 标签：标签用于从不同维度对资源分类管理。使用方法请参见 [使用标签管理资源](https://cloud.tencent.com/document/product/1493/63447)。
3. 单击**立即购买**，完成集群创建。

后续步骤：

1. 在集群中创建 [命名空间](https://cloud.tencent.com/document/product/1493/61595)，并获取接入地址，得到服务端的连接信息。
2. 在集群中创建 [角色](https://cloud.tencent.com/document/product/1493/61599) 并授予该命名空间的生产消费权限。
3. 在命名空间中创建 [Topic](https://cloud.tencent.com/document/product/1493/61597)。
4. 按照 [SDK 文档](https://cloud.tencent.com/document/product/1493/61652) 的提示编写 Demo，配置上连接信息，进行消息的生产和消费。

### 查看集群详情

在**集群管理**列表页，单击操作列的**查看详情**，进入集群详情页面。在详情页中，您可以查询到：

- 集群概况（Topic 数量、近24小时消息生产数量、当前消息堆积数量）
- 集群的基础信息（集群名称/ID、地域、创建时间、说明）
- 实例配置：
  <table>
  <thead>
  <tr>
  <th>实例配置</th>
  <th>配置说明</th>
  </tr>
  </thead>
  <tbody><tr>
  <td>单 Topic 分区 TPS 上限</td>
  <td>生产消费分开限制，即生产TPS到达上限不影响消费 TPS。</td>
  </tr>
  <tr>
  <td>命名空间数量上限</td>
  <td>命名空间可创建的最大数量。</td>
  </tr>
  <tr>
  <td>Topic 数量上限</td>
  <td>Topic 可创建的最大数量。</td>
  </tr>
  <tr>
  <td>Group 数量上限</td>
  <td>Group 可创建的最大数量。</td>
  </tr>
  <tr>
  <td>消息保留时间</td>
  <td>消息保留可配置的最长时间，在命名空间级别可以配置比这个更短的时间。</td>
  </tr>
  <tr>
  <td>消息最大延时</td>
  <td>消息延迟消费的最长时间。</td>
  </tr>
  </tbody></table>
  

![](https://qcloudimg.tencent-cloud.cn/raw/7f982eb4da3986f01adb07f1e9c7f0bb.png)

### 获取接入地址

2022年8月8日部分地区上线新的虚拟集群 RocketMQ 服务，新版集群在命名空间列表获取相应的接入地址，之前创建的集群或未升级的集群仍在集群操作列的**接入地址**处获取。

- 新版集群：
![](https://qcloudimg.tencent-cloud.cn/raw/91e590fce98e38121b3efa7243864128.png)
- 旧版集群：
![](https://main.qcloudimg.com/raw/4fed5e6a2497995613b645f6a9a7e206.png)

### 升级集群规格

如当前的集群规格不满足您的业务需求，您可以在控制台上提升您的节点数量。

> ?当前仅支持提升节点数量，暂不支持修改节点规格和存储规格（该功能会下个版本中支持）。

1. 在**集群管理**列表页，单击操作列的**升配**。
2. 修改节点数量后，单击**确认调整**。
  ![](https://qcloudimg.tencent-cloud.cn/raw/d5fb531836f8c35b845dac6073d21e67.png)
  

### 编辑集群

1. 在**集群管理**列表页，单击操作列的**编辑**。
2. 在弹窗中填写集群名称和集群说明，单击提交。

### 删除集群

如果想删掉创建的集群，可以通过以下步骤操作：

1. 在**集群管理**列表页，单击操作列的**删除**。
2. 在删除的确认弹框中，单击**删除**，即可删除集群。

> !删除后，该集群下的所有配置都会被清空，且无法恢复，请谨慎操作。

