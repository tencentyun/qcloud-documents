<style>
table th:nth-of-type(1) {
width: 15%;        
}
table th:nth-of-type(2) {
width: 20%;        
}
table th:nth-of-type(3) {
width:50%;        
}
table th:nth-of-type(4) {
width: 15%;        
}
</style>

本文主要介绍 TDMQ 集群版本升级记录，及相关注意事项。

## 2.7.1版本

**发布日期：**2021年5月17日

**全量切换：**2021年6月

**更新说明：**

| 更新类型  | 更新点                               | 详细描述                                                     | 相关文档 |
| ------------------------------------ | ------------------------------------------------------------ | -------- | -------- |
| 优化 | 统一域名接入                         | <li>每个集群的每种网络环境自动生成唯一的域名作为接入地址，用户无需手动创建和管理接入点。</li> <li>去除 SDK 中对声明 listenerName 的依赖，从而更好地兼容社区中未适配 Pulsar Multiple advertised listeners 特性的 TCP Client（包括 <a href="http://pulsar.apache.org/docs/en/client-libraries-cpp/">C++ Client</a>、<a href="http://pulsar.apache.org/docs/en/client-libraries-python/">Python Client</a>、<a href="http://pulsar.apache.org/docs/en/client-libraries-node/">Node.js Client</a>）。</li>     |      -    |
 | 新增 | 支持公网接入                         | 支持公网访问，允许用户本地或者自建 IDC 的 TCP Client 和腾讯云上的 TDMQ 集群建立连接。     |     -     |
| 优化| 重试和死信 Topic 命名规则更新          | 更新重试和死信 Topic 命名规则，保持和 Pulsar 社区一致的样式，更好兼容开 源SDK（原腾讯云版 SDK 将不再适用新的命名规则）。    |      -    |
| 优化 | 性能优化                             | 2.7.1集群在部署上做了系统内核级别的配置优化，相比2.6.x系列的集群峰值生产消费性能提升20%左右，并可根据实际使用情况无感知扩容。    |      -    |
| 新增| 支持插件化协议兼容（有限名额内测中） | 2.7.1集群上可以安装各类主流协议（AMQP、RocketMQ）以及 CMQ 协议的兼容插件，当前正在 beta 测试中，后续正式上线后，用户可以用主流消息队列的客户端无改造接入 TDMQ，方便迁移存量业务。     |     -     |

## 2.6.1 版本

**发布日期：**2020年10月12日

**全量切换：**2020年10月

**更新说明：**

| 更新类型| 更新点           | 详细描述                                                     | 相关文档 |
| ---------------- | ------------------------------------------------------------ | -------- | -------- |
| 优化| 稳定性提升       | 针对内测发现的问题进行集中修复，大幅度提升集群稳定性。              |    -      |
| 优化| zk 冷热隔离       | 内核 pulsar 的 zookeeper 组件采取了冷热数据隔离部署的架构，元数据等数据和集群 broker 配置等数据分开两套zk部署，有利于提升集群稳定性。      |       -   |
| 新增 | 支持创建虚拟集群 | 支持用户在控制台创建虚拟集群，做一定的资源隔离。                   |      -    |

**版本升级说明：**

- 所有老版本集群最终会全量升级到最新版本的集群，功能向下兼容。

- 如需自主切换到新版本集群，可以按照以下步骤执行：


1. 新建一个集群（新建的集群均为最新版本），并创建一份完全一致的元数据（命名空间、角色权限、Topic 和订阅）。
2. 将客户端代码中，原来的生产消费接入点更新为新集群的接入地址。
3. 将客户端代码中的鉴权信息（Token），更新为新集群的 Token。
4. 先切换生产客户端（重新构建部署生产端应用到线上）。
5. 等待原先集群的堆积消息消费完毕后，切换消费客户端（重新构建部署消费端应用到线上）。
