## 操作场景

集群是 TDMQ Pulsar 版中的一个资源维度，不同集群的命名空间、Topic、角色权限等完全隔离。每个集群会有集群的资源限制例如 Topic 总数、消息保留时长等。常见的使用方式如：开发测试环境使用一个专门集群，生产环境使用一个专门的集群。

集群分为虚拟集群和专享集群：

- **虚拟集群**
  使用虚拟化的计算和存储资源，根据用量自动分配，使用有一定限制，无需为资源付费，每个用户最多可以创建5个虚拟集群。
- **专享集群**
  独占物理资源，数据安全，使用几乎无限制，未达到使用要求会额外计算资源占用费。

> ?
> - 公测期间暂不提供专享集群资源，正式商业化后开启申请。届时将通过邮件、短信的方式，提前1个月通知各位开发者。
> - 当前集群存在多个版本，详细说明请参考 [集群版本更新记录](https://cloud.tencent.com/document/product/1179/55958)。

**TDMQ Pulsar 版资源层次关系**
![](https://main.qcloudimg.com/raw/2eda2b733b46ee82bba9a4a3a7a77e9e.png)



## 操作步骤

### 创建集群

1. 登录 [TDMQ Pulsar 版控制台](https://console.cloud.tencent.com/tdmq)，进入**集群管理**页面。
2. 在**集群管理**页面，选择地域后，单击**新建集群**进入新建集群对话框。
3. 在新建集群对话框，选择需要创建的集群类型并设置集群的相关属性：
   - 集群名称：设置环境的名称（创建后不可修改），不能超过64个字符，只能包含字母、数字、“-”及“_”。
   - 公网接入：公网接入一经开启将无法关闭，建议仅开发测试的集群开启。
   - 集群说明：环境设置的备注说明，不能超过200个字符。
   - 资源标签：设置资源标签，关于标签的详细介绍请参考 [标签管理](https://cloud.tencent.com/document/product/1179/63440)。
4. 单击**确定**完成所在地域环境的创建。
   ![](https://qcloudimg.tencent-cloud.cn/raw/0539ef71df6db5e4d53e908a0ccfdea3.png)

> ?
> - 每个用户最多可以创建5个虚拟集群。
> - 公测期间不收取任何资源占用费。

后续步骤：

1. [获取接入地址](#获取接入地址)，得到服务端的连接信息（仅2.6.1版本集群需要配置接入点，2.7.1及以上版本集群直接从接入地址复制）。
2. 在集群中创建 [命名空间](https://cloud.tencent.com/document/product/1179/44819)。 
3. 在集群中创建 [角色](https://cloud.tencent.com/document/product/1179/47543) 并授予该命名空间的生产消费权限。
4. 在命名空间中创建 [Topic](https://cloud.tencent.com/document/product/1179/44820)。 
5. 按照 [SDK 文档](https://cloud.tencent.com/document/product/1179/48553) 的提示编写 Demo，配置上链接信息和密钥，进行消息的生产和消费。



### 查看集群详情

在**集群管理**列表页，单击目标集群的 ID，进入集群详情页面。

在详情页中，您可以查询到：

- 集群数据统计：展示特定时间范围内的消息平均大小，生产消费速率平均值，生产消息条数和累计存储耗时。
>? 2.6.x 版本集群暂不支持统计数据。

| 指标           | 说明                                                         |
| -------------- | ------------------------------------------------------------ |
| 消息平均大小   | 所选时间范围消息数据的平均大小，包含消息头部和消息体大小。   |
| 生产速率平均值 | 所选时间范围生产到集群的消息的平均速率。                     |
| 消费速率平均值 | 所选时间范围集群推送消息到客户端的平均速率。                 |
| 生产消息条数   | 所选时间范围生产到集群的消息条数。                           |
| 累计存储耗时   | 截止到所选时间的最后时间点，消息数据占用的存储大小（该值只随时间范围的终点变化而变化）。 |

- 集群的基础信息：集群名称/ID、版本、接入地址（仅2.7.1版本及以上集群可查看）、地域、创建时间、说明。

- 集群的配置：

| 集群配置                | 配置说明                                                     |
| ----------------------- | ------------------------------------------------------------ |
| 单命名空间生产 TPS 上限 | 单命名空间生产 TPS 上限，如果超出此上限会对请求进行限流处理。 |
| 单命名空间消费 TPS 上限 | 单命名空间消费 TPS 上限，如果超出此上限会对请求进行限流处理。 |
| 单命名空间生产带宽上限  | 单命名空间内生产带宽上限。                                   |
| 单命名空间消费带宽上限  | 单命名空间内消费带宽上限                                     |
| 最大命名空间数量        | 单集群内命名空间可创建的最大数量。                           |
| 最大 Topic 数量         | 单命名空间内 Topic 可创建的最大数量                           |
| 消息保留时间            | 消息保留可配置的最长时间，在命名空间级别可以配置比这个更短的时间 |
| 消息存储上限            | 消息堆积消耗磁盘的最大容量，超过会禁止新消息的生产（正常情况下，消息堆积不应该太大，如发生此类情况请检查业务是否在正常消费消息）。 |
| 消息最长延时            | 消息最长延迟消费时间。                                       |

![](https://qcloudimg.tencent-cloud.cn/raw/4c24ecdf63f1ca8c436c577530c0dda8.png)



### 获取接入地址[](id:获取接入地址)

在**集群管理**列表页，单击目标集群操作列的**接入地址**。接入地址获取方式如下：

<dx-tabs>
::: 2.7.1及以上版本集群
可直接获取接入地址，如下图。
	![](https://main.qcloudimg.com/raw/055f727048341630b27b8382fca94cc1.png)
:::
::: 2.6.1版本集群
在接入点列表页，单击**新建**，填写接入点信息，完成接入点配置。

- VPC 网络：选择您客户端希望部署的 VPC 网络
- 子网：选择该 VPC 下的任意子网
- 填写备注



<dx-alert infotype="explain" title="">
一个集群可以配置多个接入点，当前仅支持 VPC 网络接入。
</dx-alert>
:::

</dx-tabs>

### 删除集群

如果想删掉创建的集群，可以通过以下步骤操作：

1. 在**集群管理**列表页，单击操作列的**删除**。
2. 在删除的确认弹框中，单击**删除**，即可删除集群。
