本文为您介绍如何在构建环境中添加 Maven 依赖包。

## 前提条件
设置 CODING 持续集成中构建环境前，您的腾讯云账号需要开通 CODING DevOps 服务，详情请参见 [开通服务](https://cloud.tencent.com/document/product/1115/37268)。

## 进入项目

1. 登录 [CODING 控制台](https://console.cloud.tencent.com/coding)，单击**团队域名**进入 CODING 使用页面。
2. 单击页面右上角的 <img src ="https://main.qcloudimg.com/raw/d94a8e60dd3a41d0af07d72ae0e9d70e.png" style ="margin:0">，进入项目列表页面，单击**项目图标**进入目标项目。
3.  进入左侧菜单栏的**持续集成**功能。

Java 使用 **Maven 制品库**存放依赖包，使用 Maven 或 Gradle 等构建工具进行依赖管理和安装。本文以 Gradle 为例，而 Maven 老项目可使用命令一键升级到 Gradle：
```shell
gradle init --type pom
```

## Gradle bin
Gradle 构建时会先下载 bin，官方下载链接在境外，内地用户访问可能很慢，建议切换为腾讯云镜像，即修改项目中的 `gradle/wrapper/gradle-wrapper.properties`：
```shell
# 腾讯云镜像
distributionUrl=https\://mirrors.cloud.tencent.com/gradle/gradle-6.8.1-bin.zip

# 默认境外
# distributionUrl=https\://services.gradle.org/distributions/gradle-6.8.1-bin.zip
```

## 公共制品库[](id:public)
Maven 公共制品库在境外，CODING 持续集成已内置国内镜像加速，无需配置。如本地开发需要加速，按照以下代码修改 `~/.gradle/init.gradle`：
```groovy
def repoConfig = {
    all { ArtifactRepository repo ->
        if (repo instanceof MavenArtifactRepository) {
            def url = repo.url.toString()
            if (url.contains('repo1.maven.org/maven2')
                || url.contains('jcenter.bintray.com')
                || url.contains('maven.google.com')
                || url.contains('plugins.gradle.org/m2')
                || url.contains('repo.spring.io/libs-milestone')
                || url.contains('repo.spring.io/plugins-release')
                || url.contains('repo.grails.org/grails/core')
                || url.contains('repository.apache.org/snapshots')
            ) {
                println "gradle init: [buildscript.repositories] (${repo.name}: ${repo.url}) removed"
                remove repo
            }
        }
    }

    // 腾讯云 maven 镜像聚合了：central、jcenter、google、gradle-plugin
    maven { url 'https://mirrors.cloud.tencent.com/nexus/repository/maven-public/' }
    maven { url 'https://maven.aliyun.com/repository/central' }
    maven { url 'https://maven.aliyun.com/repository/jcenter' }
    maven { url 'https://maven.aliyun.com/repository/google' }
    maven { url 'https://maven.aliyun.com/repository/gradle-plugin' }
    maven { url 'https://maven.aliyun.com/repository/spring' }
    maven { url 'https://maven.aliyun.com/repository/spring-plugin' }
    maven { url 'https://maven.aliyun.com/repository/grails-core' }
    maven { url 'https://maven.aliyun.com/repository/apache-snapshots' }
}

allprojects {
    buildscript {
        repositories repoConfig
    }

    repositories repoConfig
}
```

## 私有制品库[](id:private)
使用 Maven 私有制品库需先获得用户名和密码，请参见 [搭建团队级制品库](https://help.coding.net/docs/artifacts/practices/team-share.html#pageTitle)。

### gradle.properties
将制品库地址和用户名和密码添加到项目的 `build.gradle` 同一级目录下的 `gradle.properties` 文件中：
```ini
codingArtifactsMavenUrl=https://codes-farm-maven.pkg.coding.net/repository/share/build/
codingArtifactsUsername=无需填写
codingArtifactsPassword=无需填写
```

### build.gradle
```groovy
repositories {
    maven {
        url codingArtifactsMavenUrl
        credentials {
            username = codingArtifactsUsername
            password = codingArtifactsPassword
        }
    }
}

dependencies {
    implementation 'com.tencent:cloudpay:1.6'
    implementation '[GROUP_ID]:[ARTIFACT_ID]:[VERSION]'
}
```

### 本地构建[](id:local-build)
把用户名和密码作为参数传入构建命令：
```shell
./gradlew build -Dorg.gradle.project.codingArtifactsUsername=foo -Dorg.gradle.project.codingArtifactsPassword=bar
```

### 持续集成构建[](id:Jenkins)
把用户名和密码填入环境变量：
![](https://qcloudimg.tencent-cloud.cn/raw/1f5605354b8fee07e46e43a3bbd57181.png)
```shell
pipeline {
  agent any
  stages {
    stage('检出') {
      steps {
        checkout([$class: 'GitSCM', branches: [[name: env.GIT_BUILD_REF]], 
            userRemoteConfigs: [[url: env.GIT_REPO_URL, credentialsId: env.CREDENTIALS_ID]]])
      }
    }
    stage('编译') {
      steps {
        sh "./gradlew build -Dorg.gradle.project.codingArtifactsUsername=$CODING_ARTIFACTS_USERNAME -Dorg.gradle.project.codingArtifactsPassword=$CODING_ARTIFACTS_PASSWORD"
      }
    }
  }
}
```
