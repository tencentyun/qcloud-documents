本文为您详细介绍如何使用持续集成。

## 前提条件
使用 CODING 持续集成的前提是，您的腾讯云账号需要开通 CODING DevOps 服务，详情请参见  [开通服务](https://cloud.tencent.com/document/product/1115/37268)。


## 进入项目
1. 登录 [CODING 控制台](https://console.cloud.tencent.com/coding)，单击**立即使用**进入 CODING 使用页面。
2. 单击页面右上角的 <img src ="https://main.qcloudimg.com/raw/d94a8e60dd3a41d0af07d72ae0e9d70e.png" style ="margin:0">，进入项目列表页面，单击项目图标进入目标项目。

## 步骤1：初始化持续集成
1. 在左侧菜单栏中选择**持续集成** > **Job 列表**进入欢迎页面。
3. 单击**开始持续集成**，初始化持续集成。

## 步骤2：创建持续集成任务
1. 如下图按照提示，依次设置“Job 名称”、“触发机制”、“自动取消”以及“通知提醒”。
 - Job 名称：表示您对此次持续集成任务的命名。
 - 触发机制：表示您希望此次持续集成任务以何种方式被触发。
 - 自动取消：表示当推送相同版本或者相同合并请求的代码触发任务执行时，构建记录会自动将还在执行的任务取消，并只保留最新执行的任务。
 - 通知提醒：表示持续集成完成时向指定的成员发送通知提醒。
![](https://main.qcloudimg.com/raw/db228c43673e4825cec459e3527644c1.png)
2. 单击**下一步** 配置持续集成过程。选择持续集成过程（Jenkinsfile）模板，页面提供了 3 种适用于不同场景的模板选项。本文选择最基本的“简易模板”来演示。
![](https://main.qcloudimg.com/raw/99afa1754a6e2630ed2c57c7238a5d1e.png)
3. 配置持续集成过程（Pipeline）：
在这个页面配置持续集成的详细过程，也是在编排流水线（pipeline）。
这里默认显示的是“图形化编辑器”，提供了可视化、易上手的编排工具，了解更多请参见 [使用图形化编辑器](https://cloud.tencent.com/document/product/1115/36886)。
左边展示的是流水线，按照简易模板分成了“开始”、“检出”、“构建”、“测试”以及“部署”共 5 个阶段。从左往右是它的执行顺序。
流水线上每一个阶段具体的执行命令都可以自定义，选中某个阶段，在右边可以对选中的阶段进行更详细的步骤配置。
![](https://main.qcloudimg.com/raw/2d7c6841ea861f6891c12948d1682081.png)
例如：先选中“构建”阶段，然后在右边的配置界面中单击第2个步骤“执行 Shell 脚本”，即可以看到这个步骤执行的具体命令。
![](https://main.qcloudimg.com/raw/d83d480a3f610d1ab7eb8e9743b66664.png)
可以看到，这个步骤执行的命令是docker version，即输出当前环境中 docker 的版本。
![](https://main.qcloudimg.com/raw/6db710b99dee9ae8cb2c15dd6f2d921e.png)
4. 单击**下一步**，配置环境变量和配置缓存目录。
5. 单击**开始持续集成**，完成创建工作。

## 步骤3：查看构建
1. 回到 Job 列表页面，选中任务单击右上角**立即构建**。
2. 选择构建的分支、标签或者修订版本，单击**立即构建**完成一次构建。
3. 触发构建后，页面会跳到“构建记录”，可以看到一条构建记录即是刚才触发的。在这里可以看到构建的状态、触发信息、持续时长等信息，还可以进行删除等操作。
![](https://main.qcloudimg.com/raw/65db765e507c8bab40597f7a3a2ed49b.png)
4. 单击构建记录，可以查看流水线上每一个阶段的成功与否，每一个步骤命令具体的执行效果和日志。
![](https://main.qcloudimg.com/raw/de8289d2b918c71ec479360b890fdfeb.png)
5. 例如选中“构建”阶段，单击第 2 个步骤，它执行的命令是`docker version`。可以看到，下面的输出是当前环境 docker 的版本信息，符合预期。
![](https://main.qcloudimg.com/raw/b4e28e3c108bde5ce29aa349f76e2154.png)
6. 至此，就成功地运行了第一次持续集成，并对其中的过程配置、查看构建等有了基本的了解。接下来，您还可以查看这次构建的“改动记录”、“测试报告”以及“构建报告”。
![](https://main.qcloudimg.com/raw/16e2438c6f3df0be7c9e6efe32e1fc18.png)


## 步骤4：状态徽标
持续集成状态徽标可以实时显示当前项目的持续集成状态。
1. 选择左侧菜单栏**持续集成** > **状态徽标**。
2. 进入状态徽标页面，下拉框选择 Job 名称和分组可获取状态徽标。
![](https://main.qcloudimg.com/raw/8cf340326c7ef1c0bc54f03ca2f27339.png)
3. 目前状态徽标支持 Markdown 格式及 HTML 格式，您可以按照实际需求进行选择。

## 步骤5：环境变量

Shell 脚本和批处理文件使用环境变量来存储临时值，用于以后在脚本中引用，也用于传递数据和参数给子进程。

持续集成最后一步是要把构建好的镜像推送至远端的私有仓库，且需要用户名和密码验证。这时便可以引入环境变量，通过环境变量来输入用户名和密码。
