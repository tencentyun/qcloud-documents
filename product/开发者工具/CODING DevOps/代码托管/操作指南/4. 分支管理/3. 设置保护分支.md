本文为您详细介绍如何在代码仓库中设置保护分支。

## 进入项目
1. 登录 [CODING 控制台](https://console.cloud.tencent.com/coding)，单击团队域名进入 CODING 使用页面。
2. 单击团队首页左侧的**项目**，进入项目列表页，选择目标项目。
3. 选择左侧菜单**代码仓库** > **分支**，进入分支管理页面。

保护分支是 CODING 针对 Git 中有关代码权限开发的一个特色功能，可以将选中的分支保护起来，防止未经报备、允许的更改。

开启后，保护分支在分支列表中将以绿色盾牌为标志。成员修改保护分支时需新建一个分支并在其中进行修改，创建合并请求后邀请其他成员评审代码，评审完成并允许合并后才能执行合并操作。
![](https://qcloudimg.tencent-cloud.cn/raw/f92e6dd22009043f1ab21c656bc2526f.png)

[](id:protected-branch)
## 设置保护分支规则
在代码仓库的**设置** > **分支设置**中的分支规则名称中输入需要被保护的分支，符合命名规则的分支都会被视为保护分支。
<img style="width:700px; max-width: inherit;" src="https://qcloudimg.tencent-cloud.cn/raw/f3f78f5b9f68798aaa2e0ede7f0aaf9a.png" />
-  **禁止强制推送：**默认打开。即使有 `git push` 的权限，也不允许通过 `git push -f` 的方式强制修改分支的提交历史。对于多人合作的分支，强烈建议打开此选项。它确保了只能通过增加新的提交来改变分支内容，而不是修改历史提交的方式来提交变更。
-  **开启状态检查：**通过在 CI 中设置规范性检查条件或设置代码扫描方案，运行 CI 成功后才被允许合并，更多详情请参见 [触发规则](https://cloud.tencent.com/document/product/1115/66287)。
-  **合并前必须处理完所有的评审讨论：**开启此选项后，若评审者的代码评审意见为**需要改进**时，那么本次合并请求将不允许放行。直到代码作者针对此评审意见重新发起合并请求，并且评审者再无其他异议后，此合并请求才会被允许通过。
![](https://qcloudimg.tencent-cloud.cn/raw/f76cbf4c3edd26c8e589f4ada4bea8a1.png)
-   **自动添加分支管理员为评审者：**该功能开启之后，针对所有合并到此保护分支的合并请求，都会自动将分支管理员设置为评审者。当分支管理员的数量大于设置的**合并请求允许合并授权数量**时，会随机选择对应授权数量的分支管理员作为评审者。例如，当配置了 3 位分支管理员而授权数量为 2 时，系统会从 3 位分支管理员中随机选取 2 位作为评审者。
-   **开启代码所有者评审：**该功能开启之后，针对合并到该保护分支的合并请求，如果存在对代码所有者的文件的修改，则必须经过代码所有者的评审之后才允许合并。一般而言不同的代码路径决定了应用中的某项功能，这些功能的维护者天然不希望代码被其他成员无意间改动，详情请参见 [代码所有者](https://cloud.tencent.com/document/product/1112/64257)。
-   **合并请求允许合并授权数量：**用于设置合并请求必须经过多少位分支管理员的授权之后才允许合并到目标分支。如果该保护分支没有设置分支管理员，需经过 1 位普通成员授权之后才允许合并。

[](id:admin)
## 指定分支管理员
分支管理员为可选项。添加管理员后，所有的合并请求需得到管理员的允许才能被允许合并。管理员默认受到保护分支的条件限制，需创建合并请求才可修改分支。勾选**允许直接推送**后，管理员将不受保护限制，可以直接修改保护分支内容。
![](https://qcloudimg.tencent-cloud.cn/raw/81a84e1d04c81d6a4f1019f07f13f7a6.png)
若成员没有权限（即保护分支的非分支设置员） push 至该分支，当其尝试 push 至该分支的时候，会得到如下错误提示：
<img style="width:978px; max-width: inherit;" src="https://qcloudimg.tencent-cloud.cn/raw/aef775bed90a15683ad0ce1f33b8bca2.png" />
