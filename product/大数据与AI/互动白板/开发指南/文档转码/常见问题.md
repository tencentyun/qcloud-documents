本文记录文档转码使用过程中，遇到的常见问题。

## 接口使用问题
### 文档转码的作用是什么呢？为什么互动白板需要配合使用文档转码？
文档转码的作用，是把本地文档，转码成线上可查看的一种方式（如把 PPT 转码成 H5）。
[互动白板](https://cloud.tencent.com/document/product/1137/37901) 使用过程中，老师需要将自己的课件，展示给学生观看，这时就需要通过文档转码，将老师的课件转成线上可查看，然后学生就可以看到老师的课件了。

### 文档转码支持单独接入使用吗？
不支持。目前文档转码，只能配合 [互动白板](https://cloud.tencent.com/document/product/1137/37901) 使用。若您的互动白板服务未产生时长消耗，却调用了文档转码服务，则您发起的转码任务会被低优先级处理，可能出现长时间排队的情况。

### 为什么不建议使用 互动白板 SDK 的 addTranscodeFile 发起文档转码呢？
由于文档转码存在转码耗时和排队耗时，建议使用服务端 API 提前转码，客户端直接使用转码结果。`不建议`直接在客户端调用`互动白板sdk`的转码接口`addTranscodeFile`，避免长时间的等待，影响产品体验。

### 如果出现转码失败，是否需要业务侧重试呢？
不需要。因为转码服务器内部，已经加了转码失败的重试逻辑，业务侧无需重试（服务器重试逻辑：每台服务器重试3次，尝试2台转码服务器）。

###  服务端 API，Region 支持哪些区域呢？
目前服务端 API 接口`只支持区域广州`，在调用腾讯云 API 发起转码、查询转码结果时，`Region`参数请填写`ap-guangzhou`。

###  如何在 SDK 中使用转码结果？
请参考 [互动白板](https://cloud.tencent.com/document/product/1137/39928) 各个平台 API 文档中的 `addTranscodeFile` 接口说明。

### 文档转码后的文件，存储在哪里呢？
`建议`设置 [存储桶配置](https://cloud.tencent.com/document/product/1137/45256)，这样转码后的文件会自动转存到用户配置的 COS 桶里。
如果没有设置 [存储桶配置](https://cloud.tencent.com/document/product/1137/45256)，则默认存储在腾讯云转码服务器默认的 COS 桶，`存储周期为7天`；7天后，转码文件自动删除。

###  文档转码是怎么收费的呢？
具体收费标准，请参考 [购买指南](https://cloud.tencent.com/document/product/1137/37902)。

## 事件回调问题
### 为什么有时会出现长时间接收不到事件回调呢？
1. 转码和录制，回调的超时时间为10s，如果回调失败，会间隔5s，最大重试5次。
2. 如果长时间收不到回调，并且确认回调地址正常可用，可能原因是：1. 回调 url 和服务器的 RTT 超过了10s。 2. 回调因为网络原因丢失了。
3. 所以建议在代码逻辑中加上：如果出现`长时间收不到回调`时，配合`查询任务进度`接口确认。

## 缩略图问题
###  静态 和 动态转码 都支持缩略图吗？怎么生成？
静态 和 动态转码都支持缩略图。只需要在 发起文档转码 `CreateTranscode` 时，传入参数 `ThumbnailResolution` 参数，并且指定分辨率即可。   
例如: 传入 `"ThumbnailResolution":"640x480"`，转码结果里，就可看到 `"ThumbnailUrl":"http://xxxx/xxx/"` 缩略图 Url 地址

###  为什么调用 互动白板 `getThumbnailImages` 获取缩略图地址接口，有时返回的缩略图地址无法打开呢？
1. 互动白板 getThumbnailImages 的内部实现，只是根据固定的规则，组装缩略图地址；无法验证缩略图地址是否真实有效；    
所以如果需要缩略图功能，转码时请务必传入 `ThumbnailResolution` 参数
2. 静态转码 如果用户没有开通 [存储桶配置](https://cloud.tencent.com/document/product/1137/45256)，getThumbnailImages 会把文档转码结果 ResultUrl 按照固定规则修改成缩略图地址。   
但是 动态转码 ResultUrl 是 h5 链接，无法修成缩略图地址；所以现象就是，静态转码 缩略图正常，但是 动态转码 的缩略图地址打开 http 404 错误。所以如果需要缩略图功能，转码时请务必传入 `ThumbnailResolution` 参数。

## 转码耗时问题
###  文档转码，大概会耗时多久呢？
PPT 动态转码成 HTML5 大约为 1s/页，静态转码成图片 大约为 0.5s/页。

###  为什么有时，转码耗时很长？
1. 文档转码资源有限，存在排队逻辑; 当高峰时段，转码量过多时，新的任务会进入排队逻辑 被有序转码；所以就会增加排队时间。
2. 建议老师提前备课，错开高峰期转码；以免上课时转码时间过长，影响上课体验。

###  为什么发起转码后，长时间收不到转码回调呢？
1. 确认已经设置了回调，并且回调地址可用；设置回调，可以参考 [回调设置](https://cloud.tencent.com/document/product/1137/45255)。
2. 转码正在排队中。可以通过 [查询转码任务](https://cloud.tencent.com/document/product/1137/40059) 接口确认；如果返回的 Status 为 "QUEUED"；则代表正在排队中。

## 网络问题
###  为什么会提示，文档 url 解析错误呢？url 具体的要求是什么呢？
1. 目前只支持以 `http://` 或 `https://` 前缀的 URL。
2. 请确保文档下载 url 的 path 后缀，以 ppt(x)/doc(x)/pdf 结尾；否则下载 url 会校验失败。

###  为什么会提示，文档下载失败呢？
1. 请确认文档 url 的访问权限，并且可以通过浏览器正常下载；
2. 如果是 云服务器 COS 桶，请确认访问权限是否为 **公有读私有写**，或者签名是否过期。

###  为什么会提示，文档下载超时呢？
1. 转码服务器，默认下载超时时间为 60s（防止因为下载时间过长，过多占用服务器资源），所以建议文档最好不要超过50M，防止文档过大，导致下载超时。
2. 如果使用腾讯云 COS 桶存储，下载理论可以走腾讯云内网，所以可以支持更大的文件下载。

## 文档格式问题
### 文档转码，支持哪些格式呢？
目前只支持：doc(x)、ppt(x) 和 pdf 文档；暂时不支持 excel 和 txt 文档转码。

###  ppt 动态转码，有哪些不支持的特效 或 元素呢？
1. 不支持 "`墨迹`"元素 转码；可以通过 PowerPoint 打开 ppt，然后 `开始--》选择--》选择窗格` 查看是否存在“墨迹”。
2. 不支持4种动效；Bold Flash(加粗闪烁)、Underline(下划线)、Grow With Color(颜色渐变)、Bold Reveal(加粗显示)。

### ppt 动态转码，格式有哪些需要注意的地方呢？可以汇总一下吗？
1. 避免使用不支持转码的元素，如："`墨迹`" 和 4种特效(Bold Flash(加粗闪烁)、Underline(下划线)、Grow With Color(颜色渐变)、Bold Reveal(加粗显示))。
2. 建议使用 Microsoft Office 2007或以上版本（wps 和 keynote 都有一定的兼容性问题）。
3. 转码文件必须是**可编辑**的。不支持“只读”、“加密”、或其他保护，导致 ppt 无法编辑的文件转码。
4. 请勿插入 flash 动画，不支持 flash 动画播放。
5. 如果使用 wps，请注意不支持 wps ppt 中的音视频元素。
6. 如果使用 keynote，请注意插入的音频播放标签，无法展示。
7. 建议使用操作系统默认的中英文字体，请勿使用自己安装的字体，否则可能会出现转码失败或者转码 H5 格式异常 [查看转码服务器支持字体](https://cloud.tencent.com/document/product/1137/40251)。
8. ppt 页数不要过多，页数越多，转换速度越慢（目前最大支持500页转码）。
9. 尽量减小 ppt 体积大小，最好控制在50M以内；因为转码服务器，下载超时时间为1分钟；如果文件过大，可能会因为下载超时导致转码失败。
10. 目前文档转码，对 ppt 中 内嵌音视频 支持不完善；不建议 ppt 中内嵌音视频，否则转码后的 H5 中，可能会遇到音视频播放失败或者本地和远端音视频不同步等问题。

### 转码如何保留动画呢？
1. 使用 ppt/pptx 文档转码，默认会保留动画；
2. 如果设置了 IsStaticPPT=true，则所有的文档都会转码成 静态图片(包括 ppt 文件)。

###  提交的文档，会转码成什么格式的文件呢？
1. 默认情况下，ppt/pptx 文档会转码成`HTML5`页面，能够还原 ppt 原有的动画效果，其他文档转码成静态图片。
2. 如果设置了 IsStaticPPT=true，则所有的文档都会转码成 静态图片(包括 ppt 文件)。

###  动态转码支持音视频吗？
目前对音视频支持不完善，不建议在 ppt/pptx 中使用音视频

## 转码效果问题
###  动态转码出现某些字体错位，或大小不一致，如何处理？
1. 可能使用了转码服务器不支持的字体库导致，需要去除或修改不支持的字体 [查看转码服务器支持字体](https://cloud.tencent.com/document/product/1137/40251)。
2. 对于静态转码，如果遇到字体不支持的情况，也可以使用 office 的 `将字体嵌入文件`的功能。

`将字体嵌入文件`，操作方法：
打开文档，选择【文件】>【选项】>【保存】，然后勾选【将字体嵌入文件】>【仅嵌入演示文稿中使用的字符(适于减小文件大小)】>【确定】保存 文档，看到 office 的底部状态栏，显示【正在嵌入字体】即可

如图所示：
![](https://main.qcloudimg.com/raw/749786466e29a0afb8db26af51aded6e/powerpoint%E4%BF%9D%E5%AD%98%E5%AD%97%E4%BD%93-%E8%8C%83%E4%BE%8B.png)

### 为什么有些 ppt 动效，转换为 H5 后，丢失了呢？  
1. 确认没有使用转码不支持的4种动效(Bold Flash(加粗闪烁)、Underline(下划线)、Grow With Color(颜色渐变)、Bold Reveal(加粗显示))。
2. 最好不要使用组合动效，因为组合动效过于复杂，加大了 H5 还原的难度。

## 转码错误码解析

### 错误码：-14 Occur issue in convert processing 是什么原因？该如何解决？
问题原因：ppt 的内容中含有不支持转码的元素
解决方法：需要根据错误信息中提示的具体页数，查看是否使用了 "`墨迹`" 和 4种不支持的动效。
查看"`墨迹`"方法：PowerPoint 打开 ppt --> 依次选择`开始--》选择--》选择窗格` --> 查看右边框是否存在“墨迹”元素。
![](https://main.qcloudimg.com/raw/fd1253721e892761159ff54fd3d8d30d.png)

###  错误码: -9 ppt to pptx failed! 是什么原因呢？该如何解决？
问题原因：ppt 转换成 pptx 失败；可能是 ppt 使用的 PowerPoint 版本太老 或者 ppt 中含有某些元素，不支持转换成 pptx 格式。
解决方法：PowerPoint 打开 ppt --> 手动转换为 pptx --> 确认 pptx 打开不会有任何报错 --> 在使用转换后的 pptx 重新发起转码。

### 错误码: -20 UnKnow Ppt property! 是什么原因呢？该如何解决？
问题原因：ppt/pptx 文件，可能是“只读”、“加密”、或有其他保护，导致 ppt 无法被编辑。
解决方法：PowerPoint 打开 ppt/pptx --> 修复 PowerPoint 提示的错误 --> 确保 ppt/pptx 已经修改为 可编辑了 --> 保存 --> 重新发起文档转码。

###   错误码：-27 Download ppt data timeout! 是什么原因呢？该如何解决？
问题原因：ppt/pptx 体积过大 或者 文档 url 下载的带宽太小，导致转码服务器下载超时了；转码服务器目前下载超时时间为1分钟。
解决方法：1. 尝试去掉 ppt/pptx 中占用体积较大的元素，例如音视频文件等。 2. 确认文档 url 源站的下载带宽。

###  错误码：-106 download file suffix not support! 是什么原因呢？该如何解决？
问题原因：文档转码 的 url path，不是以 ppt(x)/doc(x)/pdf 结尾（此处注意，url 中 ?号后面的是参数，不是 path）。
解决方法：请确保文档下载 url 的 path 后缀，以 ppt(x)/doc(x)/pdf 结尾；否则下载 url 会校验失败。
 

## 其他问题
###  文档转码返回 url 的有效期是多长时间？  
1. 如果没有开通 `存储桶配置`，转码后的文件存储在`互动白板的 COS 桶`里，默认存储时间是7天。7天后，存储桶里的转码文件自动删除，url 的文件就会失效
2. 强烈建议开通 `存储桶配置`，这样转码后的文件，就可以自动转存到用户自己的 cos 桶下，不用担心转码文件过期的问题[存储桶开通指南](https://cloud.tencent.com/document/product/1137/45256)。

## 转码错误码对照表
### 文档转码 错误描述中的错误码列表

| 错误码 | 错误描述                        | 解决方法                  |
|:------|:-------------------------------|:-------------------------|
| 0     | 任务执行成功                     |    无                      |
| -1     | ppt 下载的 url 格式错误                 | 请检查 PPT 下载 URL                                         |
| -2     | ppt 打开过程中发生未知错误            | 请检查 PPT 格式是否正确                                    |
| -3     | ppt 打开超时                           | 请检查 PPT 格式是否正确                                    |
| -4     | ppt 打开无响应                        | 请检查 PPT 格式是否正确                                    |
| -5     | ppt 文件被加密                        | 不支持转换已加密的 PPT                                    |
| -6     | 未知 ppt 格式                           | 请检查 PPT 格式是否正确                                    |
| -7     | ppt 打开时发生异常                    | 请检查 PPT 格式是否正确                                    |
| -8     | ppt 为只读格式                        | 不支持只读 PPT，请检查 PPT 格式是否正确                     |
| -9     | ppt 转码失败                          | 请检查 PPT 格式是否正确                                    |
| -10    | pptx 格式解析错误                     | 请检查 PPT 格式是否正确                                    |
| -11    | ppt 下载失败，未知错误                | 请检查 PPT 下载 URL 是否有效                                 |
| -12    | h5 上传失败                           | 请联系客服人员                                     |
| -13    | ppt 转换服务未加载                    | 请联系客服人员                                           |
| -14    | ppt 转码过程中，发生错误              | 请根据错误信息中的页数,检查该页中的 元素 或 动画组合 是否正确;</br>如果错误信息中，无具体页数"unknown page"，则代表无法获取某一页转换失败，该 PPT 不支持转换|
| -15    | ppt 转码文件生成失败                  | 请联系客服人员                                     |
| -16    | ppt 转换模式异常                      | PPT 格式不支持或联系客服人员                              |
| -17    | ppt 超过最大的转换页数限制（目前为500） | 不支持转换超过500页的 PPT                                 |
| -18    | ppt 转换失败，错误未知                | ppt 格式不支持或联系客服人员                              |
| -19    | ppt 被加密                            | 不支持加密的 PPT                                          |
| -20    | ppt 未知属性错误                      | 请检查 PPT 格式是否正确                                    |
| -21    | ppt 检测属性超时                      | 请检查 PPT 格式是否正确                                    |
| -22    | ppt 转换异常                          | 请检查 PPT 格式是否正确                              |
| -23    | ppt 下载链接含有非法字符              | 请检查 PPT 下载链接是否正确                                |
| -24    | ppt 下载链接打开失败                  | 请检查 PPT 下载地址是否有效                                |
| -25    | ppt 下载链接打开超时                  | 请检查 PPT 下载链接是否有效或下载服务器网络状况          |
| -26    | ppt 下载数据失败                      | 请检查 PPT 下载服务器网络状况                              |
| -27    | ppt 下载数据超时                      | 请检查 PPT 下载服务器网络状况或是否 PPT 过大，导致下载超时 |
| -30    | ppt 转码引擎内部错误                      | 请联系维护人员 |
| -31    | ppt 中含有 jpeg 病毒                      | 请根据提示的页码，修改里面的 jpeg 图片 |
| -32    | ppt 的幻灯片数量为空             | 不支持幻灯片为空的 PPT 转换|
| -33    | 转码完成后，上传到 COS 桶失败             | 请在[腾讯云 cam 控制台](https://console.cloud.tencent.com/cam/role)检查是否存在 TIW_QCSRole 角色，以及该角色是否具有 QcloudAccessForTIWRoleInWhiteboardResourcesManagement 这个策略<br/>如果没有，请先创建角色 TIW_QCSRole，并给该角色分配 QcloudAccessForTIWRoleInWhiteboardResourcesManagement 策略 |
| -101  | task info 文件读取失败           | 请联系维护人员             |
| -102  | task info 格式不正确             | 请联系维护人员             |
| -103  | task info 的 error_code 不等于0 | 请联系维护人员             |
| -104  | task 的 url 为空                | 请联系维护人员             |
| -105  | task 的 下载 url 错误              | 请检查转码文件下载链接       |
| -106  | 不支持的文件名后缀                | 请检查文件名后缀名          |
| -107  | 文件下载失败，未知错误             | 请检查下载链接地址是否有效   |
| -108  | 下载链接非法                     | 请检查转码文件下载链接       |
| -109  | 下载链接打开失败                  | 请检查下载链接地址是否有效   |
| -110  | 下载链接打开超时                  | 请检查下载链接地址是否有效   |
| -111  | 下载失败                        | 请检查下载链接地址是否有效   |
| -112  | 下载超时                        | 请检查下载链接带宽          |
| -113  | 本地临时文件夹创建失败             | 请联系维护人员             |
| -114  | 文件上传转码后台失败              | 请联系维护人员             |
| -121  | 超过最大页数                     | 不支持超过500页的文件转码   |
| -122	| 转码服务器打开本地文件失败							| 请联系维护人员			|
|-123	| 转码服务器写本地文件失败								|请联系维护人员			|
|-124	| 转码服务器文件内容为空								|请联系维护人员			|
|-125	| 获取图片分辨率失败									|请联系维护人员			|
|-126	| pdf 打开失败										|		pdf 文件格式错误或 pdf 加密，不支持转码			|
|-127	| pdf 文件加密										|		不支持加密 pdf 文件转码			|
|-128	| 获取 pdf 页数失败										|	pdf 文件格式不支持			|
|-129	| pdf 转码未知错误									|		pdf 文件格式不支持			|
|-130	| office 转码本地错误；包括转码任务格式，任务完成格式等  |请联系维护人员			|
|-131	| office 文件加密									|	文件格式不支持			|
|-132	| office 文件未知属性错误								|文件格式不支持			|
|-133	| office 文件打开超时									|文件格式不支持			|
|-134 |  office 文件打开异常									|文件格式不支持			|
|-135	| office 文件转存异常									|文件格式不支持			|
|-136	| office 转换 taskid 对应失败							|请联系维护人员			|
|-137	| 获取 office 文件分辨率失败							|请联系维护人员			|
|-138	| 转码后的本地文件错误									|请联系维护人员			|
|-139	| 转码丢失了页数										|请联系维护人员			|
|-141	| ppt 幻灯片为空										|不支持幻灯片为空的 PPT 转码			|
|-142	| 转码丢失了页数										|请联系维护人员			|
|-143	| 转码丢失了页数										|请联系维护人员			|
