## 功能简介

腾讯云文档转码服务为您提供了将文件转码为`HTML5`页面和图片的能力，将转码后的文档展示于白板，为您提供和线下教育体验高度一致的在线教育服务。

## 如何使用文档转码

>! 文档转码后的资源文件存储依赖对象存储 COS，使用文档转码功能前，请先进行 [存储桶配置](https://cloud.tencent.com/document/product/1137/45256) 。


文档转码服务接入有两种方式，一种为主动轮询（较适用于客户端发起转码请求），一种为注册 CGI 接口回调（较适用于服务端发起转码请求）。两种接入方式的基本使用流程如图所示：

#### 主动轮询

![主动轮询](https://main.qcloudimg.com/raw/b68d5f5531262a91806e3862611a2cd6/%E6%96%87%E6%A1%A3%E8%BD%AC%E7%A0%81%E4%B8%BB%E5%8A%A8.png)

#### 注册 CGI 接口回调

![注册 CGI 接口回调](https://main.qcloudimg.com/raw/73fc644b99182750a43b4b725aa5580f/%E6%96%87%E6%A1%A3%E8%BD%AC%E7%A0%81CGI.png)

## 1分钟跑通文档转码

步骤一：上传待转码的 PPT 文件，获取文档的下载链接。如果您使用腾讯云对象存储，可以参考文档 [简单上传](https://cloud.tencent.com/document/product/436/14113) 。

步骤二：发起转码任务
   - 打开 [腾讯云 API Explorer](https://console.cloud.tencent.com/api/explorer?Product=tiw&Version=2019-09-19&Action=CreateTranscode&SignVersion=)，选择互动白板->文档转码相关接口->创建文档转码任务，输入您的 SecretId 和 SecretKey 。
   - 输入参数里 Region 请选择`华南地区(广州)`，SdkAppId 填写您的互动白板应用 SdkAppId（如果您还没有创建应用，请参考文档 [应用管理](https://cloud.tencent.com/document/product/1137/45257) 在 [互动白板控制台](https://console.cloud.tencent.com/tiw/app) 里创建）。
   - `Url`参数里填入步骤一中获取的文档下载 URL，如`https://board-sdk-1259648581.file.myqcloud.com/TIC/1590997573551/欢迎新同学.pptx`，更多参数描述请参考文档 [创建文档转码任务](https://cloud.tencent.com/document/product/1137/40060)。
   - 点击在线调用->发送请求按钮发送转码请求，获取 TaskId，如图所示获取到的 TaskId 为`gnbcie38gtgtv4mnbarb`。

![](https://main.qcloudimg.com/raw/83884ec74e199e06f19fe2da790fc4c4.png)

步骤三：查询转码结果
   - 打开 [腾讯云 API Explorer](https://console.cloud.tencent.com/api/explorer?Product=tiw&Version=2019-09-19&Action=DescribeTranscode&SignVersion=)，选择互动白板->文档转码相关接口->查询文档转码任务，输入您的 SecretId 和 SecretKey 。
   - 输入参数里 Region 请选择`华南地区(广州)`，SdkAppId 填写您的互动白板应用 SdkAppId，`TaskId`填入步骤二中获取的 TaskId 。
   - 点击在线调用->发送请求按钮查询文档转码结果，可以多次调用等待进度`Progress=100`时，`ResultUrl`参数即为您的文档转码结果`https://ppt2h5-1259648581.file.myqcloud.com/gnbcie38gtgtv4mnbarb/index.html` 。

![](https://main.qcloudimg.com/raw/9a2a06b9d0fe61f64c59476ff5a74260.png)

## 上传文档并获取链接注意事项

发起转码时需要提供待转码文档的下载链接，转码服务将在文档下载完成后开始转码。您可以选择使用腾讯云对象存储上传文档并获取下载链接，也可以使用您自己的文件服务器，以下几点需要注意：

1. 目前只支持包含`http://`或`https://`前缀的 URL。
2. 请检查 URL 的访问权限，保证文档转码服务能正常访问并下载该文档原文件。如果您使用腾讯云对象存储（Cloud Object Storage，COS），请检查存储桶的访问权限为**公有读私有写**。您可以在腾讯云控制台设置存储桶的访问权限，具体请参考 [设置访问权限](https://cloud.tencent.com/document/product/436/13315)。
3. 如果您使用其他的文件存储服务，请注意文件存储服务的上传带宽，文档转码服务提供**1分钟**的下载时间，如果下载不成功本次的转码请求将以失败终止。
4. 默认情况下，PPT 文档（后缀名为`.ppt`或`.pptx`）会转码成`HTML5`页面，能够还原 PPT 原有的动画效果，其他文档会转码成静态图片。
5. PPT 动态转码成`HTML5`页面的时间大约为每页1s，文档转码成静态图片的时间大约为每页0.5s，
6. 如果出现转码失败，客户端无需重试，应该根据错误码，修改对应的转码文件，再重试；因为转码服务器，已经添加了转码重试逻辑。
7. 目前服务端 API 接口只支持区域广州，在调用腾讯云 API 发起转码、查询转码结果时，`Region`参数请填写`ap-guangzhou` 。

## 支持转码格式
目前只支持：doc(x)、ppt(x) 和 pdf 文档；暂时不支持 excel 和 txt 文档转码。

## ppt 演示文稿课件格式建议

1. 建议使用 Microsoft Office 2007或以上版本（wps 和 keynote 都有一定的兼容性问题）。
2. ppt 转码文件必须是**可编辑**的。不支持“只读”、“加密”、或其他保护，导致 ppt 无法编辑的文件转码。
3. 动态转码，不支持 ppt 的"墨迹注释" 和 4种动效：1：“Bold Flash”、2：“Underline”、3：“Grow With Color”、4：“Bold Reveal”；
   如果使用，会导致转码失败，并且上报(-14: 不支持元素或动效)的错误码
4. 请勿插入 flash 动画，不支持 flash 动画播放。
5. 如果使用 wps，请注意不支持 wps ppt 中的音视频元素。
6. 如果使用 keynote，请注意插入的音频播放标签，无法展示。
7. 建议使用操作系统默认的中英文字体，请勿使用自己安装的字体，否则可能会出现转码失败或者转码 h5 格式异常 [查看转码服务器支持字体](https://cloud.tencent.com/document/product/1137/40251)。
8. ppt 页数不要过多，页数越多，转换速度越慢（目前最大支持500页转码）。
9. 尽量减小 ppt 体积大小，最好控制在50M以内；因为转码服务器，下载超时时间为1分钟；如果文件过大，可能会因为下载超时导致转码失败
10. 目前文档转码，对 ppt 中 内嵌音视频 支持不完善；不建议 ppt 中内嵌音视频，
   否则转码后的 h5 中，可能会遇到音视频播放失败 或者 本地和远端 音视频不同步等问题 

## 常见问题
1. ppt 转 h5后，出现某些字体错位，或大小不一致，如何处理？  
问题原因：该问题一般是因为 ppt 中使用了转码服务器不支持的字体库导致的。[查看转码服务器支持字体](https://cloud.tencent.com/document/product/1137/40251)。
解决方法（两个方法）：  
方法一：
去掉或更改字体为服务器支持的字体库。
操作指引：
打开 ppt，选择不支持字体的文字，然后切换到服务器支持的字体。
方法二：
ppt 保存时，将字体库一起打包进 ppt。
操作指引：
打开 ppt，选择【文件】>【选项】>【保存】，然后勾选【将字体嵌入文件】>【仅嵌入演示文稿中使用的字符(适于减小文件大小)】>【确定】保存 ppt，看到 PowerPoint 的底部状态栏，显示【正在嵌入字体】即可。
![保存字体](https://main.qcloudimg.com/raw/749786466e29a0afb8db26af51aded6e/powerpoint%E4%BF%9D%E5%AD%98%E5%AD%97%E4%BD%93-%E8%8C%83%E4%BE%8B.png)

2. 为什么有些 ppt 动效，转换为 h5 后，丢失了呢？  
问题原因：ppt 中使用了不支持转换的动效；包括：1：“Bold Flash”、2：“Underline”、3：“Grow With Color”、4：“Bold Reveal”。
解决方法：去掉不支持的特效或者使用其他特效替换。
3. 为什么有些 ppt 或 pptx 文件，本地 PowerPoint 预览正常；但是转码时，服务器返回错误“ppt may contain unsupported elements”？  
问题原因：ppt 的内容中含有一些不支持转码 h5 的元素，所以导致转码失败。
解决方法：如果是 pptx 格式文件，可以用 PowerPoint 另存为 ppt 格式，然后重新尝试转码。
如果是 ppt 格式文件，可以用 PowerPoint 另存为 pptx 格式，然后重新尝试转码。
4. 文档转码返回 url 的有效期是多长时间？  
有效期3个月。3个月后，您需要重新调用文档转码服务。
5. 为什么会遇到“-9 ppt transform failed! Ppt Format not support!”错误呢？应该如何解决？
问题原因：ppt 中，可能含有某些元素，导致转换成 pptx 失败。
解决方法：将 ppt 用 PowerPoint 手动转为 pptx，确认打开 pptx 不会有任何报错后，在使用转换后的 pptx 重新发起转码。
6. 为什么会遇到“-20 UnKnow Ppt property! Ppt Format not support!”错误呢？应该如何解决？
问题原因：1. ppt 文件，可能是“只读”、“加密”、或其他保护，导致 ppt 无法被编辑；2. ppt 文件，可能含有不支持的转码属性。
解决方法：如果 ppt 不支持编辑：修改 ppt 为可编辑，然后再次尝试转码。
如果含有不支持的属性：PowerPoint 打开 ppt，修改 PowerPoint 提示的异常属性，然后再次尝试转码。
7. 为什么会遇到“-29 Page [x,x,x] The same animation contains both audio and autoplay!not suport!”错误呢？应该如何解决？
问题原因：h5文档转码，暂时不支持 ppt 的某个动画，同时包含“声音”和“自动动画(与上一个动画同时 或 上一个动画之后)”属性
解决方法：去掉对应页动画的“音频”或“自动动画”属性，然后重新尝试转码即可

8. 如何在 SDK 中使用转码结果？
解决方法：请参考 [互动白板](https://cloud.tencent.com/document/product/1137/39928) 各个平台 API 文档中的 `addTranscodeFile` 接口说明。
