## 医学对比指标

用于计算常用医学指标。

对比指标：相对危险度（RR）、比值比（OR）。

- 相对危险度（Relative Risk，RR）= 暴露组的累积发病率（或死亡率）/ 对照组的累计发病率（或死亡率）。相对危险度表明暴露组发病率或死亡率是对照组发病率或死亡率的多少倍。说明暴露组发病或者死亡的危险性是非暴露组的倍数。RR 值越大，表明暴露的效应越大，暴露与结局的关联的强度越大。
- 比值比（Odds Ratio，OR）= 病例组的暴露比值（a/c）/ 对照组的暴露比值（b/d）= ad/bc。在病例对照研究中，比值比指病例组中暴露与非暴露人数的比值和对照组中暴露与非暴露人数的比值的比。在队列研究中，指的是暴露组中患病与非患病者的比值和非暴露组中患病与非患病者的比值的比。
  
#### 输入参数
输入数据路径：标签和预测结果的 csv 文件的路径。


#### 输出参数
- 指标输出路径：对比指标值输出路径。
- 混淆矩阵输出路径：对比指标混淆矩阵输出路径。

#### 算法参数
- 输入数据是否包含 header 信息：是，否。
- 输入数据分割符：逗号、分号、空格、Tab。
- 组别列（单列）：组别所在列的列号，从0开始计数。
- 类别列（单列）：类别所在列的列号，从0开始计数。



#### 资源参数

资源类型：选择合适的算力机型。




## 医学评估指标

用于计算常用医学指标。

评估指标：真阳性、假阳性、真阴性、假阴性、敏感性/度、特异性/度、精准率、准确率。

通常来说，阳性（positive）代表患病或者携带病毒，阴性（negative）代表正常样本。
- 真阳性 TP（True Positive）：预测和真实情况均为阳性，预测正确。
- 假阳性 FP（False Positive）：将不具备阳性症状的人检测出阳性，假阳性检测结果导致误诊。
- 真阴性 TN（True Negative）：预测和真实情况均为阴性，预测正确。
- 假阴性 FN（False Negative）：将阳性症状的样本预测为阴性，假阴性结果导致漏诊。

<table>
     <tr>
         <th style="text-align:center;">真实情况</th>  
         <th colspan="2" style="text-align:center;">预测结果</th>  
     </tr>
  <tr>      
         <td rowspan="2" style="text-align:center;">阳性</td>   
      <td style="text-align:center;">阳性</td>   
      <td style="text-align:center;">阴性</td>   
     </tr> 
  <tr>
      <td style="text-align:center;"> TP（真阳性）</td>   
      <td style="text-align:center;">FN（假阴性）</td>
     </tr> 
  <tr>      
         <td style="text-align:center;">阴性</td>   
      <td style="text-align:center;">FP（假阳性）</td>   
      <td style="text-align:center;">TN（真阴性）</td>   
     </tr> 
</table>



- 敏感性/度（Sensitivity）= TP /（TP + FN），即患者被预测为阳性的概率。此值越大，说明诊断试验越灵敏。
- 特异性/度（Specificity）= TN /（TN + FP），即实际上未患病样本被诊断为阴性的概率。此值越大，说明诊断试验越精确。
- 精准率（Precision）= TP /（TP + FP），即所有被预测为阳性的样本中实际为阳性的概率。
- 准确率（Accuracy）=（TP + TN）/（TP + TN + FP + FN），即预测正确的结果占总样本的百分比。



#### 输入参数

输入数据路径：标签和预测结果的 csv 文件的路径。

#### 输出参数

- 指标输出路径：评估指标值输出路径。
- 混淆矩阵输出路径：评估指标混淆矩阵输出路径。

  

#### 算法参数

- 标签列（单列）：标签所在列的列号，从0开始计数。
- 预测值列（单列）：预测值所在列的列号，从0开始计数。
- 输入数据是否包含 header 信息：是，否。
- 输入数据分割符：逗号、分号、空格、Tab。

#### 资源参数：

资源类型：选择合适的算力机型。


## 图像转换

对常用医学格式图像进行读取，包括 Dicom、nii、nrrd 等可由 simpleitk 可读取的格式，可转为 nii.gz 格式或者切片保存为 tiff 格式，同时支持对数据进行切分，供算法节点调用。

医学图像常用术语：
- 一层：即一张二维图像。
- 序列：即由多层图像所构建的三维图像。
- Dicom 格式文件：医学图像格式，通常一个 dicom 文件为一层，一个序列为一个文件夹。
- Nii、nrrd 等格式：通常一个文件为一个序列。

#### 输入参数

- 图像输入路径：目录中需包含若干个子目录，子目录名字为类别名。
- 标注输入路径：存放图像目录、label、标注目录以及 bounding box 区域（以 ";" 分隔）的 csv 格式文件，列名分别为 image_path、label、mask_path、bounding_box。



#### 输出参数

- 训练集输出路径：输出训练集的文件的路径。
- 验证集输出路径：输出验证集的文件的路径。

  

#### 算法参数

- 仅截取 ROI 部分：是，否。若选“是”，进一步选择取 bounding box 或者仅 ROI。
- 输出格式：nii.gz、tiff。
- 数据切分：是，否。是否对数据集进行切分，如果选择“否”，所有数据将会转换成目标格式，并输出到【训练集输出】目录下。
- 验证集比例：0-1，如果数据切分中选择“是”，此处为切分成验证集的数据比例。



#### 资源参数
资源类型：选择合适的算力机型。


## 影像组学特征提取

从医学影像中提取常用影像组学特征，以 pyradiomics 为参考。


#### 输入参数

图像输入路径：经医学图像转换后的医学图像。


#### 输出参数

影像组学特征输出路径：输出包含特征的 csv 文件路径。



#### 算法参数

- 特征参数设置：可以通过配置 pyradiomics 提供的配置文件进行配置，具体可配置参数如下：
  - 基本设置-binWidth (bin 的宽度标量)：float 类型，大于0，用于设定 bin 的宽度标量。
  - 基本设置-差值方法（interpolator）：用于设置重采样的差值方法。包含：枚举类型，sitkNearestNeighbor (= 1)，sitkLinear (= 2)，sitkBSpline (= 3)，sitkGaussian (= 4)，sitkLabelGaussian (= 5)，sitkHammingWindowedSinc (= 6)，sitkCosineWindowedSinc (= 7)，sitkWelchWindowedSinc (= 8)，sitkLanczosWindowedSinc (= 9)，sitkBlackmanWindowedSinc (= 10)。
  - 基本设置-是否重采样：是，否。[公有云上默认值为(1.0,1.0,1.0)]
  - 图像分量：Original、Wavelet、LoG、Square、SquareRoot、Logarithm、Exponential、Gradient、LBP3D。
  - 特征类型：Shape、Firstorder、glcm、glrlm、glszm、gldm。



#### 资源参数

资源类型：选择合适的算力机型。


## 数据拼接

将多个模型的结果文件拼接到一个 csv 文件中，目的是对该 csv 进行模型结果评估对比，以此来判断哪个模型输出的结果性能更高。



#### 输入参数

- 待拼接输入路径1：待拼接的文件路径1。
- 待拼接输入路径2：待拼接的文件路径2。



#### 输出参数

拼接输出路径：拼接后文件路径（根据输入1和输入2的指定列进行合并拼接）。



#### 算法参数

- 输入文件类型：csv 文件。
- 输入文件包含 header 信息：是，否。
- 输入文件分隔符：逗号、空格、分号、Tab（“\t”）。
- 输入文件1特征列：表示需要拼接的特征所在列，例如“1-10,12,15”，表示取特征在表中的1到10列，12列，15列，从0开始计数。
- 输入文件1模型名（可选）：输入的模型名作为输入文件1列名的前缀，输出至输出文件，用下划线连接，如不填，则不增加前缀（如模型名填写 “model1”，列0名称 “balance”，输出文件列0为 “model1_balance”）。
- 输入文件2特征列：表示需要拼接的特征所在列，例如“1-10,12,15”，表示取特征在表中的1到10列，12列，15列，从0开始计数。
- 输入文件2模型名（可选）：输入的模型名作为输入文件1列名的前缀，输出至输出文件，用下划线连接，如不填，则不增加前缀（如模型名填写 "model1"，列0名称 “balance”，输出文件对应列为 “model1_balance”）。

#### 资源参数

资源类型：选择合适的算力机型。


## 模型校验

计算常用医学单样本和多样本检验，包含独立 T 检验，配对 T 检验、Delong 检验、Pearson 校验、 Spearmanr 检验、Kendalltau 校验。

对比不同模型表现的差异性、对比不同数据集分布差异显著性。

- 独立 T 检验：用于分析定类数据（X）与定量数据（Y）之间的差异情况。独立样本T检验需要样本服从正态分布，且两组样本的总体方差相等。
- 配对 T 检验（paired t-test）：用于分析配对定量数据之间的差异对比关系。配对样本T检验要求样本是配对的，两个样本的样本量要相同，且样本先后的顺序是一一对应的。
- Delong 检验：用于检验 AUC 显著性。
- 卡方检验（Chi-Squared Test）：用于比较两个及两个以上样本率（构成比）以及两个分类变量的关联性分析。
- 显著性检验
   - Mann-whitney：假设两个样本分别来自除了总体均值以外完全相同的两个总体，用于检验这两个总体的均值是否有显著的差别。
- 相关系数
   - 皮尔逊相关系数（Pearson）：用于度量两个变量 X 和 Y 之间的相关程度（线性相关）。
   - 斯皮尔曼等级相关系数（Spearmanr Rank）：用来估计两个变量 X、Y 之间的相关性，其中变量间的相关性可以使用单调函数来描述。
   - 肯德尔等级相关系数（Kendalltau Rank）：用来测量两个随机变量相关性的统计值。



#### 输入参数

输入数据路径：标签和预测结果的 csv 的路径。

#### 输出参数

校验结果输出路径：校验结果输出路径。


#### 算法参数

- 标签列（单列）：标签所在列的列号，从0开始计数。
- 预测结果列（支持多列）：预测结果所在列的列号，从0开始计数。
- 输入数据是否包含 header 信息：是，否。
- 输入数据分割符：逗号，分号，空格，Tab。
- 校验类型（选项）：独立 T 检验，配对 T 检验，Delong 检验，pearson、spearmanr、kendalltau。
- 置信度水平：默认0.95。

