## 开发准备

1. 注册腾讯云账号，单击进入 [文字识别控制台](https://console.cloud.tencent.com/ocr/general)，即可开通相应服务。

2. 在 [账号中心](https://console.cloud.tencent.com/cam/capi) 获取 API 密钥。

3. 从 OCR SDK 下载链接中下载 SDK 到本地准备集成。

    

## 小程序端 OCR SDK 接入流程

### 小程序端 OCR SDK 介绍

​	SDK 中包含了三个页面：

- **id-card** - 身份证识别页面
- **bank-card** - 银行卡识别页面
- **business-card** - 名片识别页面

### 环境依赖

- 当前小程序 OCR 识别 SDK 版本适用于 iOS（7.0.5及以上版本）Android（7.0.5及以上版本）

  **客户端版本过低可能会导致拍照时无法打开手电筒**
- 开发工具使用微信开发者工具，基础库 2.8.0 或以上版本

### 接入步骤

1. 配置合法域名

   在微信公众平台服务器域名配置中，将 `https://ocr.tencentcloudapi.com` 添加到 request 合法域名中。

2. 导入 SDK    

   将 SDK 包中 ocrsdk 目录放入小程序根目录中.       

3. 添加 SDK 页面配置

   在小程序 app.json 文件中添加 SDK 页面。


    ```json
    "pages": [
      // ...,
      "ocrsdk/pages/id-card/id-card", // 身份证识别页面
      "ocrsdk/pages/bank-card/bank-card", // 银行卡识别页面
      "ocrsdk/pages/business-card/business-card" // 名片识别页面
    ],
    ```

4. 在需要使用 SDK 的页面中引入包

    ```javascript
    const ocrSDK = require("/ocrsdk/index");
    ```

5. 调用以下方法进入对应卡证识别页面

    ```javascript
    ocrSdk.start({
      getAuthorization: function() {
        return new Promise((resolve, reject) => {
          wx.request({
            url: '您服务器端获取临时密钥的接口地址', // 填写您服务器端的接口地址，获取临时密钥
            method: "POST",
            data: {
              option // 您自定义的参数
            },
            success(res) {
              let credentials = res.Credentials;
              resolve({
                secretId: credentials.TmpSecretId,
                secretKey: credentials.TmpSecretKey,
                token: credentials.Token,
              })
            },
            fail(err) {
              resolve(err)
              wx.navigateTo({
                url: '您的小程序页面',
              });
            }
          })
        })
      },
      secretId: '**************', // 不推荐在生产环境中使用固定密钥
      secretKey: '**************', // 不推荐在生产环境中使用固定密钥
      ocrType: ocrSdk.OcrType.ID_CARD,
      ocrOption: {
        Config: {
          "CropIdCard": true,
          "CropPortrait": true
        }
      },
      resultPage: true,
      resultPageConfig: {
        modifiable: true,
        themeColor: 'red',
      },
      success: (res) => {
        console.log('ocr result is:', res)
        wx.navigateTo({
          url: '您的小程序页面',
        })
      },
      fail: (error)=> {
        console.log('ocr failed:', error)
      }
    });
    ```
    方法中具体参数请参考 SDK 接口说明。
