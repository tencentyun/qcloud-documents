## 简介

数据万象支持设置媒体工作流，您可以快速、灵活、按需搭建视频处理流程。每个工作流与输入存储桶的一个路径绑定，当视频文件**上传**至该路径时，该媒体工作流就会被**自动触发**，执行指定的处理操作，并将处理结果自动保存至输出存储桶的指定路径下。

在数据工作流中可以实现**音视频转码**、**极速高清转码**、**视频截帧**、 **视频转动图**、**智能封面**、**音视频拼接**、**人声分离**、**精彩集锦**、**hts自适应多码率**、**SDRtoHDR** 、**视频增强**、**自定义函数**等功能。


>!
> - 工作流目前支持处理 3gp、asf、avi、dv、flv、f4v、m3u8、m4v、mkv、mov、mp4、mpg、mpeg、mts、ogg、rm、rmvb、swf、vob、wmv、webm、mp3、aac、flac、amr、m4a、wma、wav 格式的文件，您在发起媒体处理请求时，请务必输入完整的文件名和文件格式，否则无法识别格式和处理。
> - 目前工作流功能仅支持对上传中的视频文件进行操作，若您需要对云上数据进行媒体处理操作，请使用 [任务](https://cloud.tencent.com/document/product/460/46489) 功能。
> 

## 操作步骤

### 创建工作流

1. 登录 [数据万象控制台](https://console.cloud.tencent.com/ci)。
2. 在左侧导航栏中，单击【存储桶管理】，进入存储桶列表。
3. 找到需要进行视频处理的存储桶，单击右侧操作栏的【管理】，进入相应存储桶管理页面。
4. 在左侧导航栏中，单击【媒体处理】，并在页面上方选择【工作流】页签，进入工作流页面。
5. 单击【创建工作流】，进入创建工作流页面。
6. 在创建工作流页面，配置如下信息：
   ![](https://main.qcloudimg.com/raw/60dc55ccd18a65b6371e8b5ed3efd6a9.png)
  - **工作流名称**：必填项，仅支持中文、英文大小写[A-Z,a-z]、数字[0-9]、下划线(\_)和短横线(-)，长度不能超过128个字符。
  - **输入存储桶**：默认项，即为当前存储桶。
  - **输入路径**：选填项，以`/`开头，以`/`结尾，如果不填写，则对输入存储桶所有路径生效。工作流启用后，当视频文件上传至该路径时，媒体工作流将被自动触发。
  - **格式过滤**：选择系统默认音视频过滤规则或自定义需要进入工作流的文件规则。
  - **队列**：必选项，在开通服务时，系统会自动创建一个用户队列。当用户提交任务后，任务会先进入队列中进行排队，根据优先级和提交顺序依次执行。
  - **回调设置**：可使用队列回调即回调 URL 与队列绑定，如需修改请前往指定队列的列表进行修改，或自定义回调 URL。
  - **配置工作流**：单击输入右侧的“+”可以添加**音视频转码（包括极速高清转码）**、**视频截帧**、 **视频转动图**、**智能封面**、**音视频拼接**、**人声分离**、**精彩集锦**、**hts自适应多码率**、**SDRtoHDR** 、**视频增强**、**自定义函数**节点，每个工作流至少配置一个任务节点。任务节点配置需设置输出存储桶、输出文件名（详情请参见 [工作流变量说明](#1)）、输出路径、选择任务模板。模板的介绍和设置详情请参见 [模板](https://cloud.tencent.com/document/product/460/46490) 文档。
<dx-tabs>
::: 音视频转码
![](https://main.qcloudimg.com/raw/276eacbb030f4432f5e3d6c0af84f810.png)
:::
::: 视频截帧
![img](https://main.qcloudimg.com/raw/ff18c20c29b018e1a03c6a23ad3be4a4.png)
:::
::: 视频转动图
![img](https://main.qcloudimg.com/raw/32bc6162f99f736ac38f1d9fd5f128d1.png)
:::
::: 智能封面
![](https://main.qcloudimg.com/raw/4a175f08f29fabd93ae9c36bfdf698c0.png)
说明：智能封面结合腾讯云先进的 AI 技术，通过对视频内容的理解，智能计算输出3张最优的关键帧。
:::
::: 音视频拼接
![](https://main.qcloudimg.com/raw/662304e4988dbeae7aa15295849c2d35.png)
:::
</dx-tabs>
<dx-tabs>
::: 人声分离
![](https://main.qcloudimg.com/raw/3f2c556d6a40e93ffb5a7272f77414fc.png)
:::
::: 精彩集锦
![](https://main.qcloudimg.com/raw/c187fbb5d2b090c6c085018c9af03b4d.png)
:::
::: hts自适应打包
![](https://main.qcloudimg.com/raw/e3823d294fb6b5b955fd26d686eb4342.png)
说明：将多码率、多音轨的多个文件打包生成一个文件，一步生成多码率自适应的视频文件。
:::
</dx-tabs>
6. 以上配置无误后，单击【保存】即可看到刚创建的工作流。
![](https://main.qcloudimg.com/raw/d72a2ce91f802bc4c5e65b78122319b9.png)
工作流默认为未启用状态，单击该工作流对应的状态按钮，即可启用工作流。工作流启用后，将在5分钟内生效。工作流生效后，后续上传的视频文件将自动进行媒体处理操作，待处理完成后，将新生成的文件输出到指定文件路径中。


### 管理工作流

进入工作流管理页面，查看已创建工作流的列表。
![](https://main.qcloudimg.com/raw/d72a2ce91f802bc4c5e65b78122319b9.png)

工作流列表展示了工作流名称、工作流 ID、输入路径、创建时间以及启用状态等信息。支持按照工作流名称、工作流 ID 搜索以及对指定工作流进行查看详情、编辑和删除操作。
 - **启用按钮**：启动工作流后，您上传至输入存储桶对应路径下的视频文件将会根据工作流配置自动处理。再次单击该启用按钮，可暂停工作流。暂停工作流后，将不会对上传至对应路径下的视频文件进行自动处理。
>? 工作流默认为未启用状态，单击该工作流对应的状态按钮后，可启用工作流。工作流启用后，将在5分钟内生效。
>
 - **详情**：查看当前工作流的配置详情。
 - **执行实例**：按照时间维度查看工作流的执行状态、执行时间等信息。
 - **更多**：   
   - 在操作栏下，单击【更多】>【编辑】，进入“工作流编辑”页面，您可在该页面更改工作流配置。
   - 在操作栏下，单击【更多】>【删除】，删除该工作流。

>! 工作流处于启用状态时，无法对其进行编辑和删除操作。
>

### 查看执行实例

每个视频文件执行完一遍工作流，就会产生一个执行实例，执行实例页面展示源文件地址、工作流执行状态、执行时间等信息。

1. 进入工作流管理页面，找到目标工作流，并在操作栏中单击【执行实例】，进入执行实例列表页面。
![](https://main.qcloudimg.com/raw/d72a2ce91f802bc4c5e65b78122319b9.png)
2. 在列表页面，找到目标实例，并在操作栏中单击【详情】，进入实例详情页面。
![](https://main.qcloudimg.com/raw/9adfdda6e20fe90c1675a0192bbe4e95.png)
3. 在实例详情页面中，您可查看工作流各节点的任务 ID、执行状态、开始/结束时间等信息。
![](https://main.qcloudimg.com/raw/0c2f798838b18d708e00edb66d5c36cb.png)

### 触发工作流

创建工作流完成后，除了针对上传文件至存储桶时会自动触发外，还支持对已存储在存储桶中的文件立即触发工作流。

1. 进入工作流管理页面，找到目标工作流，单击【更多】>【触发工作流】，进入触发工作流页面。
2. 在触发工作流页面中，选择需要触发工作流的文件，单击【保存】，即可立即触发工作流并执行。
后续您可在执行实例页面查看工作流执行状态。
![](https://main.qcloudimg.com/raw/20501a10f7665c6b8969f1d824551159.png)


<span id="1"></span>
## 工作流变量说明


工作流支持使用变量渲染输出文件名及输出路径。目前已支持的变量如下：

| 变量名称        | 含义                         |
| :-------------- | :--------------------------- |
| InputName       | 输入文件的文件名（不带后缀） |
| InputNameAndExt | 输入文件的文件名（带后缀）   |
| InputPath       | 文件的输入路径               |
| RunId           | 执行实例 ID                  |
| Ext             | 输出文件的格式               |
| Number          | 输出文件的序号               |


#### 示例

假如用户输入文件的文件名是 test1.mp4、test2.mp4，希望转换为 FLV 封装格式（即最终文件名分别为 test1.flv、test2.flv），则输出文件名的参数格式应设置为`${InputName}.${Ext}`。

若输出文件名的参数格式设置为：`${InputNameAndExt}_${RunId}.${Ext}`。

当工作流执行时产生两个执行实例（例如执行实例 ID 分别为000001和000002）时，则最后输出的文件名为 test1.mp4_000001.flv 和 test2.mp4_000002.flv。


