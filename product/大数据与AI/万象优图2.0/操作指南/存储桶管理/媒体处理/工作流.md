## 简介

数据万象支持设置媒体工作流，您可以快速、灵活、按需搭建视频处理流程。每个工作流与输入存储桶的一个路径绑定，当视频文件**上传**至该路径时，该媒体工作流就会被**自动触发**，执行指定的处理操作，并将处理结果自动保存至输出存储桶的指定路径下。在工作流中可以设置**文件转码**任务、**音视频拼接**任务、**视频截帧**任务、 **视频转动图**任务和**智能封面**任务。


>?
>- 工作流目前支持处理 avi、mp4、mkv、flv、hls、ts、mp3、aac、flac 等格式文件，您在发起媒体处理请求时，请务必输入完整的文件名和文件格式，否则无法识别格式和处理。
>- 目前工作流功能仅支持对上传中的视频文件进行操作，若您需要对云上数据进行媒体处理操作，请使用 [任务](https://cloud.tencent.com/document/product/460/46489) 功能。



## 操作步骤

### 创建工作流

1. 登录 [数据万象控制台](https://console.cloud.tencent.com/ci) ，单击左侧导航栏【存储桶管理】，进入存储桶列表。
2. 找到您需要进行视频处理的存储桶，并单击右侧操作栏的【管理】，然后进入相应存储桶管理页面。
3. 单击左侧导航栏的【媒体处理】，然后单击页面上方【工作流】，进入工作流界面。
4. 单击【创建工作流】，进入创建工作流页面。在创建工作流时，您需要设置工作流名称、输入路径、队列和配置工作流节点，配置项说明如下：
   - **工作流名称**：必填项，仅支持中文、英文大小写[A-Z,a-z]、数字[0-9]、下划线(\_)和短横线(-)，长度不能超过128个字符。
   - **输入存储桶**：默认项，即为当前存储桶。
   - **输入路径**：选填项，以`/`开头，以`/`结尾，如果不填写，则对输入存储桶所有路径生效。工作流启用后，当视频文件上传至该路径时，媒体工作流将被自动触发。
   - **队列**：必选项，在开通服务时，系统会自动创建一个用户队列。当用户提交任务后，任务会先进入队列中进行排队，根据优先级和提交顺序依次执行。
     ![](https://main.qcloudimg.com/raw/bc2a0d58f28e070197fb6ea481684a11.png)
   - **配置工作流**：单击输入右侧的“+”可以添加**文件转码**、**音视频拼接**、**视频截帧**、**视频转动图**和**智能封面**节点，每个工作流至少配置一个任务节点。任务节点配置需设置输出存储桶、输出文件名（详情请参见 [工作流变量说明](#1)）和输出路径、选择任务模板。模板的介绍和设置详情请参见 [模板文档](https://cloud.tencent.com/document/product/460/46490)。
 - 文件转码
![](https://main.qcloudimg.com/raw/6f4f61c2eec160c7be618dcf9504e379.png)
 - 视频截帧
   ![](https://main.qcloudimg.com/raw/ff18c20c29b018e1a03c6a23ad3be4a4.png)
 - 视频转动图
   ![](https://main.qcloudimg.com/raw/32bc6162f99f736ac38f1d9fd5f128d1.png)
 - 智能封面
   ![](https://main.qcloudimg.com/raw/4a175f08f29fabd93ae9c36bfdf698c0.png)
	 >?智能封面结合腾讯云先进的 AI 技术，通过对视频内容的理解，智能计算输出3张最优的关键帧。
 - 音视频拼接
 ![](https://main.qcloudimg.com/raw/4ef463321b239418719f59bdd9b88239.png)
5. 以上配置无误后，单击【保存】即可看到刚创建的工作流。工作流默认为未启用状态，单击该工作流对应的状态按钮后，可启用工作流。工作流启用后，将在5分钟内生效。工作流生效后，后续上传的视频文件将自动进行媒体处理操作，处理完成后，将新生成的文件输出到指定文件路径中。
![](https://main.qcloudimg.com/raw/57defa2340dd509463ff1ea632fbf583.png)


### 管理工作流


1. 登录 [数据万象控制台](https://console.cloud.tencent.com/ci) ，单击左侧导航栏【存储桶管理】，进入存储桶列表。
2. 找到您需要进行视频处理的存储桶，并单击右侧操作栏的【管理】，然后进入相应存储桶管理页面。
3. 单击左侧导航栏的【媒体处理】，进入媒体处理页面，单击页面上方【工作流】，进入工作流界面。
4. 工作流列表展示了工作流名称、工作流 ID、输入路径、创建时间以及启用状态等信息。支持按照工作流名称、工作流 ID 搜索以及对指定工作流进行查看详情、编辑和删除操作。
   ![](https://main.qcloudimg.com/raw/791f9de773ec92fb3abbd97a5c17afb1.png)
   - **启用按钮**：启动工作流后，您上传至输入存储桶对应路径下的视频文件将会根据工作流配置自动处理。再次单击该状态按钮，可暂停工作流。暂停工作流后，将不会对上传至对应路径下的视频文件进行自动处理。
   >?工作流默认为未启用状态，单击该工作流对应的状态按钮后，可启用工作流。工作流启用后，将在5分钟内生效。
   - **编辑**：单击操作栏下的【编辑】，进入“工作流编辑”页面，在该页面可以更改工作流配置。
   > !工作流处于启用状态时，无法对其进行编辑和删除操作。
   - **删除**：单击目标工作流操作栏中的【删除】，可删除该工作流。


### 查看执行实例

每个视频文件执行完一遍工作流，就会产生一个执行实例，执行实例页面展示源文件地址、工作流执行状态、执行时间等信息。

1. 单击目标工作流操作栏中的【执行实例】，进入“执行实例”列表页面。
   <img src="https://main.qcloudimg.com/raw/bbcc563815d3758fc36dc68e13ed2106.png" style="zoom:70%;" />
2. 在列表页面中，选择单击目标实例 ID 右侧的【详情】，进入“实例”详情页面。
   ![](https://main.qcloudimg.com/raw/9adfdda6e20fe90c1675a0192bbe4e95.png)
3. 单击任务节点中的详情图标，可查看工作流各节点的任务 ID、执行状态、开始/结束时间等信息。
   ![](https://main.qcloudimg.com/raw/0c2f798838b18d708e00edb66d5c36cb.png)




<span id="1"></span>

## 工作流变量说明


工作流支持使用变量渲染输出文件名及输出路径。目前已支持的变量如下：

| 变量名称         | 含义                         |
| :--------------- | :--------------------------- |
| InputName        | 输入文件的文件名（不带后缀） |
| InputNameAndExit | 输入文件的文件名（带后缀）   |
| InputPath        | 文件的输入路径               |
| RunId            | 执行实例 ID                   |
| Ext              | 输出文件的格式               |
| Number           | 输出文件的序号               |

#### 示例


假如用户输入文件的文件名是 test1.mp4、test2.mp4，希望转换为 FLV 封装格式（即最终文件名分别为 test1.flv、test2.flv），则输出文件名的参数格式应设置为`${InputName}.${Ext}`。

若输出文件名的参数格式设置为：`${InputNameAndExit}_${RunId}.${Ext}`。

当工作流执行时产生两个执行实例（例如执行实例 ID 分别为000001和000002）时，则最后输出的文件名为 test1.mp4_000001.flv 和 test2.mp4_000002.flv。




