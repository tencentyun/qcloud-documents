
## 简介

本文档提供关于数据万象标准处理回调信息解析的SDK示例代码。

## XML回调内容解析

### 功能说明

将万象公共的XML回调信息解析为Java对象。

### 使用示例

本示例用于解析回调数据，可通过获取Unmarshallers来进行xml数据的解析。
> - 可以通过查看COSClient的接口获取到需要使用的xml解析器,也可以查看功能对应的查询接口实现使用的是哪个Unmarshaller。

以文档预览回调信息为例 对应的查询接口为describeDocProcessJob

> [COSClient](https://github.com/tencentyun/cos-java-sdk-v5/blob/master/src/main/java/com/qcloud/cos/COSClient.java)中的代码片段 查看invoke方法中是使用哪个Unmarshaller
```java
@Override
public DocJobResponse describeDocProcessJob(DocJobRequest request) {
    this.checkCIRequestCommon(request);
    CosHttpRequest<DocJobRequest> httpRequest = this.createRequest(request.getBucketName(), "/doc_jobs/" + request.getJobId(), request, HttpMethodName.GET);
    return this.invoke(httpRequest, new Unmarshallers.DescribeDocJobUnmarshaller());
}
```

> 使用Unmarshaller进行解析响应内容 
```java
public static void processCINotifyResponse(String response) throws Exception {
    Unmarshallers.DescribeDocJobUnmarshaller describeDocJobUnmarshaller = new Unmarshallers.DescribeDocJobUnmarshaller();
    InputStream is = new ByteArrayInputStream(response.getBytes());
    DocJobResponse docJobResponse = describeDocJobUnmarshaller.unmarshall(is);
}
```

## Json回调内容解析

### 功能说明

将万象公共的Json回调信息解析为Java对象。

### 使用示例

> - 本质上处理Json回调是将Json转为Xml后再进行处理。
> - demo中使用了org.json将Json转为Xml,并未在SDK的Pom中提供该依赖,需要自行导入。

以图片内容审核回调接口为例，对应的查询接口为describeAuditingImageJob。

> [COSClient](https://github.com/tencentyun/cos-java-sdk-v5/blob/master/src/main/java/com/qcloud/cos/COSClient.java)中的代码片段 查看invoke方法中是使用哪个Unmarshaller。
```java
@Override
public ImageAuditingResponse describeAuditingImageJob(DescribeImageAuditingRequest imageAuditingRequest) {
    rejectNull(imageAuditingRequest.getBucketName(),
            "The bucketName parameter must be specified setting the object tags");
    rejectNull(imageAuditingRequest.getJobId(),
            "The jobId parameter must be specified setting the object tags");
    CosHttpRequest<DescribeImageAuditingRequest> request = createRequest(imageAuditingRequest.getBucketName(), "/image/auditing/" + imageAuditingRequest.getJobId(), imageAuditingRequest, HttpMethodName.GET);
    return invoke(request, new Unmarshallers.ImageAuditingDescribeJobUnmarshaller());
}
```

> 将Json响应转为XML后使用Unmarshaller进行解析响应内容 
```java
//回调demo
public static void processJsonCINotifyResponse(String jsonResponse) throws Exception {
    JSONObject response = new JSONObject(jsonResponse);
    JSONObject json = new JSONObject();
    json.put("Response",response);
    String xml = XML.toString(json);
    Unmarshallers.ImageAuditingDescribeJobUnmarshaller imageJobUnmarshaller = new Unmarshallers.ImageAuditingDescribeJobUnmarshaller();
    InputStream is = new ByteArrayInputStream(xml.getBytes());
    ImageAuditingResponse imageAuditingResponse = imageJobUnmarshaller.unmarshall(is);
}
```

> 上述示例使用的是org.json.json,SDK中并没有提供,如需使用请添加该依赖。
```xml
<dependency>
    <groupId>org.json</groupId>
    <artifactId>json</artifactId>
    <version>20180130</version>
</dependency>
```
