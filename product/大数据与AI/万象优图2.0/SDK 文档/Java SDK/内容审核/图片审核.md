## 简介

本文档提供关于图片审核的 API 概览和 SDK 示例代码。

| API           | 操作描述                 |
| ------------- |  ---------------------- |
| [图片同步审核](https://cloud.tencent.com/document/product/460/37318) |  对对象存储（Cloud Object Storage，COS）存量数据进行涉黄、违法违规以及广告引导类图片的扫描 |
| [图片批量审核](https://cloud.tencent.com/document/product/460/63594) |  对多个图片进行批量审核 |


## 图片同步审核

#### 功能说明

图片审核的存量扫描功能通过借助数据万象的持久化处理接口，实现对 COS 存量数据的涉黄、违法违规以及广告引导类图片的扫描。

#### 方法原型

```java
ImageAuditingResponse imageAuditing(ImageAuditingRequest request);
```


#### 请求示例

```java
//1.创建任务请求对象
ImageAuditingRequest request = new ImageAuditingRequest();
//2.添加请求参数 参数详情请见api接口文档
//2.1设置请求bucket
request.setBucketName("examplebucket-1250000000");
//2.2设置审核类型
request.setDetectType("porn,ads");
//2.3设置bucket中的图片位置
request.setObjectKey("1.png");
//3.调用接口,获取任务响应对象
ImageAuditingResponse response = client.imageAuditing(request);
```


#### 参数说明

Request 中的具体数据描述如下：

| 节点名称（关键字） | 父节点  | 描述                                                     | 类型      | 是否必选 |
| ------------------ | ------- | -------------------------------------------------------- | --------- | ---- |
| bucketName | Request |Bucket 的命名规则为 BucketName-APPID，详情请参见 [存储桶概述](https://cloud.tencent.com/document/product/436/13312) | String |是|
| detectType | Request | 审核的场景类型，有效值：Porn（涉黄）、Ads（广告）等，可以传入多种类型，不同类型以逗号分隔，例如：Porn,Ads。如您有更多场景的审核需要，请使用 bizType 参数。 | String    | 否   |
| objectKey | Request | 图片文件在 bucket 中的位置 | String    | 是   |
| detectUrl | Request | 您可以通过填写`detect-url`审核任意公网可访问的图片链接<li>不填写`detect-url`时，后台会默认审核`ObjectKey`</li><li>填写了`detectUrl`时，后台会审核`detectUrl`链接，无需再填写`ObjectKey`<br>`detectUrl`示例：http://www.example.com/abc.jpg</li> | String | 否       |
| interval   | Request | 审核 GIF 动图时，可使用该参数进行截帧配置，代表截帧的间隔。例如值设为5，则表示从第1帧开始截取，每隔5帧截取一帧，默认值5 | Int    | 否       |
| maxFrames | Request | 针对 GIF 动图审核的最大截帧数量，需大于0。例如值设为5，则表示最大截取5帧，默认值为5 | Int    | 否       |
| largeImageDetect | Request | 对于超过大小限制的图片是否进行压缩后再审核，取值为： 0（不压缩），1（压缩）。默认为0。注：压缩最大支持32MB的图片，且会收取图片压缩费用。对于 GIF 等动态图过大时，压缩时间较长，可能会导致审核超时失败。| Int    | 否       |
| dataid   | Request | 图片标识，该字段在结果中返回原始内容，长度限制为512字节 | Int    | 否       |
| async   | Request | 请求方式参数，有效值： 0（同步返回结果），1（异步进行审核），默认值为0。	 | Int    | 否       |
| callback   | Request | 	回调地址，审核结果（Detail版本）以回调形式发送至您的回调地址，仅在异步审核时生效，支持以 http:// 或者 https:// 开头的地址，例如： http://www.callback.com  | Int    | 否       |


#### 返回结果说明

- 成功：成功则返回 ImageAuditingResponse 实例，内含审核结果内容。
- 失败：发生错误（例如 Bucket 不存在），抛出异常 CosClientException 或者 CosServiceException。详情请参见 [异常处理](https://cloud.tencent.com/document/product/436/35218)。

## 图片批量审核

#### 功能说明

图片批量审核接口为同步请求方式，您可以通过本接口对多个图片文件进行内容审核。该接口属于 POST 请求。

#### 方法原型

```java
BatchImageAuditingResponse batchImageAuditing(BatchImageAuditingRequest request);
```


#### 请求示例

```java
//1.创建任务请求对象
BatchImageAuditingRequest request = new BatchImageAuditingRequest();
//2.添加请求参数 参数详情请见api接口文档
//2.1设置请求bucket
request.setBucketName("examplebucket-1250000000");
//2.2添加请求内容
List<BatchImageAuditingInputObject> inputList = request.getInputList();
BatchImageAuditingInputObject input = new BatchImageAuditingInputObject();
input.setObject("1.jpg");
input.setDataId("DataId");
inputList.add(input);

input = new BatchImageAuditingInputObject();
input.setUrl("https://examplebucket-1250000000.cos.ap-chongqing.myqcloud.com/1.png");
input.setDataId("DataId");
inputList.add(input);

//2.2设置审核类型
request.getConf().setDetectType("all");
//3.调用接口,获取任务响应对象
BatchImageAuditingResponse response = client.batchImageAuditing(request);
List<BatchImageJobDetail> jobList = response.getJobList();
for (BatchImageJobDetail batchImageJobDetail : jobList) {
    List<AuditingInfo> imageInfoList = AuditingResultUtil.getBatchImageInfoList(batchImageJobDetail);
    System.out.println(imageInfoList);
}
```


#### 参数说明

request的数据描述如下：

| 节点名称（关键字） | 父节点 | 描述                       | 类型      | 是否必选 |
| :----------------- | :----- | :------------------------- | :-------- | :--- |
| Request            | 无     | 图片批量审核的具体配置项。 | Container | 是   |

Container 类型 Request 的具体数据描述如下：

| 节点名称（关键字） | 父节点  | 描述                                                | 类型            | 是否必选 |
| :----------------- | :------ | :-------------------------------------------------- | :-------------- | :--- |
| Input              | Request | 需要审核的内容，如有多个图片，请传入多个 Input 结构。 | Container Array | 是   |
| Conf               | Request | 审核规则配置。                                      | Container       | 是   |

Container 类型 Input 的具体数据描述如下，使用其中一种：

| 节点名称（关键字） | 父节点        | 描述                                                         | 类型   | 是否必选 |
| :----------------- | :------------ | :----------------------------------------------------------- | :----- | :--- |
| Object             | Request.Input | 存储在 COS 存储桶中的图片文件名称，例如在目录 test 中的文件 image.jpg，则文件名称为 test/image.jpg。Object 和 Url 只能选择其中一种。 | String | 否   |
| Url                | Request.Input | 图片文件的链接地址，例如 http://examplebucket-1250000000.cos.ap-shanghai.myqcloud.com/image.jpg。Object 和 Url 只能选择其中一种。 | String | 否   |
| Interval           | Request.Input | 截帧频率，GIF 图检测专用，默认值为5，表示从第一帧（包含）开始每隔5帧截取一帧 | Int    | 否   |
| MaxFrames          | Request.Input | 最大截帧数量，GIF 图检测专用，默认值为5，表示只截取 GIF 的5帧图片进行审核，必须大于0 | Int    | 否   |
| DataId             | Request.Input | 图片标识，该字段在结果中返回原始内容，长度限制为512字节      | String | 否   |

Container 类型 Conf 的具体数据描述如下：

| 节点名称（关键字） | 父节点       | 描述                                                         | 类型   | 是否必选 |
| :----------------- | :----------- | :----------------------------------------------------------- | :----- | :--- |
| BizType            | Request.Conf | 审核策略，不填写则使用默认策略。可在控制台进行配置，详情请参见 [设置公共审核策略](https://cloud.tencent.com/document/product/460/56345)。 | String | 否   |
| DetectType         | Request.Conf | 审核的场景类型，有效值：Porn（涉黄）、Ads（广告）等，可以传入多种类型，不同类型以逗号分隔，例如：Porn,Ads。如您有更多场景的审核需要，请使用 BizType 参数。 | String | 否   |


>!
> - 通过 Object 进行审核为内网操作，不会产生额外的外网流量。
> - 通过 Url 进行审核，会产生图片所在源站对应的外网流量。
> 

#### 返回结果说明

- 成功：成功则返回 ImageAuditingResponse 实例，内含审核结果内容。
- 失败：发生错误（例如 Bucket 不存在），抛出异常 CosClientException 或者 CosServiceException。详情请参见 [异常处理](https://cloud.tencent.com/document/product/436/35218)。

