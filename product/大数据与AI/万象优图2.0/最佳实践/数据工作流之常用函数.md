## 概述

对象存储（Cloud Object Storage，COS）工作流提供了一系列针对音视频、图片等媒体文件的处理能力，用户可以按照自身需求，灵活快速地搭建媒体处理流水线。随着越来越多用户接入 COS 工作流，一些定制化需求也被提上议程。为了保障灵活性，COS 工作流推出了自定义云函数功能，支持用户在工作流中配置云函数节点，在云函数中实现定制化逻辑。
为了进一步降低用户的使用门槛，COS 工作流整理了常用的云函数功能模板，并将其创建流程集成至节点的配置步骤中，方便用户对处理前的源文件、处理后的产物文件进行后续加工。现已支持修改对象属性、移动对象，删除对象等基本操作。

## 应用场景

- 在媒体处理后，对源文件进行移动、沉降等处理，降低存储成本。
- 在媒体处理后，对产物文件进行标签设置，修改头部等处理，方便业务使用。

## 方案优势

- 开箱即用：无需开发函数逻辑，无需关注复杂的部署流程，简易配置即可使用。
-  配置灵活：可以按需配置常用功能节点，分别针对源文件和产物文件进行不同的业务操作。
-  拓展方便：支持用户修改云函数逻辑，以满足更多定制化需求。

## 操作步骤

1. 登录 [对象存储控制台](https://console.cloud.tencent.com/cos5)。
2. 在左侧导航栏中，单击**存储桶列表**，进入存储桶列表页面。
3. 单击待操作的存储桶，进入存储桶详情页面。
4. 在左侧导航栏中，选择**数据工作流 > 工作流**，单击**创建工作流**。
5. 在创建工作流页面，配置业务需要的媒体处理节点，例如“音视频转码”节点，详情可参阅 [工作流](https://cloud.tencent.com/document/product/460/46488)。
![](https://qcloudimg.tencent-cloud.cn/raw/657be33bfeeafd549f1698f443417789.png)
6. 在创建工作流页面，添加**自定义函数**节点，选择您需要的常用功能函数。
![](https://qcloudimg.tencent-cloud.cn/raw/61fd324990852f1dc7d2cee40d99a453.png)
如果您尚未创建此类函数，则单击**创建函数**。
![](https://qcloudimg.tencent-cloud.cn/raw/4604984846b2a12738e9c7c08a06e880.png)
创建常用功能函数的步驟如下：
 1. 填写函数基础配置。输入函数名称前缀，勾选**授权SCF服务**，单击**下一步**。
 ![](https://qcloudimg.tencent-cloud.cn/raw/4a851f67a0e0dd2ba18a2910f87297b9.png)
 2. 填写属性配置。按业务需求设置存储类型，自定义头部等，单击**下一步**。
 ![](https://qcloudimg.tencent-cloud.cn/raw/1c05d750af8f78f0ff52c44e28107c6d.png)
 3. 勾选处理对象，可以只针对工作流源文件执行该操作。
 ![](https://qcloudimg.tencent-cloud.cn/raw/e49947b3b44f1b104fce08a1a5e642ff.png)
 4. 单击**确认**。
 5. COS 工作流封装了函数创建，版本发布，别名切流等过程，请等待其创建完成。
 ![](https://qcloudimg.tencent-cloud.cn/raw/f97003f6a59970a33646faf24278a2b3.png)
7. 创建完成后，选中刚刚创建的函数实例，单击**确定**。
 ![](https://qcloudimg.tencent-cloud.cn/raw/4d73d098d7afe4110d8b09ffa71db2d6.png)
8. 单击**保存**当前工作流即可。

## 操作验证

1. 登录 [对象存储控制台](https://console.cloud.tencent.com/cos5)。
2. 在左侧导航栏中，单击**存储桶列表**，进入存储桶列表页面。
3. 单击待操作的存储桶，进入存储桶详情页面。
4. 在左侧导航栏中，选择**数据工作流 > 工作流**，进入工作流管理页面。
5. 找到刚创建的工作流，单击启用，并前往指定存储桶路径上传媒体文件，等待工作流执行。
![](https://qcloudimg.tencent-cloud.cn/raw/dbad5130f4b39506c1cb43cd0a9fa2a9.png)
6. 待工作流运行结束后，即：
可以看到媒体处理成功，产物已生成。
![](https://qcloudimg.tencent-cloud.cn/raw/283c87398b2343003b440e129e7813f7.png)
源文件已成功设置了存储类型和自定义头部。
![](https://qcloudimg.tencent-cloud.cn/raw/ee7571fc2eefe6cdad802ac6ec881521.png)

