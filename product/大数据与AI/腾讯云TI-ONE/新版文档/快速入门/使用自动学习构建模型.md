## 操作背景
- 腾讯 TI 平台 TI-ONE 自动学习模块内置了常见深度学习场景，例如图片分类、目标检测，使用户仅需通过简单的配置即可完成深度学习模型构建、评测、发布等模型生命周期全流程工作。  
- 为了方便您有效地使用腾讯 TI 平台 TI-ONE 的自动学习，本文将通过一个图片分类案例向您演示使用流程。  

## 前提条件
- 完成腾讯云 TI 平台 TI-ONE 服务注册与开通，请参考 [账号和权限说明](https://cloud.tencent.com/document/product/851/74113)。  
- 开通 [对象存储 COS ](https://console.cloud.tencent.com/cos)服务并完成 [存储桶创建](https://cloud.tencent.com/document/product/436/13309)。
- 在数据中心 [上传](https://cloud.tencent.com/document/product/851/74157) 带有标注标签的数据或对数据进行 [标注](https://cloud.tencent.com/document/product/851/74156)。
- 使用后付费类型资源会预先冻结所选配置2个小时的使用费用，若您的现金账户余额不足，请先进行充值。

## 使用自动学习进行图片分类模型训练  
### 步骤1：新建任务  
进入**自动学习 > 立即开始**，选择对应的区域，单击**新建任务**：  
![](https://qcloudimg.tencent-cloud.cn/raw/b7e7bfa7157c7773c10303cdf17d5fe7.png)
 单击后进入**新建任务**页面，用户需在此填写本次任务的任务名称、训练数据、训练输出路径、训练配置及训练资源配置等信息。  
1. 填写**基本信息**：  
	![新建任务-配置任务-填写基本信息](https://qcloudimg.tencent-cloud.cn/raw/0a0f27a3c3e88515db2dd1befd878916.png)   
2. 填写**数据配置**：  
	![新建任务-配置任务-填写数据配置](https://qcloudimg.tencent-cloud.cn/raw/344f9bccaf9b0710a3d15d2224e94311.png)  
	其中：  
	- 是否增量训练：对于首次训练的任务，是否增量训练默认关闭。如果您需要基于某个已有训练任务进行模型的增量更新，可选择将该项开启。  
	- 数据来源：您可选择数据中心中的数据或示例数据。数据中心的数据通常是您自己创建的数据集，示例数据为平台内置数据。  
3. 填写**训练配置**：  
![](https://qcloudimg.tencent-cloud.cn/raw/c413db4583e68a648b0eadbdfdd40707.png)
	其中：  
	- 预训练模型：腾讯TI平台提供腾讯超大规模预训练模型及通用训练模型。其中，推荐优先使用腾讯超大规模预训练模型，其具有训练数据庞大（亿级别数据）、训练起点高、通用性强、对训练数据要求更少、迭代速度快等特点。  
	- 训练偏好设置：可结合您的业务场景设置训练偏好，训练偏好主要用于平衡模型精度及推理速度。  
	- 期望准确率：可结合业务目标设置合理的期望准确率值，到达准确率后会为您自动停止训练。  
	- 最长训练时长：默认为1小时，到达后任务会立即停止。该设置下，模型可能无法达到所需的训练效果，可结合实际情况对该项进行调整。  
  训练参数设置为可选项，自动学习会为您提供默认值。也可结合您的实际情况进行修改，可修改的训练参数包括：  
	- epochs：模型训练次数，可选择系统内置的值或进行自定义。  
	- lr：学习率，可选择系统内置的值或进行自定义。  
	- batch_size：训练批次大小，可选择系统内置的值或进行自定义。  
	- warmup：预热训练次数，可选择系统内置的值或进行自定义。  
	- 模型优化：可通过此功能降低模型的推理时延，支持针对T4及V100两种类型的GPU进行优化。  
4. 填写训练资源配置，可按需选择后付费或预付费训练模式，确认后单击**下一步**。  
![](https://qcloudimg.tencent-cloud.cn/raw/02e556b47e8b006fb3e38a9936bbc65b.png)
单击下一步后，进入**训练模型**页面  
如您在单击下一步后离开**训练模型**页面，可至**任务管理**列表页重新找到该任务。  

### 步骤2：训练模型  
在**训练模型**页，可以查看模型的运行状态及训练详情。页面展示信息如下：  
1. **训练状态**  
![](https://qcloudimg.tencent-cloud.cn/raw/344ac56bb3044b4086fe0d885f36bcde.png)
	- 已运行时长：展示模型训练任务已经运行的时长。 
	- 最长运行时长：为本任务在**配置任务**页所设置的值，本例中为1小时。  
	- 训练进度：展示模型训练任务进度及训练任务当前所处阶段。如果您不再需要本次训练任务，可以单击**停止训练**按钮。如果训练意外中断，可单击**重启训练**按钮。  
	- 优化进度：展示模型优化任务进度，如开启了模型优化功能开关，则模型训练完成后将自动启动模型优化。  
2. **训练详情**  
	- 实时指标：展示模型训练过程中的实时指标，包含横坐标为epoch（模型训练次数）， 纵坐标为具体指标所对应的数值。  
	![训练模型-训练详情-训练实时指标](https://qcloudimg.tencent-cloud.cn/raw/4fdf6bbcf627aa3d6e2ba31e8801fde5.png)  
	- 训练日志：展示模型训练过程中产生的日志详情，支持自动刷新及检索分析。  
	   ![训练模型-训练详情-训练日志](https://qcloudimg.tencent-cloud.cn/raw/589a350dbc450d90351950374c7a02f5.png)  
3. 图片分类训练指标说明：  
	- accuracy：正确预测图片的数量 / 图片总数量。  
	- valid_top1_accuracy：验证集预测结果中，排名第一的类别里面正确预测的准确率。    
	- valid_top5_accuracy：验证集预测结果中，排名前五的类别里面正确预测的准确率。    
	- loss：损失值，代表模型预测与目标之间的距离。    

### 步骤3：模型评测  
模型评测提供基于测试集的模型表现信息。包含模型评测任务基本信息（如评测时长、评测图片数量、badcase 数量），整体指标（可通过定义不同的全局阈值查看模型的精确率、召回率、F1-Score），PR曲线。
1. 查看模型评测的基本信息，包含测试集、评测时长、评测图片数量、badcase 数量等。  
![模型评测-基本信息](https://qcloudimg.tencent-cloud.cn/raw/d0700cae146b25f248b20f4150e7f08f.png)  
	- 如需查看测试数据集，请单击**测试集**对应的**查看**，单击后，可看到测试集的标签分布信息、各类别标签数量及标签占比。由于图片读取会产生 COS 请求及流量费用，因此，默认不展示测试集图片详情。如需展示图片详情，您可打开**详情展示**开关  
	![模型评测-测试集数据预览](https://qcloudimg.tencent-cloud.cn/raw/2bfedfa6d7267d03866422f19c61e335.png)  
	- 单击**详情展示**后，会为您展示测试集中所包含的图片详情信息。您可依次查看，或根据标注类别选择具体的标签进行查看。  
	![模型评测-测试集数据详情](https://qcloudimg.tencent-cloud.cn/raw/790851ae07b683825ec6b7347fb07bf3.png)  
	- 对于模型在测试集上的 badcase，可单击**基本信息**中 **badcase 数量**对应的**查看**，进入到对应的页面进行查看。由于 badcase 访问需要产生对象存储COS的请求和流量费用，因此图片默认是不展示的。请将**预览 badcase 图片**开关打开后查看详情。  
	![模型评测-评测图片badcase](https://qcloudimg.tencent-cloud.cn/raw/5d4ac21ec05eb638c805251b30122a1c.png)  
		可通过筛选正确结果、预测结果对应的标签快速了解模型表现，以便于制定有针对性的模型优化计划。  
2. 查看模型整体指标，包含精确率、召回率、F1-Score。  
	![模型评测-整体指标](https://qcloudimg.tencent-cloud.cn/raw/db6812d333ba920a402152179eec7df5.png)  
	- 全局阈值：默认为80%，可按步长为5进行数值调整。通过调整阈值，可以权衡精确率和召回率，以判断模型是否符合实际业务场景的需求。  
	- 精确率：表示预测结果为正类的样本中，真正的正样本比例。 
	- 召回率：实际图片类别被检测到的比率。    
	- F1-Score：F1-Score 通常用于概括分类模型的性能，它结合了精确率和召回率两个指标。计算公式为： F1 = （2 \* 精确率 \* 召回率）/ (精确率 + 召回率)。
3. 查看模型的PR曲线，横轴表示 Recall（召回率），纵轴表示 Precision（精确率），鼠标 hover 至曲线上可查看每个类别对应的精确率、召回率及阈值。  
	![模型评测-进阶指标-PR 曲线](https://qcloudimg.tencent-cloud.cn/raw/60d7389d41f3b86b1051a7f6b8cc7da1.png)  
4.  在 PR 曲线下方提供每个类别对应的预测结果及指标。可通过调整右侧面板中的**阈值**，查看不同阈值对应的精度、召回率及 F1-Score。同时在左侧表格中，可以单击分类错误的数量查看每个类别下对应的 badcase。  
![模型评测-进阶指标-分类别指标](https://qcloudimg.tencent-cloud.cn/raw/1b7e20e7ccc16f15197b9eac7ad4c82b.png)  

### 步骤4：一键发布  
1. 模型评测结束后，可单击下一步，进入一键发布页面，快速将训练得到的模型部署为在线预测服务。如需发布正式服务，请直接单击**正式发布**前往**在线服务**发布。如需进行服务测试，可填写本页面上的信息：  
![](https://qcloudimg.tencent-cloud.cn/raw/b59d0e7c51b2f6a3a7bc2d10a0cffe5a.png) 
	- 计费模式：可选择后付费或预付费。  
	- 算力规格：按需选择模型部署所需的算力。  
	- 测试图片存储路径：选择 COS 存储桶对应的路径，用于保存服务测试中上传的数据，最多保存30张（超出后会自动删除），您也可以可自行前往COS进行删除。
	- 最长运行时长：为节省资源您可设置最长运行时长，服务将按照设置时长停止。  
	- 单击**服务测试**按钮进行模型发布，如果计费模式选择后付费，则会预先冻结所选配置2个小时的费用，需要保证账户余额能满足您的业务要求。  
2. 单击**服务测试**后，进入到发布页面：  
![一键发布-上传图片进行测试](https://qcloudimg.tencent-cloud.cn/raw/4092f5a69c1b3fcf7ec564edea63d014.png)  
	- 运行状态：显示预测服务当前所处的状态。如您不再需要此服务，可单击**停止**，停止该服务。  
	- 在线预测服务：单击**查看服务**，进入该服务对应的详情页面。包含服务的基本信息、实例列表、监控、事件、日志、更新记录。详情可查看 [在线服务运营](https://cloud.tencent.com/document/product/851/74143)。  
	- 服务测试：服务测试区域，您可单击**点击上传**按钮，上传新的测试图片，查看模型的预测结果。  
>? 如果识别结果显示暂无数据，可通过**调整置信度**，对显示结果进行过滤。  
3. 如需将模型发布为正式服务，请单击页面下方的**正式发布**按钮，如果是首次发布，可选择**发布服务组**；如果是发布服务的新版本，可选择**发布服务版本**。发布服务的相关说明可参考[在线服务部署](https://cloud.tencent.com/document/product/851/74141)
