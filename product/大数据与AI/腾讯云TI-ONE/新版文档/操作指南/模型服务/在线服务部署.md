

在完成模型的训练或自定义镜像的开发后，可以使用模型服务模块部署为在线服务。   

## 前提条件   
已完成模型的训练并导入模型仓库，或者已将自定义的镜像上传至腾讯云容器镜像服务 TCR。

## 操作步骤   
1. 登录 TI-ONE 控制台，在左侧导航栏中选择**模型服务 > 在线服务**，进入在线服务列表页面。  
2. 在服务列表页面单击**新建服务**，进入服务启动页面。  
3. 在服务启动页面，配置在线服务的相关参数。   
![](https://qcloudimg.tencent-cloud.cn/raw/98e83825aba26040c89aa1043adac144.png)
	1. 服务基础信息  
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>服务名称</td>
<td>服务的名称，按照界面提示的规则填写即可</td>
</tr>
<tr>
<td>服务版本</td>
<td>版本号系统自动生成</td>
</tr>
<tr>
<td>服务描述</td>
<td>可按需为服务配置描述信息</td>
</tr>
<tr>
<td>地域</td>
<td>同账号下的服务按地域进行隔离，地域字段取值根据您在服务列表页面所选择的地域自动带入</td>
</tr>
<tr>
<td>计费模式</td>
<td>可选择预付费模式或后付费模式。（A）预付费模式下，可使用在资源组管理模块已购买的推理资源组部署服务，算力费用在购买资源组时已支付，启动服务时无需扣费。（B）后付费模式下，用户无需预先购买推理资源组，根据服务依赖的算力规格，启动服务时冻结两小时费用，之后每小时根据运行中的实例数量按量扣费。（C）预付费+后付费模式下，则需要为预付费算力、后付费算力分别设置服务实例数量。该计费模式下，后付费实例数支持根据时间策略进行自动调节，从而实现稳定的业务负载通过预付费算力支撑，不稳定的业务负载通过后付费算力支撑，业务负载高峰过后，后付费算力占用可以缩容到0，从而实现更低成本的算力资源使用策略。</td>
</tr>
<tr>
<td>资源组</td>
<td>若选择预付费模式或者预付费+后付费模式，可选择资源组管理模块的推理资源组</td>
</tr>
</tbody></table>
	2. 实例容器信息    
![](https://qcloudimg.tencent-cloud.cn/raw/a2e8a4ea825687f8dd0124da86c4e334.png)  
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>是否使用模型文件</td>
<td>可选择启动服务是否需要使用模型文件。<br>（A）不使用模型文件适用于，部署服务所需的自定义镜像已封装模型文件，不需要再进行模型文件挂载，且自定义镜像已上传至容器镜像服务 TCR 的场景。<br>（B）使用模型文件适用于，部署服务所需的模型文件已导入至模型仓库的场景。</td>
</tr>
<tr>
<td>运行环境</td>
<td>（A）若不使用模型文件，则运行环境可以选择已上传至容器镜像服务 TCR 的自定义镜像。<br>（B）若使用模型文件，则运行环境会根据模型仓库的配置信息自动赋值。<br>如需使用自定义镜像启动服务，镜像文件大小建议不超过34G。</td>
</tr>
<tr>
<td>存储挂载</td>
<td>模型服务支持外挂CFS文件系统作为该服务的存储空间：后付费模式下本地磁盘默认支持的模型包总大小约45G，预付费模式下模型包会存储在资源组节点挂载的磁盘上（资源组单节点磁盘总大小约110G）,当您的模型包大小超过限制时，需要另外配置CFS文件系统，平台会自动使用CFS文件系统存储模型；当服务停止或者服务更新时，平台会默认帮用户清理该CFS源路径下的文件，请确保该路径下无其他数据</td>
</tr>
<tr>
<td>模型热更新</td>
<td>当配置了模型自动热更新后，模型服务会自动同步模型文件至服务本地磁盘，后付费模式下本地磁盘默认支持的模型包总大小约45G，预付费模式下模型包会存储在资源组节点挂载的磁盘上（资源组单节点磁盘总大小约110G）请合理配置模型清理周期。<br>当前版本仅支持推理镜像为tfserving的模型进行热更新；此外，由于模型热更新会持续下载模型到服务本地盘，因此需要该模型包配置了模型自动清理策略，或者模型服务外挂了CFS文件系统，才可以启动模型热更新。</td>
</tr>
<tr>
<td>资源申请/算力规格</td>
<td>（A）预付费模式下，可设置从所选资源组中申请多少资源用于启动当前服务。<br>（B）后付费模式下，可按需选择启动当前服务所需的算力规格。</td>
</tr>
<tr>
<td>环境变量</td>
<td>支持配置容器的环境变量，选填。</td>
</tr>
</tbody></table>
	3. 服务高级配置    
![](https://qcloudimg.tencent-cloud.cn/raw/1e8c4dada196fee4ff1ffa040c2e8203.png)  
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>实例调节</td>
<td>（A）手动调节模式下，可以自定义设置服务的实例数量，实例数量最小为1。（B）自动调节模式下，可以选择基于时间或者给予HPA的调节策略，该部分详细说明请查看【在线服务运营】-【自动扩缩容】。</td>
</tr>
<tr>
<td>是否生成鉴权</td>
<td>若开启，则服务调用时会进行签名认证，已启动的服务可在服务调用页面查看签名密钥及签名计算指引。</td>
</tr>
<tr>
<td>CLS日志投递</td>
<td>平台为用户提供免费的近7日服务日志存储，若需要持久化日志存储以及更灵活的日志检索能力，可开启CLS日志投递，开启后服务日志会根据日志集与日志主题投递至腾讯云日志服务CLS。</td>
</tr>
<tr>
<td>请求限流</td>
<td>支持配置服务限流值：1.该限流值为单个副本的限流，当服务进行扩缩容时，服务整体限流值将按照 设置的值*副本数 进行更新；2.单个服务组最大的QPS为500，当服务组下设置的服务总限流值大于500时，按照500进行限流。</td>
</tr>
<tr>
<td>自动停止</td>
<td>平台支持自动停止模型服务，当开启该开关后，在线服务将在指定的停止时间自动停止，同时停止服务算力计费。</td>
</tr>
<tr>
<td>标签</td>
<td>支持为服务添加标签，用于按照标签进行授权或出账。</td>
</tr>
</tbody></table>
4. 确认服务配置信息无误后，单击**启动服务**进行服务部署。  
服务部署过程中将为您创建网关并调度计算资源，需要等待一段时间，待服务成功完成部署时，服务状态将变为**运行中**。    
