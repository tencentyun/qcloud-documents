

面向不定时批量数据处理的业务场景，平台提供批量预测的模块能力，用于支撑算力资源按需使用，批量数据处理完成后推理算力自动释放的场景诉求。


## 前提条件
- 已完成模型的训练并导入模型仓库，或者已将自定义推理镜像上传至腾讯云容器镜像服务 TCR；
- 已完成需要批量预测的数据准备，并上传至腾讯云对象存储 COS；
- 已在对象存储 COS 中创建好文件夹，用于存储批量预测的推理结果文件。

## 创建预测任务
1. 登录 TI-ONE 控制台，在左侧导航栏中选择**模型服务** > **批量预测**，进入批量预测任务页面。
2. 在任务列表页面单击**新建任务**，进入任务创建页面。
3. 在任务创建页面，配置批量预测任务的相关参数。
	1. 任务基础信息
![](https://qcloudimg.tencent-cloud.cn/raw/c584884cd399e4f957609db9212bbf26.png)
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>任务名称</td>
<td>预测任务的名称，按照界面提示的规则填写即可</td>
</tr>
<tr>
<td>任务描述</td>
<td>可按需为预测任务配置描述信息</td>
</tr>
<tr>
<td>地域</td>
<td>同账号下的预测任务按地域进行隔离，地域字段取值根据您在任务列表页面所选择的地域自动带入</td>
</tr>
<tr>
<td>计费模式</td>
<td>可选择预付费模式或后付费模式。（A）预付费模式下，可使用在资源组管理模块已购买的推理资源组部署任务，算力费用在购买资源组时已支付，创建任务时无需扣费。（B）后付费模式下，用户无需预先购买推理资源组，根据任务依赖的算力规格，创建任务时冻结两小时费用，之后每小时根据运行中的实例数量按量扣费。</td>
</tr>
<tr>
<td>资源组</td>
<td>若选择预付费模式，可选择资源组管理模块的推理资源组</td>
</tr>
</tbody></table>
	2. 实例容器信息
![](https://qcloudimg.tencent-cloud.cn/raw/9dd4353e92eb4bab6579abb605a56b6c.png)
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>是否使用模型文件    </td>
<td>可选择创建任务是否需要使用模型文件。</br>（A）不使用模型文件适用于，预测任务所需的自定义镜像已封装模型文件，不需要再进行模型文件挂载，且自定义镜像已上传至容器镜像服务 TCR 的场景。<br>（B）使用模型文件适用于，预测任务所需的模型文件已导入至模型仓库的场景。<br>如需使用模型文件创建任务，模型文件大小建议不超过16G。</td>
</tr>
<tr>
<td>运行环境</td>
<td>（A）若不使用模型文件，则运行环境可以选择已上传至容器镜像服务 TCR 的自定义镜像。<br>（B）若使用模型文件，则运行环境会根据模型仓库的配置信息自动赋值。<br>如需使用自定义镜像创建任务，镜像文件大小建议不超过34G。</td>
</tr>
<tr>
<td>代码包</td>
<td>使用模型文件场景下，若配置代码包则优先执行相关脚本进行跑批预测，若未配置则执行模型包中的 model_service.py 推理脚本进行预测</td>
</tr>
<tr>
<td>启动命令</td>
<td>（A）若不使用模型文件，代码包放置路径建议为/opt/ml/code，启动命令默认为sh /opt/ml/code/start.sh，若代码包使用其他路径，需要自定义启动命令<br>（B）若使用模型文件，则默认入口为start.sh，若需要自定义启动命令，则可按需填写，填写后会通过自定义启动命令启动</td>
</tr>
<tr>
<td>资源申请/算力规格</td>
<td>（A）预付费模式下，可设置从所选资源组中申请多少资源用于当前任务。<br>（B）后付费模式下，可按需选择当前任务所需的算力规格。</td>
</tr>
</tbody></table>
	3. 数据路径配置
![](https://qcloudimg.tencent-cloud.cn/raw/c744455a208d27b6cdd2e420b8cbda63.png)
![](https://qcloudimg.tencent-cloud.cn/raw/eaa229958191ae4683ddc36c4edf303a.png)
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>输入数据路径</td>
<td>即批量预测任务待处理数据的存储路径，可选择对象存储 COS 或者 Wedata(HDFS)；当选择COS时，需要选择存储桶中的文件夹或文件；当选择Wedata(HDFS)时，需要下拉选择数据源，填写源路径（输入数据会默认挂载到 /opt/ml/input/data 下作为预测数据目录，您的代码中需要使用该路径以获取数据）</td>
</tr>
<tr>
<td>输出数据路径</td>
<td>即批量预测任务将预测结果文件写入的目标路径，可选择对象存储 COS 或者 Wedata(HDFS)；当选择COS时，需要选择存储桶中的文件夹或文件；当选择Wedata(HDFS)时，需要下拉选择数据源，填写源路径（输入数据会默认挂载到 /opt/ml/output 下作为预测数据目录，您的代码中需要使用该路径以获取数据）</td>
</tr>
</tbody></table>
	4. 任务高级配置
![](https://qcloudimg.tencent-cloud.cn/raw/957990a9f778833c43de5a407edbae72.png)
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>CLS 日志投递</td>
<td>平台为用户提供免费的近7日任务日志存储，若需要持久化日志存储以及更灵活的日志检索能力，可开启 CLS 日志投递，开启后任务日志会根据日志集与日志主题投递至腾讯云日志服务 CLS。</td>
</tr>
<tr>
<td>标签</td>
<td>支持为任务添加标签，用于按照标签进行授权或出账。</td>
</tr>
</tbody></table>
4. 确认预测任务配置信息无误后，单击**保存**进行任务创建。
任务启动过程中将为您调度算力资源，需要等待一段时间，启动成功后任务自动进入**运行中**状态，为您进行批量数据的预测处理，处理完成后任务状态将变为**已完成**。



## 查看预测结果
批量预测任务为**已完成**状态时，可查看批量预测任务的运行结果。
1. 在批量预测任务页面页面点击任务名称，进入任务基本信息页面查看输出数据路径；
2. 前往 [对象存储 COS 控制台](https://console.cloud.tencent.com/cos)，在预测任务已关联的输出数据路径下，查看预测任务的结果文件，可在 COS 控制台进行预览或下载操作。
![](https://qcloudimg.tencent-cloud.cn/raw/27fbf5b18c6e0e569d24fe1e7c0a2d41.png)
