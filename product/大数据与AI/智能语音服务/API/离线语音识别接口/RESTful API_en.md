## Request Structure
### Request Structure of RESTful API
The request structure of RESTful API for offline speech recognition is as follows:

| Parameter Name | Required | Type | Description | 
| ------------- | ---------- | ------------- | ---------- |
| Version | Yes | String | HTTPS protocol version | 
| URL | Yes | String | HTTPS request address | 
| Https Headers | Yes | Dataset | HTTPS request header | 
| Https Method | Yes | String | HTTPS request method. The HTTPS request method for offline speech recognition is POST.
| Https Body | Yes | String | HTTPS request body, i.e. voice data. Enter a value when source_type is 1. Its maximum size is 5M. | 

The URL structure is as follows:
```
https://aai.qcloud.com/asr/v1/appid?
projectid=xxx&
sub_service_type=x&
engine_model_type=x&
callback_url=xxx&
res_text_format=x&
res_type=x&
source_type=x&
url=xxx&
secretid=xxx&
timestamp=xxx&
expired=xxx&
nonce=xxx
```

The description of the fields in the URL is as follows (the value of each field needs to be URL-encoded):

| Field | Required | Type | Description | 
| ------------- | ---------- | ------------- | ---------- |
| APPID | Yes | Uint | Tencent Cloud application ID | 
| projectid | No | Uint | Tencent Cloud project ID. If the field is left empty (0), the default project is used. The ID should not exceed 1,024 bytes. | 
| sub_service_type | Yes | Uint | Subservice type. 0: Offline speech recognition; 1: Streaming speech recognition. | 
| engine_model_type | Yes | String | Engine type. 8k_0:  phone 8k universal model; 16k_0: 16k universal model | 
| callback_url | Yes | String | Callback URL, the result received by the user, with a length between 0 and 2048. |
| channel_num | No | Unit | The number of speech channels. 1 and 2 are supported for phone 8k universal model, and only 1 is supported for other models. |
| res_text_format | Yes | Uint | The method by which the recognized result text is encoded. 0: UTF-8; 1: GB2312; 2: GBK; 3: BIG5 |
| res_type | No | Uint | The method by which the result is returned. 0: Synchronous return; 1: Asynchronous return. Only asynchronous return is supported. |
| source_type | Yes | Uint | Voice data source. 0: Voice URL; 1: Voice Data (post body) |
| url | No | String | Voice URL, which can be downloaded on public network. This field must be filled in if source_type is 0, and can be left empty if source_type is 1. The length of the URL is between 0 and 2048. |
| secretid | Yes | String | The official website secretId |
| timestamp | Yes | Uint | Current timestamp (in sec). It is a value that aligns with the UNIX Epoch timestamp specifications. | 
| expired | Yes | Uint | Validity period of the signature (in sec). It is a value that aligns with the UNIX Epoch timestamp specifications. "expired" must be greater than "timestamp" and the interval between "expired" and "timestamp" must be less than 90 days. |
| nonce | Yes | Uint | Random positive integer with a maximum length of 10 digits. It needs to be generated by users. |

The structure of HTTPS Headers is as follows:

| Parameter Name | Required | Type | Description | 
| -------- | ------ | ------- | ------ |
| Host | Yes | String | Speech recognition service domain name. It is always ``aai.qcloud.com ``. | 
| Authorization | Yes | String | A valid signature of the user for authentication. It corresponds to the signature string obtained in signature authentication. | 
| Content-Type | Yes | String | application/octet-stream | 
| Content-Length | Yes | Int | The request length in bytes. Here it is refers to the number of bytes of voice data. | 

### Request Example

In the following example, <arrow brackets> enclose the variable that must be replaced with a valid value. If source_type = 0, URL voice data can be accessed on the public network. The request Host and path are as follows:
```
http://aai.qcloud.com/asr/v1/<appid>
```
Request Parameters: 
```
{
"projectid":0,
"sub_service_type":0,
"engine_model_type":"16k_0",
"url":"http://test.qq.com/rec_callback",
"res_text_format":0,
"res_type":1,
"callback_url":"http://test.qq.com/rec_callback",
"source_type":0,
"secretid":"AKIDUfLUEUigQiXqm7CVSspKJnuaiIKtxqAv",
"timestamp":1473752207,
"expired":1473752807,
"nonce":"44925",
}
```
Taking `< appid > = 200001, < SecretKey >=bLcPnl88WU30VY57ipRhSePfPdOfSruK` as an example, the combined original signature text is:
```
POSTaai.qcloud.com/asr/v1/2000001?callback_url=http://test.qq.com/rec_callback&engine_model_type=1&expired=1473752807&nonce=44925&projectid=0&res_text_format=0&res_type=1&secretid=AKIDUfLUEUigQiXqm7CVSspKJnuaiIKtxqAv&source_type=0&sub_service_type=0&timestamp=1473752207&url=http://test.qq.com/voice_url
```
Encrypt the original signature:
```
Base64Encode(HmacSha1(original signature, SecretKey))
```
The result signature string is as follows:
```
UyKZ+Q4xMbdu3gxOmPD7tgnAm1A=
```
Request headers:
```
{
"Content-Type":"application/octet-stream",
"Authorization":"UyKZ+Q4xMbdu3gxOmPD7tgnAm1A="
}
```

The speech recognition API is as follows:
```
http://aai.qcloud.com/asr/v1/<appid>?engine_model_type=0
&expired=1473752807
&nonce=44925
&projectid=0
&res_text_format=0
&res_type=1
&secretid=<secretid>
&source_type=0
&sub_service_type=0
&timestamp=1473752207
&url=<url>
```

## Structure of Returned Value

### Returned Result from RESTful API
The returned results from RESTful API for offline speech recognition are shown in the following table:

| Name | Type | Description | 
| ------------- | ---------- | ------------- | 
| code | Int | Server error code. 0: successful |
| message | String | Message returned by server |
| requestId | Int | Task ID is returned if successful |

### Example of Returned Result
 An example of the returned message is as follows:
```
 {
 "code":0, 
 "message":"success",
 "requestId":500
 }
```

## Error Codes

Error codes are as follows:

| Value | Error Code | Description |
|---------|---------|---------|
| 0 | SUCCESS | Successful |
| 1000 | ERROR_BAD_REQ | Request parameters do not meet the requirements |
| 1001 | ERROR_PARSE_DATA_FAILED | Failed to parse request parameters |
| 1002 | ERROR_HAS_NO_VALID_PROJECTID | No/invalid projectid |
| 1003 | ERROR_HAS_NO_VALID_RES_TEXT_FORMAT | No/invalid res_text_format |
| 1004 | ERROR_HAS_NO_VALID_SUB_SERVICE_TYPE | No/invalid sub_service_type |
| 1005 | ERROR_HAS_NO_VALID_ENGINE_MODEL_TYPE | No/invalid engine_model_type |
| 1006 | ERROR_HAS_NO_VALID_CALLBACK_URL | No/invalid callback_url |
| 1007 | ERROR_HAS_NO_VALID_RES_TYPE | No/invalid res_type |
| 1008 | ERROR_HAS_NO_VALID_SOURCE_TYPE | No/invalid source_type |
| 1009 | ERROR_HAS_NO_VALID_URL | No/invalid url for voice download |
| 1010 | ERROR_HAS_NO_VALID_SECRET_ID | No/invalid SecretId |
| 1011 | ERROR_HAS_NO_VALID_TIMESTAMP | No/invalid timestamp |
| 1012 | ERROR_HAS_NO_VALID_EXPIRED | No/invalid "expired" |
| 1013 | ERROR_HAS_NO_VALID_NONCE | No/invalid nonce |
| 1016 | ERROR_URL_TOO_LONG | The length of url exceeds 2048 |
| 1018 | ERROR_APPID_NOT_REG | Unregistered APPID |
| 1014 | ERROR_HAS_NO_VALID_TEMPLATENAME | Invalid template_name |
| 1016 | ERROR_URL_TOO_LONG | The length of url exceeds 2048 |
| 1018 | ERROR_APPID_NOT_REGI | Unregistered APPID |
| 1019 | ERROR_APPID_PROJECTID_TEMPLATENAME_MISMATCH | The APPID and ProjectId do not match template_name |
| 1020 | ERROR_PROCESS_FAILED | Internal error on the server |
| 1021 | ERROR_PROXY_BAD_AUTH | Signature does not meet rules |
| 1023 | ERROR_PROXY_AUTH_TOO_LONG_EXPIRED | Too long signature validity period |
| 1024 | ERROR_PROXY_AUTH_EXPIRED | Expired signature |
| 1026 | ERROR_PROXY_AUTH_SECRETID_NOEXIST | Signature secretId error |
| 1028 | ERROR_PROXY_AUTH_REPLAY_ATTACK | Replay attack |
| 1029 | ERROR_PROXY_AUTH_FAILED | Failed to pass signature verification |
| 1031 | ERROR_AUDIO_TOO_LARGE | Too large voice data (more than 5 MB) |
| 1033 | ERROR_UNKNOWN | Other unknown errors |

## PHP Sample Code

```php
<?php
$appid = YOUR_APPID ;
// https://console.cloud.tencent.com/capi
// Obtain SecretID and SecretKey of APPID from this page
$secretid ='YOUR_SECRET_ID';
$secretkey = 'YOUR_SECRET_KEY';

$req_url = 'aai.qcloud.com/asr/v1/'.$appid;

$args = array(
    'channel_num' => 1,
    'secretid' => $secretid,
    'engine_model_type' => 1,
    'timestamp' => time(),
    'expired' => time() + 3600,
    'nonce' => rand(100000, 200000),
    'projectid' => 0,
    'callback_url' => "http://aai.qcloud.com/cb",
    'res_text_format' => 0,
    'res_type' => 1,
    'source_type' => 0,
    'sub_service_type' => 0,
    'url' => "http://aai.qcloud.com/test.mp3",
);

// Sort the parameters alphabetically by Key
ksort($args);

$arg_str = "";
foreach($args as $k => $v) {
    $arg_str = $arg_str . "$k=$v&";
}
$arg_str = trim($arg_str, "&");

// Combine the signature strings
$sig_str = "POST$req_url?$arg_str";
echo "sig_str: $sig_str\n";

// Calculate the signature
$signature = base64_encode(hash_hmac("sha1", $sig_str, $secretkey, TRUE));
echo "signature: $signature\n";

$req_url = "https://$req_url?$arg_str";
echo "curl -sv -H 'Authorization:$signature' '$req_url' -d ''\n";

```
> **Note:**
> If a php script is embedded into an html page, &times may be translated as x, and a 404 error will be returned. This problem will not occur in pure php codes. To solve this problem, replace & with &amp; (with the semicolon) in PHP codes.

