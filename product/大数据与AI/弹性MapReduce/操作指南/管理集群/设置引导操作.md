## 功能介绍
引导脚本操作是在生产集群的过程中执行自定义脚本，以便您修改集群环境、安装第三方软件和使用自有数据，引导操作会在集群创建（含扩容）和集群销毁（含缩容）时运行引导脚本（router 节点除外）。
目前控制台只支持集群创建和销毁集群时指定引导操作，您可使用 API 扩缩容时指定引导操作，如未指定，扩容时将默认执行创建时指定的引导操作；缩容时将默认执行销毁集群时指定的引导操作。
1. 集群创建（含扩容）时指定的引导操作支持在如下三个时机执行：
	a. 主机初始化后：在机器资源初始化之后和安装EMR集群软件之前。
	b. 集群启动前：在集群服务启动之前。
	c. 集群启动后：在集群服务启动之后。
![](https://qcloudimg.tencent-cloud.cn/raw/473451cec873ce9b1c5f4dee78874a50.png)
2. 集群销毁（含缩容）时指定的引导操作支持在如下1个时机执行：
	a. 服务下线前：在集群服务下线前。
![](https://qcloudimg.tencent-cloud.cn/raw/18422889eacab79dbc5af992c5a743cc.png)
引导操作会在集群创建和集群扩容时运行引导脚本，引导脚本按照脚本添加的顺序依次执行，引导操作累计不超过16个。

>! 先创建按量付费的小集群测试引导操作是否成功，测试成功后再创建正式集群。


## 操作步骤
**方法一：在 [购买页](https://buy.cloud.tencent.com/emr) 创建集群时添加引导操作。**
1. 选择**基础配置 > 高级设置 > 添加引导操作**，即可添加引导操作。
![](https://qcloudimg.tencent-cloud.cn/raw/b4f88fcf018eec6090273f67931cabd4.png)
2. 添加引导操作完成支持编辑与删除操作。
![](https://qcloudimg.tencent-cloud.cn/raw/b1bef37d3ce15d28b891ac99f66f3251.png)
 - 选择运行时机，并填写相关参数。
 - 名称：建议与您的“对象名称”保持一致。
 - 脚本位置：建议从 COS 详情页进行复制。进入 [COS 存储桶列表](https://console.cloud.tencent.com/cos/bucket)，单击**存储桶名称**，进入存储桶详情页，选择您需要的脚本，然后在操作项中选择**详情**。
![](https://qcloudimg.tencent-cloud.cn/raw/6153275ce039c5449c9cfd532e1b7f11.png)
在详情页，即可看到“对象名称”和“对象地址”。
![](https://qcloudimg.tencent-cloud.cn/raw/c8c6b3cb815c24273e869fc7f44cb04a.png)
 - 参数：执行脚本的参数。不同的参数以空格分割，参数中不能有空格，“参数”和“脚本名”之和小于240个字符。

**方法二：在集群基本信息页添加引导操作**
1. 登录 [EMR 控制台](https://console.cloud.tencent.com/emr)，在集群列表中单击对应的集群 **ID/名称**进入集群详情页。然后选择**基本信息 > 引导操作**，单击**添加引导操作**，即可添加引导操作。
2. 添加引导操作完成支持编辑与删除操作。选择运行时机，并填写相关参数。
 - 名称：建议与您的“对象名称”保持一致。
 - 脚本位置：建议从 COS 详情页进行复制。进入 [COS 控制台](https://console.cloud.tencent.com/cos5)，单击**存储桶列表**，选择您需要的脚本，然后在操作项中选择**详情**。
![](https://qcloudimg.tencent-cloud.cn/raw/131e50601131c2f367ecc2d93a277632.png)
![](https://qcloudimg.tencent-cloud.cn/raw/6842d450d9c1fd5c3d3fb38ad7693fd8.png)
 - 参数：执行脚本的参数。不同的参数以空格分割，参数中不能有空格，“参数”和“脚本名”之和小于240个字符。

## 查看引导结果
目前控制台不支持扩容时指定引导操作，扩容时默认执行创建时指定的引导操作。您可以使用 API 扩容指定引导操作。如果扩容时指定了引导操作，则执行您指定的引导操作；若未指定，则执行创建时候的引导操作。
1. 在脚本的系统日志中查看引导结果。
	- 日志和执行的脚本文件保存都放到 /usr/local/service/scripts/ 这目录下，脚本的系统日志是 script_syslog。命名规则为：“执行顺序” + “_” +“运行时机”+ “脚本名”+“_”+stderr。
	- 命名规则为：“执行顺序” + “_” + “运行时机”+“脚本名”+“_”+stdout。
>! 
>- i.所有的节点类型都会执行，同时在每个节点上保存脚本文件和执行脚本的输出 log 文件。。
>- 引导脚本内容需使用 utf8 编码。

2. 在任务中心查看引导结果
登录 [EMR 控制台](https://console.cloud.tencent.com/emr)，单击左侧菜单栏**任务中心**或进入单个集群单击右上角**任务**，选择对应流程（创建集群、扩容、节点初始化），在**任务详情**的初始化服务操作步骤中可单击**运行详情**查看引导结果。
