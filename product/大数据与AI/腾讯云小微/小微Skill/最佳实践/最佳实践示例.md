## 了解自定义技能
### 自定义技能的组成部分
在设计和构建自定义技能时，您将创建以下内容：

* 一组意图，表示用户可以用您的技能执行的操作。这些意图代表了您的技能的核心功能。
* 一组示例语句，用于指定用户可以说的单词和短语来调用这些意图。您将这些话语映射到您的意图。该映射形成技能的交互模型。
* 用于进入技能的调用名称。用户通过一个包含您技能调用名称的特定句式，来发起该技能内的对话。
* 开发一个基于云的服务，处理已经结构化的意图，然后对其进行操作。此服务必须能通过 Internet 访问。在配置技能时，需要您为您的服务提供调用地址。
* 将所有上述内容组合在一起的配置，以便腾讯云小微可以根据您的技能将请求路由到服务。您可以在开发人员门户中创建此配置。
例如，一个帮助用户查询彩票信息的技能可能会定义意图 QueryNumber，用来查询开奖号码。

这个意图将映射到几个示例语句，例如：
```
 QueryNumber {lotteryName}的开奖号码
  QueryNumber {date}的开奖号码是？
  QueryNumber {date}{lotteryName}的开奖号码
  QueryNumber 查询{date}{lotteryName}的开奖号码
  QueryNumber 告诉我{date}{lotteryName}的开奖号码
  QueryNumber 告诉我{latestIssue}{lotteryName}的开奖号码
  ......
 （更多的例句话）
```

用户会说：
> 用户：小微，问问 **彩票** *昨天双色球的开奖号码*

（在此示例中，斜体字部分是您定义的样本话语，而调用名称以粗体显示）。

当用户向接入腾讯云小微的设备说话，会发生以下这些事情：
1. 用户的话语将流式传输到腾讯云小微服务。
2. 腾讯云小微识别出这个请求代表了“彩票”技能的 QueryNumber 意图。
3. 腾讯云小微将此信息构建成一个请求（特别是本例中的 IntentRequest），并将此请求发送给为“彩票”定义的服务。请求中包含值为“昨天”、名称为“date”以及值为“双色球”、名称为“lotteryName”的槽位。
4. “彩票”服务处理该请求。
5. “彩票”服务发送具有与用户通话的文本的结构化响应到腾讯云小微服务。
6. 接入腾讯云小微服务的设备会向用户发出回复：

> 彩票：昨天的双色球开奖号码是：07 12 13 20 24 31 05。

### 开始一个技能会话

自定义技能通常从用户那里得到一个问题或其他信息，然后回答一个答案或一些动作，例如订购汽车或比萨饼。用户可以通过使用您的调用名称与由腾讯云小微定义的示例语句和短语相结合来调用您的技能：

* 小微，**问问**彩票*昨天双色球的开奖号码*
* 小微，**咨询一下**彩票*昨天双色球的开奖号码*
* 小微，**帮忙问问**彩票*昨天双色球的开奖号码* **好吗**
* 小微，**用**彩票*查询昨天双色球的开奖号码*

用户还可以开始与技能进行交互，而不提供任何特定的问题或请求：

* 小微，**打开**彩票
* 小微，**给老子打开**彩票
* 小微，**开启**彩票
* 小微，**进入**彩票

如果用户不知道或不清楚他们想要的确切请求，用户可以使用此选项。在这种情况下，技能通常会返回欢迎消息，为用户提供有关如何使用技能的简短帮助。
在上述例子中，粗体字由腾讯云小微服务定义，而斜体字是为技能定义的抽样话语。
如果您的技能需要更多信息来完成请求，则可以与用户进行有上下文的对话：
```
用户：小微，今天的开奖号码是？
```
（虽然该语句能映射到 QueryNumber 这个意图，但用户没有指定彩票的彩种，而彩票中奖号码需要收集这些信息才能继续。）
彩票：您需要查询哪个彩种？
（腾讯云小微现在正在收听用户的响应，对于具有灯光的设备，设备可以亮灯以提供视觉提示）
用户：双色球
彩票：今天的双色球的开奖号码是...
（交互结束）


### 为您的技能提供视觉组件

腾讯云小微应用程序是可用于 Android，iOS 的免费配套应用程序。 此应用程序与您的自定义技能有两种相关：
- 该应用程序显示所有已发布技能的技能细节卡。用户可以在决定是否启用您的技能时，查看这些卡片，了解您的技能以及使用方法。技能准备发布时需要提供这些有用信息。
- 该应用程序显示 Feeds 卡片消息。用户可以稍后查看这些卡片消息，以获取有关交互的更多信息。

您的技能可以在您的回复中包含这些卡片消息的内容。
例如，“彩票”技能发送包含用户要求的开奖号码信息的卡片消息。卡片消息给用户一种查看开奖号码信息的方式，而无需再发出一次语音请求。

### 将您的技能托管与云服务之上

您可以编写一个 Web 服务，并与任何云托管提供商进行托管。Web 服务必须通过 HTTPS 接受请求。 在这种情况下，腾讯云小微会将请求发送到您的 Web 服务，您的服务将采取任何必要的操作，然后发送回应。 您可以使用任何语言编写您的 Web 服务。

## 建立自定义技能的步骤
### 步骤 1：设计语音用户界面

为您的技能设计一个有效的语音用户界面是编写任何代码之前应该做的关键的第一步。 这是用户与您的技能交互的主要方式。

1. 创建流程图，描述用户如何与技能交互。此流程图应显示用户将要做出的请求以及这些请求的可能结果。 在设计界面的详细元素时，可以使用该图。
2. 使用流程图来识别您的技能将处理的用户请求。进而归纳出一批用户意图。

### 步骤2：在开发者门户中设置技能
在开发者门户中创建一个新的自定义技能。此时，您可以为您的新技能输入名称和调用词。

### 步骤3：使用语音设计来构建交互模型
交互模型是指您收集的意图，样本语句和对话模型：

* 您的技能可以处理的请求表示为*意图*。
* 意图可以可选地具有被称为*槽位*的参数。
* *示例语句*将意图映射到用户可以说的与您的技能交互的单词和短语。
* *对话模型*识别您的技能要求的信息，以及腾讯云小微可以在与用户的对话中收集和确认该信息的提示。

### 步骤4：编写和测试您的技能代码

您的技能的主要编码任务是创建一个可以接受来自腾讯云小微服务的请求并发回响应的服务。

* 您可以为您的技能构建 Web 服务，并与任何云提供商进行托管
* 编写代码处理腾讯云小微发送的请求，返回可用于设备播放的语音文本或者发送一条卡片消息到腾讯云小微应用程序
* 在开发人员门户中，填写你的 Web 服务地址。
* 在 Skill 编辑-测试页中进行测试、或者使用启用了腾讯云小微的设备测试您的技能。您也可以使用腾讯云小微应用程序来进行测试。
* 填写发布时需要完善的信息

### 步骤5：提交认证技能
您的技能进行过充分测试后，可以提交进行认证，认证通过后，将对所有的用户可见并可使用。

## 设计一个具体的技能（彩票）
下面我们以一个彩票查询的技能作为例子，进行详细讲解。

### 设计语言交互的用户界面
一些可能的对话场景，我们可以先罗列一下：
> 用户： 小微，昨天双色球的中奖号码
  彩票： 昨天双色球的中奖号码是07 12 13 20 24 31 05

> 用户： 小微，双色球的开奖日是哪几天
  彩票： 双色球的开奖日是二、四、日

> 用户： 小微，双色球的奖池现在有多少
  彩票： 双色球的奖池现在有685895820人民币

> 用户： 帮忙购买一张双色球的彩票
  彩票： 您需要的彩票号码是多少？
  用户： 号码是 07 12 13 20 24 31 05
  彩票： 好的，你确定是要购买一张号码是 07 12 13 20 24 31 05 的双色球彩票吗？
  用户： 是的
  彩票： 已成功为您购买彩票

我们可以规划出意图
```
  QueryNumber       查询彩票中奖号码
  QueryOpenDay      查询彩票开奖日
  QueryBonusPool    查询彩票的奖金池
  BuyLottery        购买彩票
```
我们可以完善示例语句，提取出槽位信息
```
  QueryNumber {lotteryName}的开奖号码
  QueryNumber {date}的开奖号码是？
  QueryNumber {date}{lotteryName}的开奖号码
  QueryNumber 查询{date}{lotteryName}的开奖号码
  QueryNumber 告诉我{date}{lotteryName}的开奖号码
  QueryNumber 告诉我{latestIssue}{lotteryName}的开奖号码
  QueryOpenDay {lotteryName}的开奖日是哪几天？
  QueryOpenDay {lotteryName}是哪几天开奖？
  BuyLottery 帮忙购买一张{lotteryName}
  ......
```
我们可以设计这样一个对话过程
> 用户： 帮忙购买一张{lotteryName}的彩票
  彩票： 您需要的彩票号码是多少？     //{lotteryNumber}槽位问询
  用户： 号码是{lotteryNumber}     //{lotteryNumber}槽位答复语句
  彩票： 好的，你确定是要购买一张号码是{lotteryNumber}的{lotteryName}彩票吗？  //意图确认
  用户： 是的
  彩票： 已成功为你购买彩票  //执行意图，结束会话
