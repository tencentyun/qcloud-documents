
## 概述
流计算 Oceanus  + CKafka 构建异常实时检测系统：异常检测包括金融风控、设备运行监控、气象预测、入侵检测等众多应用场景，大多数情况下，及时发现异常情况，便能提前控制异常情况的蔓延，因此构建一个性能优越的异常检测系统十分重要。
腾讯云流计算 Oceanus 是基于 Apache Flink 的一个大数据实时处理流计算系统，用户可以通过定义 SQL 的方式实现业务逻辑，轻松实现毫秒级，高吞吐的消息处理。
腾讯云 CKafka 是基于 Apache Kafka 实现的一个分布式、高吞吐量、可扩展的消息队列，可用于处理监控数据聚合、日志收集、实时数据处理等场景。

## 系统架构
流计算作业使用 CKafka 作为数据输入管道，使用腾讯云关系数据库（TencentDB）作为输入数据维表，结合使用本地缓存提高作业数据处理的实时性，提高作业的吞吐量；进行 Join 计算，并通过流计算管道 CDP 将结果进行数据集成到关系数据库。
![](https://main.qcloudimg.com/raw/c159d6b28d560f50a6605f4ef4973d06.png)

## 实现方法
### Ckafka 消息队列
用于收集客户端上报的数据，例如设备 CPU、内存等监控数据，并将上报的数据发到下游的流计算 Oceanus。

### Flink 实时计算
以 CKafka，TencentDB 作为输入数据管道和维表，从 CKafka 中读取上报的需要进行异常检测的数据，从 TencentDB 中读取进行异常的阈值数据，并将读取来的数据进行比较分析（此处流计算可以使用本地缓存，将远端 TencentDB 的阈值数据写入缓存，然后进行流表和维表 Join 计算，提高计算的实时性和吞吐量），最终得出计算结果，并将计算结果写入到数据目的 CDP 中。

### CDP 数据集成
数据计算结果写入到流计算的专用数据管道 CDP 中，CDP 具有数据集成的功能，可以将结果数据集成到关系数据库 TencentDB 中，以供用户查询。

### Cache 本地缓存  
用户编写流计算作业时，可以在 SQL 中指定使用数据缓存，通过数据在本地缓存，减少与远端数据库的交互，提高作业的运行效率。
